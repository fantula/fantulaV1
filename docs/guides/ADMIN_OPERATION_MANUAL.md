# 后台功能/页面操作说明书

本文档详细描述了后台管理系统四大核心模块的操作逻辑与功能说明。

## 目录
1. [订单管理 (Order Management)](#一-订单管理)
2. [商品管理 (Product Management)](#二-商品管理)
3. [CDK资源管理 (Asset Management)](#三-cdk资源管理)
4. [优惠券营销 (Marketing)](#四-优惠券营销)

---

## 一、 订单管理

订单管理模块用于监控全站交易状态、处理售后退款及补发逻辑。

### 1.1 订单列表操作
各类型订单（虚拟充值、合租、激活码）均具备以下通用操作：
*   **搜索与筛选**: 支持按 `订单号`、`用户UID`、`商品名称` 进行精准搜索；支持按 `支付状态` (已支付/退款中等) 筛选。
*   **复制单号**: 点击订单号可直接复制到剪贴板，方便沟通查询。
*   **查看关联**: 列表页直接展示关联的 用户头像/UID、商品快照、SKU规格及优惠券抵扣金额。

### 1.2 虚拟充值订单 (`orders/recharge`)
针对 API 对接或人工充值的业务。
*   **核心字段**:
    *   **充值账号**: 用户下单时填写的充值目标（如手机号、游戏ID），存储在 `订单详情` -> `ExtInfo` 中。
    *   **状态流转**: `pending` (待支付) -> `paid` (已支付) -> `processing` (充值中) -> `completed` (到账) 或 `failed` (失败)。
*   **操作**:
    *   **详情查看**: 点击操作栏“查看”，跳转详情页查看充值日志和回调结果。
    *   **人工补单** (开发中): 如果自动充值失败，可在详情页手动修改状态为 `completed` 并备注。

### 1.3 退款管理 (`orders/refund`)
集中处理用户的退款申请。
*   **退款流程**:
    1.  用户前台申请退款。
    2.  订单进入 `refunding` (退款审核中) 状态。
    3.  后台 `退款管理` 列表显示该订单。
    4.  **审核操作**:
        *   **同意退款**: 系统自动原路退回资金（余额或支付渠道），订单变更为 `refunded`，库存释放。
        *   **拒绝退款**: 需要填写拒绝理由，订单恢复为 `paid` 或 `processing` 状态。
*   **注意事项**: 退款一旦执行不可撤销，且会触发关联的 CDK 状态回滚（如未使用）。

---

## 二、 商品管理

商品管理涵盖分类、SKU 定义及商品发布全流程。

### 2.1 分类管理 (`products/categories`)
*   **拖拽排序**: 在列表页按住 <el-icon><Rank /></el-icon> 图标拖拽即可调整分类在客户端的显示顺序。
*   **状态控制**: 可一键 `启用/停用` 分类。停用的分类下所有商品在客户端均不可见。

### 2.2 SKU 规格与库存 (`products/skus`)
*   **物理 SKU 概念**: 系统采用“物理 SKU”设计，即 SKU 是独立的库存实体，不强制依附于某一个商品。
    *   **Unlinked (未连接)**: 指未被任何商品绑定的 SKU（孤儿 SKU）。建议定期清理。
    *   **Shared (共享)**: 多个商品可绑定同一个 SKU ID，实现库存共享（如“通用会员卡”）。
*   **批量删除**: 在 SKU 列表页筛选 `未连接` 状态，可一键批量删除无用 SKU。

### 2.3 商品发布/编辑 (`products/post`)
发布商品分为三个核心板块：

#### A. 基础信息
*   **商品分类**: 必选。决定商品在首页的展示位置。
*   **上架状态**: `立即上架` 或 `暂不上架`（放入仓库）。
*   **标签**: 支持输入自定义标签（如“热销”、“特价”），回车添加。

#### B. 营销与展示
*   **展示价格**: 列表页显示的起步价（仅做展示，实际价格由 SKU 决定）。
*   **角标**: 可选 `热卖`、`新品`、`限量` 等，显示在商品图右上角。
*   **加购配置**: 勾选 `允许加购` 后，用户在详情页可选择购买数量（如购买 5 个账号）。

#### C. 商品详情 (模块化编辑)
*   **文本模块**: 支持多段文字描述。
*   **图片模块**: 支持上传多张详情图。
*   **排序**: 点击 <el-icon><ArrowUp /></el-icon> / <el-icon><ArrowDown /></el-icon> 调整模块顺序。

---

## 三、 CDK资源管理

系统核心资产管理模块，支持三种类型的资源配置。

### 3.1 资源发布流程 (`cdk/post`)
采用三步向导式创建：
1.  **选择商品与SKU**: 必须先选分类 -> 商品，再选择该资源归属的 SKU（可多选）。
2.  **配置资源**: 根据商品类型（虚拟/合租/激活码）展示不同表单。
3.  **确认添加**: 最终预览并提交入库。

### 3.2 资源类型详解

#### 类型 1: 激活码 (One-time CDK)
*   **适用场景**: 一次性卡密，如 Apple Gift Card, Netflix 独享号。
*   **批量导入**:
    *   在文本框粘贴多行卡密。
    *   点击 **【解析并校验】**。系统会自动：
        *   去除空行和过短字符。
        *   **查重**: 自动比对数据库，剔除已存在于库中的重复卡密。
        *   **统计**: 显示 `有效`、`重复`、`无效` 数量。
*   **库存逻辑**: 导入 100 条即增加 100 库存。售出一条扣减一条。

#### 类型 2: 虚拟充值 (Virtual)
*   **适用场景**: API 直充业务，如话费充值、会员直充。
*   **库存配置**: 手动输入 `可用库存数` (如 API 并发限制或额度池)。
*   **字段配置**: 定义用户下单必填项（如 `充值账号`, `归属地`）。
    *   可动态添加/删除字段。

#### 类型 3: 账号合租 (Shared Account)
*   **适用场景**: 共享账号，如 Netflix 5人车。
*   **车位管理**: 设置 `最大车位数` (Max Slots)。例如设置为 5，则该账号可被卖给 5 个人。
*   **属性配置**: 填写账号信息的键值对（如 `账号: admin`, `密码: 123456`）。
*   **库存计算**: `(最大车位数 - 已占用数) = 剩余库存`。

### 3.3 孤儿数据清理
在 CDK 列表页 (`cdk/cdks`)，选择筛选器 `未连接`，可查看到所有未绑定 SKU 的废弃资源。支持批量删除以释放数据库空间。

---

## 四、 优惠券营销

支持创建多种促销规则，提升转化率。

### 4.1 优惠券类型
*   **立减券 (Flat)**: 满减促销（如满 100 减 10）。
*   **额度券 (Balance)**: 充值卡模式（如赠送 100 元余额），用户领取后直接增加账户余额。

### 4.2 创建流程
1.  **基础规则**:
    *   **面额**: 减免金额或赠送金额。
    *   **门槛**: `最低使用金额` (0表示无门槛)。
2.  **有效期**:
    *   固定日期范围 (Start ~ End)。
    *   勾选 `永久有效` 则无截止日期。
3.  **效果预览**: 右侧实时预览优惠券样式 (红色立减券 / 金色余额券)。

### 4.3 统计与核销 (`coupons/stats`)
*   **数据监控**: 查看所有已领取的优惠券状态（已使用/已过期）。
*   **用户穿透**: 显示领取人的 `8位 UID` 和昵称。
*   **数据清理**: 仅允许删除 `已使用` 或 `已过期` 的记录，`未使用` 的有效券不可删除以保障用户资产安全。
