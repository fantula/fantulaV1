# è®¢å•è¯¦æƒ…é¡µé¢æ˜¾ç¤ºè§„èŒƒ

> **é€‚ç”¨è·¯å¾„**: `pages/profile/order/[id].vue`  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-19

---

## é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é¡¶éƒ¨ (TOP)                  â”‚
â”‚  è®¢å•åŸºç¡€ä¿¡æ¯ï¼ˆæ‰€æœ‰ç±»å‹é€šç”¨ï¼‰              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              ä¸­éƒ¨ (MIDDLE)               â”‚
â”‚  äº¤ä»˜ä¿¡æ¯ï¼ˆæ ¹æ® order_type åˆ†åˆ«æ˜¾ç¤ºï¼‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              åº•éƒ¨ (BOTTOM)               â”‚
â”‚  ä½¿ç”¨æ•™ç¨‹ï¼ˆCDK.account_data.imageï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸€ã€é¡¶éƒ¨ (TOP) - é€šç”¨

| å­—æ®µ | æ•°æ®æ¥æº |
|------|----------|
| è®¢å•å· | `orders.order_no` |
| è®¢å•çŠ¶æ€ | `orders.status` |
| å‰©ä½™å¤©æ•° | `orders.expires_at` - å½“å‰æ—¶é—´ |
| å•†å“å¤´å›¾ | `orders.product_snapshot.image` |
| å•†å“åç§° | `orders.product_snapshot.product_name` |
| SKUè§„æ ¼ | `orders.sku_snapshot.spec_combination` |
| ä¸‹å•æ—¶é—´ | `orders.created_at` |
| æ•°é‡ | `orders.quantity` |
| æ€»é‡‘é¢ | `orders.total_amount` |

---

## äºŒã€ä¸­éƒ¨ (MIDDLE) - æŒ‰ç±»å‹åŒºåˆ†

### 2.1 è™šæ‹Ÿå……å€¼ (virtual)

**ç»„ä»¶**: `FulfillmentSubmitForm.vue` + `FulfillmentHistory.vue`

#### æ˜¾ç¤ºå†…å®¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”” å›¾æ‹‰æé†’ï¼šæ‚¨è¦å¡«å†™ä»¥ä¸‹ä¿¡æ¯æ‰å¯ä»¥å“¦     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é‚®ç®±ï¼š    [è¯·è¾“å…¥å……å€¼å†…å®¹]               â”‚
â”‚  è®¢å•å·ï¼š  [è¯·è¾“å…¥å……å€¼å†…å®¹]               â”‚
â”‚  åœ°åŒºï¼š    [è¯·è¾“å…¥å……å€¼å†…å®¹]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å¡«å†™å›æ‰§] / [ä¿®æ”¹å›æ‰§] / [é‡æ–°æäº¤]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æ¥æº

| å­—æ®µ | æ¥æº | è¯´æ˜ |
|------|------|------|
| è¡¨å•å­—æ®µåˆ—è¡¨ | `cdks.code` â†’ `{"fields":["é‚®ç®±","è®¢å•å·"]}` | è§£æ JSON çš„ fields æ•°ç»„ |
| å·²æäº¤çš„å€¼ | `order_fulfillments.payload` | ç”¨æˆ·æäº¤çš„å¿«ç…§ |
| å›æ‰§çŠ¶æ€ | `order_fulfillments.status` | submitted/approved/rejected |
| é©³å›åŸå›  | `order_fulfillments.reject_reason` | ç®¡ç†å‘˜å¡«å†™ |

#### æŒ‰é’®é€»è¾‘

| å›æ‰§çŠ¶æ€ | æŒ‰é’® | æ“ä½œ |
|----------|------|------|
| æ— è®°å½• | å¡«å†™å›æ‰§ | INSERT |
| submitted | ä¿®æ”¹å›æ‰§ | UPDATE |
| rejected | é‡æ–°æäº¤ | INSERT |
| approved | å†æ¬¡æäº¤ | INSERT |

---

### 2.2 è´¦å·åˆç§Ÿ (shared_account)

**ç»„ä»¶**: `FulfillmentShared.vue`

#### æ˜¾ç¤ºå†…å®¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ äº¤ä»˜å†…å®¹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸš— ä½ç½®: 01                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è´¦å·: 11111          [å¤åˆ¶]        â”‚  â”‚
â”‚  â”‚ å¯†ç : 111111         [å¤åˆ¶]        â”‚  â”‚
â”‚  â”‚ å¤‡æ³¨: xxxxxxxx       [å¤åˆ¶]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¥ ä¸€èµ·å…±äº«çš„å‹å‹ (3äºº)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ å¤´åƒ â”‚ â”‚ å¤´åƒ â”‚ â”‚ å¤´åƒ â”‚               â”‚
â”‚  â”‚ æ˜µç§° â”‚ â”‚ æ˜µç§° â”‚ â”‚ æ˜µç§° â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æ¥æº

| å­—æ®µ | æ¥æº | è¯´æ˜ |
|------|------|------|
| è½¦ä½ä½ç½® | `slot_occupancies.slot_index` | é€šè¿‡ `orders.slot_occupancy_ids` å…³è” |
| è´¦å·/å¯†ç ç­‰ | `cdks.code` | JSON æ ¼å¼ï¼Œå¦‚ `{"è´¦å·":"xxx","å¯†ç ":"xxx"}` |
| å…±äº«ç”¨æˆ·å¤´åƒ | `profiles.avatar` | é€šè¿‡ `slot_occupancies.user_id` å…³è” |
| å…±äº«ç”¨æˆ·æ˜µç§° | `profiles.nickname` | é€šè¿‡ `slot_occupancies.user_id` å…³è” |

#### å…±äº«ç”¨æˆ·æŸ¥è¯¢

```sql
SELECT user_id, profiles(id, avatar, nickname)
FROM slot_occupancies
WHERE cdk_id = [è®¢å•å…³è”çš„CDK ID]
  AND status = 'using'
  AND user_id IS NOT NULL
```

---

### 2.3 ä¸€æ¬¡æ€§CDK (one_time_cdk)

**ç»„ä»¶**: `FulfillmentCdk.vue`

#### æ˜¾ç¤ºå†…å®¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ äº¤ä»˜å†…å®¹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¿€æ´»ç  #1                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ XXXX-XXXX-XXXX-XXXX     [å¤åˆ¶å…¨éƒ¨]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æ¥æº

| å­—æ®µ | æ¥æº |
|------|------|
| æ¿€æ´»ç å†…å®¹ | `cdks.code` |
| CDK ID | `orders.cdk_snapshot.locked_cdk_ids` |

---

## ä¸‰ã€åº•éƒ¨ (BOTTOM) - ä½¿ç”¨æ•™ç¨‹

| å­—æ®µ | æ¥æº |
|------|------|
| æ•™ç¨‹å›¾ç‰‡ | `cdks.account_data.image` æˆ– `cdks.account_data.help_image` |

**æ˜¾ç¤ºæ¡ä»¶**: ä»…åœ¨ `account_data` ä¸­å­˜åœ¨å›¾ç‰‡ URL æ—¶æ˜¾ç¤º

---

## å››ã€åº•éƒ¨æ“ä½œæ  (Action Bar)

ä½äºé¡µé¢æœ€åº•éƒ¨çš„å›ºå®šæ“ä½œæ ï¼ŒæŒ‰é’®æ ¹æ®è®¢å•çŠ¶æ€å’Œç±»å‹æ˜¾ç¤ºã€‚

| æŒ‰é’® | é€‚ç”¨ç±»å‹ | æ˜¾ç¤ºæ¡ä»¶ | æ“ä½œ |
|------|----------|----------|------|
| **è”ç³»å®¢æœ** | æ‰€æœ‰ | æ— é™åˆ¶ | æ‰“å¼€å®¢æœä¼šè¯ |
| **ç”³è¯·å·¥å•** | æ‰€æœ‰ | æ— é™åˆ¶ | è·³è½¬å·¥å•é¡µé¢ |
| **ç”³è¯·é€€æ¬¾** | virtual / shared | çŠ¶æ€ != pending | è·³è½¬é€€æ¬¾ç”³è¯· |
| **ç«‹å³ç»­è´¹** | virtual / shared | çŠ¶æ€ = active/expired | è·³è½¬ç»­è´¹é¡µé¢ |

> **æ³¨æ„**: `one_time_cdk` ç±»å‹ä¸æ”¯æŒé€€æ¬¾å’Œç»­è´¹æ“ä½œã€‚

---

## äº”ã€ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `pages/profile/order/[id].vue` | è®¢å•è¯¦æƒ…ä¸»é¡µé¢ |
| `components/order/FulfillmentSubmitForm.vue` | è™šæ‹Ÿå……å€¼å›æ‰§è¡¨å• |
| `components/order/FulfillmentHistory.vue` | å›æ‰§å†å²è®°å½• |
| `components/order/FulfillmentShared.vue` | è´¦å·åˆç§Ÿæ˜¾ç¤º |
| `components/order/FulfillmentCdk.vue` | ä¸€æ¬¡æ€§CDKæ˜¾ç¤º |
| `api/client/order.ts` | è®¢å•API |
