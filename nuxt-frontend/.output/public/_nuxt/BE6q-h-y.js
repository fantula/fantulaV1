import{dM as n}from"./gYbOYKrZ.js";const l={async getAllSkus(a){let t=n().from("product_skus").select("*, product_sku_map(product_id)",{count:"exact"}).is("tag",null);const{data:u,error:r}=await t;if(r)return{success:!1,error:r.message};let e=u.map(c=>{const o=c.product_sku_map||[];return{...c,is_linked:o.length>0,linked_count:o.length}});return a?.showUnlinkedOnly&&(e=e.filter(c=>!c.is_linked)),e.sort((c,o)=>new Date(o.created_at).getTime()-new Date(c.created_at).getTime()),{success:!0,skus:e}},async deleteSkus(a){const s=n();await s.from("cdk_sku_map").delete().in("sku_id",a),await s.from("product_sku_map").delete().in("sku_id",a);const{error:t}=await s.from("product_skus").delete().in("id",a);return t?{success:!1,error:t.message}:{success:!0}},async getSharedSkuGroups(){const a=n(),{data:s,error:t}=await a.from("product_skus").select("*").not("tag","is",null).order("tag",{ascending:!0}).order("sort_order",{ascending:!0});if(t)return{success:!1,groups:[],error:t.message};if(!s||s.length===0)return{success:!0,groups:[]};const u=new Map;return s.forEach(r=>{const e=r.tag;u.has(e)||u.set(e,{tag:e,tag_name:r.tag_name||`Group #${e}`,created_at:r.created_at,skus:[]}),u.get(e).skus.push(r)}),{success:!0,groups:Array.from(u.values())}},async getProductsBySharedTag(a){const s=n(),{data:t}=await s.from("product_skus").select("id").eq("tag",a);if(!t||!t.length)return{success:!0,products:[]};const u=t.map(d=>d.id),{data:r,error:e}=await s.from("product_sku_map").select("product_id").in("sku_id",u);if(e)return{success:!1,error:e.message};if(!r||!r.length)return{success:!0,products:[]};const c=[...new Set(r.map(d=>d.product_id))],{data:o,error:i}=await s.from("products").select("id, product_name, image, display_price, status").in("id",c);return i?{success:!1,error:i.message}:{success:!0,products:o||[]}}};export{l as a};
