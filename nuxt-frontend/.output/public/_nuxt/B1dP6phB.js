import{ad as i}from"./CEI0siaN.js";const _={async create(t,c,s,r,n=[]){const a=i(),{data:e,error:d}=await a.rpc("create_ticket",{p_order_id:t,p_title:c,p_content:s,p_priority:r,p_attachments:n});if(d)return{success:!1,error:d.message};const o=e;return o.success?{success:!0,ticketId:o.ticket_id}:{success:!1,error:o.error}},async getList(t="all"){let s=i().from("tickets").select("*, orders(order_no, product_snapshot), ticket_messages(content)").order("created_at",{ascending:!1});t!=="all"&&(s=s.eq("status",t));const{data:r,error:n}=await s;return n?{success:!1,data:[],error:n.message}:{success:!0,data:r?.map(e=>({...e,last_message:e.ticket_messages?.[0]?.content||""}))||[]}},async getDetail(t){const c=i(),{data:s,error:r}=await c.from("tickets").select("*, orders(id, order_no, product_snapshot)").eq("id",t).single();if(r)return{success:!1,error:r.message};const{data:n,error:a}=await c.from("ticket_messages").select("*, sender_id, is_admin").eq("ticket_id",t).order("created_at",{ascending:!0});return a?{success:!1,error:a.message}:{success:!0,data:{...s,replies:n?.map(e=>({id:e.id,sender:e.is_admin?"admin":"user",content:e.content,attachments:e.attachments,time:e.created_at}))||[]}}},async reply(t,c,s=[]){const r=i(),{data:n,error:a}=await r.rpc("send_ticket_message",{p_ticket_id:t,p_content:c,p_attachments:s});return a?{success:!1,error:a.message}:{success:!0}}};export{_ as t};
