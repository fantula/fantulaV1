import{f as V,r as n,h as U,c as k,a as h,i as X,b as a,w as i,l as z,B as p,C as j,o as B,d as l,E as q,p as F,aD as R,t as d,_ as G}from"./gYbOYKrZ.js";import{E as H}from"./CswOF4xx.js";import{a as J,E as K}from"./Dj2lpOJg.js";import{E as O}from"./CxsxdZaY.js";import{E as Q}from"./BxcDqkou.js";import{E as W}from"./Cq19oc2c.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{b as u}from"./DkGBDzDg.js";import{v as Y}from"./CUySdIcD.js";import{E as Z}from"./DK0lTgRd.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./BSx1rCp4.js";import"./Cq9Fpw4b.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./CaswxL1d.js";import"./BlcygIWm.js";import"./Bh6H2ams.js";import"./CUkNyi1D.js";import"./pxhmPWjv.js";import"./-tO7MSA0.js";import"./CrRq4wwb.js";import"./C5EOtA6j.js";import"./BPYHQo7_.js";import"./Cr8dt13I.js";import"./DtgOm6Sf.js";import"./BB_Ol6Sd.js";import"./BYT9QUPE.js";import"./Djfz0t-N.js";import"./DxwfhIR6.js";import"./BNtqh2Az.js";import"./CdHOYNgq.js";import"./B-n2-D39.js";import"./DrogL690.js";import"./YvAJPawC.js";import"./CqTJWtX6.js";import"./DEN0lkI5.js";import"./gVImYNNu.js";const tt={class:"admin-page"},et={class:"page-actions"},ot={class:"table-container"},at={class:"pagination-container"},rt=V({__name:"articles",setup(it){const y=j(),_=n(!1),b=n([]),w=n(0),g=n(1),f=n(20),v=n([]),D=e=>new Date(e).toLocaleString(),S=e=>{const t=v.value.find(r=>r.id===e);return t?t.name:e||"未分类"},C=e=>{const t=v.value.find(r=>r.id===e);return t?t.color:"var(--el-text-color-secondary)"},T=async()=>{try{const{data:e}=await u.getCategories();v.value=e||[]}catch(e){console.error("Failed to fetch categories",e)}},c=async()=>{_.value=!0;try{const{data:e,total:t,error:r}=await u.getArticles(g.value,f.value);if(r)throw r;b.value=e||[],w.value=t||0}catch(e){p.error("获取列表失败: "+e.message)}finally{_.value=!1}},A=e=>{y.push({path:"/_mgmt_9Xfa3/help-center/articles/post",query:{id:e.id}})},I=async e=>{const t=!e.is_published;try{const{error:r}=await u.updateArticle(e.id,{is_published:t});if(r)throw r;e.is_published=t,p.success(t?"已发布":"已下架")}catch(r){p.error("操作失败: "+r.message)}},P=e=>{Z.confirm("确定要删除这篇文章吗？此类操作不可恢复","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const{error:t}=await u.deleteArticle(e.id);if(t)throw t;p.success("删除成功"),c()}catch(t){p.error("删除失败: "+t.message)}})};return U(async()=>{await T(),await c()}),(e,t)=>{const r=q,m=H,s=K,$=O,E=Q,L=J,M=W,N=Y;return B(),k("div",tt,[h("div",et,[a(m,{type:"primary",onClick:t[0]||(t[0]=o=>z(y).push("/_mgmt_9Xfa3/help-center/articles/post"))},{default:i(()=>[a(r,{class:"mr-1"},{default:i(()=>[a(z(F))]),_:1}),t[3]||(t[3]=l(" 发布文章 ",-1))]),_:1})]),t[6]||(t[6]=h("div",{class:"filter-section"},null,-1)),X((B(),k("div",ot,[a(L,{data:b.value,border:"",style:{width:"100%"}},{default:i(()=>[a(s,{prop:"id",label:"ID",width:"180","show-overflow-tooltip":""}),a(s,{label:"封面",width:"100"},{default:i(({row:o})=>[a($,{style:{width:"60px",height:"40px","border-radius":"4px"},src:o.cover_image,"preview-src-list":[o.cover_image],fit:"cover"},null,8,["src","preview-src-list"])]),_:1}),a(s,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),a(s,{prop:"category",label:"分类",width:"140"},{default:i(({row:o})=>[a(E,{style:R({borderColor:C(o.category),color:C(o.category),backgroundColor:"transparent"}),effect:"plain"},{default:i(()=>[l(d(S(o.category)),1)]),_:2},1032,["style"])]),_:1}),a(s,{prop:"views",label:"阅读量",width:"100"}),a(s,{label:"状态",width:"100"},{default:i(({row:o})=>[a(E,{type:o.is_published?"success":"info"},{default:i(()=>[l(d(o.is_published?"已发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),a(s,{prop:"created_at",label:"创建时间",width:"180"},{default:i(({row:o})=>[l(d(D(o.created_at)),1)]),_:1}),a(s,{label:"操作",width:"200",fixed:"right"},{default:i(({row:o})=>[a(m,{link:"",type:"primary",onClick:x=>A(o)},{default:i(()=>[...t[4]||(t[4]=[l("编辑",-1)])]),_:1},8,["onClick"]),a(m,{link:"",type:"success",onClick:x=>I(o)},{default:i(()=>[l(d(o.is_published?"下架":"发布"),1)]),_:2},1032,["onClick"]),a(m,{link:"",type:"danger",onClick:x=>P(o)},{default:i(()=>[...t[5]||(t[5]=[l("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),h("div",at,[a(M,{"current-page":g.value,"onUpdate:currentPage":t[1]||(t[1]=o=>g.value=o),"page-size":f.value,"onUpdate:pageSize":t[2]||(t[2]=o=>f.value=o),total:w.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])])),[[N,_.value]])])}}}),ae=G(rt,[["__scopeId","data-v-e699d3ba"]]);export{ae as default};
