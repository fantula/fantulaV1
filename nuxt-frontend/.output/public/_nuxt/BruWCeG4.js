const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BAJNIM6A.js","./C-2dxbDp.js","./92s3wAHG.js","./BlcygIWm.js","./gYbOYKrZ.js","./entry.DI7xQWfr.css","./BB_Ol6Sd.js","./BPU0QgcX.js","./CqTJWtX6.js","./DrogL690.js","./BdJc3h2o.js","./C3yI_83l.js","./BNtqh2Az.js","./D4AXxtJy.js","./Dnj8X3EN.js","./Bh6H2ams.js","./Cq9Fpw4b.js","./CaswxL1d.js","./CUkNyi1D.js","./DSGcGbHT.js","./CswOF4xx.js","./el-button.C18MJXp0.css","./CjhxNRX1.js","./CXRW75i2.js","./CoqpTYH6.js","./CxsxdZaY.js","./Djfz0t-N.js","./DxwfhIR6.js","./BYT9QUPE.js","./BPYHQo7_.js","./Cr8dt13I.js","./BxcDqkou.js","./BSx1rCp4.js","./DtgOm6Sf.js","./-tO7MSA0.js","./pxhmPWjv.js","./Dej0q2Sz.js","./CrM0zeZk.js","./DILJPjji.js","./Dl4E2L6n.js","./C5EOtA6j.js","./D6FW0B1r.js","./YvAJPawC.js","./DBymc828.js","./DR2PtzNo.js","./MkrgA_tt.js","./X-MfRVD6.js","./qZy57oqE.js","./DEN0lkI5.js","./CzVV9LeR.js","./BpJTCjS8.js","./BO6-pa8Z.js","./A8Zj-15Y.js","./B94kvl1B.js","./Cq19oc2c.js","./CdHOYNgq.js","./B-n2-D39.js","./CrRq4wwb.js","./Bzz8SiwP.js","./CFTg8q6G.js","./DF9y0dYJ.js","./DTPsCTYH.js","./DHvcgjJz.js","./Di9v79cN.js","./gVImYNNu.js","./Dj2lpOJg.js","./Df-HzxCI.js","./CUySdIcD.js","./DK0lTgRd.js"])))=>i.map(i=>d[i]);
import{f as nt,r as T,J as _t,g as q,ab as Rt,G as dt,ac as Jt,w as _,ad as qe,B as E,o as B,a as u,c as H,b as D,l as Y,ae as Ze,E as Se,d as rt,af as Qe,F as Je,k as ta,n as te,D as Ct,ag as ea,K as aa,_ as bt,aa as j,i as ct,v as pt,j as ia,h as Bt,ah as Ie,t as J,ai as sa,aj as ee,ak as ra,al as na,z as Te,am as oa,x as la,an as ca,ao as ua,ap as da,aq as he,ar as ha,as as fa,at as va,au as pa,av as ma,L as Wt,aw as ga,Y as ba,ax as wa}from"./gYbOYKrZ.js";/* empty css        */import{E as ya}from"./CswOF4xx.js";/* empty css        *//* empty css        */import{C as A}from"./DMM0XfB1.js";import{B as ae}from"./Cqtiwte7.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";function fe(s,t){var a=Object.keys(s);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(s);t&&(e=e.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),a.push.apply(a,e)}return a}function Ne(s){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?fe(Object(a),!0).forEach(function(e){Ma(s,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):fe(Object(a)).forEach(function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(a,e))})}return s}function Da(s,t){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var e=a.call(s,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function ke(s){var t=Da(s,"string");return typeof t=="symbol"?t:t+""}function Xt(s){"@babel/helpers - typeof";return Xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xt(s)}function Ea(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(s,t){for(var a=0;a<t.length;a++){var e=t[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,ke(e.key),e)}}function xa(s,t,a){return t&&ve(s.prototype,t),a&&ve(s,a),Object.defineProperty(s,"prototype",{writable:!1}),s}function Ma(s,t,a){return t=ke(t),t in s?Object.defineProperty(s,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[t]=a,s}function Le(s){return Ca(s)||Aa(s)||Oa(s)||_a()}function Ca(s){if(Array.isArray(s))return Ht(s)}function Aa(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function Oa(s,t){if(s){if(typeof s=="string")return Ht(s,t);var a=Object.prototype.toString.call(s).slice(8,-1);if(a==="Object"&&s.constructor&&(a=s.constructor.name),a==="Map"||a==="Set")return Array.from(s);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ht(s,t)}}function Ht(s,t){(t==null||t>s.length)&&(t=s.length);for(var a=0,e=new Array(t);a<t;a++)e[a]=s[a];return e}function _a(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Pt=typeof window<"u"&&typeof window.document<"u",et=Pt?window:{},ie=Pt&&et.document.documentElement?"ontouchstart"in et.document.documentElement:!1,se=Pt?"PointerEvent"in et:!1,L="cropper",re="all",Re="crop",Be="move",Pe="zoom",ot="e",lt="w",ht="s",at="n",yt="ne",Dt="nw",Et="se",xt="sw",Vt="".concat(L,"-crop"),pe="".concat(L,"-disabled"),G="".concat(L,"-hidden"),me="".concat(L,"-hide"),Sa="".concat(L,"-invisible"),Lt="".concat(L,"-modal"),Ft="".concat(L,"-move"),At="".concat(L,"Action"),St="".concat(L,"Preview"),ne="crop",$e="move",Ue="none",Gt="crop",jt="cropend",Kt="cropmove",qt="cropstart",ge="dblclick",Ia=ie?"touchstart":"mousedown",Ta=ie?"touchmove":"mousemove",Na=ie?"touchend touchcancel":"mouseup",be=se?"pointerdown":Ia,we=se?"pointermove":Ta,ye=se?"pointerup pointercancel":Na,De="ready",Ee="resize",xe="wheel",Zt="zoom",Me="image/jpeg",ka=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,La=/^data:/,Ra=/^data:image\/jpeg;base64,/,Ba=/^img|canvas$/i,We=200,Ye=100,Ce={viewMode:0,dragMode:ne,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:We,minContainerHeight:Ye,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Pa='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',$a=Number.isNaN||et.isNaN;function C(s){return typeof s=="number"&&!$a(s)}var Ae=function(t){return t>0&&t<1/0};function Yt(s){return typeof s>"u"}function ut(s){return Xt(s)==="object"&&s!==null}var Ua=Object.prototype.hasOwnProperty;function ft(s){if(!ut(s))return!1;try{var t=s.constructor,a=t.prototype;return t&&a&&Ua.call(a,"isPrototypeOf")}catch{return!1}}function F(s){return typeof s=="function"}var Wa=Array.prototype.slice;function ze(s){return Array.from?Array.from(s):Wa.call(s)}function $(s,t){return s&&F(t)&&(Array.isArray(s)||C(s.length)?ze(s).forEach(function(a,e){t.call(s,a,e,s)}):ut(s)&&Object.keys(s).forEach(function(a){t.call(s,s[a],a,s)})),s}var R=Object.assign||function(t){for(var a=arguments.length,e=new Array(a>1?a-1:0),r=1;r<a;r++)e[r-1]=arguments[r];return ut(t)&&e.length>0&&e.forEach(function(i){ut(i)&&Object.keys(i).forEach(function(n){t[n]=i[n]})}),t},Ya=/\.\d*(?:0|9){12}\d*$/;function mt(s){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Ya.test(s)?Math.round(s*t)/t:s}var za=/^width|height|left|top|marginLeft|marginTop$/;function it(s,t){var a=s.style;$(t,function(e,r){za.test(r)&&C(e)&&(e="".concat(e,"px")),a[r]=e})}function Xa(s,t){return s.classList?s.classList.contains(t):s.className.indexOf(t)>-1}function z(s,t){if(t){if(C(s.length)){$(s,function(e){z(e,t)});return}if(s.classList){s.classList.add(t);return}var a=s.className.trim();a?a.indexOf(t)<0&&(s.className="".concat(a," ").concat(t)):s.className=t}}function tt(s,t){if(t){if(C(s.length)){$(s,function(a){tt(a,t)});return}if(s.classList){s.classList.remove(t);return}s.className.indexOf(t)>=0&&(s.className=s.className.replace(t,""))}}function vt(s,t,a){if(t){if(C(s.length)){$(s,function(e){vt(e,t,a)});return}a?z(s,t):tt(s,t)}}var Ha=/([a-z\d])([A-Z])/g;function oe(s){return s.replace(Ha,"$1-$2").toLowerCase()}function Qt(s,t){return ut(s[t])?s[t]:s.dataset?s.dataset[t]:s.getAttribute("data-".concat(oe(t)))}function Ot(s,t,a){ut(a)?s[t]=a:s.dataset?s.dataset[t]=a:s.setAttribute("data-".concat(oe(t)),a)}function Va(s,t){if(ut(s[t]))try{delete s[t]}catch{s[t]=void 0}else if(s.dataset)try{delete s.dataset[t]}catch{s.dataset[t]=void 0}else s.removeAttribute("data-".concat(oe(t)))}var Xe=/\s\s*/,He=(function(){var s=!1;if(Pt){var t=!1,a=function(){},e=Object.defineProperty({},"once",{get:function(){return s=!0,t},set:function(i){t=i}});et.addEventListener("test",a,e),et.removeEventListener("test",a,e)}return s})();function Q(s,t,a){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},r=a;t.trim().split(Xe).forEach(function(i){if(!He){var n=s.listeners;n&&n[i]&&n[i][a]&&(r=n[i][a],delete n[i][a],Object.keys(n[i]).length===0&&delete n[i],Object.keys(n).length===0&&delete s.listeners)}s.removeEventListener(i,r,e)})}function K(s,t,a){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},r=a;t.trim().split(Xe).forEach(function(i){if(e.once&&!He){var n=s.listeners,o=n===void 0?{}:n;r=function(){delete o[i][a],s.removeEventListener(i,r,e);for(var f=arguments.length,c=new Array(f),d=0;d<f;d++)c[d]=arguments[d];a.apply(s,c)},o[i]||(o[i]={}),o[i][a]&&s.removeEventListener(i,o[i][a],e),o[i][a]=r,s.listeners=o}s.addEventListener(i,r,e)})}function gt(s,t,a){var e;return F(Event)&&F(CustomEvent)?e=new CustomEvent(t,{detail:a,bubbles:!0,cancelable:!0}):(e=document.createEvent("CustomEvent"),e.initCustomEvent(t,!0,!0,a)),s.dispatchEvent(e)}function Ve(s){var t=s.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var zt=et.location,Fa=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Oe(s){var t=s.match(Fa);return t!==null&&(t[1]!==zt.protocol||t[2]!==zt.hostname||t[3]!==zt.port)}function _e(s){var t="timestamp=".concat(new Date().getTime());return s+(s.indexOf("?")===-1?"?":"&")+t}function Mt(s){var t=s.rotate,a=s.scaleX,e=s.scaleY,r=s.translateX,i=s.translateY,n=[];C(r)&&r!==0&&n.push("translateX(".concat(r,"px)")),C(i)&&i!==0&&n.push("translateY(".concat(i,"px)")),C(t)&&t!==0&&n.push("rotate(".concat(t,"deg)")),C(a)&&a!==1&&n.push("scaleX(".concat(a,")")),C(e)&&e!==1&&n.push("scaleY(".concat(e,")"));var o=n.length?n.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function Ga(s){var t=Ne({},s),a=0;return $(s,function(e,r){delete t[r],$(t,function(i){var n=Math.abs(e.startX-i.startX),o=Math.abs(e.startY-i.startY),h=Math.abs(e.endX-i.endX),f=Math.abs(e.endY-i.endY),c=Math.sqrt(n*n+o*o),d=Math.sqrt(h*h+f*f),v=(d-c)/c;Math.abs(v)>Math.abs(a)&&(a=v)})}),a}function It(s,t){var a=s.pageX,e=s.pageY,r={endX:a,endY:e};return t?r:Ne({startX:a,startY:e},r)}function ja(s){var t=0,a=0,e=0;return $(s,function(r){var i=r.startX,n=r.startY;t+=i,a+=n,e+=1}),t/=e,a/=e,{pageX:t,pageY:a}}function st(s){var t=s.aspectRatio,a=s.height,e=s.width,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",i=Ae(e),n=Ae(a);if(i&&n){var o=a*t;r==="contain"&&o>e||r==="cover"&&o<e?a=e/t:e=a*t}else i?a=e/t:n&&(e=a*t);return{width:e,height:a}}function Ka(s){var t=s.width,a=s.height,e=s.degree;if(e=Math.abs(e)%180,e===90)return{width:a,height:t};var r=e%90*Math.PI/180,i=Math.sin(r),n=Math.cos(r),o=t*n+a*i,h=t*i+a*n;return e>90?{width:h,height:o}:{width:o,height:h}}function qa(s,t,a,e){var r=t.aspectRatio,i=t.naturalWidth,n=t.naturalHeight,o=t.rotate,h=o===void 0?0:o,f=t.scaleX,c=f===void 0?1:f,d=t.scaleY,v=d===void 0?1:d,l=a.aspectRatio,m=a.naturalWidth,w=a.naturalHeight,y=e.fillColor,S=y===void 0?"transparent":y,k=e.imageSmoothingEnabled,I=k===void 0?!0:k,b=e.imageSmoothingQuality,g=b===void 0?"low":b,p=e.maxWidth,x=p===void 0?1/0:p,P=e.maxHeight,V=P===void 0?1/0:P,O=e.minWidth,M=O===void 0?0:O,U=e.minHeight,X=U===void 0?0:U,W=document.createElement("canvas"),N=W.getContext("2d"),Z=st({aspectRatio:l,width:x,height:V}),wt=st({aspectRatio:l,width:M,height:X},"cover"),$t=Math.min(Z.width,Math.max(wt.width,m)),Ut=Math.min(Z.height,Math.max(wt.height,w)),le=st({aspectRatio:r,width:x,height:V}),ce=st({aspectRatio:r,width:M,height:X},"cover"),ue=Math.min(le.width,Math.max(ce.width,i)),de=Math.min(le.height,Math.max(ce.height,n)),je=[-ue/2,-de/2,ue,de];return W.width=mt($t),W.height=mt(Ut),N.fillStyle=S,N.fillRect(0,0,$t,Ut),N.save(),N.translate($t/2,Ut/2),N.rotate(h*Math.PI/180),N.scale(c,v),N.imageSmoothingEnabled=I,N.imageSmoothingQuality=g,N.drawImage.apply(N,[s].concat(Le(je.map(function(Ke){return Math.floor(mt(Ke))})))),N.restore(),W}var Fe=String.fromCharCode;function Za(s,t,a){var e="";a+=t;for(var r=t;r<a;r+=1)e+=Fe(s.getUint8(r));return e}var Qa=/^data:.*,/;function Ja(s){var t=s.replace(Qa,""),a=atob(t),e=new ArrayBuffer(a.length),r=new Uint8Array(e);return $(r,function(i,n){r[n]=a.charCodeAt(n)}),e}function ti(s,t){for(var a=[],e=8192,r=new Uint8Array(s);r.length>0;)a.push(Fe.apply(null,ze(r.subarray(0,e)))),r=r.subarray(e);return"data:".concat(t,";base64,").concat(btoa(a.join("")))}function ei(s){var t=new DataView(s),a;try{var e,r,i;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var n=t.byteLength,o=2;o+1<n;){if(t.getUint8(o)===255&&t.getUint8(o+1)===225){r=o;break}o+=1}if(r){var h=r+4,f=r+10;if(Za(t,h,4)==="Exif"){var c=t.getUint16(f);if(e=c===18761,(e||c===19789)&&t.getUint16(f+2,e)===42){var d=t.getUint32(f+4,e);d>=8&&(i=f+d)}}}if(i){var v=t.getUint16(i,e),l,m;for(m=0;m<v;m+=1)if(l=i+m*12+2,t.getUint16(l,e)===274){l+=8,a=t.getUint16(l,e),t.setUint16(l,1,e);break}}}catch{a=1}return a}function ai(s){var t=0,a=1,e=1;switch(s){case 2:a=-1;break;case 3:t=-180;break;case 4:e=-1;break;case 5:t=90,e=-1;break;case 6:t=90;break;case 7:t=90,a=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:a,scaleY:e}}var ii={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,a=this.options,e=this.container,r=this.cropper,i=Number(a.minContainerWidth),n=Number(a.minContainerHeight);z(r,G),tt(t,G);var o={width:Math.max(e.offsetWidth,i>=0?i:We),height:Math.max(e.offsetHeight,n>=0?n:Ye)};this.containerData=o,it(r,{width:o.width,height:o.height}),z(t,G),tt(r,G)},initCanvas:function(){var t=this.containerData,a=this.imageData,e=this.options.viewMode,r=Math.abs(a.rotate)%180===90,i=r?a.naturalHeight:a.naturalWidth,n=r?a.naturalWidth:a.naturalHeight,o=i/n,h=t.width,f=t.height;t.height*o>t.width?e===3?h=t.height*o:f=t.width/o:e===3?f=t.width/o:h=t.height*o;var c={aspectRatio:o,naturalWidth:i,naturalHeight:n,width:h,height:f};this.canvasData=c,this.limited=e===1||e===2,this.limitCanvas(!0,!0),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),c.left=(t.width-c.width)/2,c.top=(t.height-c.height)/2,c.oldLeft=c.left,c.oldTop=c.top,this.initialCanvasData=R({},c)},limitCanvas:function(t,a){var e=this.options,r=this.containerData,i=this.canvasData,n=this.cropBoxData,o=e.viewMode,h=i.aspectRatio,f=this.cropped&&n;if(t){var c=Number(e.minCanvasWidth)||0,d=Number(e.minCanvasHeight)||0;o>1?(c=Math.max(c,r.width),d=Math.max(d,r.height),o===3&&(d*h>c?c=d*h:d=c/h)):o>0&&(c?c=Math.max(c,f?n.width:0):d?d=Math.max(d,f?n.height:0):f&&(c=n.width,d=n.height,d*h>c?c=d*h:d=c/h));var v=st({aspectRatio:h,width:c,height:d});c=v.width,d=v.height,i.minWidth=c,i.minHeight=d,i.maxWidth=1/0,i.maxHeight=1/0}if(a)if(o>(f?0:1)){var l=r.width-i.width,m=r.height-i.height;i.minLeft=Math.min(0,l),i.minTop=Math.min(0,m),i.maxLeft=Math.max(0,l),i.maxTop=Math.max(0,m),f&&this.limited&&(i.minLeft=Math.min(n.left,n.left+(n.width-i.width)),i.minTop=Math.min(n.top,n.top+(n.height-i.height)),i.maxLeft=n.left,i.maxTop=n.top,o===2&&(i.width>=r.width&&(i.minLeft=Math.min(0,l),i.maxLeft=Math.max(0,l)),i.height>=r.height&&(i.minTop=Math.min(0,m),i.maxTop=Math.max(0,m))))}else i.minLeft=-i.width,i.minTop=-i.height,i.maxLeft=r.width,i.maxTop=r.height},renderCanvas:function(t,a){var e=this.canvasData,r=this.imageData;if(a){var i=Ka({width:r.naturalWidth*Math.abs(r.scaleX||1),height:r.naturalHeight*Math.abs(r.scaleY||1),degree:r.rotate||0}),n=i.width,o=i.height,h=e.width*(n/e.naturalWidth),f=e.height*(o/e.naturalHeight);e.left-=(h-e.width)/2,e.top-=(f-e.height)/2,e.width=h,e.height=f,e.aspectRatio=n/o,e.naturalWidth=n,e.naturalHeight=o,this.limitCanvas(!0,!1)}(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCanvas(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,it(this.canvas,R({width:e.width,height:e.height},Mt({translateX:e.left,translateY:e.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var a=this.canvasData,e=this.imageData,r=e.naturalWidth*(a.width/a.naturalWidth),i=e.naturalHeight*(a.height/a.naturalHeight);R(e,{width:r,height:i,left:(a.width-r)/2,top:(a.height-i)/2}),it(this.image,R({width:e.width,height:e.height},Mt(R({translateX:e.left,translateY:e.top},e)))),t&&this.output()},initCropBox:function(){var t=this.options,a=this.canvasData,e=t.aspectRatio||t.initialAspectRatio,r=Number(t.autoCropArea)||.8,i={width:a.width,height:a.height};e&&(a.height*e>a.width?i.height=i.width/e:i.width=i.height*e),this.cropBoxData=i,this.limitCropBox(!0,!0),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),i.width=Math.max(i.minWidth,i.width*r),i.height=Math.max(i.minHeight,i.height*r),i.left=a.left+(a.width-i.width)/2,i.top=a.top+(a.height-i.height)/2,i.oldLeft=i.left,i.oldTop=i.top,this.initialCropBoxData=R({},i)},limitCropBox:function(t,a){var e=this.options,r=this.containerData,i=this.canvasData,n=this.cropBoxData,o=this.limited,h=e.aspectRatio;if(t){var f=Number(e.minCropBoxWidth)||0,c=Number(e.minCropBoxHeight)||0,d=o?Math.min(r.width,i.width,i.width+i.left,r.width-i.left):r.width,v=o?Math.min(r.height,i.height,i.height+i.top,r.height-i.top):r.height;f=Math.min(f,r.width),c=Math.min(c,r.height),h&&(f&&c?c*h>f?c=f/h:f=c*h:f?c=f/h:c&&(f=c*h),v*h>d?v=d/h:d=v*h),n.minWidth=Math.min(f,d),n.minHeight=Math.min(c,v),n.maxWidth=d,n.maxHeight=v}a&&(o?(n.minLeft=Math.max(0,i.left),n.minTop=Math.max(0,i.top),n.maxLeft=Math.min(r.width,i.left+i.width)-n.width,n.maxTop=Math.min(r.height,i.top+i.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=r.width-n.width,n.maxTop=r.height-n.height))},renderCropBox:function(){var t=this.options,a=this.containerData,e=this.cropBoxData;(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCropBox(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,t.movable&&t.cropBoxMovable&&Ot(this.face,At,e.width>=a.width&&e.height>=a.height?Be:re),it(this.cropBox,R({width:e.width,height:e.height},Mt({translateX:e.left,translateY:e.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),gt(this.element,Gt,this.getData())}},si={initPreview:function(){var t=this.element,a=this.crossOrigin,e=this.options.preview,r=a?this.crossOriginUrl:this.url,i=t.alt||"The image to preview",n=document.createElement("img");if(a&&(n.crossOrigin=a),n.src=r,n.alt=i,this.viewBox.appendChild(n),this.viewBoxImage=n,!!e){var o=e;typeof e=="string"?o=t.ownerDocument.querySelectorAll(e):e.querySelector&&(o=[e]),this.previews=o,$(o,function(h){var f=document.createElement("img");Ot(h,St,{width:h.offsetWidth,height:h.offsetHeight,html:h.innerHTML}),a&&(f.crossOrigin=a),f.src=r,f.alt=i,f.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',h.innerHTML="",h.appendChild(f)})}},resetPreview:function(){$(this.previews,function(t){var a=Qt(t,St);it(t,{width:a.width,height:a.height}),t.innerHTML=a.html,Va(t,St)})},preview:function(){var t=this.imageData,a=this.canvasData,e=this.cropBoxData,r=e.width,i=e.height,n=t.width,o=t.height,h=e.left-a.left-t.left,f=e.top-a.top-t.top;!this.cropped||this.disabled||(it(this.viewBoxImage,R({width:n,height:o},Mt(R({translateX:-h,translateY:-f},t)))),$(this.previews,function(c){var d=Qt(c,St),v=d.width,l=d.height,m=v,w=l,y=1;r&&(y=v/r,w=i*y),i&&w>l&&(y=l/i,m=r*y,w=l),it(c,{width:m,height:w}),it(c.getElementsByTagName("img")[0],R({width:n*y,height:o*y},Mt(R({translateX:-h*y,translateY:-f*y},t))))}))}},ri={bind:function(){var t=this.element,a=this.options,e=this.cropper;F(a.cropstart)&&K(t,qt,a.cropstart),F(a.cropmove)&&K(t,Kt,a.cropmove),F(a.cropend)&&K(t,jt,a.cropend),F(a.crop)&&K(t,Gt,a.crop),F(a.zoom)&&K(t,Zt,a.zoom),K(e,be,this.onCropStart=this.cropStart.bind(this)),a.zoomable&&a.zoomOnWheel&&K(e,xe,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&K(e,ge,this.onDblclick=this.dblclick.bind(this)),K(t.ownerDocument,we,this.onCropMove=this.cropMove.bind(this)),K(t.ownerDocument,ye,this.onCropEnd=this.cropEnd.bind(this)),a.responsive&&K(window,Ee,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,a=this.options,e=this.cropper;F(a.cropstart)&&Q(t,qt,a.cropstart),F(a.cropmove)&&Q(t,Kt,a.cropmove),F(a.cropend)&&Q(t,jt,a.cropend),F(a.crop)&&Q(t,Gt,a.crop),F(a.zoom)&&Q(t,Zt,a.zoom),Q(e,be,this.onCropStart),a.zoomable&&a.zoomOnWheel&&Q(e,xe,this.onWheel,{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&Q(e,ge,this.onDblclick),Q(t.ownerDocument,we,this.onCropMove),Q(t.ownerDocument,ye,this.onCropEnd),a.responsive&&Q(window,Ee,this.onResize)}},ni={resize:function(){if(!this.disabled){var t=this.options,a=this.container,e=this.containerData,r=a.offsetWidth/e.width,i=a.offsetHeight/e.height,n=Math.abs(r-1)>Math.abs(i-1)?r:i;if(n!==1){var o,h;t.restore&&(o=this.getCanvasData(),h=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData($(o,function(f,c){o[c]=f*n})),this.setCropBoxData($(h,function(f,c){h[c]=f*n})))}}},dblclick:function(){this.disabled||this.options.dragMode===Ue||this.setDragMode(Xa(this.dragBox,Vt)?$e:ne)},wheel:function(t){var a=this,e=Number(this.options.wheelZoomRatio)||.1,r=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){a.wheeling=!1},50),t.deltaY?r=t.deltaY>0?1:-1:t.wheelDelta?r=-t.wheelDelta/120:t.detail&&(r=t.detail>0?1:-1),this.zoom(-r*e,t)))},cropStart:function(t){var a=t.buttons,e=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(C(a)&&a!==1||C(e)&&e!==0||t.ctrlKey))){var r=this.options,i=this.pointers,n;t.changedTouches?$(t.changedTouches,function(o){i[o.identifier]=It(o)}):i[t.pointerId||0]=It(t),Object.keys(i).length>1&&r.zoomable&&r.zoomOnTouch?n=Pe:n=Qt(t.target,At),ka.test(n)&&gt(this.element,qt,{originalEvent:t,action:n})!==!1&&(t.preventDefault(),this.action=n,this.cropping=!1,n===Re&&(this.cropping=!0,z(this.dragBox,Lt)))}},cropMove:function(t){var a=this.action;if(!(this.disabled||!a)){var e=this.pointers;t.preventDefault(),gt(this.element,Kt,{originalEvent:t,action:a})!==!1&&(t.changedTouches?$(t.changedTouches,function(r){R(e[r.identifier]||{},It(r,!0))}):R(e[t.pointerId||0]||{},It(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var a=this.action,e=this.pointers;t.changedTouches?$(t.changedTouches,function(r){delete e[r.identifier]}):delete e[t.pointerId||0],a&&(t.preventDefault(),Object.keys(e).length||(this.action=""),this.cropping&&(this.cropping=!1,vt(this.dragBox,Lt,this.cropped&&this.options.modal)),gt(this.element,jt,{originalEvent:t,action:a}))}}},oi={change:function(t){var a=this.options,e=this.canvasData,r=this.containerData,i=this.cropBoxData,n=this.pointers,o=this.action,h=a.aspectRatio,f=i.left,c=i.top,d=i.width,v=i.height,l=f+d,m=c+v,w=0,y=0,S=r.width,k=r.height,I=!0,b;!h&&t.shiftKey&&(h=d&&v?d/v:1),this.limited&&(w=i.minLeft,y=i.minTop,S=w+Math.min(r.width,e.width,e.left+e.width),k=y+Math.min(r.height,e.height,e.top+e.height));var g=n[Object.keys(n)[0]],p={x:g.endX-g.startX,y:g.endY-g.startY},x=function(V){switch(V){case ot:l+p.x>S&&(p.x=S-l);break;case lt:f+p.x<w&&(p.x=w-f);break;case at:c+p.y<y&&(p.y=y-c);break;case ht:m+p.y>k&&(p.y=k-m);break}};switch(o){case re:f+=p.x,c+=p.y;break;case ot:if(p.x>=0&&(l>=S||h&&(c<=y||m>=k))){I=!1;break}x(ot),d+=p.x,d<0&&(o=lt,d=-d,f-=d),h&&(v=d/h,c+=(i.height-v)/2);break;case at:if(p.y<=0&&(c<=y||h&&(f<=w||l>=S))){I=!1;break}x(at),v-=p.y,c+=p.y,v<0&&(o=ht,v=-v,c-=v),h&&(d=v*h,f+=(i.width-d)/2);break;case lt:if(p.x<=0&&(f<=w||h&&(c<=y||m>=k))){I=!1;break}x(lt),d-=p.x,f+=p.x,d<0&&(o=ot,d=-d,f-=d),h&&(v=d/h,c+=(i.height-v)/2);break;case ht:if(p.y>=0&&(m>=k||h&&(f<=w||l>=S))){I=!1;break}x(ht),v+=p.y,v<0&&(o=at,v=-v,c-=v),h&&(d=v*h,f+=(i.width-d)/2);break;case yt:if(h){if(p.y<=0&&(c<=y||l>=S)){I=!1;break}x(at),v-=p.y,c+=p.y,d=v*h}else x(at),x(ot),p.x>=0?l<S?d+=p.x:p.y<=0&&c<=y&&(I=!1):d+=p.x,p.y<=0?c>y&&(v-=p.y,c+=p.y):(v-=p.y,c+=p.y);d<0&&v<0?(o=xt,v=-v,d=-d,c-=v,f-=d):d<0?(o=Dt,d=-d,f-=d):v<0&&(o=Et,v=-v,c-=v);break;case Dt:if(h){if(p.y<=0&&(c<=y||f<=w)){I=!1;break}x(at),v-=p.y,c+=p.y,d=v*h,f+=i.width-d}else x(at),x(lt),p.x<=0?f>w?(d-=p.x,f+=p.x):p.y<=0&&c<=y&&(I=!1):(d-=p.x,f+=p.x),p.y<=0?c>y&&(v-=p.y,c+=p.y):(v-=p.y,c+=p.y);d<0&&v<0?(o=Et,v=-v,d=-d,c-=v,f-=d):d<0?(o=yt,d=-d,f-=d):v<0&&(o=xt,v=-v,c-=v);break;case xt:if(h){if(p.x<=0&&(f<=w||m>=k)){I=!1;break}x(lt),d-=p.x,f+=p.x,v=d/h}else x(ht),x(lt),p.x<=0?f>w?(d-=p.x,f+=p.x):p.y>=0&&m>=k&&(I=!1):(d-=p.x,f+=p.x),p.y>=0?m<k&&(v+=p.y):v+=p.y;d<0&&v<0?(o=yt,v=-v,d=-d,c-=v,f-=d):d<0?(o=Et,d=-d,f-=d):v<0&&(o=Dt,v=-v,c-=v);break;case Et:if(h){if(p.x>=0&&(l>=S||m>=k)){I=!1;break}x(ot),d+=p.x,v=d/h}else x(ht),x(ot),p.x>=0?l<S?d+=p.x:p.y>=0&&m>=k&&(I=!1):d+=p.x,p.y>=0?m<k&&(v+=p.y):v+=p.y;d<0&&v<0?(o=Dt,v=-v,d=-d,c-=v,f-=d):d<0?(o=xt,d=-d,f-=d):v<0&&(o=yt,v=-v,c-=v);break;case Be:this.move(p.x,p.y),I=!1;break;case Pe:this.zoom(Ga(n),t),I=!1;break;case Re:if(!p.x||!p.y){I=!1;break}b=Ve(this.cropper),f=g.startX-b.left,c=g.startY-b.top,d=i.minWidth,v=i.minHeight,p.x>0?o=p.y>0?Et:yt:p.x<0&&(f-=d,o=p.y>0?xt:Dt),p.y<0&&(c-=v),this.cropped||(tt(this.cropBox,G),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}I&&(i.width=d,i.height=v,i.left=f,i.top=c,this.action=o,this.renderCropBox()),$(n,function(P){P.startX=P.endX,P.startY=P.endY})}},li={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&z(this.dragBox,Lt),tt(this.cropBox,G),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=R({},this.initialImageData),this.canvasData=R({},this.initialCanvasData),this.cropBoxData=R({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(R(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),tt(this.dragBox,Lt),z(this.cropBox,G)),this},replace:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),a?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,$(this.previews,function(e){e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,tt(this.cropper,pe)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,z(this.cropper,pe)),this},destroy:function(){var t=this.element;return t[L]?(t[L]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.canvasData,r=e.left,i=e.top;return this.moveTo(Yt(t)?t:r+Number(t),Yt(a)?a:i+Number(a))},moveTo:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.canvasData,r=!1;return t=Number(t),a=Number(a),this.ready&&!this.disabled&&this.options.movable&&(C(t)&&(e.left=t,r=!0),C(a)&&(e.top=a,r=!0),r&&this.renderCanvas(!0)),this},zoom:function(t,a){var e=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(e.width*t/e.naturalWidth,null,a)},zoomTo:function(t,a,e){var r=this.options,i=this.canvasData,n=i.width,o=i.height,h=i.naturalWidth,f=i.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&r.zoomable){var c=h*t,d=f*t;if(gt(this.element,Zt,{ratio:t,oldRatio:n/h,originalEvent:e})===!1)return this;if(e){var v=this.pointers,l=Ve(this.cropper),m=v&&Object.keys(v).length?ja(v):{pageX:e.pageX,pageY:e.pageY};i.left-=(c-n)*((m.pageX-l.left-i.left)/n),i.top-=(d-o)*((m.pageY-l.top-i.top)/o)}else ft(a)&&C(a.x)&&C(a.y)?(i.left-=(c-n)*((a.x-i.left)/n),i.top-=(d-o)*((a.y-i.top)/o)):(i.left-=(c-n)/2,i.top-=(d-o)/2);i.width=c,i.height=d,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),C(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var a=this.imageData.scaleY;return this.scale(t,C(a)?a:1)},scaleY:function(t){var a=this.imageData.scaleX;return this.scale(C(a)?a:1,t)},scale:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.imageData,r=!1;return t=Number(t),a=Number(a),this.ready&&!this.disabled&&this.options.scalable&&(C(t)&&(e.scaleX=t,r=!0),C(a)&&(e.scaleY=a,r=!0),r&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=this.options,e=this.imageData,r=this.canvasData,i=this.cropBoxData,n;if(this.ready&&this.cropped){n={x:i.left-r.left,y:i.top-r.top,width:i.width,height:i.height};var o=e.width/e.naturalWidth;if($(n,function(c,d){n[d]=c/o}),t){var h=Math.round(n.y+n.height),f=Math.round(n.x+n.width);n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=f-n.x,n.height=h-n.y}}else n={x:0,y:0,width:0,height:0};return a.rotatable&&(n.rotate=e.rotate||0),a.scalable&&(n.scaleX=e.scaleX||1,n.scaleY=e.scaleY||1),n},setData:function(t){var a=this.options,e=this.imageData,r=this.canvasData,i={};if(this.ready&&!this.disabled&&ft(t)){var n=!1;a.rotatable&&C(t.rotate)&&t.rotate!==e.rotate&&(e.rotate=t.rotate,n=!0),a.scalable&&(C(t.scaleX)&&t.scaleX!==e.scaleX&&(e.scaleX=t.scaleX,n=!0),C(t.scaleY)&&t.scaleY!==e.scaleY&&(e.scaleY=t.scaleY,n=!0)),n&&this.renderCanvas(!0,!0);var o=e.width/e.naturalWidth;C(t.x)&&(i.left=t.x*o+r.left),C(t.y)&&(i.top=t.y*o+r.top),C(t.width)&&(i.width=t.width*o),C(t.height)&&(i.height=t.height*o),this.setCropBoxData(i)}return this},getContainerData:function(){return this.ready?R({},this.containerData):{}},getImageData:function(){return this.sized?R({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,a={};return this.ready&&$(["left","top","width","height","naturalWidth","naturalHeight"],function(e){a[e]=t[e]}),a},setCanvasData:function(t){var a=this.canvasData,e=a.aspectRatio;return this.ready&&!this.disabled&&ft(t)&&(C(t.left)&&(a.left=t.left),C(t.top)&&(a.top=t.top),C(t.width)?(a.width=t.width,a.height=t.width/e):C(t.height)&&(a.height=t.height,a.width=t.height*e),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,a;return this.ready&&this.cropped&&(a={left:t.left,top:t.top,width:t.width,height:t.height}),a||{}},setCropBoxData:function(t){var a=this.cropBoxData,e=this.options.aspectRatio,r,i;return this.ready&&this.cropped&&!this.disabled&&ft(t)&&(C(t.left)&&(a.left=t.left),C(t.top)&&(a.top=t.top),C(t.width)&&t.width!==a.width&&(r=!0,a.width=t.width),C(t.height)&&t.height!==a.height&&(i=!0,a.height=t.height),e&&(r?a.height=a.width/e:i&&(a.width=a.height*e)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var a=this.canvasData,e=qa(this.image,this.imageData,a,t);if(!this.cropped)return e;var r=this.getData(t.rounded),i=r.x,n=r.y,o=r.width,h=r.height,f=e.width/Math.floor(a.naturalWidth);f!==1&&(i*=f,n*=f,o*=f,h*=f);var c=o/h,d=st({aspectRatio:c,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),v=st({aspectRatio:c,width:t.minWidth||0,height:t.minHeight||0},"cover"),l=st({aspectRatio:c,width:t.width||(f!==1?e.width:o),height:t.height||(f!==1?e.height:h)}),m=l.width,w=l.height;m=Math.min(d.width,Math.max(v.width,m)),w=Math.min(d.height,Math.max(v.height,w));var y=document.createElement("canvas"),S=y.getContext("2d");y.width=mt(m),y.height=mt(w),S.fillStyle=t.fillColor||"transparent",S.fillRect(0,0,m,w);var k=t.imageSmoothingEnabled,I=k===void 0?!0:k,b=t.imageSmoothingQuality;S.imageSmoothingEnabled=I,b&&(S.imageSmoothingQuality=b);var g=e.width,p=e.height,x=i,P=n,V,O,M,U,X,W;x<=-o||x>g?(x=0,V=0,M=0,X=0):x<=0?(M=-x,x=0,V=Math.min(g,o+x),X=V):x<=g&&(M=0,V=Math.min(o,g-x),X=V),V<=0||P<=-h||P>p?(P=0,O=0,U=0,W=0):P<=0?(U=-P,P=0,O=Math.min(p,h+P),W=O):P<=p&&(U=0,O=Math.min(h,p-P),W=O);var N=[x,P,V,O];if(X>0&&W>0){var Z=m/o;N.push(M*Z,U*Z,X*Z,W*Z)}return S.drawImage.apply(S,[e].concat(Le(N.map(function(wt){return Math.floor(mt(wt))})))),y},setAspectRatio:function(t){var a=this.options;return!this.disabled&&!Yt(t)&&(a.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var a=this.options,e=this.dragBox,r=this.face;if(this.ready&&!this.disabled){var i=t===ne,n=a.movable&&t===$e;t=i||n?t:Ue,a.dragMode=t,Ot(e,At,t),vt(e,Vt,i),vt(e,Ft,n),a.cropBoxMovable||(Ot(r,At,t),vt(r,Vt,i),vt(r,Ft,n))}return this}},ci=et.Cropper,Ge=(function(){function s(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ea(this,s),!t||!Ba.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=R({},Ce,ft(a)&&a),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return xa(s,[{key:"init",value:function(){var a=this.element,e=a.tagName.toLowerCase(),r;if(!a[L]){if(a[L]=this,e==="img"){if(this.isImg=!0,r=a.getAttribute("src")||"",this.originalUrl=r,!r)return;r=a.src}else e==="canvas"&&window.HTMLCanvasElement&&(r=a.toDataURL());this.load(r)}}},{key:"load",value:function(a){var e=this;if(a){this.url=a,this.imageData={};var r=this.element,i=this.options;if(!i.rotatable&&!i.scalable&&(i.checkOrientation=!1),!i.checkOrientation||!window.ArrayBuffer){this.clone();return}if(La.test(a)){Ra.test(a)?this.read(Ja(a)):this.clone();return}var n=new XMLHttpRequest,o=this.clone.bind(this);this.reloading=!0,this.xhr=n,n.onabort=o,n.onerror=o,n.ontimeout=o,n.onprogress=function(){n.getResponseHeader("content-type")!==Me&&n.abort()},n.onload=function(){e.read(n.response)},n.onloadend=function(){e.reloading=!1,e.xhr=null},i.checkCrossOrigin&&Oe(a)&&r.crossOrigin&&(a=_e(a)),n.open("GET",a,!0),n.responseType="arraybuffer",n.withCredentials=r.crossOrigin==="use-credentials",n.send()}}},{key:"read",value:function(a){var e=this.options,r=this.imageData,i=ei(a),n=0,o=1,h=1;if(i>1){this.url=ti(a,Me);var f=ai(i);n=f.rotate,o=f.scaleX,h=f.scaleY}e.rotatable&&(r.rotate=n),e.scalable&&(r.scaleX=o,r.scaleY=h),this.clone()}},{key:"clone",value:function(){var a=this.element,e=this.url,r=a.crossOrigin,i=e;this.options.checkCrossOrigin&&Oe(e)&&(r||(r="anonymous"),i=_e(e)),this.crossOrigin=r,this.crossOriginUrl=i;var n=document.createElement("img");r&&(n.crossOrigin=r),n.src=i||e,n.alt=a.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),z(n,me),a.parentNode.insertBefore(n,a.nextSibling)}},{key:"start",value:function(){var a=this,e=this.image;e.onload=null,e.onerror=null,this.sizing=!0;var r=et.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(et.navigator.userAgent),i=function(f,c){R(a.imageData,{naturalWidth:f,naturalHeight:c,aspectRatio:f/c}),a.initialImageData=R({},a.imageData),a.sizing=!1,a.sized=!0,a.build()};if(e.naturalWidth&&!r){i(e.naturalWidth,e.naturalHeight);return}var n=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){i(n.width,n.height),r||o.removeChild(n)},n.src=e.src,r||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(n))}},{key:"stop",value:function(){var a=this.image;a.onload=null,a.onerror=null,a.parentNode.removeChild(a),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var a=this.element,e=this.options,r=this.image,i=a.parentNode,n=document.createElement("div");n.innerHTML=Pa;var o=n.querySelector(".".concat(L,"-container")),h=o.querySelector(".".concat(L,"-canvas")),f=o.querySelector(".".concat(L,"-drag-box")),c=o.querySelector(".".concat(L,"-crop-box")),d=c.querySelector(".".concat(L,"-face"));this.container=i,this.cropper=o,this.canvas=h,this.dragBox=f,this.cropBox=c,this.viewBox=o.querySelector(".".concat(L,"-view-box")),this.face=d,h.appendChild(r),z(a,G),i.insertBefore(o,a.nextSibling),tt(r,me),this.initPreview(),this.bind(),e.initialAspectRatio=Math.max(0,e.initialAspectRatio)||NaN,e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,z(c,G),e.guides||z(c.getElementsByClassName("".concat(L,"-dashed")),G),e.center||z(c.getElementsByClassName("".concat(L,"-center")),G),e.background&&z(o,"".concat(L,"-bg")),e.highlight||z(d,Sa),e.cropBoxMovable&&(z(d,Ft),Ot(d,At,re)),e.cropBoxResizable||(z(c.getElementsByClassName("".concat(L,"-line")),G),z(c.getElementsByClassName("".concat(L,"-point")),G)),this.render(),this.ready=!0,this.setDragMode(e.dragMode),e.autoCrop&&this.crop(),this.setData(e.data),F(e.ready)&&K(a,De,e.ready,{once:!0}),gt(a,De)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var a=this.cropper.parentNode;a&&a.removeChild(this.cropper),tt(this.element,G)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ci,s}},{key:"setDefaults",value:function(a){R(Ce,ft(a)&&a)}}])})();R(Ge.prototype,ii,si,ri,ni,oi,li);const ui={class:"avatar-preview-section"},di={class:"preview-wrapper"},hi={key:0,class:"preview-skeleton"},fi=["src"],vi={key:2,class:"preview-avatar-placeholder"},pi={class:"upload-btn-wrapper"},mi={key:0,class:"cropper-section"},gi={class:"cropper-container",ref:"cropperContainer"},bi=["src"],wi={class:"cropper-actions"},yi={key:1,class:"system-avatars-section"},Di={class:"avatar-grid"},Ei=["onClick"],xi=["src"],Mi={key:0,class:"check-mark-overlay"},Ci=nt({__name:"ChangeAvatarModal",props:{visible:{type:Boolean},currentAvatar:{}},emits:["close","update","update:visible"],setup(s,{emit:t}){const a=s,e=t,r=T(null),i=T(""),n=T(""),o=T(!1),h=T(!1),f=T(null),c=T(!1),d=T(null),v=T("");let l=null;const m=[];_t(()=>a.visible,O=>{O&&(i.value="",n.value="",f.value=null,c.value=!1,x(),r.value&&(r.value.value=""))});const w=q(()=>i.value||a.currentAvatar),y=q(()=>(i.value||n.value)&&!o.value&&!c.value),S=()=>{r.value?.click()},k=O=>{O.target.src=""},I=async O=>{const M=O.target.files?.[0];if(!M)return;if(M.size>5*1024*1024){E.warning("图片大小不能超过 5MB");return}if(!["image/jpeg","image/png","image/webp"].includes(M.type)){E.warning("仅支持 JPG, PNG, WebP 格式");return}const U=new FileReader;U.onload=X=>{v.value=X.target?.result,c.value=!0,aa(()=>{b()})},U.readAsDataURL(M)},b=()=>{d.value&&!l&&(l=new Ge(d.value,{aspectRatio:1,viewMode:1,minCropBoxWidth:100,minCropBoxHeight:100,background:!0,guides:!0,center:!0,highlight:!0,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!1}))},g=()=>{x(),c.value=!1,v.value=""},p=async()=>{if(l){o.value=!0;try{const O=l.getCroppedCanvas({width:200,height:200,imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}),M=await new Promise((U,X)=>{O.toBlob(W=>{W?U(W):X(new Error("Canvas to blob failed"))},"image/webp",.85)});f.value=new File([M],`avatar_${Date.now()}.webp`,{type:"image/webp"}),i.value=URL.createObjectURL(M),n.value="",x(),c.value=!1,E.success('裁剪成功，点击"保存修改"应用头像')}catch(O){console.error(O),E.error("裁剪失败")}finally{o.value=!1}}},x=()=>{l&&(l.destroy(),l=null)},P=O=>{n.value=O,i.value=O,f.value=null},V=async()=>{o.value=!0;let O=n.value||a.currentAvatar;try{if(f.value){const M=qe(),{data:{user:U}}=await M.auth.getUser();if(!U)throw new Error("未登录");const X=`avatar_${Date.now()}.webp`,W=`${U.id}/${X}`,{error:N}=await M.storage.from("avatars").upload(W,f.value,{upsert:!0});if(N)throw N;const{data:Z}=M.storage.from("avatars").getPublicUrl(W);O=Z.publicUrl}e("update",O)}catch(M){console.error(M),E.error("上传失败: "+(M.message||"未知错误")),o.value=!1}};return Rt(()=>{x()}),(O,M)=>{const U=Se,X=ya,W=Jt;return B(),dt(W,{visible:s.visible,title:"修改头像",width:"560px","confirm-text":"保存修改",loading:o.value,"confirm-disabled":!y.value,"show-mascot":"","mascot-position":"bottom",onClose:M[0]||(M[0]=N=>O.$emit("close")),"onUpdate:visible":M[1]||(M[1]=N=>O.$emit("update:visible",N)),onConfirm:V},{default:_(()=>[u("div",ui,[u("div",di,[h.value?(B(),H("div",hi)):w.value?(B(),H("img",{key:1,src:w.value,class:"preview-avatar",onError:k},null,40,fi)):(B(),H("div",vi,[D(U,{size:48},{default:_(()=>[D(Y(Ze))]),_:1})]))]),u("div",pi,[u("button",{class:"btn-upload",onClick:S},[D(U,null,{default:_(()=>[D(Y(Qe))]),_:1}),M[2]||(M[2]=rt(" 上传新头像 ",-1))]),u("input",{type:"file",ref_key:"fileInput",ref:r,hidden:"",accept:"image/png,image/jpeg,image/webp",onChange:I},null,544),M[3]||(M[3]=u("div",{class:"upload-tip"},"支持 JPG, PNG, WebP 格式，上传后自动裁剪压缩",-1)),M[4]||(M[4]=u("div",{class:"upload-limit"},"最大 5MB，将压缩为 200x200px",-1))])]),c.value?(B(),H("div",mi,[u("div",gi,[u("img",{ref_key:"cropperImage",ref:d,src:v.value},null,8,bi)],512),u("div",wi,[D(X,{onClick:g},{default:_(()=>[...M[5]||(M[5]=[rt("取消",-1)])]),_:1}),D(X,{type:"primary",onClick:p},{default:_(()=>[...M[6]||(M[6]=[rt("确认裁剪",-1)])]),_:1})])])):(B(),H("div",yi,[M[7]||(M[7]=u("div",{class:"section-title"},"系统推荐头像",-1)),u("div",Di,[(B(),H(Je,null,ta(m,(N,Z)=>u("div",{key:Z,class:te(["avatar-item",{active:n.value===N}]),onClick:wt=>P(N)},[u("img",{src:N,class:"system-avatar-img",loading:"lazy"},null,8,xi),n.value===N?(B(),H("div",Mi,[D(U,null,{default:_(()=>[D(Y(ea))]),_:1})])):Ct("",!0)],10,Ei)),64))])]))]),_:1},8,["visible","loading","confirm-disabled"])}}}),Ai=bt(Ci,[["__scopeId","data-v-a62b4ced"]]),Oi={class:"form-group"},_i=nt({__name:"ChangeNicknameModal",props:{visible:{type:Boolean},currentNickname:{}},emits:["close","update","update:visible"],setup(s,{emit:t}){const a=s,e=t,r=T(a.currentNickname),i=T(!1);_t(()=>a.visible,h=>{h&&(r.value=a.currentNickname)});const n=q(()=>r.value.trim().length>=2&&r.value!==a.currentNickname&&!i.value),o=async()=>{if(n.value){i.value=!0;try{const h=await j.updateProfile({nickname:r.value});h.success?(E.success(A.NICKNAME_MODAL.SUCCESS),e("update",r.value)):E.error(h.msg||A.NICKNAME_MODAL.FAIL)}catch(h){E.error(h.message||A.NICKNAME_MODAL.FAIL)}finally{i.value=!1}}};return(h,f)=>{const c=Jt;return B(),dt(c,{visible:s.visible,title:"修改昵称","confirm-text":"确认修改",loading:i.value,"confirm-disabled":!n.value,"show-mascot":"",onClose:f[1]||(f[1]=d=>h.$emit("close")),"onUpdate:visible":f[2]||(f[2]=d=>h.$emit("update:visible",d)),onConfirm:o},{default:_(()=>[u("div",Oi,[f[3]||(f[3]=u("label",{class:"form-label"},"新昵称",-1)),ct(u("input",{"onUpdate:modelValue":f[0]||(f[0]=d=>r.value=d),type:"text",class:"form-input",placeholder:"请输入新昵称",onKeyup:ia(o,["enter"])},null,544),[[pt,r.value]])])]),_:1},8,["visible","loading","confirm-disabled"])}}}),Si={key:0,class:"step-content"},Ii={class:"form-group"},Ti=["value"],Ni={class:"form-group code-group-wrapper"},ki={class:"code-group-inner"},Li={class:"form-tip"},Ri={key:1,class:"step-content"},Bi={class:"form-group"},Tt="otp_change_email_timer_end",Pi=300,$i=nt({__name:"BindEmailModal",props:{visible:{type:Boolean},currentEmail:{}},emits:["close","confirm","update:visible"],setup(s,{emit:t}){const a=s,e=t,r=T(1),i=T(""),n=T(""),o=T(0),h=T(!1);let f=null;_t(()=>a.visible,b=>{b&&(r.value=1,i.value="",n.value="")});const c=q(()=>"取消"),d=q(()=>h.value?r.value===1?"验证中...":"提交中...":r.value===1?"下一步":"确认换绑"),v=q(()=>r.value===1?!i.value||i.value.length<4||h.value:!m.value||h.value),l=()=>{r.value===1?k():I()},m=q(()=>n.value&&n.value.includes("@")&&n.value!==a.currentEmail),w=(b,g=!0)=>{if(o.value=b,g){const p=Date.now()+b*1e3;localStorage.setItem(Tt,p.toString())}f&&clearInterval(f),f=ee(()=>{o.value--,o.value<=0&&(clearInterval(f),localStorage.removeItem(Tt))},1e3)},y=()=>{const b=localStorage.getItem(Tt);if(b){const g=parseInt(b,10),p=Date.now();if(g>p){const x=Math.ceil((g-p)/1e3);w(x,!1)}else localStorage.removeItem(Tt)}};Bt(()=>{y()}),Rt(()=>{f&&clearInterval(f)});async function S(){if(!(!a.currentEmail||o.value>0||h.value)){h.value=!0;try{const b=await j.sendOtp(a.currentEmail);b.success?(E.success(A.EMAIL_MODAL.CODE_SENT),w(Pi)):E.error(b.msg||A.PASSWORD_MODAL.SEND_FAIL)}catch(b){E.error(b.message||A.PASSWORD_MODAL.SEND_FAIL)}finally{h.value=!1}}}async function k(){if(!(!i.value||i.value.length<4||h.value)){h.value=!0;try{const b=await j.verifyOtp(a.currentEmail,i.value);b.success?(E.success(A.EMAIL_MODAL.VERIFY_SUCCESS),r.value=2):E.error(b.msg||A.PASSWORD_MODAL.VERIFY_FAIL)}catch(b){E.error(b.message||A.PASSWORD_MODAL.VERIFY_FAIL)}finally{h.value=!1}}}async function I(){if(!(!m.value||h.value)){if(n.value===a.currentEmail){E.error(A.EMAIL_MODAL.SAME_EMAIL);return}h.value=!0;try{if(!(await j.checkEmailAvailable(n.value)).success){E.error(A.EMAIL_MODAL.EMAIL_OCCUPIED),h.value=!1;return}const g=await j.updateEmail(n.value);g.success?(E.success(A.EMAIL_MODAL.CONFIRM_SENT),e("confirm",n.value),e("close")):E.error(g.msg||"换绑失败")}catch(b){E.error(b.message||"换绑失败")}finally{h.value=!1}}}return(b,g)=>(B(),dt(ae,{visible:s.visible,title:"换绑邮箱",width:"500px","theme-id":"suit-001","cancel-text":c.value,"confirm-text":d.value,loading:h.value,"confirm-disabled":v.value,onClose:g[3]||(g[3]=p=>b.$emit("close")),"onUpdate:visible":g[4]||(g[4]=p=>b.$emit("update:visible",p)),onConfirm:l},{default:_(()=>[r.value===1?(B(),H("div",Si,[g[7]||(g[7]=u("div",{class:"step-indicator"},[u("span",{class:"step-badge active"},"1"),u("span",{class:"step-line"}),u("span",{class:"step-badge"},"2")],-1)),g[8]||(g[8]=u("p",{class:"step-title"},"验证当前邮箱",-1)),g[9]||(g[9]=u("p",{class:"step-desc"},"为确保账号安全，请先验证您的当前邮箱",-1)),u("div",Ii,[g[5]||(g[5]=u("label",{class:"form-label"},"当前邮箱",-1)),u("input",{value:s.currentEmail,type:"email",class:"form-input",disabled:""},null,8,Ti)]),u("div",Ni,[g[6]||(g[6]=u("label",{class:"form-label"},"验证码",-1)),u("div",ki,[ct(u("input",{"onUpdate:modelValue":g[0]||(g[0]=p=>i.value=p),type:"text",class:"form-input code-input",placeholder:"请输入验证码",maxlength:"6",inputmode:"numeric",autocomplete:"off",onInput:g[1]||(g[1]=p=>i.value=i.value.replace(/\D/g,""))},null,544),[[pt,i.value]]),D(Ie,{loading:h.value,countdown:o.value,onClick:S},null,8,["loading","countdown"])])]),u("div",Li,"验证码将发送至: "+J(s.currentEmail),1)])):Ct("",!0),r.value===2?(B(),H("div",Ri,[g[11]||(g[11]=u("div",{class:"step-indicator"},[u("span",{class:"step-badge done"},"✓"),u("span",{class:"step-line done"}),u("span",{class:"step-badge active"},"2")],-1)),g[12]||(g[12]=u("p",{class:"step-title"},"设置新邮箱",-1)),g[13]||(g[13]=u("p",{class:"step-desc"},"输入您要绑定的新邮箱地址",-1)),u("div",Bi,[g[10]||(g[10]=u("label",{class:"form-label"},"新邮箱地址",-1)),D(sa,{modelValue:n.value,"onUpdate:modelValue":g[2]||(g[2]=p=>n.value=p),placeholder:"请输入新邮箱"},null,8,["modelValue"])]),g[14]||(g[14]=u("div",{class:"info-box"},[u("span",{class:"info-icon"},"ℹ️"),u("span",null,"确认后，系统将向新邮箱发送确认链接，点击链接即可完成换绑")],-1))])):Ct("",!0)]),_:1},8,["visible","cancel-text","confirm-text","loading","confirm-disabled"]))}}),Ui=bt($i,[["__scopeId","data-v-ed6c3eab"]]),Wi=ra("/images/shared/oauth-google.png"),Yi={class:"google-content"},zi={class:"status-info"},Xi={class:"status-text"},Hi={key:0,class:"bound-email"},Vi={key:0,class:"action-area"},Fi={key:1,class:"action-area"},Gi=nt({__name:"BindGoogleModal",props:{visible:{type:Boolean},isBound:{type:Boolean},currentGoogleEmail:{}},emits:["close","bind","update:visible"],setup(s,{emit:t}){const a=t,e=()=>{console.log("Initiating Google Binding..."),a("bind"),a("close")};return(r,i)=>(B(),dt(ae,{visible:s.visible,title:"绑定谷歌邮箱","show-footer":!1,"theme-id":"suit-001",onClose:i[0]||(i[0]=n=>r.$emit("close")),"onUpdate:visible":i[1]||(i[1]=n=>r.$emit("update:visible",n))},{default:_(()=>[u("div",Yi,[i[7]||(i[7]=u("div",{class:"modal-subtitle"},"关联您的 Google 账号以更快捷登录",-1)),u("div",{class:te(["status-box",{bound:s.isBound}])},[i[3]||(i[3]=u("div",{class:"status-icon"},[u("img",{src:Wi,alt:"Google",class:"google-icon"})],-1)),u("div",zi,[i[2]||(i[2]=u("div",{class:"status-label"},"当前状态",-1)),u("div",Xi,J(s.isBound?"已绑定":"未绑定"),1),s.isBound?(B(),H("div",Hi,J(s.currentGoogleEmail),1)):Ct("",!0)])],2),s.isBound?(B(),H("div",Vi,[i[5]||(i[5]=u("div",{class:"action-tip"},"如需更换绑定的 Google 账号，请点击下方按钮",-1)),u("button",{class:"btn-google",onClick:e},[...i[4]||(i[4]=[u("span",{class:"btn-icon"},"G",-1),rt(" 换绑 Google 账号 ",-1)])])])):(B(),H("div",Fi,[u("button",{class:"btn-google",onClick:e},[...i[6]||(i[6]=[u("span",{class:"btn-icon"},"G",-1),rt(" 立即绑定 Google 账号 ",-1)])])])),i[8]||(i[8]=u("div",{class:"modal-footer-tip"}," 绑定后可直接使用 Google 账号登录凡图拉 ",-1))])]),_:1},8,["visible"]))}}),ji=bt(Gi,[["__scopeId","data-v-78cbf845"]]),Ki={class:"form-group code-group-wrapper"},qi={class:"code-group-inner"},Zi={class:"form-tip"},Qi={class:"form-group"},Ji={key:0,class:"password-strength"},ts={class:"form-group"},Nt="otp_password_timer_end",es=300,as=nt({__name:"ChangePasswordModal",props:{visible:{type:Boolean},email:{}},emits:["close","update:visible"],setup(s,{emit:t}){const a=s,e=t,r=T(""),i=T(""),n=T(""),o=T(0),h=T(!1),f=T(0);let c=null;_t(()=>a.visible,b=>{b&&(r.value="",i.value="",n.value="",o.value=0)});const d=q(()=>a.email||"当前账户"),v=(b,g=!0)=>{if(f.value=b,g){const p=Date.now()+b*1e3;localStorage.setItem(Nt,p.toString())}c&&clearInterval(c),c=ee(()=>{f.value--,f.value<=0&&(clearInterval(c),localStorage.removeItem(Nt))},1e3)},l=()=>{const b=localStorage.getItem(Nt);if(b){const g=parseInt(b,10),p=Date.now();if(g>p){const x=Math.ceil((g-p)/1e3);v(x,!1)}else localStorage.removeItem(Nt)}};Bt(()=>{l()}),Rt(()=>{c&&clearInterval(c)});const m=()=>{let b=0;i.value.length>=8&&b++,/\d/.test(i.value)&&b++,/[a-zA-Z]/.test(i.value)&&b++,/[^a-zA-Z0-9]/.test(i.value)&&b++,o.value=b},w=q(()=>{const b=["弱","弱","中","强","很强"];return b[o.value>=0&&o.value<b.length?o.value:0]}),y=q(()=>{const b=["weak","weak","medium","strong","very-strong"];return b[o.value>=0&&o.value<b.length?o.value:0]}),S=q(()=>r.value.length>=4&&i.value.length>=8&&/\d/.test(i.value)&&/[a-zA-Z]/.test(i.value)&&n.value===i.value),k=async()=>{if(!(f.value>0||h.value)){h.value=!0;try{const b=await j.sendOtp(a.email);b.success?(v(es),E.success(A.PASSWORD_MODAL.CODE_SENT)):E.error(b.msg||A.PASSWORD_MODAL.SEND_FAIL)}catch(b){E.error(b.message||A.PASSWORD_MODAL.SEND_FAIL)}finally{h.value=!1}}},I=async()=>{if(!(!S.value||h.value)){h.value=!0;try{const b=await j.verifyOtp(a.email,r.value);if(!b.success){E.error(b.msg||A.PASSWORD_MODAL.VERIFY_FAIL),h.value=!1;return}const g=await j.updatePassword(i.value);g.success?(E.success(A.PASSWORD_MODAL.SUCCESS),e("close")):E.error(g.msg||A.PASSWORD_MODAL.FAIL)}catch(b){b.message?.toLowerCase().includes("different")?E.error(A.PASSWORD_MODAL.SAME_PASSWORD):E.error(b.message||A.GLOBAL.UNKNOWN_ERROR)}finally{h.value=!1}}};return(b,g)=>(B(),dt(ae,{visible:s.visible,title:"更新密码",width:"500px","submit-text":"确认更新",loading:h.value,"submit-disabled":!S.value,"theme-id":"suit-001",onClose:g[4]||(g[4]=p=>b.$emit("close")),"onUpdate:visible":g[5]||(g[5]=p=>b.$emit("update:visible",p)),onSubmit:I},{default:_(()=>[u("div",Ki,[g[6]||(g[6]=u("label",{class:"form-label"},"邮箱验证码",-1)),u("div",qi,[ct(u("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=p=>r.value=p),class:"form-input code-input",placeholder:"请输入验证码",maxlength:"6",inputmode:"numeric",autocomplete:"off",onInput:g[1]||(g[1]=p=>r.value=r.value.replace(/\D/g,""))},null,544),[[pt,r.value]]),D(Ie,{loading:h.value,countdown:f.value,onClick:k},null,8,["loading","countdown"])]),u("p",Zi,"验证码将发送至: "+J(d.value),1)]),u("div",Qi,[g[8]||(g[8]=u("label",{class:"form-label"},"新密码",-1)),ct(u("input",{"onUpdate:modelValue":g[2]||(g[2]=p=>i.value=p),type:"password",class:"form-input",placeholder:"请输入新密码 (至少8位,包含数字和字母)",onInput:m,autocomplete:"new-password"},null,544),[[pt,i.value]]),i.value?(B(),H("div",Ji,[g[7]||(g[7]=rt(" 强度: ",-1)),u("span",{class:te(y.value)},J(w.value),3)])):Ct("",!0)]),u("div",ts,[g[9]||(g[9]=u("label",{class:"form-label"},"确认新密码",-1)),ct(u("input",{"onUpdate:modelValue":g[3]||(g[3]=p=>n.value=p),type:"password",class:"form-input",placeholder:"请再次输入新密码",autocomplete:"new-password"},null,512),[[pt,n.value]])])]),_:1},8,["visible","loading","submit-disabled"]))}}),is=bt(as,[["__scopeId","data-v-c50a4b17"]]),ss={class:"form-group"},rs={class:"captcha-row"},ns=["disabled"],os={class:"form-tip"},ls={class:"confirmation-area"},cs={class:"checkbox-label"},us=["disabled"],kt="otp_delete_timer_end",ds=300,hs=nt({__name:"DeleteAccountModal",props:{visible:{type:Boolean},email:{}},emits:["close","confirm","update:visible"],setup(s,{emit:t}){const a=s,e=t,r=T(!1),i=T(""),n=T(!1),o=T(0);let h=null;_t(()=>a.visible,l=>{l&&(r.value=!1,i.value="")});const f=(l,m=!0)=>{if(o.value=l,m){const w=Date.now()+l*1e3;localStorage.setItem(kt,w.toString())}h&&clearInterval(h),h=ee(()=>{o.value--,o.value<=0&&(clearInterval(h),localStorage.removeItem(kt))},1e3)},c=()=>{const l=localStorage.getItem(kt);if(l){const m=parseInt(l,10),w=Date.now();if(m>w){const y=Math.ceil((m-w)/1e3);f(y,!1)}else localStorage.removeItem(kt)}};Bt(()=>{c()}),Rt(()=>{h&&clearInterval(h)});const d=async()=>{if(!(o.value>0)){n.value=!0;try{const l=await j.sendOtp(a.email);l.success?(E.success(A.DELETE_MODAL.CODE_SENT),f(ds)):E.error(l.msg||A.PASSWORD_MODAL.SEND_FAIL)}catch(l){E.error(l.message||A.PASSWORD_MODAL.SEND_FAIL)}finally{n.value=!1}}},v=async()=>{if(!(!r.value||!i.value)){n.value=!0;try{const l=await j.verifyOtp(a.email,i.value);if(!l.success){E.error(l.msg||A.DELETE_MODAL.CODE_ERROR),n.value=!1;return}e("confirm")}catch(l){E.error(l.message||A.PASSWORD_MODAL.VERIFY_FAIL),n.value=!1}}};return(l,m)=>{const w=Jt;return B(),dt(w,{visible:s.visible,title:"注销账号",width:"500px","show-footer":!1,"theme-id":"suit-001",onClose:m[4]||(m[4]=y=>l.$emit("close")),"onUpdate:visible":m[5]||(m[5]=y=>l.$emit("update:visible",y))},{footer:_(()=>[u("button",{class:"base-modal-cancel",onClick:m[3]||(m[3]=y=>l.$emit("close"))},"取消"),u("button",{class:"delete-btn",disabled:!r.value||!i.value||n.value,onClick:v},J(n.value?"处理中...":"确认注销"),9,us)]),default:_(()=>[m[8]||(m[8]=u("div",{class:"warning-box"},[u("span",{class:"warning-icon"},"⚠️"),u("div",{class:"warning-content"}," 警告：账号注销是不可恢复的操作。所有个人数据、订单记录和资产将被永久删除。 ")],-1)),u("div",ss,[m[6]||(m[6]=u("label",{class:"form-label"},"邮箱验证",-1)),u("div",rs,[ct(u("input",{"onUpdate:modelValue":m[0]||(m[0]=y=>i.value=y),type:"text",class:"form-input",placeholder:"请输入验证码",maxlength:"6",inputmode:"numeric",autocomplete:"off",onInput:m[1]||(m[1]=y=>i.value=i.value.replace(/\D/g,""))},null,544),[[pt,i.value]]),u("button",{class:"send-code-btn",disabled:o.value>0||n.value,onClick:d},J(o.value>0?`${o.value}s后重发`:"获取验证码"),9,ns)]),u("p",os,"为了您的资产安全，请验证邮箱: "+J(s.email),1)]),u("div",ls,[u("label",cs,[ct(u("input",{type:"checkbox","onUpdate:modelValue":m[2]||(m[2]=y=>r.value=y)},null,512),[[na,r.value]]),m[7]||(m[7]=u("span",null,"我已了解风险，确认注销当前账号",-1))])])]),_:1},8,["visible"])}}}),fs=bt(hs,[["__scopeId","data-v-852eaafe"]]),vs={class:"personal-info-page"},ps={class:"profile-banner"},ms={class:"banner-content"},gs={class:"hero-left"},bs=["src"],ws={class:"hero-avatar-overlay"},ys={class:"hero-text"},Ds={class:"hero-nickname"},Es={class:"hero-tags"},xs={class:"user-tag security-tag"},Ms={class:"hero-actions"},Cs={class:"workspace-scroll-area"},As={class:"workspace-content"},Os={class:"info-grid section-gap"},_s={class:"glass-tile info-tile"},Ss={class:"tile-icon-bg"},Is={class:"tile-header"},Ts={class:"tile-value-group"},Ns={class:"tile-value-mono"},ks={class:"glass-tile info-tile"},Ls={class:"tile-icon-bg"},Rs={class:"tile-header"},Bs={key:0,class:"status-badge success"},Ps={key:1,class:"status-badge warning"},$s={class:"tile-value-group"},Us={class:"tile-value"},Ws={class:"glass-tile info-tile"},Ys={class:"tile-icon-bg"},zs={class:"command-center section-gap"},Xs={class:"command-grid"},Hs={class:"card-content"},Vs={class:"card-icon-frame blue-frame"},Fs={class:"card-arrow"},Gs={class:"card-content"},js={class:"card-icon-frame purple-frame"},Ks={class:"card-arrow"},qs={class:"card-content"},Zs={class:"card-icon-frame red-frame"},Qs={class:"card-arrow"},Js=nt({__name:"ProfilePersonalInfo",props:{user:{}},emits:["update:user"],setup(s,{emit:t}){const a=Te(),e=oa({avatar:!1,nickname:!1,email:!1,google:!1,password:!1,delete:!1}),r=v=>{Object.keys(e).forEach(l=>{e[l]=!1}),e[v]=!0},i=v=>{e[v]=!1},n=async v=>{try{const l=await j.updateProfile({avatar:v});l.success?(E.success(A.PROFILE.AVATAR_UPDATE),await a.fetchUserInfo(),i("avatar")):E.error(l.msg||A.PROFILE.AVATAR_FAIL)}catch(l){E.error(l.message||A.PROFILE.AVATAR_FAIL)}},o=async v=>{try{const l=await j.updateProfile({nickname:v});l.success?(E.success(A.PROFILE.NICKNAME_UPDATE),await a.fetchUserInfo(),i("nickname")):E.error(l.msg||A.PROFILE.NICKNAME_FAIL)}catch(l){E.error(l.message||A.PROFILE.NICKNAME_FAIL)}},h=async v=>{await a.fetchUserInfo(),i("email")},f=()=>{console.log("Google Bind Action Triggered")},c=async()=>{try{const v=await j.deleteAccount();if(v.success){const{ElMessageBox:l}=await wa(async()=>{const{ElMessageBox:m}=await import("./BAJNIM6A.js");return{ElMessageBox:m}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68]),import.meta.url);await a.logout(),l.alert("您的账号已成功注销，所有数据已被永久删除。感谢您的使用！","注销成功",{confirmButtonText:"返回首页",type:"success",center:!0,callback:()=>{window.location.href="/"}})}else E.error(v.msg||A.PROFILE.LOGOUT_FAIL)}catch(v){E.error(v.message||A.PROFILE.LOGOUT_FAIL)}},d=v=>{!v||v==="---"||navigator.clipboard.writeText(v).then(()=>{E.success(A.PROFILE.UID_COPY)})};return(v,l)=>{const m=Se;return B(),H("div",vs,[u("div",ps,[l[22]||(l[22]=u("div",{class:"banner-glass"},null,-1)),u("div",ms,[u("div",gs,[u("div",{class:"hero-avatar-wrapper",onClick:l[0]||(l[0]=w=>r("avatar"))},[u("img",{src:s.user.avatar||"/images/client/pc/avatars/avatar-cat.png",class:"hero-avatar"},null,8,bs),u("div",ws,[D(m,null,{default:_(()=>[D(Y(ca))]),_:1})])]),u("div",ys,[u("h1",Ds,J(s.user.nickname),1),u("div",Es,[l[20]||(l[20]=u("span",{class:"user-tag role-tag"},"FANTULA Member",-1)),u("span",xs,[D(m,null,{default:_(()=>[D(Y(ua))]),_:1}),l[19]||(l[19]=rt(" 安全等级: 高 ",-1))])])])]),u("div",Ms,[u("button",{class:"glass-pill-btn primary-glass-btn",onClick:l[1]||(l[1]=w=>r("nickname"))},[D(m,null,{default:_(()=>[D(Y(da))]),_:1}),l[21]||(l[21]=rt(" 编辑资料 ",-1))])])])]),u("div",Cs,[u("div",As,[u("div",Os,[u("div",_s,[u("div",Ss,[D(m,null,{default:_(()=>[D(Y(he))]),_:1})]),u("div",Is,[l[23]||(l[23]=u("div",{class:"tile-label"},"账户 UID",-1)),D(m,{class:"tile-corner-icon"},{default:_(()=>[D(Y(he))]),_:1})]),u("div",Ts,[u("span",Ns,J(s.user.uid||s.user.id||"---"),1),u("button",{class:"copy-btn-mini",onClick:l[2]||(l[2]=w=>d(s.user.uid||s.user.id))},[D(m,null,{default:_(()=>[D(Y(ha))]),_:1})])])]),u("div",ks,[u("div",Ls,[D(m,null,{default:_(()=>[D(Y(fa))]),_:1})]),u("div",Rs,[l[24]||(l[24]=u("div",{class:"tile-label"},"绑定邮箱",-1)),s.user.email?(B(),H("div",Bs,"已绑定")):(B(),H("div",Ps,"未绑定"))]),u("div",$s,[u("span",Us,J(s.user.email||"未绑定邮箱"),1),u("button",{class:"icon-action-btn",onClick:l[3]||(l[3]=w=>r("email"))},[D(m,null,{default:_(()=>[D(Y(va))]),_:1})])])]),u("div",Ws,[u("div",Ys,[D(m,null,{default:_(()=>[D(Y(pa))]),_:1})]),l[25]||(l[25]=la('<div class="tile-header" data-v-a2af28c4><div class="tile-label" data-v-a2af28c4>账号安全</div><div class="status-badge success" data-v-a2af28c4>保护中</div></div><div class="tile-value-group" data-v-a2af28c4><div class="security-level-bar" data-v-a2af28c4><div class="level-fill" style="width:100%;" data-v-a2af28c4></div></div><span class="tile-meta" data-v-a2af28c4>极高</span></div>',2))])]),u("div",zs,[l[32]||(l[32]=u("h3",{class:"section-title"},"账户管理",-1)),u("div",Xs,[u("div",{class:"action-card-lg",onClick:l[4]||(l[4]=w=>r("password"))},[l[27]||(l[27]=u("div",{class:"card-bg-icon"},"🔑",-1)),u("div",Hs,[u("div",Vs,[D(m,null,{default:_(()=>[D(Y(ma))]),_:1})]),l[26]||(l[26]=u("div",{class:"card-text"},[u("span",{class:"card-title"},"修改密码"),u("span",{class:"card-desc"},"定期更新密码保护账号安全")],-1))]),u("div",Fs,[D(m,null,{default:_(()=>[D(Y(Wt))]),_:1})])]),u("div",{class:"action-card-lg",onClick:l[5]||(l[5]=w=>r("google"))},[l[29]||(l[29]=u("div",{class:"card-bg-icon"},"🔗",-1)),u("div",Gs,[u("div",js,[D(m,null,{default:_(()=>[D(Y(ga))]),_:1})]),l[28]||(l[28]=u("div",{class:"card-text"},[u("span",{class:"card-title"},"账号绑定"),u("span",{class:"card-desc"},"Google / 微信 快捷登录")],-1))]),u("div",Ks,[D(m,null,{default:_(()=>[D(Y(Wt))]),_:1})])]),u("div",{class:"action-card-lg danger-card",onClick:l[6]||(l[6]=w=>r("delete"))},[l[31]||(l[31]=u("div",{class:"card-bg-icon"},"⚠️",-1)),u("div",qs,[u("div",Zs,[D(m,null,{default:_(()=>[D(Y(ba))]),_:1})]),l[30]||(l[30]=u("div",{class:"card-text"},[u("span",{class:"card-title"},"注销账号"),u("span",{class:"card-desc"},"永久删除账号数据")],-1))]),u("div",Qs,[D(m,null,{default:_(()=>[D(Y(Wt))]),_:1})])])])])])]),D(Ai,{visible:e.avatar,"onUpdate:visible":l[7]||(l[7]=w=>e.avatar=w),"current-avatar":s.user.avatar,onClose:l[8]||(l[8]=w=>i("avatar")),onUpdate:n},null,8,["visible","current-avatar"]),D(_i,{visible:e.nickname,"onUpdate:visible":l[9]||(l[9]=w=>e.nickname=w),"current-nickname":s.user.nickname,onClose:l[10]||(l[10]=w=>i("nickname")),onUpdate:o},null,8,["visible","current-nickname"]),D(Ui,{visible:e.email,"onUpdate:visible":l[11]||(l[11]=w=>e.email=w),"current-email":s.user.email,onClose:l[12]||(l[12]=w=>i("email")),onConfirm:h},null,8,["visible","current-email"]),D(ji,{visible:e.google,"onUpdate:visible":l[13]||(l[13]=w=>e.google=w),"is-bound":!!s.user.isGoogleBound,"current-google-email":s.user.googleEmail,onClose:l[14]||(l[14]=w=>i("google")),onBind:f},null,8,["visible","is-bound","current-google-email"]),D(is,{visible:e.password,"onUpdate:visible":l[15]||(l[15]=w=>e.password=w),email:s.user.email,onClose:l[16]||(l[16]=w=>i("password"))},null,8,["visible","email"]),D(fs,{visible:e.delete,"onUpdate:visible":l[17]||(l[17]=w=>e.delete=w),email:s.user.email,onClose:l[18]||(l[18]=w=>i("delete")),onConfirm:c},null,8,["visible","email"])])}}}),tr=bt(Js,[["__scopeId","data-v-a2af28c4"]]),ur=nt({__name:"index",setup(s){const t=Te(),a=q(()=>{const r=t.user;return r?{id:r.id,uid:r.uid||r.id?.slice(0,8)||"未分配",nickname:r.nickName||r.nickname||r.email?.split("@")[0]||"用户",avatar:r.avatar||"",email:r.email||"未绑定",isGoogleBound:!1,googleEmail:""}:{id:"",uid:"---",nickname:"用户",avatar:"",email:"未绑定",isGoogleBound:!1,googleEmail:""}}),e=r=>{t.fetchUserInfo()};return Bt(()=>{t.isLoggedIn&&!t.user&&t.fetchUserInfo()}),(r,i)=>(B(),dt(tr,{user:a.value,"onUpdate:user":e},null,8,["user"]))}});export{ur as default};
