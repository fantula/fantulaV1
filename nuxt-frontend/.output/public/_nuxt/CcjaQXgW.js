import{f as I,z as x,A as q,r as E,g as _,h as F,c as n,a as t,l as v,F as y,k as $,t as r,B as m,C as N,o as i,D as B,_ as D}from"./CEI0siaN.js";/* empty css        */import"./CoJKtQsI.js";/* empty css        *//* empty css        */import{c as O}from"./Eu8zRIf2.js";import{E as f}from"./BOUQDXLJ.js";import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./BCllKHMW.js";import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./BB_Ol6Sd.js";import"./C6m5ANi3.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./hs4dPNZ2.js";import"./OwHC_0Ap.js";import"./BC9Y1jC9.js";import"./tbxUD7ww.js";import"./DxNR5PDn.js";import"./uZ_KtR8H.js";import"./CB_o0Cdi.js";const P={class:"cart-page"},S={class:"cart-main-bg"},A={class:"cart-container"},L={class:"cart-list-section"},M={key:0,class:"loading-state"},Q={key:1,class:"empty-cart"},T={key:2,class:"cart-table"},R={class:"cart-goods-info"},U=["src"],V={class:"cart-goods-meta"},j={class:"cart-goods-name"},z={key:0,class:"cart-goods-spec"},X={class:"cart-price"},G={class:"cart-qty"},H=["onClick","disabled"],J={class:"qty-value"},K=["onClick"],W={key:1},Y={class:"cart-subtotal"},Z=["onClick"],tt={class:"cart-summary-section"},st={class:"summary-row"},ot={class:"summary-row"},et={class:"discount"},rt={class:"summary-row total"},at={class:"total-price"},nt=["disabled"],it=I({__name:"cart",setup(ct){const u=N(),g=x(),c=q(),p=E(!1),l=_(()=>c.items),d=_(()=>c.totalPrice),h=_(()=>d.value>=1e3?120:d.value>=500?50:d.value>=200?20:0);F(()=>{c.loadCart()});const k=e=>{c.updateQuantity(e.id,e.quantity+1)},C=e=>{e.quantity>1&&c.updateQuantity(e.id,e.quantity-1)},b=e=>{c.removeFromCart(e.id)},w=async()=>{if(!g.isLoggedIn){m.warning("请先登录");return}if(l.value.length===0){m.warning("购物车是空的");return}p.value=!0;const e=[],o=[];try{for(const s of l.value){const a=await O.createPreOrder(s.skuId,s.quantity,"cart");if(!a.success){if(a.error?.includes("DUPLICATE_ORDER")||a.error?.includes("未支付"))try{await f.confirm(`商品 "${s.productName}" 已存在未支付订单，快去看看吧`,"重复下单提示",{confirmButtonText:"去查看",cancelButtonText:"继续结算",type:"warning"}),u.push("/profile/orders?tab=待支付");return}catch{o.push(s.productName);continue}if(a.error?.includes("LIMIT_EXCEEDED")||a.error?.includes("太多")){await f.alert("您的未支付订单太多了，请先处理一下吧","订单数量超限",{type:"warning"}),u.push("/profile/orders?tab=待支付");return}o.push(s.productName);continue}e.push(a.preOrderId),await c.removeFromCart(s.id)}if(e.length===0){m.error("创建订单失败，请稍后重试");return}e.length===1?u.push(`/checkout/${e[0]}`):u.push(`/checkout/${e[0]}?ids=${e.join(",")}`)}catch(s){console.error("结算失败:",s),m.error(s.message||"创建订单失败")}finally{p.value=!1}};return(e,o)=>(i(),n("div",P,[t("div",S,[t("div",A,[t("div",L,[o[3]||(o[3]=t("h2",{class:"cart-title"},"购物车",-1)),v(c).loading?(i(),n("div",M,"加载中...")):l.value.length===0?(i(),n("div",Q,[o[1]||(o[1]=t("p",null,"购物车是空的",-1)),t("button",{onClick:o[0]||(o[0]=s=>v(u).push("/"))},"去选购")])):(i(),n("table",T,[o[2]||(o[2]=t("thead",null,[t("tr",null,[t("th",null,"商品信息"),t("th",null,"单价"),t("th",null,"数量"),t("th",null,"小计"),t("th",null,"操作")])],-1)),t("tbody",null,[(i(!0),n(y,null,$(l.value,s=>(i(),n("tr",{key:s.id},[t("td",R,[t("img",{src:s.productImage,class:"cart-goods-img"},null,8,U),t("div",V,[t("div",j,r(s.productName),1),s.specName?(i(),n("div",z,"规格："+r(s.specName),1)):B("",!0)])]),t("td",X,"￥"+r(s.price.toFixed(2)),1),t("td",G,[s.allowAddon?(i(),n(y,{key:0},[t("button",{onClick:a=>C(s),disabled:s.quantity<=1},"-",8,H),t("span",J,r(s.quantity),1),t("button",{onClick:a=>k(s)},"+",8,K)],64)):(i(),n("span",W,r(s.quantity),1))]),t("td",Y,"￥"+r((s.price*s.quantity).toFixed(2)),1),t("td",null,[t("button",{class:"cart-remove",onClick:a=>b(s)},"删除",8,Z)])]))),128))])]))]),t("div",tt,[o[7]||(o[7]=t("div",{class:"summary-title"},"订单结算",-1)),t("div",st,[o[4]||(o[4]=t("span",null,"商品总额",-1)),t("span",null,"￥"+r(d.value.toFixed(2)),1)]),t("div",ot,[o[5]||(o[5]=t("span",null,"优惠折扣",-1)),t("span",et,"-￥"+r(h.value.toFixed(2)),1)]),t("div",rt,[o[6]||(o[6]=t("span",null,"应付总额",-1)),t("span",at,"￥"+r((d.value-h.value).toFixed(2)),1)]),t("button",{class:"checkout-btn",onClick:w,disabled:l.value.length===0||p.value},r(p.value?"正在创建订单...":`去结算 (${l.value.length})`),9,nt)])])])]))}}),Dt=D(it,[["__scopeId","data-v-9e7c5da6"]]);export{Dt as default};
