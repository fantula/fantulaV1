import{E as q}from"./CoJKtQsI.js";import{E as z}from"./B77-r_qQ.js";import{E as F}from"./b7hvKMAc.js";import{f as H,r as u,am as D,h as R,c as b,b as i,G as $,D as j,i as J,w as a,B as C,C as K,o as f,l as v,aX as O,d,p as Q,a as n,t as _,_ as W}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{c as V}from"./ByqilF2g.js";import{u as Y}from"./CRWHP3jh.js";import{P as Z}from"./BSp69RIM.js";import{A as tt}from"./Jf5bIUYa.js";import{B as ot}from"./CAt24aya.js";import{A as et}from"./Zi8pc7L8.js";import{C as it,a as at,_ as nt}from"./-KsJubj4.js";import{v as st}from"./BrE0JoK1.js";import{E as lt}from"./BOUQDXLJ.js";import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./CNYNJsmX.js";import"./Cq9Fpw4b.js";import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./BjbJQEzT.js";import"./wVnq5BSo.js";import"./Bh6H2ams.js";import"./BC9Y1jC9.js";import"./CCDBlmbt.js";import"./DE5qJ7kT.js";import"./BzZM8Et6.js";import"./DW0_wk9g.js";import"./CChPPi86.js";import"./B_7HZhJl.js";import"./D-7LAYt0.js";import"./BB_Ol6Sd.js";import"./CB_o0Cdi.js";import"./tbxUD7ww.js";import"./BPYXJYQz.js";import"./BV_QTDOQ.js";import"./DgMG35os.js";import"./DB7JGTAC.js";import"./OwHC_0Ap.js";/* empty css        */import"./PbH8IyH8.js";/* empty css        */import"./CgQ-l74f.js";import"./Ct1yoKpA.js";import"./DIhsiPve.js";import"./BTKFVfca.js";import"./aSYcAdI9.js";import"./uZ_KtR8H.js";import"./BCllKHMW.js";import"./C6m5ANi3.js";import"./CXRxotb2.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./aU3tz_xb.js";import"./CCoZ80-G.js";import"./ClIUVBla.js";import"./BHHTv4u8.js";import"./IibC-tXt.js";import"./CP47LeNR.js";import"./hs4dPNZ2.js";import"./D6FW0B1r.js";import"./DxNR5PDn.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./DwL2e8cc.js";/* empty css        */import"./C-2dxbDp.js";import"./92s3wAHG.js";const rt={class:"coupon-flat-list"},pt={class:"code-info"},mt={class:"code-name"},ut={class:"benefit-tag"},dt={class:"benefit-value"},ct={key:0,class:"validity-tag"},ft={key:1,class:"validity-range"},vt=H({__name:"index",setup(_t){const{formatDate:E,formatPrice:A}=Y(),B=K(),h=u(!1),y=u([]),N=u(0),s=u([]),k=u(!1),x=u(null),l=D({visible:!1,couponId:"",couponName:""}),c=D({visible:!1,coupon:null}),g=async()=>{h.value=!0;try{const o=await V.coupon.getCoupons({type:"flat"});o.success&&(y.value=o.coupons.map(t=>({...t,statusLoading:!1})),N.value=o.total||y.value.length)}catch{C.error("加载异常")}finally{h.value=!1}},S=()=>{B.push("/_mgmt_9Xfa3/coupons/flat/post")},L=o=>{B.push({path:"/_mgmt_9Xfa3/coupons/flat/post",query:{id:o.id}})},I=o=>{x.value=o,k.value=!0},U=o=>{l.couponId=o.id,l.couponName=o.name,l.visible=!0},G=o=>{c.coupon=o,c.visible=!0},T=o=>{s.value=o.map(t=>t.id)},M=()=>{s.value.length&&lt.confirm(`确定要删除选中的 ${s.value.length} 个优惠券吗？`,"批量删除",{type:"warning"}).then(async()=>{let o=0;for(const t of s.value)(await V.coupon.deleteCoupon(t)).success&&o++;C.success(`成功删除 ${o} 个优惠券`),g(),s.value=[]})},P=async o=>{o.statusLoading=!0;try{const t=await V.coupon.toggleStatus(o.id,o.status);t.success?C.success(`已${o.status?"启用":"停用"}`):(o.status=!o.status,C.error(t.error||"操作失败"))}catch{o.status=!o.status}finally{o.statusLoading=!1}};return R(()=>{g()}),(o,t)=>{const r=q,p=z,X=F,w=st;return f(),b("div",rt,[i(Z,{title:"立减券管理",description:"管理满减类型的优惠券，用户满足最低消费金额后可减免指定金额。"}),i(tt,null,{actions:a(()=>[i(r,{icon:v(O),onClick:g},{default:a(()=>[...t[3]||(t[3]=[d("刷新",-1)])]),_:1},8,["icon"]),i(r,{type:"primary",icon:v(Q),onClick:S},{default:a(()=>[...t[4]||(t[4]=[d("新增立减券",-1)])]),_:1},8,["icon"])]),_:1}),s.value.length>0?(f(),$(ot,{key:0,count:s.value.length,onDelete:M},null,8,["count"])):j("",!0),J((f(),$(et,{data:y.value,onSelectionChange:T},{default:a(()=>[i(p,{type:"selection",width:"50",align:"center"}),i(p,{label:"名称","min-width":"200"},{default:a(({row:e})=>[n("div",pt,[n("div",mt,_(e.name),1)])]),_:1}),i(p,{label:"优惠内容",width:"180"},{default:a(({row:e})=>[n("div",ut,[n("span",null,"满 "+_(e.min_usage)+" 减",1),n("span",dt,_(v(A)(e.value)),1)])]),_:1}),i(p,{label:"有效期",width:"220",align:"center"},{default:a(({row:e})=>[e.end_date?(f(),b("div",ft,[n("div",null,_(v(E)(e.start_date)),1),t[5]||(t[5]=n("div",{class:"date-sep"},"至",-1)),n("div",null,_(v(E)(e.end_date)),1)])):(f(),b("div",ct,"永久有效"))]),_:1}),i(p,{label:"状态",width:"100",align:"center"},{default:a(({row:e})=>[i(X,{modelValue:e.status,"onUpdate:modelValue":m=>e.status=m,"inline-prompt":"","active-text":"启用","inactive-text":"停用",loading:e.statusLoading,onChange:m=>P(e)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),i(p,{label:"操作",width:"260",align:"center",fixed:"right"},{default:a(({row:e})=>[i(r,{link:"",type:"primary",onClick:m=>L(e)},{default:a(()=>[...t[6]||(t[6]=[d("编辑",-1)])]),_:1},8,["onClick"]),i(r,{link:"",type:"success",onClick:m=>I(e)},{default:a(()=>[...t[7]||(t[7]=[d("发券",-1)])]),_:1},8,["onClick"]),i(r,{link:"",type:"warning",onClick:m=>G(e)},{default:a(()=>[...t[8]||(t[8]=[d("说明",-1)])]),_:1},8,["onClick"]),i(r,{link:"",type:"info",onClick:m=>U(e)},{default:a(()=>[...t[9]||(t[9]=[d("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[w,h.value]]),i(it,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),coupon:x.value},null,8,["modelValue","coupon"]),i(at,{modelValue:l.visible,"onUpdate:modelValue":t[1]||(t[1]=e=>l.visible=e),"coupon-id":l.couponId,"coupon-name":l.couponName},null,8,["modelValue","coupon-id","coupon-name"]),i(nt,{modelValue:c.visible,"onUpdate:modelValue":t[2]||(t[2]=e=>c.visible=e),coupon:c.coupon,onSaved:g},null,8,["modelValue","coupon"])])}}}),Ro=W(vt,[["__scopeId","data-v-35af36e7"]]);export{Ro as default};
