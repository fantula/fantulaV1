import{E as z}from"./CswOF4xx.js";import{E as L}from"./DrogL690.js";import{E as O,a as T}from"./A8Zj-15Y.js";import{a as j,E as G}from"./CdHOYNgq.js";import{f as X,r as f,g as Y,am as Z,h as H,c as p,a as i,b as o,t as h,w as l,l as g,i as J,G as I,a1 as K,B as d,C as Q,o as m,d as y,F as W,k as ee,D as U,E as te,ap as oe,p as re,_ as le}from"./gYbOYKrZ.js";import{E as ae}from"./Di9v79cN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{a as b}from"./DNxv18EJ.js";import{A as ie}from"./Bc4MtzBs.js";import{v as se}from"./CUySdIcD.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./BB_Ol6Sd.js";import"./BNtqh2Az.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./C5EOtA6j.js";import"./pxhmPWjv.js";import"./CaswxL1d.js";import"./BlcygIWm.js";import"./CUkNyi1D.js";import"./BSx1rCp4.js";import"./BxcDqkou.js";import"./B-n2-D39.js";import"./Cr8dt13I.js";import"./DxwfhIR6.js";import"./BYT9QUPE.js";import"./CrRq4wwb.js";import"./YvAJPawC.js";import"./CqTJWtX6.js";import"./gVImYNNu.js";import"./CrM0zeZk.js";import"./CxsxdZaY.js";import"./Djfz0t-N.js";import"./BPYHQo7_.js";import"./BO6-pa8Z.js";import"./qZy57oqE.js";import"./DEN0lkI5.js";import"./D6FW0B1r.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./9gheNwfe.js";import"./DMMqLNeM.js";import"./C6CbiQn9.js";import"./B9zwl8KS.js";const ne={class:"admin-page-post"},me={class:"page-header"},ue={class:"page-title"},pe={class:"form-container"},de={style:{float:"left"}},ce={key:0,style:{float:"right",color:"var(--el-text-color-placeholder)","font-size":"13px"}},fe={class:"image-select-container"},ve=["src"],_e={class:"cover-mask"},ge={key:0,class:"video-preview"},ye=["src"],be=X({__name:"post",setup(we){const w=Q(),V=K(),k=f(),c=f(!1),E=f([]),v=f(!1),x=Y(()=>!!V.query.id),r=Z({title:"",category:"",cover_image:"",video_url:"",description:"",content:"",is_published:!1}),A={title:[{required:!0,message:"请输入标题",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}]},q=async()=>{try{const{data:a}=await b.getCategories();E.value=a||[]}catch(a){console.error("Failed to fetch categories",a)}},F=a=>{r.cover_image=a,d.success("已选择图片")},u=f(""),C=()=>{const a=r.video_url;if(!a){u.value="";return}const e=a.match(/(BV[a-zA-Z0-9]+)/);if(e){u.value=`//player.bilibili.com/player.html?bvid=${e[1]}&page=1&high_quality=1&danmaku=0`;return}const s=a.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]+)/);if(s){u.value=`https://www.youtube.com/embed/${s[1]}?rel=0&modestbranding=1`;return}d.warning("未能识别视频链接格式，请检查"),u.value=""},$=async()=>{if(x.value){c.value=!0;try{const{success:a,data:e,msg:s}=await b.getArticleById(V.query.id);if(!a)throw new Error(s);Object.assign(r,{title:e.title,category:e.category,cover_image:e.cover_image,video_url:e.video_url,description:e.description,content:e.content,is_published:e.is_published}),C()}catch(a){d.error("获取详情失败: "+a.message)}finally{c.value=!1}}},S=async()=>{k.value&&await k.value.validate(async a=>{if(a){c.value=!0;try{if(x.value){const{error:e}=await b.updateArticle(V.query.id,r);if(e)throw e;d.success("更新成功")}else{const{error:e}=await b.createArticle(r);if(e)throw e;d.success("发布成功")}w.push("/_mgmt_9Xfa3/article")}catch(e){d.error("提交失败: "+e.message)}finally{c.value=!1}}})};return H(()=>{q(),$()}),(a,e)=>{const s=z,_=L,n=T,D=G,N=j,B=te,R=ae,M=O,P=se;return m(),p("div",ne,[i("div",me,[i("h2",ue,h(x.value?"编辑文章":"发布文章"),1),o(s,{onClick:e[0]||(e[0]=t=>g(w).back())},{default:l(()=>[...e[11]||(e[11]=[y("返回列表",-1)])]),_:1})]),i("div",pe,[J((m(),I(M,{model:r,"label-width":"120px",ref_key:"formRef",ref:k,rules:A},{default:l(()=>[o(n,{label:"文章标题",prop:"title"},{default:l(()=>[o(_,{modelValue:r.title,"onUpdate:modelValue":e[1]||(e[1]=t=>r.title=t),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1}),o(n,{label:"所属分类",prop:"category"},{default:l(()=>[o(N,{modelValue:r.category,"onUpdate:modelValue":e[2]||(e[2]=t=>r.category=t),placeholder:"请选择分类"},{default:l(()=>[(m(!0),p(W,null,ee(E.value,t=>(m(),I(D,{key:t.id,label:t.name,value:t.id},{default:l(()=>[i("span",de,h(t.icon)+" "+h(t.name),1),t.is_active?U("",!0):(m(),p("span",ce,"已禁用"))]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"封面图片",prop:"cover_image"},{default:l(()=>[i("div",fe,[r.cover_image?(m(),p("div",{key:0,class:"cover-preview",onClick:e[3]||(e[3]=t=>v.value=!0)},[i("img",{src:r.cover_image,class:"cover-image"},null,8,ve),i("div",_e,[o(B,null,{default:l(()=>[o(g(oe))]),_:1}),e[12]||(e[12]=i("span",null,"更换图片",-1))])])):(m(),p("div",{key:1,class:"cover-uploader",onClick:e[4]||(e[4]=t=>v.value=!0)},[o(B,{class:"cover-uploader-icon"},{default:l(()=>[o(g(re))]),_:1}),e[13]||(e[13]=i("span",null,"选择封面",-1))])),e[14]||(e[14]=i("div",{class:"tip-text"},"建议尺寸 800x450 (16:9)，点击选择或上传",-1))])]),_:1}),o(n,{label:"视频链接",prop:"video_url"},{default:l(()=>[o(_,{modelValue:r.video_url,"onUpdate:modelValue":e[5]||(e[5]=t=>r.video_url=t),placeholder:"支持 Bilibili (BV号) 或 YouTube 链接"},{append:l(()=>[o(s,{onClick:C},{default:l(()=>[...e[15]||(e[15]=[y("预览",-1)])]),_:1})]),_:1},8,["modelValue"]),e[16]||(e[16]=i("div",{class:"tip-text"},"示例: https://www.bilibili.com/video/BVxxx 或 https://youtu.be/xxx",-1)),u.value?(m(),p("div",ge,[i("iframe",{src:u.value,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true"},null,8,ye)])):U("",!0)]),_:1}),o(n,{label:"简短描述",prop:"description"},{default:l(()=>[o(_,{modelValue:r.description,"onUpdate:modelValue":e[6]||(e[6]=t=>r.description=t),type:"textarea",rows:3,placeholder:"文章摘要，用于列表展示"},null,8,["modelValue"])]),_:1}),o(n,{label:"详细内容",prop:"content"},{default:l(()=>[o(_,{modelValue:r.content,"onUpdate:modelValue":e[7]||(e[7]=t=>r.content=t),type:"textarea",rows:15,placeholder:"支持 Markdown 格式。如果填写了视频链接，视频将显示在内容上方。"},null,8,["modelValue"])]),_:1}),o(n,{label:"发布状态"},{default:l(()=>[o(R,{modelValue:r.is_published,"onUpdate:modelValue":e[8]||(e[8]=t=>r.is_published=t),"active-text":"立即发布","inactive-text":"存为草稿"},null,8,["modelValue"])]),_:1}),o(n,null,{default:l(()=>[o(s,{type:"primary",onClick:S},{default:l(()=>[...e[17]||(e[17]=[y("保存提交",-1)])]),_:1}),o(s,{onClick:e[9]||(e[9]=t=>g(w).back())},{default:l(()=>[...e[18]||(e[18]=[y("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[P,c.value]])]),o(ie,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value=t),onSelect:F},null,8,["modelValue"])])}}}),ht=le(be,[["__scopeId","data-v-f1edf8f1"]]);export{ht as default};
