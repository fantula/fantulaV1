import{E as O}from"./DB7JGTAC.js";import{E as X,a as q}from"./C7QSzEzh.js";import{E as H}from"./CoJKtQsI.js";import{E as J}from"./B77-r_qQ.js";import{E as Q}from"./BTKFVfca.js";import{E as W}from"./DAIghOY5.js";import{f as Y,r as f,h as Z,c as g,a as p,b as s,w as o,B as d,o as n,l as v,aX as tt,d as i,a$ as et,t as r,G as k,D as x,F as at,k as ot,_ as st}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{a as E}from"./BPYXJYQz.js";import{A as lt}from"./Jf5bIUYa.js";import{A as it}from"./Zi8pc7L8.js";import{u as nt}from"./Ce6k4emn.js";import{u as rt}from"./CRWHP3jh.js";import{E as S}from"./BOUQDXLJ.js";import"./OwHC_0Ap.js";import"./BB_Ol6Sd.js";import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./Cq9Fpw4b.js";import"./DE5qJ7kT.js";import"./CCDBlmbt.js";import"./CNYNJsmX.js";import"./BjbJQEzT.js";import"./wVnq5BSo.js";import"./Bh6H2ams.js";import"./BC9Y1jC9.js";import"./BzZM8Et6.js";import"./DW0_wk9g.js";import"./CChPPi86.js";import"./B_7HZhJl.js";import"./D-7LAYt0.js";import"./CB_o0Cdi.js";import"./DxNR5PDn.js";import"./uZ_KtR8H.js";import"./C6m5ANi3.js";import"./PbH8IyH8.js";/* empty css        */import"./CgQ-l74f.js";import"./Ct1yoKpA.js";import"./DIhsiPve.js";import"./aSYcAdI9.js";import"./BCllKHMW.js";import"./CXRxotb2.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./BrE0JoK1.js";import"./hs4dPNZ2.js";import"./tbxUD7ww.js";const pt={class:"cdks-page"},mt={class:"page-tip-header"},dt={class:"filter-group"},ct={class:"product-cell",style:{display:"flex","align-items":"center"}},ut={class:"product-name"},_t={key:0,class:"linked-skus"},ft={key:0,class:"more-tag"},gt={class:"code-text"},kt={class:"time-text"},ht=Y({__name:"cdks",setup(yt){const{getProductTypeLabel:D,getProductTypeTag:w,getCdkStatusLabel:A,getCdkStatusType:K}=nt(),{formatDate:V}=rt(),h=f(!1),y=f("all"),T=f([]),m=f([]),c=async()=>{h.value=!0;try{const t=await E.getCdks({limit:500});if(t.success){let a=t.cdks||[];y.value==="unlinked"&&(a=a.filter(u=>!u.sku_mappings||u.sku_mappings.length===0)),T.value=a}else d.error(t.error)}catch(t){d.error(t.message||"加载失败")}finally{h.value=!1}},z=()=>{c()},L=t=>D(t),F=t=>w(t),M=t=>A(t),N=t=>K(t),R=t=>t?Object.values(t).join(" / "):"默认",I=t=>!t.sku_mappings||t.sku_mappings.length===0,U=t=>{m.value=t.map(a=>a.id)},$=t=>{S.confirm("确认删除此未绑定的孤儿 CDK 吗？此操作无法恢复。","警告",{type:"warning"}).then(async()=>{const a=await E.deleteCdk(t.id);a.success?(d.success("删除成功"),c()):d.error(a.error)})},j=()=>{m.value.length&&S.confirm(`确认批量删除 ${m.value.length} 个孤儿 CDK？`,"高风险操作",{type:"error",confirmButtonText:"确定删除",cancelButtonText:"取消"}).then(async()=>{const t=await E.deleteCdks(m.value);t.success?(d.success("批量删除成功"),m.value=[],c()):d.error(t.error)})};return Z(()=>{c()}),(t,a)=>{const u=O,B=q,G=X,b=H,l=J,_=Q,P=W;return n(),g("div",pt,[p("div",mt,[s(u,{title:"此处显示所有 CDK 物理数据。建议定期清理未绑定 SKU 的孤儿 CDK。",type:"warning","show-icon":"",closable:!1,center:""})]),s(lt,null,{default:o(()=>[p("div",dt,[s(G,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),onChange:z},{default:o(()=>[s(B,{label:"all"},{default:o(()=>[...a[1]||(a[1]=[i("全部",-1)])]),_:1}),s(B,{label:"unlinked"},{default:o(()=>[...a[2]||(a[2]=[i("未连接",-1)])]),_:1})]),_:1},8,["modelValue"])])]),actions:o(()=>[s(b,{onClick:c,icon:v(tt)},{default:o(()=>[...a[3]||(a[3]=[i("刷新",-1)])]),_:1},8,["icon"]),s(b,{type:"danger",icon:v(et),disabled:!m.value.length,onClick:j},{default:o(()=>[...a[4]||(a[4]=[i(" 批量删除 ",-1)])]),_:1},8,["icon","disabled"])]),_:1}),s(it,{ref:"adminTableRef",data:T.value,loading:h.value,onSelectionChange:U},{default:o(()=>[s(l,{type:"selection",width:"55",selectable:I}),s(l,{label:"CDK 类型",width:"120",align:"center"},{default:o(({row:e})=>[s(_,{type:F(e.cdk_type)},{default:o(()=>[i(r(L(e.cdk_type)),1)]),_:2},1032,["type"])]),_:1}),s(l,{label:"绑定商品","min-width":"200"},{default:o(({row:e})=>[p("div",ct,[e.product_snapshot?.product_image?(n(),k(P,{key:0,src:e.product_snapshot.product_image,fit:"cover",style:{width:"40px",height:"40px","border-radius":"4px","margin-right":"8px","flex-shrink":"0"}},null,8,["src"])):x("",!0),p("span",ut,r(e.product_snapshot?.product_name||"未知商品"),1)])]),_:1}),s(l,{label:"绑定 SKU","min-width":"160"},{default:o(({row:e})=>[e.sku_mappings&&e.sku_mappings.length>0?(n(),g("div",_t,[(n(!0),g(at,null,ot(e.sku_mappings.slice(0,2),C=>(n(),k(_,{key:C.id,size:"small",effect:"plain",style:{"margin-right":"4px"}},{default:o(()=>[i(r(R(C.sku?.spec_combination)),1)]),_:2},1024))),128)),e.sku_mappings.length>2?(n(),g("span",ft,"+"+r(e.sku_mappings.length-2),1)):x("",!0)])):(n(),k(_,{key:1,type:"danger",effect:"plain",size:"small"},{default:o(()=>[...a[5]||(a[5]=[i("未绑定",-1)])]),_:1}))]),_:1}),s(l,{label:"内容","min-width":"180"},{default:o(({row:e})=>[p("span",gt,r(e.code||"-"),1)]),_:1}),s(l,{label:"库存",width:"80",align:"center"},{default:o(({row:e})=>[p("span",null,r(e.stock??1),1)]),_:1}),s(l,{label:"状态",width:"100",align:"center"},{default:o(({row:e})=>[s(_,{type:N(e.status),size:"small"},{default:o(()=>[i(r(M(e.status)),1)]),_:2},1032,["type"])]),_:1}),s(l,{label:"创建时间",width:"180",align:"center"},{default:o(({row:e})=>[p("span",kt,r(v(V)(e.created_at)),1)]),_:1}),s(l,{label:"操作",width:"100",align:"center",fixed:"right"},{default:o(({row:e})=>[!e.sku_mappings||e.sku_mappings.length===0?(n(),k(b,{key:0,type:"danger",link:"",size:"small",onClick:C=>$(e)},{default:o(()=>[...a[6]||(a[6]=[i("删除",-1)])]),_:1},8,["onClick"])):x("",!0)]),_:1})]),_:1},8,["data","loading"])])}}}),Ae=st(ht,[["__scopeId","data-v-b5660394"]]);export{Ae as default};
