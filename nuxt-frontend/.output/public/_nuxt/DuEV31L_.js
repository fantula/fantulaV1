import{E as Q}from"./1SfIsks3.js";import{E as W}from"./-Yx_0iEM.js";import{E as X}from"./DC3lfPj1.js";import{E as Y}from"./DytS51kl.js";import{a as Z,E as ee}from"./Ci1VNkC9.js";import{a as le,E as te}from"./CrjkcmUY.js";import{f as ae,r as y,J,c as f,a as i,b as a,D as E,F as w,k as B,l as z,w as m,o as u,G as V,b2 as se,d as K,t as M,j as ne,p as oe,n as ie,E as ue,b1 as de,K as re,_ as ce}from"./o2XBa361.js";import{E as me}from"./Cq9RPQ5L.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{A as pe}from"./Tzes-zbc.js";const ve={class:"sku-editor"},fe={class:"spec-editor"},_e={class:"spec-list-grid"},ge={class:"spec-header"},Ve={class:"spec-values"},be={key:0,class:"add-spec-btn-container"},ke={class:"btn-icon"},ye={class:"sku-table-container"},he=["onClick"],Se=["src"],Ee={key:1,class:"sku-upload-placeholder"},Oe=ae({__name:"SkuEditor",props:{mode:{},productId:{},tag:{},initialSpecs:{},initialSkus:{},readOnly:{type:Boolean}},emits:["update:specs","update:skus"],setup(d,{expose:j,emit:F}){const O=d,T=F,s=y([]),p=y([]);J(()=>O.initialSpecs,e=>{console.log("[SkuEditor] initialSpecs changed:",e),e&&e.length>0&&(s.value=JSON.parse(JSON.stringify(e)))},{immediate:!0,deep:!0}),J(()=>O.initialSkus,e=>{console.log("[SkuEditor] initialSkus changed:",e),e&&e.length>0&&(p.value=JSON.parse(JSON.stringify(e)))},{immediate:!0,deep:!0});const P=()=>{s.value.push({name:"",values:[],inputVisible:!1,inputValue:""})},R=e=>{s.value.splice(e,1),U()},G=(e,t)=>{s.value[e].values.splice(t,1),U()},$=y([]),L=e=>{s.value[e].inputVisible=!0,re(()=>{const t=$.value;t&&t[e]&&t[e]?.focus?.()})},A=e=>{const t=s.value[e].inputValue.trim();t&&!s.value[e].values.includes(t)&&(s.value[e].values.push(t),U()),s.value[e].inputVisible=!1,s.value[e].inputValue=""},U=()=>{const e=s.value.filter(o=>o.name&&o.values.length>0);if(e.length===0){p.value=[],C();return}const t=o=>{if(o.length===0)return[[]];const[r,...v]=o,_=t(v);return r.flatMap(k=>_.map(g=>[k,...g]))},b=e.map(o=>o.values),h=t(b),S=new Map;p.value.forEach(o=>{S.set(o.key,o)}),p.value=h.map(o=>{const r={};e.forEach((k,g)=>{r[k.name]=o[g]});const v=o.join("::"),_=S.get(v);return _?{..._,specValues:r}:{key:v,specValues:r,product_type:"virtual",price:0,duration:null,intro:"",image:"",tag:O.tag}}),C()},C=()=>{T("update:specs",s.value),T("update:skus",p.value)};J(()=>s.value,()=>{},{deep:!0});const N=y(!1),I=y(null),q=e=>{I.value=e,N.value=!0},x=e=>{e.length>0&&I.value&&(I.value.image=e[0],C())};return j({getSpecs:()=>s.value,getSkus:()=>p.value,setSpecs:e=>{s.value=JSON.parse(JSON.stringify(e))},setSkus:e=>{p.value=JSON.parse(JSON.stringify(e))}}),(e,t)=>{const b=Q,h=W,S=X,o=Y,r=ee,v=te,_=le,k=ue,g=me,H=Z;return u(),f("div",ve,[i("div",fe,[t[3]||(t[3]=i("div",{class:"spec-editor-header"},[i("div",{class:"panel-title"},"规格配置")],-1)),i("div",_e,[(u(!0),f(w,null,B(s.value,(l,n)=>(u(),f("div",{key:n,class:"spec-group"},[i("div",ge,[a(b,{modelValue:l.name,"onUpdate:modelValue":c=>l.name=c,placeholder:"规格名 (如: 颜色)",style:{width:"150px"},disabled:d.readOnly},null,8,["modelValue","onUpdate:modelValue","disabled"]),d.readOnly?E("",!0):(u(),V(h,{key:0,type:"danger",link:"",onClick:c=>R(n),icon:z(se),circle:""},null,8,["onClick","icon"]))]),i("div",Ve,[(u(!0),f(w,null,B(l.values,(c,D)=>(u(),V(S,{key:D,closable:!d.readOnly,onClose:Ue=>G(n,D),class:"spec-tag"},{default:m(()=>[K(M(c),1)]),_:2},1032,["closable","onClose"]))),128)),l.inputVisible?(u(),V(b,{key:0,ref_for:!0,ref_key:"saveTagInput",ref:$,modelValue:l.inputValue,"onUpdate:modelValue":c=>l.inputValue=c,class:"input-new-tag",size:"small",onKeyup:ne(c=>A(n),["enter"]),onBlur:c=>A(n)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):d.readOnly?E("",!0):(u(),V(h,{key:1,class:"button-new-tag",size:"small",onClick:c=>L(n)},{default:m(()=>[...t[1]||(t[1]=[K("+ 添加值",-1)])]),_:1},8,["onClick"]))])]))),128))]),d.readOnly?E("",!0):(u(),f("div",be,[i("div",{class:"premium-add-btn",onClick:P},[i("div",ke,[a(z(oe))]),t[2]||(t[2]=i("div",{class:"btn-text"},[i("span",{class:"t1"},"添加规格项目"),i("span",{class:"t2"},"支持自定义规格名与属性值")],-1))])]))]),a(o),i("div",ye,[t[4]||(t[4]=i("div",{class:"panel-title"},"SKU 配置",-1)),a(H,{data:p.value,border:"",style:{width:"100%"}},{default:m(()=>[(u(!0),f(w,null,B(s.value,(l,n)=>(u(),V(r,{key:n,label:l.name||"规格","min-width":"100"},{default:m(({row:c})=>[K(M(c.specValues[l.name]),1)]),_:2},1032,["label"]))),128)),a(r,{label:"类型",width:"140",align:"center"},{default:m(({row:l})=>[a(_,{modelValue:l.product_type,"onUpdate:modelValue":n=>l.product_type=n,size:"small",placeholder:"选择类型",style:{width:"100%"},disabled:d.readOnly},{default:m(()=>[a(v,{label:"虚拟充值",value:"virtual"}),a(v,{label:"账号合租",value:"shared_account"}),a(v,{label:"兑换码",value:"one_time_cdk"})]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),a(r,{label:"SKU图片",width:"100",align:"center"},{default:m(({row:l})=>[i("div",{class:ie(["sku-img-uploader small-box",{disabled:d.readOnly}]),onClick:n=>!d.readOnly&&q(l)},[l.image?(u(),f("img",{key:0,src:l.image,class:"sku-img"},null,8,Se)):(u(),f("div",Ee,[a(k,null,{default:m(()=>[a(z(de))]),_:1})]))],10,he)]),_:1}),d.readOnly?E("",!0):(u(),V(r,{key:0,label:"简介","min-width":"150"},{default:m(({row:l})=>[a(b,{modelValue:l.intro,"onUpdate:modelValue":n=>l.intro=n,size:"small",placeholder:"简短描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})),a(r,{label:"时长(天)",width:"100"},{default:m(({row:l})=>[a(g,{modelValue:l.duration,"onUpdate:modelValue":n=>l.duration=n,size:"small",min:0,controls:!1,style:{width:"100%"},disabled:d.readOnly},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),a(r,{label:"售价 (元)",width:"140",align:"center"},{default:m(({row:l})=>[a(g,{modelValue:l.price,"onUpdate:modelValue":n=>l.price=n,min:0,precision:2,step:1,size:"small",style:{width:"100%"},controls:!1,disabled:d.readOnly},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1})]),_:1},8,["data"])]),a(pe,{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=l=>N.value=l),multiple:!1,onSelect:x},null,8,["modelValue"])])}}}),qe=ce(Oe,[["__scopeId","data-v-cfe7291a"]]);export{qe as S};
