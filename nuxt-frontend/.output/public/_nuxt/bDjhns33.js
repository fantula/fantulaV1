import{a as B,E as O}from"./CRYDGWf-.js";import{f as V,z as A,q as P,r as v,h as R,g as z,c as a,a as s,F as y,k,b as n,w as _,d as x,ay as G,aJ as I,C as U,E as q,o as i,n as J,D as N,t as p,l as b,aK as K,aG as j,aL as H,aD as E,B as f,_ as Q}from"./CEI0siaN.js";/* empty css        */import{c as W}from"./Eu8zRIf2.js";const X={class:"favorites-section"},Y={class:"favorites-tabs"},Z=["onClick"],ss={key:0,class:"active-indicator"},es={class:"favorites-list-container"},ts={key:0,class:"loading-grid"},os={style:{padding:"14px"}},as={style:{"margin-top":"10px"}},ns={key:1,class:"empty-state"},is={key:2,class:"favorites-grid"},rs=["onClick"],cs={class:"card-image-container"},ls=["src","alt"],ds={class:"card-content"},us={class:"product-title"},vs={key:0,class:"spec-row"},_s={class:"spec-text"},ps={class:"price-row"},fs={class:"amount"},ms={class:"card-actions"},hs=["onClick"],gs=["onClick","disabled"],ys=V({__name:"favorites",setup(ks){const r=U(),F=A(),S=P(),m=v(!0),c=v(!1),C=v([]),l=v([]),d=v("all");R(async()=>{m.value=!0;try{const o=await I.getFavoritesData();o.success&&o.data&&(C.value=o.data.categories,l.value=o.data.favorites)}finally{m.value=!1}});const w=z(()=>d.value==="all"?l.value:l.value.filter(o=>o.categoryId===d.value)),$=o=>{r.push(`/goods/${o}`)},D=async o=>{(await I.removeFavorite(o)).success&&(l.value=l.value.filter(u=>u.id!==o),f.success("已取消收藏"))},L=async o=>{if(!F.isLoggedIn){S.showLogin=!0;return}if(!o.skuId){f.warning("请先选择商品规格"),r.push(`/goods/${o.productId}`);return}if(!c.value){c.value=!0;try{const e=await W.createPreOrder(o.skuId,1,"buy_now");if(!e.success){if(e.error?.includes("DUPLICATE_ORDER")||e.error?.includes("未支付")){f.warning("您已经下过该商品的订单了"),r.push("/profile/orders?tab=待支付");return}f.error(e.error||"创建订单失败");return}r.push(`/checkout/${e.preOrderId}`)}catch{f.error("创建订单失败")}finally{c.value=!1}}},M=()=>{r.push("/")};return(o,e)=>{const u=B,T=O,h=q;return i(),a("div",X,[e[4]||(e[4]=s("div",{class:"section-header"},[s("h2",{class:"section-title"},"我的收藏"),s("div",{class:"section-subtitle"},"My Collection")],-1)),s("div",Y,[(i(!0),a(y,null,k(C.value,t=>(i(),a("div",{key:t.id,class:J(["tab-item",{active:d.value===t.id}]),onClick:g=>d.value=t.id},[x(p(t.name)+" ",1),d.value===t.id?(i(),a("div",ss)):N("",!0)],10,Z))),128))]),s("div",es,[m.value?(i(),a("div",ts,[(i(),a(y,null,k(6,t=>n(T,{animated:"",class:"skeleton-item",key:t},{template:_(()=>[n(u,{variant:"image",class:"skeleton-img"}),s("div",os,[n(u,{variant:"h3",style:{width:"50%"}}),s("div",as,[n(u,{variant:"text",style:{width:"30%"}})])])]),_:1})),64))])):w.value.length===0?(i(),a("div",ns,[n(h,{class:"empty-icon"},{default:_(()=>[n(b(K))]),_:1}),e[1]||(e[1]=s("div",{class:"empty-text"},"暂无收藏商品",-1)),e[2]||(e[2]=s("div",{class:"empty-desc"},"去探索更多好物，填满您的收藏夹吧",-1)),s("button",{class:"go-shopping-btn",onClick:M},[e[0]||(e[0]=x(" 前往商城 ",-1)),n(h,null,{default:_(()=>[n(b(j))]),_:1})])])):(i(),a("div",is,[n(G,{name:"list"},{default:_(()=>[(i(!0),a(y,null,k(w.value,t=>(i(),a("div",{key:t.id,class:"favorite-card",onClick:g=>$(t.productId)},[s("div",cs,[s("img",{src:t.productImage,alt:t.productName,class:"product-img"},null,8,ls)]),s("div",ds,[s("h3",us,p(t.productName),1),t.specName?(i(),a("div",vs,[n(h,{class:"spec-icon"},{default:_(()=>[n(b(H))]),_:1}),s("span",_s,p(t.specName),1)])):N("",!0),s("div",ps,[s("span",fs,p(Number(t.price).toFixed(2)),1),e[3]||(e[3]=s("span",{class:"unit"},"点",-1))]),s("div",ms,[s("button",{class:"action-btn cancel-btn",onClick:E(g=>D(t.id),["stop"])}," 取消收藏 ",8,hs),s("button",{class:"action-btn buy-btn",onClick:E(g=>L(t),["stop"]),disabled:c.value},p(c.value?"处理中...":"立即购买"),9,gs)])])],8,rs))),128))]),_:1})]))])])}}}),Ns=Q(ys,[["__scopeId","data-v-1d635bb7"]]);export{Ns as default};
