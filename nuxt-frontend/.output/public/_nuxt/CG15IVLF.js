import{a as ae,E as le}from"./DIhsiPve.js";import{E as oe}from"./CoJKtQsI.js";import{E as ne}from"./B77-r_qQ.js";import{E as ie}from"./DAIghOY5.js";import{E as re}from"./BTKFVfca.js";import{E as de}from"./b7hvKMAc.js";import{f as ue,R as ce,g as j,r as b,am as pe,h as me,c as k,o as n,b as l,w as a,l as I,aX as fe,d as m,a$ as _e,p as ge,t as u,a as r,F as A,k as B,G as d,D as T,B as _,_ as ye}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{a as ke,b as he}from"./ByqilF2g.js";import{A as ve}from"./Jf5bIUYa.js";import{A as be}from"./Zi8pc7L8.js";import{u as Ce}from"./Ce6k4emn.js";import{a as C}from"./BPYXJYQz.js";import{E as xe}from"./BOUQDXLJ.js";const Ee={class:"cdk-list-view"},Se={class:"filter-group"},Ie={class:"product-cell"},Ae={class:"product-name"},Be={key:0,class:"sku-mappings-cell"},Te={key:0,class:"more-tag"},Ve={class:"code-display"},we={class:"code-text"},Le={class:"stock-info"},$e={class:"remaining"},je=ue({__name:"CdkListByType",props:{type:{}},setup(z){const{getProductTypeLabel:D,getCdkStatusLabel:O,getCdkStatusType:N}=Ce(),h=z,V=ce(),P=j(()=>D(h.type)),x=b(!1),w=b([]),L=b([]),E=b([]),g=b([]),o=pe({categoryId:"",productId:"",status:""}),U=j(()=>o.categoryId?E.value.filter(e=>e.category_id===o.categoryId):E.value),M=async()=>{const e=await ke.getCategories();e.success&&(L.value=e.categories)},R=async()=>{const e=await he.getProducts();e.success&&(E.value=e.products)},f=async()=>{x.value=!0;try{const e={cdk_type:h.type,limit:200};o.productId&&(e.product_id=o.productId),o.status&&o.status!=="unlinked"&&(e.status=o.status);const s=await C.getCdks(e);if(s.success){let i=s.cdks;o.status==="unlinked"&&(i=i.filter(c=>!c.sku_mappings||c.sku_mappings.length===0)),w.value=i}else _.error(s.error)}catch(e){_.error(e.message)}finally{x.value=!1}},X=()=>{o.productId="",f()},$=()=>f(),q=()=>{V.push({path:"/_mgmt_9Xfa3/cdk/post",query:{type:h.type}})},F=e=>{V.push({path:`/_mgmt_9Xfa3/cdk/edit/${e.id}`,query:{type:h.type}})},K=async(e,s)=>{s?(await C.enableCdk(e.id)).success&&(_.success("上架成功"),f()):(await C.disableCdk(e.id)).success&&(_.success("下架成功"),f())},G=e=>g.value=e,J=()=>{g.value.length&&xe.confirm(`确认批量删除 ${g.value.length} 条 CDK？`,"警告",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}).then(async()=>{const e=await C.deleteCdks(g.value.map(s=>s.id));e.success?(_.success("批量删除成功"),g.value=[],f()):_.error(e.error)})},H=e=>O(e),Q=e=>N(e),W=e=>{navigator.clipboard.writeText(e),_.success("已复制")},Y=e=>e?Object.values(e).join(" / "):"默认",Z=e=>{if(!e)return"-";try{const s=JSON.parse(e);return typeof s=="object"&&s!==null?s.fields&&Array.isArray(s.fields)?`字段: ${s.fields.join(", ")}`:Object.entries(s).map(([i,c])=>`${i}：${c}`).join("  "):e}catch{return e}},ee=e=>e.slot_occupancies&&Array.isArray(e.slot_occupancies)?e.slot_occupancies.filter(s=>s.status==="idle").length:e.status==="idle"?e.max_slots||1:0;return me(()=>{M(),R(),f()}),(e,s)=>{const i=le,c=ae,v=oe,p=ne,te=ie,S=re,se=de;return n(),k("div",Ee,[l(ve,null,{default:a(()=>[r("div",Se,[l(c,{modelValue:o.categoryId,"onUpdate:modelValue":s[0]||(s[0]=t=>o.categoryId=t),placeholder:"选择分类",clearable:"",style:{width:"140px"},onChange:X},{default:a(()=>[(n(!0),k(A,null,B(L.value,t=>(n(),d(i,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(c,{modelValue:o.productId,"onUpdate:modelValue":s[1]||(s[1]=t=>o.productId=t),placeholder:"筛选商品",clearable:"",filterable:"",style:{width:"160px"},onChange:$,disabled:!o.categoryId},{default:a(()=>[(n(!0),k(A,null,B(U.value,t=>(n(),d(i,{key:t.id,label:t.product_name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(c,{modelValue:o.status,"onUpdate:modelValue":s[2]||(s[2]=t=>o.status=t),placeholder:"状态",clearable:"",style:{width:"120px"},onChange:$},{default:a(()=>[l(i,{label:"未连接SKU",value:"unlinked"}),l(i,{label:"空闲",value:"idle"}),l(i,{label:"使用中",value:"using"}),l(i,{label:"已使用",value:"used"}),l(i,{label:"已下架",value:"disabled"})]),_:1},8,["modelValue"])])]),actions:a(()=>[l(v,{onClick:f,icon:I(fe)},{default:a(()=>[...s[3]||(s[3]=[m("刷新",-1)])]),_:1},8,["icon"]),l(v,{type:"danger",icon:I(_e),disabled:!g.value.length,onClick:J},{default:a(()=>[...s[4]||(s[4]=[m(" 批量删除 ",-1)])]),_:1},8,["icon","disabled"]),l(v,{type:"primary",icon:I(ge),onClick:q},{default:a(()=>[m("新增 "+u(P.value),1)]),_:1},8,["icon"])]),_:1}),l(be,{data:w.value,loading:x.value,onSelectionChange:G},{default:a(()=>[l(p,{type:"selection",width:"55"}),l(p,{label:"商品","min-width":"180"},{default:a(({row:t})=>[r("div",Ie,[t.product_snapshot?.product_image?(n(),d(te,{key:0,src:t.product_snapshot.product_image,fit:"cover",style:{width:"40px",height:"40px","border-radius":"4px","margin-right":"8px"}},null,8,["src"])):T("",!0),r("span",Ae,u(t.product_snapshot?.product_name||"未知商品"),1)])]),_:1}),l(p,{label:"规格","min-width":"160"},{default:a(({row:t})=>[t.sku_mappings&&t.sku_mappings.length>0?(n(),k("div",Be,[(n(!0),k(A,null,B(t.sku_mappings.slice(0,2),y=>(n(),d(S,{key:y.id,size:"small",effect:"plain",style:{"margin-right":"4px"}},{default:a(()=>[m(u(Y(y.sku?.spec_combination)),1)]),_:2},1024))),128)),t.sku_mappings.length>2?(n(),k("span",Te,"+"+u(t.sku_mappings.length-2),1)):T("",!0)])):(n(),d(S,{key:1,type:"warning",size:"small",effect:"plain"},{default:a(()=>[...s[5]||(s[5]=[m("未绑定",-1)])]),_:1}))]),_:1}),l(p,{label:"内容","min-width":"240"},{default:a(({row:t})=>[r("div",Ve,[r("span",we,u(Z(t.code)),1),t.code?(n(),d(v,{key:0,link:"",size:"small",onClick:y=>W(t.code)},{default:a(()=>[...s[6]||(s[6]=[m("复制",-1)])]),_:1},8,["onClick"])):T("",!0)])]),_:1}),h.type==="shared"?(n(),d(p,{key:0,label:"库存/剩余",width:"120",align:"center"},{default:a(({row:t})=>[r("div",Le,[r("span",null,u(t.max_slots||1),1),s[7]||(s[7]=r("span",{class:"stock-divider"},"/",-1)),r("span",$e,u(ee(t)),1)])]),_:1})):(n(),d(p,{key:1,label:"库存",width:"80",align:"center"},{default:a(({row:t})=>[r("span",null,u(t.stock??1),1)]),_:1})),l(p,{label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[["idle","disabled"].includes(t.status)?(n(),d(se,{key:0,"model-value":t.status==="idle","active-text":"上架","inactive-text":"下架","inline-prompt":"",onChange:y=>K(t,y)},null,8,["model-value","onChange"])):(n(),d(S,{key:1,type:Q(t.status),size:"small"},{default:a(()=>[m(u(H(t.status)),1)]),_:2},1032,["type"]))]),_:1}),l(p,{label:"操作",width:"100",align:"center",fixed:"right"},{default:a(({row:t})=>[l(v,{link:"",type:"primary",size:"small",onClick:y=>F(t)},{default:a(()=>[...s[8]||(s[8]=[m("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","loading"])])}}}),ot=ye(je,[["__scopeId","data-v-8373458f"]]);export{ot as C};
