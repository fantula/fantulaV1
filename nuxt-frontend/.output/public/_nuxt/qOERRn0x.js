import{f as P,r as c,am as T,h as z,c as K,a as l,b as t,w as a,ad as U,B as k,o as C,j as V,E as j,l as v,ew as D,a3 as L,d as u,a_ as F,t as _,i as G,G as H,_ as R}from"./gYbOYKrZ.js";import{E as Y}from"./DrogL690.js";import{E as A}from"./CswOF4xx.js";import{E as J}from"./DTPsCTYH.js";import{E as O}from"./CjhxNRX1.js";import{a as Q,E as W}from"./Dj2lpOJg.js";import{E as X}from"./BxcDqkou.js";import{E as Z}from"./Cq19oc2c.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{v as ee}from"./CUySdIcD.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./BB_Ol6Sd.js";import"./BNtqh2Az.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./BSx1rCp4.js";import"./CaswxL1d.js";import"./BlcygIWm.js";import"./CUkNyi1D.js";import"./pxhmPWjv.js";import"./-tO7MSA0.js";import"./CrRq4wwb.js";import"./C5EOtA6j.js";import"./BPYHQo7_.js";import"./Cr8dt13I.js";import"./DtgOm6Sf.js";import"./BYT9QUPE.js";import"./CdHOYNgq.js";import"./B-n2-D39.js";import"./DxwfhIR6.js";import"./YvAJPawC.js";import"./CqTJWtX6.js";const te={class:"refund-stats-page"},ae={class:"filter-container"},oe={class:"filter-left"},re={class:"filter-right"},le={class:"stat-number"},ne={class:"pagination-wrapper",style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},ie=P({__name:"index",setup(se){const h=c(!1),E=c([]),w=c(0),s=c(1),b=c(20),d=T({orderNo:"",uid:""}),m=async()=>{h.value=!0;try{let e=U().from("refund_requests").select(`
        id,
        order_id,
        user_id,
        reason,
        reason_detail,
        created_at,
        reviewed_at,
        orders!inner(order_no),
        profiles!refund_requests_user_id_fkey(nickname)
      `,{count:"exact"}).eq("status","cancelled").order("reviewed_at",{ascending:!1}).range((s.value-1)*b.value,s.value*b.value-1);const{data:f,error:p,count:g}=await e;if(p){console.error("加载失败:",p),k.error("加载失败: "+p.message);return}E.value=(f||[]).map(r=>({id:r.id,order_id:r.order_id,order_no:r.orders?.order_no||"-",user_id:r.user_id,user_nickname:r.profiles?.nickname,reason:r.reason,reason_detail:r.reason_detail,created_at:r.created_at,reviewed_at:r.reviewed_at})),w.value=g||0}catch(n){k.error("系统错误: "+n.message)}finally{h.value=!1}},y=()=>{s.value=1,m()},N=()=>{d.orderNo="",d.uid="",s.value=1,m()},B=n=>{s.value=n,m()},x=n=>{if(!n)return"-";const e=new Date(n);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};return z(()=>{m()}),(n,e)=>{const f=j,p=Y,g=A,r=J,S=O,i=W,$=X,q=Q,I=Z,M=ee;return C(),K("div",te,[e[5]||(e[5]=l("div",{class:"page-header"},[l("h2",null,"退款统计"),l("p",{class:"sub-desc"},"已取消的退款申请记录")],-1)),t(S,{shadow:"never",class:"filter-card"},{default:a(()=>[l("div",ae,[l("div",oe,[t(p,{modelValue:d.orderNo,"onUpdate:modelValue":e[0]||(e[0]=o=>d.orderNo=o),placeholder:"订单号",clearable:"",style:{width:"200px","margin-right":"15px"},onKeyup:V(y,["enter"])},{prefix:a(()=>[t(f,null,{default:a(()=>[t(v(D))]),_:1})]),_:1},8,["modelValue"]),t(p,{modelValue:d.uid,"onUpdate:modelValue":e[1]||(e[1]=o=>d.uid=o),placeholder:"用户UID",clearable:"",style:{width:"150px","margin-right":"15px"},onKeyup:V(y,["enter"])},{prefix:a(()=>[t(f,null,{default:a(()=>[t(v(L))]),_:1})]),_:1},8,["modelValue"]),t(g,{type:"primary",icon:v(D),onClick:y},{default:a(()=>[...e[2]||(e[2]=[u("查询",-1)])]),_:1},8,["icon"]),t(g,{icon:v(F),onClick:N},{default:a(()=>[...e[3]||(e[3]=[u("刷新",-1)])]),_:1},8,["icon"])]),l("div",re,[t(r,{title:"总取消次数"},{default:a(()=>[l("span",le,_(w.value),1)]),_:1})])])]),_:1}),t(S,{shadow:"never",class:"list-card"},{default:a(()=>[G((C(),H(q,{data:E.value,style:{width:"100%"},border:""},{default:a(()=>[t(i,{prop:"order_no",label:"订单号","min-width":"180","show-overflow-tooltip":""}),t(i,{label:"用户",width:"150"},{default:a(({row:o})=>[l("span",null,_(o.user_nickname||o.user_id?.slice(0,8)),1)]),_:1}),t(i,{prop:"reason",label:"退款原因","min-width":"150","show-overflow-tooltip":""}),t(i,{prop:"reason_detail",label:"补充说明","min-width":"150","show-overflow-tooltip":""},{default:a(({row:o})=>[u(_(o.reason_detail||"-"),1)]),_:1}),t(i,{label:"申请时间",width:"180"},{default:a(({row:o})=>[u(_(x(o.created_at)),1)]),_:1}),t(i,{label:"取消时间",width:"180"},{default:a(({row:o})=>[u(_(x(o.reviewed_at)),1)]),_:1}),t(i,{label:"状态",width:"100",align:"center"},{default:a(()=>[t($,{type:"info"},{default:a(()=>[...e[4]||(e[4]=[u("已取消",-1)])]),_:1})]),_:1})]),_:1},8,["data"])),[[M,h.value]]),l("div",ne,[t(I,{background:"",layout:"total, prev, pager, next",total:w.value,"page-size":b.value,"current-page":s.value,onCurrentChange:B},null,8,["total","page-size","current-page"])])]),_:1})])}}}),tt=R(ie,[["__scopeId","data-v-97bb9292"]]);export{tt as default};
