import{E as H}from"./CswOF4xx.js";import{E as K}from"./Dj2lpOJg.js";import{E as R}from"./BxcDqkou.js";import{E as j}from"./Di9v79cN.js";import{f as q,r as d,am as $,h as J,c,b as i,G as g,D as S,i as O,w as a,B as C,C as Q,o as n,l as k,a_ as W,d as l,p as Y,a as h,t as _,F as Z,k as tt,_ as ot}from"./gYbOYKrZ.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{c as E}from"./9gheNwfe.js";import{u as et}from"./CRWHP3jh.js";import{P as it}from"./BYrpNS1P.js";import{A as at}from"./Ng33ccKC.js";import{B as nt}from"./D10pjZA7.js";import{A as st}from"./CuEj_ZtV.js";import{C as lt,a as rt,_ as pt}from"./Dapi5PT3.js";import{v as ut}from"./CUySdIcD.js";import{E as mt}from"./DK0lTgRd.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./BSx1rCp4.js";import"./Cq9Fpw4b.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./CaswxL1d.js";import"./BlcygIWm.js";import"./Bh6H2ams.js";import"./CUkNyi1D.js";import"./pxhmPWjv.js";import"./-tO7MSA0.js";import"./CrRq4wwb.js";import"./C5EOtA6j.js";import"./BPYHQo7_.js";import"./Cr8dt13I.js";import"./DtgOm6Sf.js";import"./BB_Ol6Sd.js";import"./BYT9QUPE.js";import"./gVImYNNu.js";import"./DMMqLNeM.js";import"./C6CbiQn9.js";import"./B9zwl8KS.js";import"./BPU0QgcX.js";import"./CqTJWtX6.js";/* empty css        */import"./CzVV9LeR.js";/* empty css        */import"./BO6-pa8Z.js";import"./Cq19oc2c.js";import"./CdHOYNgq.js";import"./B-n2-D39.js";import"./DxwfhIR6.js";import"./DrogL690.js";import"./BNtqh2Az.js";import"./YvAJPawC.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./B94kvl1B.js";import"./MkrgA_tt.js";import"./A8Zj-15Y.js";import"./Df-HzxCI.js";import"./CoqpTYH6.js";import"./qZy57oqE.js";import"./DEN0lkI5.js";import"./D6FW0B1r.js";import"./Djfz0t-N.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./BpJTCjS8.js";/* empty css        */import"./C-2dxbDp.js";import"./92s3wAHG.js";const dt={class:"coupon-product-list"},ct={class:"code-info"},ft={class:"code-name"},_t={key:0,class:"product-tags"},vt={key:1,class:"text-secondary"},gt={class:"amount"},Ct={key:0,class:"validity-tag"},kt={key:1,class:"validity-range"},ht=q({__name:"index",setup(yt){const{formatDate:A,formatPrice:L}=et(),x=Q(),y=d(!1),b=d([]),N=d(0),r=d([]),V=d(!1),B=d(null),p=$({visible:!1,couponId:"",couponName:""}),f=$({visible:!1,coupon:null}),v=async()=>{y.value=!0;try{const t=await E.coupon.getCoupons({type:"product"});t.success&&(b.value=t.coupons.map(o=>({...o,statusLoading:!1})),N.value=t.total||b.value.length)}catch{C.error("加载异常")}finally{y.value=!1}},U=()=>{x.push("/_mgmt_9Xfa3/coupons/product/post")},I=t=>{x.push(`/_mgmt_9Xfa3/coupons/product/post?id=${t.id}`)},T=t=>{B.value=t,V.value=!0},G=t=>{p.couponId=t.id,p.couponName=t.name,p.visible=!0},z=t=>{f.coupon=t,f.visible=!0},F=t=>{r.value=t.map(o=>o.id)},M=()=>{r.value.length&&mt.confirm(`确定要删除选中的 ${r.value.length} 个优惠券吗？`,"批量删除",{type:"warning"}).then(async()=>{let t=0;for(const o of r.value)(await E.coupon.deleteCoupon(o)).success&&t++;C.success(`成功删除 ${t} 个优惠券`),v(),r.value=[]})},P=async t=>{t.statusLoading=!0;try{const o=await E.coupon.toggleStatus(t.id,t.status);o.success?C.success(`已${t.status?"启用":"停用"}`):(t.status=!t.status,C.error(o.error||"操作失败"))}catch{t.status=!t.status}finally{t.statusLoading=!1}};return J(()=>{v()}),(t,o)=>{const u=H,m=K,D=R,X=j,w=ut;return n(),c("div",dt,[i(it,{title:"指定商品券",description:"管理特定商品专用的优惠券，用户购买指定商品时可享受优惠。"}),i(at,null,{actions:a(()=>[i(u,{icon:k(W),onClick:v},{default:a(()=>[...o[3]||(o[3]=[l("刷新",-1)])]),_:1},8,["icon"]),i(u,{type:"primary",icon:k(Y),onClick:U},{default:a(()=>[...o[4]||(o[4]=[l("新增指定商品券",-1)])]),_:1},8,["icon"])]),_:1}),r.value.length>0?(n(),g(nt,{key:0,count:r.value.length,onDelete:M},null,8,["count"])):S("",!0),O((n(),g(st,{data:b.value,onSelectionChange:F},{default:a(()=>[i(m,{type:"selection",width:"50",align:"center"}),i(m,{label:"名称","min-width":"180"},{default:a(({row:e})=>[h("div",ct,[h("div",ft,_(e.name),1)])]),_:1}),i(m,{label:"关联商品","min-width":"200"},{default:a(({row:e})=>[e.sku_ids&&e.sku_ids.length?(n(),c("div",_t,[(n(!0),c(Z,null,tt(e.sku_ids.slice(0,3),s=>(n(),g(D,{key:s,size:"small",effect:"plain",class:"product-tag"},{default:a(()=>[l(" SKU: "+_(s.slice(0,6))+"... ",1)]),_:2},1024))),128)),e.sku_ids.length>3?(n(),g(D,{key:0,size:"small",type:"info"},{default:a(()=>[l("+"+_(e.sku_ids.length-3),1)]),_:2},1024)):S("",!0)])):(n(),c("span",vt,"无关联商品"))]),_:1}),i(m,{label:"立减金额",width:"120",align:"right"},{default:a(({row:e})=>[h("span",gt,_(k(L)(e.value)),1)]),_:1}),i(m,{label:"有效期",width:"200",align:"center"},{default:a(({row:e})=>[e.end_date?(n(),c("div",kt,[h("div",null,_(k(A)(e.end_date))+" 到期",1)])):(n(),c("div",Ct,"永久有效"))]),_:1}),i(m,{label:"状态",width:"100",align:"center"},{default:a(({row:e})=>[i(X,{modelValue:e.status,"onUpdate:modelValue":s=>e.status=s,"inline-prompt":"","active-text":"启用","inactive-text":"停用",loading:e.statusLoading,onChange:s=>P(e)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),i(m,{label:"操作",width:"260",align:"center",fixed:"right"},{default:a(({row:e})=>[i(u,{link:"",type:"primary",onClick:s=>I(e)},{default:a(()=>[...o[5]||(o[5]=[l("编辑",-1)])]),_:1},8,["onClick"]),i(u,{link:"",type:"success",onClick:s=>T(e)},{default:a(()=>[...o[6]||(o[6]=[l("发券",-1)])]),_:1},8,["onClick"]),i(u,{link:"",type:"warning",onClick:s=>z(e)},{default:a(()=>[...o[7]||(o[7]=[l("说明",-1)])]),_:1},8,["onClick"]),i(u,{link:"",type:"info",onClick:s=>G(e)},{default:a(()=>[...o[8]||(o[8]=[l("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[w,y.value]]),i(lt,{modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=e=>V.value=e),coupon:B.value},null,8,["modelValue","coupon"]),i(rt,{modelValue:p.visible,"onUpdate:modelValue":o[1]||(o[1]=e=>p.visible=e),"coupon-id":p.couponId,"coupon-name":p.couponName},null,8,["modelValue","coupon-id","coupon-name"]),i(pt,{modelValue:f.visible,"onUpdate:modelValue":o[2]||(o[2]=e=>f.visible=e),coupon:f.coupon,onSaved:v},null,8,["modelValue","coupon"])])}}}),Qo=ot(ht,[["__scopeId","data-v-3436345f"]]);export{Qo as default};
