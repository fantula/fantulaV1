import{f as S,r as a,h as T,a1 as M,ad as w,c as u,a as e,b as v,d as x,w as V,t as d,B as y,C as N,E as R,o as c,l as j,a2 as F,F as U,k as $,_ as L}from"./o2XBa361.js";import{a as P,E as z}from"./CrjkcmUY.js";import{E as A}from"./1SfIsks3.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./-Yx_0iEM.js";/* empty css        */import{E as G}from"./BfOrkIVm.js";import"./qVmxJdp3.js";import"./CqX7ZdKI.js";import"./Dlk0BVst.js";import"./DtTI1xRr.js";import"./Bh6H2ams.js";import"./t2w4jifC.js";import"./Dnj8X3EN.js";import"./ClnTspdU.js";import"./Cq9Fpw4b.js";import"./DC3lfPj1.js";import"./Culj45X8.js";import"./B8yeDp5P.js";import"./B_FoF6yT.js";import"./BlW_46uR.js";import"./Ds34GQx2.js";import"./Dzr5IOAO.js";import"./BB_Ol6Sd.js";import"./Z6faUBN3.js";import"./KSqZSeJ0.js";import"./CQuNCUIC.js";import"./DVQwC1Y0.js";import"./FKUjHIpz.js";import"./DwwA_QlG.js";import"./CleHDoLI.js";const H={class:"refund-apply-page"},J={class:"page-container"},K={class:"page-header"},Q={key:0,class:"loading-state"},W={key:1,class:"error-state"},X={key:2,class:"pending-state"},Y={key:3,class:"apply-form"},Z={class:"order-card"},ee={class:"order-header"},te={class:"order-no"},oe={class:"order-content"},se={class:"product-info"},ae=["src"],re={class:"product-detail"},le={class:"product-name"},ne={class:"product-spec"},ie={class:"order-amount"},ue={class:"form-section"},de={class:"form-section"},ce=["disabled"],pe=S({__name:"create",setup(me){const q=M(),f=N(),s=a(""),n=a(null),_=a(!0),i=a(""),p=a(!1),h=a(!1),m=a(""),b=a(""),B=[{value:"ä¹°é”™å•†å“",label:"ä¹°é”™å•†å“"},{value:"ä¸æƒ³è¦äº†",label:"ä¸æƒ³è¦äº†"},{value:"å•†å“æ— æ³•ä½¿ç”¨",label:"å•†å“æ— æ³•ä½¿ç”¨"},{value:"æœªæ”¶åˆ°å•†å“",label:"æœªæ”¶åˆ°å•†å“"},{value:"å…¶ä»–åŸå› ",label:"å…¶ä»–åŸå› "}];T(()=>{if(s.value=q.query.orderId,!s.value){i.value="ç¼ºå°‘è®¢å•ID",_.value=!1;return}k()});async function k(){_.value=!0,i.value="";try{const o=w(),{data:t,error:r}=await o.from("orders").select("*").eq("id",s.value).single();if(r)throw r;if(n.value=t,!["pending_delivery","active"].includes(t.status)){i.value="å½“å‰è®¢å•çŠ¶æ€ä¸å¯ç”³è¯·é€€æ¬¾";return}const{data:g}=await o.rpc("get_refund_request",{p_order_id:s.value});g?.request?.status==="pending"&&(h.value=!0)}catch(o){i.value=o.message||"åŠ è½½å¤±è´¥"}finally{_.value=!1}}function C(o){return o?.spec_combination?Object.values(o.spec_combination).join(" / "):""}async function I(){if(!(!m.value||p.value)){try{await G.confirm("ç¡®å®šè¦æäº¤é€€æ¬¾ç”³è¯·å—ï¼Ÿ","ç¡®è®¤æäº¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ"})}catch{return}p.value=!0;try{const o=w(),{data:t,error:r}=await o.rpc("create_refund_request",{p_order_id:s.value,p_reason:m.value,p_reason_detail:b.value||null});if(r)throw r;if(!t?.success){y.error(t?.error||"æäº¤å¤±è´¥");return}y.success("é€€æ¬¾ç”³è¯·å·²æäº¤ï¼Œè¯·ç­‰å¾…å®¡æ ¸"),f.replace(`/profile/order/${s.value}`)}catch(o){y.error(o.message||"æäº¤å¤±è´¥")}finally{p.value=!1}}}function E(){s.value?f.push(`/profile/order/${s.value}`):f.back()}return(o,t)=>{const r=R,g=z,D=P,O=A;return c(),u("div",H,[e("div",J,[e("div",K,[e("button",{class:"back-btn",onClick:E},[v(r,null,{default:V(()=>[v(j(F))]),_:1}),t[2]||(t[2]=x(" è¿”å› ",-1))]),t[3]||(t[3]=e("h1",{class:"page-title"},"ç”³è¯·é€€æ¬¾",-1))]),_.value?(c(),u("div",Q,[...t[4]||(t[4]=[e("div",{class:"spinner"},null,-1),e("p",null,"åŠ è½½ä¸­...",-1)])])):i.value?(c(),u("div",W,[t[5]||(t[5]=e("div",{class:"error-icon"},"âš ï¸",-1)),e("p",null,d(i.value),1),e("button",{class:"retry-btn",onClick:k},"é‡è¯•")])):h.value?(c(),u("div",X,[t[6]||(t[6]=e("div",{class:"pending-icon"},"ğŸ•",-1)),t[7]||(t[7]=e("h2",null,"é€€æ¬¾ç”³è¯·å¤„ç†ä¸­",-1)),t[8]||(t[8]=e("p",null,"æ‚¨çš„é€€æ¬¾ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚",-1)),e("button",{class:"primary-btn",onClick:E},"è¿”å›è®¢å•è¯¦æƒ…")])):(c(),u("div",Y,[e("div",Z,[e("div",ee,[t[9]||(t[9]=e("span",{class:"order-label"},"è®¢å•ä¿¡æ¯",-1)),e("span",te,d(n.value?.order_no),1)]),e("div",oe,[e("div",se,[e("img",{src:n.value?.product_snapshot?.image||"/images/placeholder.png",class:"product-img"},null,8,ae),e("div",re,[e("div",le,d(n.value?.product_snapshot?.product_name),1),e("div",ne,d(C(n.value?.sku_snapshot)),1)])]),e("div",ie,"Â¥"+d(n.value?.total_amount),1)])]),e("div",ue,[t[10]||(t[10]=e("div",{class:"form-label"},[x("é€€æ¬¾åŸå›  "),e("span",{class:"required"},"*")],-1)),v(D,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l),placeholder:"è¯·é€‰æ‹©é€€æ¬¾åŸå› ",class:"reason-select"},{default:V(()=>[(c(),u(U,null,$(B,l=>v(g,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),e("div",de,[t[11]||(t[11]=e("div",{class:"form-label"},"è¡¥å……è¯´æ˜",-1)),v(O,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=l=>b.value=l),type:"textarea",rows:3,placeholder:"è¯·è¯¦ç»†æè¿°æ‚¨çš„é—®é¢˜ï¼ˆé€‰å¡«ï¼‰",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),t[12]||(t[12]=e("div",{class:"notice-card"},[e("div",{class:"notice-icon"},"â„¹ï¸"),e("div",{class:"notice-text"}," é€€æ¬¾ç”³è¯·æäº¤åå°†è¿›å…¥äººå·¥å®¡æ ¸æµç¨‹ï¼Œæœ€ç»ˆé€€æ¬¾é‡‘é¢ä»¥å®¡æ ¸ç»“æœä¸ºå‡†ã€‚ ")],-1)),e("button",{class:"submit-btn",disabled:!m.value||p.value,onClick:I},d(p.value?"æäº¤ä¸­...":"æäº¤é€€æ¬¾ç”³è¯·"),9,ce)]))])])}}}),We=L(pe,[["__scopeId","data-v-4bbee51e"]]);export{We as default};
