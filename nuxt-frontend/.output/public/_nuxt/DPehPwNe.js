import{r as _,g as z,f as A,h as G,c as i,a as s,b as d,F as q,k as I,l,w as b,t as c,ac as H,E as U,C as Y,o as r,n as N,D as J,aV as K,b1 as Q,aG as V,b2 as R,d as j,L as W,Y as X,B as E,_ as Z}from"./gYbOYKrZ.js";import{c as F}from"./B1GEwpVY.js";import{u as ee}from"./CRWHP3jh.js";import{u as se}from"./Ce6k4emn.js";function te(){const P=_(!1),p=_([]),v=_([]),f=_("all"),{formatPrice:x,formatDate:M}=ee(),{getOrderStatusLabel:w,getOrderStatusType:S}=se(),L=[{label:"全部订单",value:"all"},{label:"待支付",value:"pending"},{label:"待发货",value:"pending_delivery"},{label:"使用中",value:"active"},{label:"已过期",value:"expired"},{label:"退款/售后",value:"refund"}],C=z(()=>{const e=v.value.map(a=>({id:a.id,order_no:a.order_no,status:"pending",total_amount:a.total_amount,quantity:a.quantity,created_at:a.created_at,product_name:a.product_snapshot?.product_name||"待支付商品",product_image:a.product_snapshot?.image||"",spec_text:m(a.sku_snapshot?.spec_combination),isPending:!0})),h=p.value.map(a=>({id:a.id,order_no:a.order_no,status:a.status,total_amount:a.total_amount,quantity:a.quantity,created_at:a.created_at,product_name:a.product_snapshot?.product_name||"未知商品",product_image:a.product_snapshot?.image||"",spec_text:m(a.sku_snapshot?.spec_combination),isPending:!1})),u=[...e,...h];return u.sort((a,o)=>new Date(o.created_at).getTime()-new Date(a.created_at).getTime()),u}),$={all:()=>!0,pending:e=>e.isPending===!0&&e.status==="pending",pending_delivery:e=>!e.isPending&&e.status==="pending_delivery",active:e=>!e.isPending&&e.status==="active",expired:e=>!e.isPending&&e.status==="expired",refund:e=>!e.isPending&&["refunding","refunded"].includes(e.status)},B=z(()=>{const e=$[f.value];return e?C.value.filter(e):C.value});async function D(){P.value=!0;try{const[e,h]=await Promise.all([F.getOrderList(),F.getPendingPreOrders()]);e.success&&(p.value=e.data||[]),h.success&&(v.value=h.data||[])}catch(e){console.error("加载订单列表失败:",e)}finally{P.value=!1}}function O(e){f.value=e}async function g(e){return(await F.cancelPreOrder(e)).success?(v.value=v.value.filter(u=>u.id!==e),!0):!1}function m(e){return e?typeof e=="string"?e:Object.values(e).join(" / "):""}function y(){return L.find(e=>e.value===f.value)?.label||"订单"}return{loading:P,orders:p,preOrders:v,currentTab:f,tabs:L,allOrders:C,filteredList:B,loadList:D,changeTab:O,deletePreOrder:g,formatSpec:m,getCurrentTabLabel:y,formatPrice:x,formatDate:M,getOrderStatusLabel:w,getOrderStatusType:S}}const ne={class:"orders-page"},ae={class:"order-tabs"},oe=["onClick"],ie={key:0,class:"active-glow"},le={class:"orders-scroll-area"},re={class:"orders-container"},de={key:0,class:"loading-state"},ce={key:1,class:"empty-state"},ue={class:"empty-icon-wrapper"},_e={class:"empty-text"},pe={key:2,class:"order-list"},ve=["onClick"],fe={class:"card-inner"},ge={class:"card-header"},me={class:"order-no-group"},he={class:"value"},be={class:"card-body"},ye={class:"product-thumb"},ke=["src"],xe={key:1,class:"placeholder-img"},Ce={class:"product-info"},Pe={class:"name-row"},we={class:"product-name"},Le={class:"spec-tag"},Oe={class:"price-row"},Te={class:"price"},Me={class:"amount"},Se={class:"qty"},$e={class:"card-footer"},Be={class:"order-time"},De={class:"card-actions"},qe=["onClick"],Ne=["onClick"],Ve=["onClick"],Ee={key:2,class:"action-btn view"},Fe={class:"confirm-content"},ze={class:"confirm-icon"},Ie={class:"confirm-text"},Re=A({__name:"index",setup(P){const p=Y(),{loading:v,filteredList:f,currentTab:x,tabs:M,loadList:w,deletePreOrder:S,getCurrentTabLabel:L,formatDate:C,getOrderStatusLabel:$}=te();G(()=>{w()});const B=o=>$(o),D=o=>C(o),O=o=>{if(o.status==="pending"||o.isPending){p.push(`/checkout/${o.id}`);return}if(["expired","refunded","cancelled"].includes(o.status)){u(o,!1);return}p.push(`/profile/order/${o.id}`)},g=_(!1),m=_(!1),y=_("cleanup"),e=_(null),h=z(()=>y.value==="pending"?"确定要取消这个订单吗？取消后将释放锁定库存。":"该订单已无效(过期或退款)，确认要从列表中移除吗？"),u=(o,n)=>{e.value=o,y.value=n?"pending":"cleanup",g.value=!0},a=async()=>{if(e.value){m.value=!0;try{y.value==="pending"?await S(e.value.id)?(E.success("订单已取消"),g.value=!1):E.error("操作失败"):setTimeout(()=>{E.success("记录已清理"),g.value=!1,w()},500)}catch(o){console.error(o)}finally{m.value=!1}}};return(o,n)=>{const k=U;return r(),i("div",ne,[n[9]||(n[9]=s("div",{class:"section-header"},[s("h2",{class:"section-title"},"我的订单"),s("div",{class:"section-subtitle"},"Order History")],-1)),s("div",ae,[(r(!0),i(q,null,I(l(M),t=>(r(),i("div",{key:t.value,class:N(["tab-item",{active:l(x)===t.value}]),onClick:T=>x.value=t.value},[s("span",null,c(t.label),1),l(x)===t.value?(r(),i("div",ie)):J("",!0)],10,oe))),128))]),s("div",le,[s("div",re,[l(v)?(r(),i("div",de,[...n[2]||(n[2]=[s("div",{class:"glass-loader"},null,-1),s("p",null,"正在加载订单...",-1)])])):l(f).length===0?(r(),i("div",ce,[s("div",ue,[d(k,{class:"empty-icon"},{default:b(()=>[d(l(K))]),_:1})]),s("div",_e,"暂无"+c(l(L)())+"记录",1),s("button",{class:"go-shopping-btn",onClick:n[0]||(n[0]=t=>l(p).push("/"))},"前往选购")])):(r(),i("div",pe,[(r(!0),i(q,null,I(l(f),t=>(r(),i("div",{key:t.id,class:N(["order-card",["status-"+(t.isPending?"pending":t.status)]]),onClick:T=>O(t)},[n[8]||(n[8]=s("div",{class:"status-line"},null,-1)),s("div",fe,[s("div",ge,[s("div",me,[n[3]||(n[3]=s("span",{class:"label"},"NO.",-1)),s("span",he,c(t.order_no),1)]),s("div",{class:N(["status-pill",t.isPending?"pending":t.status])},[n[4]||(n[4]=s("div",{class:"dot"},null,-1)),s("span",null,c(t.isPending?"待支付":B(t.status)),1)],2)]),s("div",be,[s("div",ye,[t.product_image?(r(),i("img",{key:0,src:t.product_image,class:"thumb-img"},null,8,ke)):(r(),i("div",xe,[d(k,null,{default:b(()=>[d(l(Q))]),_:1})]))]),s("div",Ce,[s("div",Pe,[s("h3",we,c(t.product_name),1),s("span",Le,c(t.spec_text||"标准规格"),1)]),s("div",Oe,[s("div",Te,[s("span",Me,c(Number(t.total_amount).toFixed(2)),1),n[5]||(n[5]=s("span",{class:"unit"},"点",-1))]),s("div",Se,"x"+c(t.quantity),1)])])]),s("div",$e,[s("div",Be,c(D(t.created_at)),1),s("div",De,[t.isPending||t.status==="pending"?(r(),i(q,{key:0},[s("button",{class:"action-btn delete",onClick:V(T=>u(t,!0),["stop"])},[d(k,null,{default:b(()=>[d(l(R))]),_:1})],8,qe),s("button",{class:"action-btn pay",onClick:V(T=>O(t),["stop"])},"去支付",8,Ne)],64)):["expired","refunded","cancelled"].includes(t.status)?(r(),i("button",{key:1,class:"action-btn cleanup",onClick:V(T=>u(t,!1),["stop"])},[d(k,null,{default:b(()=>[d(l(R))]),_:1}),n[6]||(n[6]=j(" 清理记录 ",-1))],8,Ve)):(r(),i("button",Ee,[n[7]||(n[7]=j("查看详情 ",-1)),d(k,null,{default:b(()=>[d(l(W))]),_:1})]))])])])],10,ve))),128))]))])]),d(H,{visible:g.value,"onUpdate:visible":n[1]||(n[1]=t=>g.value=t),title:y.value==="pending"?"取消订单":"清理记录",width:"400px",confirmText:"确认删除","confirm-type":"danger",loading:m.value,"show-mascot":"",onConfirm:a},{default:b(()=>[s("div",Fe,[s("div",ze,[d(k,null,{default:b(()=>[d(l(X))]),_:1})]),s("p",Ie,c(h.value),1)])]),_:1},8,["visible","title","loading"])])}}}),Ue=Z(Re,[["__scopeId","data-v-f3252da0"]]);export{Ue as default};
