import{E as Y}from"./COgFiiev.js";import{E as Z}from"./-Yx_0iEM.js";import{E as ee}from"./CFoaU_UR.js";import{E as te}from"./BTJpnMK3.js";import{a as oe,E as ae}from"./Ci1VNkC9.js";import{E as le}from"./Cq9RPQ5L.js";import{E as se}from"./C8ZH7i_a.js";import{a as re,E as ne}from"./CrjkcmUY.js";import{f as ie,r as s,h as ce,g as me,c as y,a as r,b as a,w as l,B as n,o as c,l as V,p as de,d as h,i as pe,G as U,t as $,F as j,k as z,j as ue,E as _e,ew as fe,n as ve,D as ge,ag as ye,_ as he}from"./o2XBa361.js";import{E as be}from"./1SfIsks3.js";import{E as we}from"./BOgRz4Th.js";import{E as Ee}from"./CziALilw.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{c as m}from"./Di05QSSe.js";import{v as xe}from"./BwD4Hz0h.js";import{E as Ce}from"./BfOrkIVm.js";import"./CQuNCUIC.js";import"./Culj45X8.js";import"./Dnj8X3EN.js";import"./t2w4jifC.js";import"./Bh6H2ams.js";import"./DtTI1xRr.js";import"./CleHDoLI.js";import"./Cq9Fpw4b.js";import"./Ds34GQx2.js";import"./Dzr5IOAO.js";import"./hXKBSGVD.js";import"./B_FoF6yT.js";import"./DVQwC1Y0.js";import"./ClnTspdU.js";import"./CqX7ZdKI.js";import"./Dlk0BVst.js";import"./qVmxJdp3.js";import"./C9zJf5rn.js";import"./Bx0EXMjc.js";import"./Z6faUBN3.js";import"./BlW_46uR.js";import"./BCItYl8Z.js";import"./BB_Ol6Sd.js";import"./BHSqheQV.js";import"./DwwA_QlG.js";import"./DC3lfPj1.js";import"./B8yeDp5P.js";import"./KSqZSeJ0.js";import"./FKUjHIpz.js";import"./D6FW0B1r.js";import"./Bdid5VjX.js";import"./XmVVhx5S.js";import"./CM1YTunQ.js";const ke={class:"banner-page"},Ve={class:"action-container"},Be={style:{"margin-bottom":"15px",display:"flex"}},Ie={class:"selector-grid"},Se=["onClick"],De={class:"selector-name"},Ne={key:0,class:"selector-mask"},Ue={class:"pagination-wrapper",style:{"margin-top":"15px",display:"flex","justify-content":"flex-end"}},$e={class:"dialog-footer"},je=ie({__name:"index",setup(ze){const p=s(!1),u=s(!1),b=s([]),w=s([]),B=s([]),E=async()=>{p.value=!0;try{const t=await m.banner.getBanners();t.success?b.value=t.banners:n.error("加载轮播图失败: "+t.error)}finally{p.value=!1}},x=async()=>{const t=await m.image.getImages({category_id:C.value,keyword:k.value});t.success&&(w.value=t.images)};ce(async()=>{await Promise.all([A(),E()])});const A=async()=>{const t=await m.imageCategory.getCategories();t.success&&(B.value=t.categories)},K=me(()=>[...b.value].sort((t,o)=>t.sort_order-o.sort_order)),C=s(""),k=s(""),_=s(""),f=s(null),L=async()=>{_.value="",f.value=null,await x(),u.value=!0},M=t=>{_.value=t.id,f.value=t},T=async()=>{if(f.value){p.value=!0;try{const t=await m.banner.createBanner({image_id:f.value.id,title:f.value.name,sort_order:b.value.length+1});t.success?(n.success("添加成功"),u.value=!1,await E()):n.error("添加失败: "+t.error)}finally{p.value=!1}}},F=async t=>{(await m.banner.updateBanner(t.id,{sort_order:t.sort_order})).success&&n.success("排序已更新")},O=async(t,o)=>{const v=o?"on":"off",i=await m.banner.updateBanner(t.id,{status:v});i.success?(t.status=v,n.success(v==="on"?"已启用":"已停用")):n.error("更新状态失败: "+i.error)},P=t=>{Ce.confirm("确认移除该轮播图吗？","删除",{type:"warning"}).then(async()=>{const o=await m.banner.deleteBanner(t.id);o.success?(n.success("已删除"),await E()):n.error("删除失败: "+o.error)})};return(t,o)=>{const v=Y,i=Z,I=ee,S=te,g=ae,G=le,q=se,H=oe,D=ne,J=re,N=_e,Q=be,R=we,W=Ee,X=xe;return c(),y("div",ke,[o[8]||(o[8]=r("div",{class:"page-header"},[r("h2",null,"轮播图管理")],-1)),a(I,{shadow:"never",class:"action-card"},{default:l(()=>[r("div",Ve,[a(v,{title:"提示：轮播图图片需从图片管理中选择，前端展示顺序由排序值决定（越小越靠前）。",type:"info","show-icon":"",closable:!1,style:{"margin-right":"20px",flex:"1"}}),a(i,{type:"primary",icon:V(de),onClick:L},{default:l(()=>[...o[4]||(o[4]=[h("添加轮播图",-1)])]),_:1},8,["icon"])])]),_:1}),a(I,{shadow:"never",class:"list-card"},{default:l(()=>[pe((c(),U(H,{data:K.value,style:{width:"100%"},border:""},{default:l(()=>[a(g,{label:"图片预览",width:"180"},{default:l(({row:e})=>[a(S,{src:e.image?.url||e.url,fit:"cover",style:{width:"140px",height:"70px","border-radius":"4px"},"preview-src-list":[e.image?.url||e.url]},null,8,["src","preview-src-list"])]),_:1}),a(g,{label:"图片名称","min-width":"200","show-overflow-tooltip":""},{default:l(({row:e})=>[h($(e.image?.name||e.title||"未命名"),1)]),_:1}),a(g,{label:"排序值",width:"150"},{default:l(({row:e})=>[a(G,{modelValue:e.sort_order,"onUpdate:modelValue":d=>e.sort_order=d,min:0,max:999,size:"small","controls-position":"right",onChange:d=>F(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(g,{label:"状态",width:"100",align:"center"},{default:l(({row:e})=>[a(q,{"model-value":e.status==="on",onChange:d=>O(e,!!d)},null,8,["model-value","onChange"])]),_:1}),a(g,{label:"操作",width:"100",fixed:"right",align:"center"},{default:l(({row:e})=>[a(i,{link:"",type:"danger",onClick:d=>P(e)},{default:l(()=>[...o[5]||(o[5]=[h("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,p.value]])]),_:1}),a(W,{modelValue:u.value,"onUpdate:modelValue":o[3]||(o[3]=e=>u.value=e),title:"选择图片",width:"800px"},{footer:l(()=>[r("span",$e,[a(i,{onClick:o[2]||(o[2]=e=>u.value=!1)},{default:l(()=>[...o[6]||(o[6]=[h("取消",-1)])]),_:1}),a(i,{type:"primary",onClick:T,disabled:!_.value},{default:l(()=>[...o[7]||(o[7]=[h("确认添加",-1)])]),_:1},8,["disabled"])])]),default:l(()=>[r("div",Be,[a(J,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=e=>C.value=e),placeholder:"图片分类",clearable:"",style:{width:"150px","margin-right":"15px"},onChange:x},{default:l(()=>[a(D,{label:"全部",value:""}),(c(!0),y(j,null,z(B.value,e=>(c(),U(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(Q,{modelValue:k.value,"onUpdate:modelValue":o[1]||(o[1]=e=>k.value=e),placeholder:"搜索图片名称",clearable:"",style:{width:"200px"},onKeyup:ue(x,["enter"])},{prefix:l(()=>[a(N,null,{default:l(()=>[a(V(fe))]),_:1})]),_:1},8,["modelValue"])]),r("div",Ie,[(c(!0),y(j,null,z(w.value,e=>(c(),y("div",{key:e.id,class:ve(["selector-item",{"is-selected":_.value===e.id}]),onClick:d=>M(e)},[a(S,{src:e.url,fit:"cover",class:"selector-thumb"},null,8,["src"]),r("div",De,$(e.name),1),_.value===e.id?(c(),y("div",Ne,[a(N,null,{default:l(()=>[a(V(ye))]),_:1})])):ge("",!0)],10,Se))),128))]),r("div",Ue,[a(R,{background:"",layout:"prev, pager, next",total:w.value.length,"page-size":12},null,8,["total"])])]),_:1},8,["modelValue"])])}}}),Qt=he(je,[["__scopeId","data-v-22a412b1"]]);export{Qt as default};
