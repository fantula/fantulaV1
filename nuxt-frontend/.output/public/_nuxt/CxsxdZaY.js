import{cW as Xe,cp as ye,b_ as Se,b$ as Q,cr as Ce,c3 as $e,f as Ne,cd as Ee,cX as Be,cY as Ve,cZ as Te,c2 as Oe,c_ as De,r as p,c$ as Fe,g as d,d0 as He,bd as je,J as ie,K as _e,h as Re,cs as B,G as be,o as I,w as m,b as u,T as We,a as k,aD as Le,n as v,l as s,D as S,c as _,aI as N,aG as Ke,E as A,d1 as Ze,F as ke,a2 as qe,L as Ge,d as Je,t as xe,d2 as Ue,a$ as Qe,M as ea,aW as aa,aR as sa,c8 as ta,c9 as Z,d3 as oa,c6 as Pe,ct as na,cI as la,cj as U,bw as ra,d4 as ia,c4 as ze,b0 as ua,d5 as we,d6 as he,cn as ca,bn as da,cH as fa,d7 as va}from"./gYbOYKrZ.js";import{E as ma}from"./CUkNyi1D.js";import{E as pa}from"./BlcygIWm.js";import{u as ga}from"./Djfz0t-N.js";import{d as wa}from"./BPYHQo7_.js";import{u as ha}from"./BNtqh2Az.js";import{a as ya}from"./DxwfhIR6.js";var ba="Expected a function";function re(i,V,T){var c=!0,f=!0;if(typeof i!="function")throw new TypeError(ba);return Xe(T)&&(c="leading"in T?!!T.leading:c,f="trailing"in T?!!T.trailing:f),wa(i,V,{leading:c,maxWait:V,trailing:f})}const ka=Se({urlList:{type:Q(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),Ia={close:()=>!0,error:i=>i instanceof Event,switch:i=>ye(i),rotate:i=>ye(i)},Ea=["src","crossorigin"],La=Ne({name:"ElImageViewer",__name:"image-viewer",props:ka,emits:Ia,setup(i,{expose:V,emit:T}){var c;const f={CONTAIN:{name:"contain",icon:Ee(Ve)},ORIGINAL:{name:"original",icon:Ee(Be)}},r=i,g=T;let q;const{t:ee}=Te(),n=Oe("image-viewer"),{nextZIndex:G}=De(),E=p(),O=p(),D=Fe(),R=d(()=>{const{scale:e,minScale:t,maxScale:l}=r;return He(e,t,l)}),w=p(!0),M=p(!1),x=p(!1),h=p(r.initialIndex),F=je(f.CONTAIN),o=p({scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ue=p((c=r.zIndex)!=null?c:G());ga(x,{ns:n});const ae=d(()=>{const{urlList:e}=r;return e.length<=1}),H=d(()=>h.value===0),se=d(()=>h.value===r.urlList.length-1),j=d(()=>r.urlList[h.value]),ce=d(()=>[n.e("btn"),n.e("prev"),n.is("disabled",!r.infinite&&H.value)]),te=d(()=>[n.e("btn"),n.e("next"),n.is("disabled",!r.infinite&&se.value)]),oe=d(()=>{const{scale:e,deg:t,offsetX:l,offsetY:z,enableTransition:C}=o.value;let b=l/e,$=z/e;const K=t*Math.PI/180,X=Math.cos(K),J=Math.sin(K);b=b*X+$*J,$=$*X-l/e*J;const ge={transform:`scale(${e}) rotate(${t}deg) translate(${b}px, ${$}px)`,transition:C?"transform .3s":""};return F.value.name===f.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),ne=d(()=>`${h.value+1} / ${r.urlList.length}`);function Y(){fe(),q?.(),x.value=!1,g("close")}function de(){const e=re(l=>{switch(ta(l)){case Z.esc:r.closeOnPressEscape&&Y();break;case Z.space:ve();break;case Z.left:me();break;case Z.up:P("zoomIn");break;case Z.right:pe();break;case Z.down:P("zoomOut");break}}),t=re(l=>{const z=l.deltaY||l.deltaX;P(z<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});D.run(()=>{B(document,"keydown",e),B(E,"wheel",t)})}function fe(){D.stop()}function a(){w.value=!1}function L(e){M.value=!0,w.value=!1,g("error",e),e.target.alt=ee("el.image.error")}function y(e){if(w.value||e.button!==0||!E.value)return;o.value.enableTransition=!1;const{offsetX:t,offsetY:l}=o.value,z=e.pageX,C=e.pageY,b=re(X=>{o.value={...o.value,offsetX:t+X.pageX-z,offsetY:l+X.pageY-C}}),$=B(document,"mousemove",b),K=B(document,"mouseup",()=>{$(),K()});e.preventDefault()}function W(e){if(w.value||!E.value||e.touches.length!==1)return;o.value.enableTransition=!1;const{offsetX:t,offsetY:l}=o.value,{pageX:z,pageY:C}=e.touches[0],b=re(X=>{const J=X.touches[0];o.value={...o.value,offsetX:t+J.pageX-z,offsetY:l+J.pageY-C}}),$=B(document,"touchmove",b),K=B(document,"touchend",()=>{$(),K()});e.preventDefault()}function Ie(){o.value={scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ve(){if(w.value||M.value)return;const e=oa(f),t=Object.values(f),l=F.value.name,C=(t.findIndex(b=>b.name===l)+1)%e.length;F.value=f[e[C]],Ie()}function le(e){M.value=!1;const t=r.urlList.length;h.value=(e+t)%t}function me(){H.value&&!r.infinite||le(h.value-1)}function pe(){se.value&&!r.infinite||le(h.value+1)}function P(e,t={}){if(w.value||M.value)return;const{minScale:l,maxScale:z}=r,{zoomRate:C,rotateDeg:b,enableTransition:$}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":o.value.scale>l&&(o.value.scale=Number.parseFloat((o.value.scale/C).toFixed(3)));break;case"zoomIn":o.value.scale<z&&(o.value.scale=Number.parseFloat((o.value.scale*C).toFixed(3)));break;case"clockwise":o.value.deg+=b,g("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=b,g("rotate",o.value.deg);break}o.value.enableTransition=$}function Ae(e){var t;((t=e.detail)==null?void 0:t.focusReason)==="pointer"&&e.preventDefault()}function Me(){r.closeOnPressEscape&&Y()}function Ye(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ie(()=>R.value,e=>{o.value.scale=e}),ie(j,()=>{_e(()=>{const e=O.value;e?.complete||(w.value=!0)})}),ie(h,e=>{Ie(),g("switch",e)}),Re(()=>{x.value=!0,de(),q=B("wheel",Ye,{passive:!1})}),V({setActiveItem:le}),(e,t)=>(I(),be(s(pa),{to:"body",disabled:!e.teleported},{default:m(()=>[u(We,{name:"viewer-fade",appear:""},{default:m(()=>[k("div",{ref_key:"wrapper",ref:E,tabindex:-1,class:v(s(n).e("wrapper")),style:Le({zIndex:ue.value})},[u(s(ma),{loop:"",trapped:"","focus-trap-el":E.value,"focus-start-el":"container",onFocusoutPrevented:Ae,onReleaseRequested:Me},{default:m(()=>[k("div",{class:v(s(n).e("mask")),onClick:t[0]||(t[0]=Ke(l=>e.hideOnClickModal&&Y(),["self"]))},null,2),S(" CLOSE "),k("span",{class:v([s(n).e("btn"),s(n).e("close")]),onClick:Y},[u(s(A),null,{default:m(()=>[u(s(Ze))]),_:1})],2),S(" ARROW "),ae.value?S("v-if",!0):(I(),_(ke,{key:0},[k("span",{class:v(ce.value),onClick:me},[u(s(A),null,{default:m(()=>[u(s(qe))]),_:1})],2),k("span",{class:v(te.value),onClick:pe},[u(s(A),null,{default:m(()=>[u(s(Ge))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(I(),_("div",{key:1,class:v([s(n).e("btn"),s(n).e("progress")])},[N(e.$slots,"progress",{activeIndex:h.value,total:e.urlList.length},()=>[Je(xe(ne.value),1)])],2)):S("v-if",!0),S(" ACTIONS "),k("div",{class:v([s(n).e("btn"),s(n).e("actions")])},[k("div",{class:v(s(n).e("actions__inner"))},[N(e.$slots,"toolbar",{actions:P,prev:me,next:pe,reset:ve,activeIndex:h.value,setActiveItem:le},()=>[u(s(A),{onClick:t[1]||(t[1]=l=>P("zoomOut"))},{default:m(()=>[u(s(Ue))]),_:1}),u(s(A),{onClick:t[2]||(t[2]=l=>P("zoomIn"))},{default:m(()=>[u(s(Qe))]),_:1}),k("i",{class:v(s(n).e("actions__divider"))},null,2),u(s(A),{onClick:ve},{default:m(()=>[(I(),be(ea(F.value.icon)))]),_:1}),k("i",{class:v(s(n).e("actions__divider"))},null,2),u(s(A),{onClick:t[3]||(t[3]=l=>P("anticlockwise"))},{default:m(()=>[u(s(aa))]),_:1}),u(s(A),{onClick:t[4]||(t[4]=l=>P("clockwise"))},{default:m(()=>[u(s(sa))]),_:1})])],2)],2),S(" CANVAS "),k("div",{class:v(s(n).e("canvas"))},[M.value&&e.$slots["viewer-error"]?N(e.$slots,"viewer-error",{key:0,activeIndex:h.value,src:j.value}):(I(),_("img",{ref_key:"imgRef",ref:O,key:j.value,src:j.value,style:Le(oe.value),class:v(s(n).e("img")),crossorigin:e.crossorigin,onLoad:a,onError:L,onMousedown:y,onTouchstart:W},null,46,Ea))],2),N(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var za=$e(La,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const Sa=Pe(za),Ca=Se({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Q([String,Object])},previewSrcList:{type:Q(Array),default:()=>Ce([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),$a={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ye(i),close:()=>!0,show:()=>!0},Na=["src","loading","crossorigin"],Ta={key:0},Oa=Ne({name:"ElImage",inheritAttrs:!1,__name:"image",props:Ca,emits:$a,setup(i,{expose:V,emit:T}){const c=i,f=T,{t:r}=Te(),g=Oe("image"),q=na(),ee=d(()=>la(Object.entries(q).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),n=ha({excludeListeners:!0,excludeKeys:d(()=>Object.keys(ee.value))}),G=p(),E=p(!1),O=p(!0),D=p(!1),R=p(),w=p(),M=U&&"loading"in HTMLImageElement.prototype;let x;const h=d(()=>[g.e("inner"),o.value&&g.e("preview"),O.value&&g.is("loading")]),F=d(()=>{const{fit:a}=c;return U&&a?{objectFit:a}:{}}),o=d(()=>{const{previewSrcList:a}=c;return ra(a)&&a.length>0}),ue=d(()=>{const{previewSrcList:a,initialIndex:L}=c;let y=L;return L>a.length-1&&(y=0),y}),ae=d(()=>c.loading==="eager"?!1:!M&&c.loading==="lazy"||c.lazy),H=()=>{U&&(O.value=!0,E.value=!1,G.value=c.src)};function se(a){O.value=!1,E.value=!1,f("load",a)}function j(a){O.value=!1,E.value=!0,f("error",a)}function ce(a){a&&(H(),ne())}const te=ia(ce,200,!0);async function oe(){var a;if(!U)return;await _e();const{scrollContainer:L}=c;if(ca(L))w.value=L;else if(da(L)&&L!=="")w.value=(a=document.querySelector(L))!=null?a:void 0;else if(R.value){const W=ya(R.value);w.value=fa(W)?void 0:W}const{stop:y}=va(R,([W])=>{te(W.isIntersecting)},{root:w});x=y}function ne(){!U||!te||(x?.(),w.value=void 0,x=void 0)}function Y(){o.value&&(D.value=!0,f("show"))}function de(){D.value=!1,f("close")}function fe(a){f("switch",a)}return ie(()=>c.src,()=>{ae.value?(O.value=!0,E.value=!1,ne(),oe()):H()}),Re(()=>{ae.value?oe():H()}),V({showPreview:Y}),(a,L)=>(I(),_("div",ze({ref_key:"container",ref:R},ee.value,{class:[s(g).b(),a.$attrs.class]}),[E.value?N(a.$slots,"error",{key:0},()=>[k("div",{class:v(s(g).e("error"))},xe(s(r)("el.image.error")),3)]):(I(),_(ke,{key:1},[G.value!==void 0?(I(),_("img",ze({key:0},s(n),{src:G.value,loading:a.loading,style:F.value,class:h.value,crossorigin:a.crossorigin,onClick:Y,onLoad:se,onError:j}),null,16,Na)):S("v-if",!0),O.value?(I(),_("div",{key:1,class:v(s(g).e("wrapper"))},[N(a.$slots,"placeholder",{},()=>[k("div",{class:v(s(g).e("placeholder"))},null,2)])],2)):S("v-if",!0)],64)),o.value?(I(),_(ke,{key:2},[D.value?(I(),be(s(Sa),{key:0,"z-index":a.zIndex,"initial-index":ue.value,infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,scale:a.scale,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:de,onSwitch:fe},ua({toolbar:m(y=>[N(a.$slots,"toolbar",we(he(y)))]),default:m(()=>[a.$slots.viewer?(I(),_("div",Ta,[N(a.$slots,"viewer")])):S("v-if",!0)]),_:2},[a.$slots.progress?{name:"progress",fn:m(y=>[N(a.$slots,"progress",we(he(y)))]),key:"0"}:void 0,a.$slots["viewer-error"]?{name:"viewer-error",fn:m(y=>[N(a.$slots,"viewer-error",we(he(y)))]),key:"1"}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):S("v-if",!0)],64)):S("v-if",!0)],16))}});var _a=$e(Oa,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Ba=Pe(_a);export{Ba as E,Ca as a,Ia as b,ka as c,Sa as d,$a as i,re as t};
