import{f as S,G as E,T as Q,w as g,o as n,c as i,D as r,a as o,t as p,n as C,aI as x,d as w,aD as R,aG as Y,_ as A,g as V,r as b,J as Z,b as m,l as T,Z as j,E as q,a_ as K,aQ as O,F as W,k as X}from"./gYbOYKrZ.js";import{E as ee}from"./CswOF4xx.js";import{E as te}from"./BO6-pa8Z.js";/* empty css        */import{B as oe,c as se}from"./Du3BG93F.js";const ae={key:0,class:"modal-header"},ne={class:"header-content"},le={class:"modal-title"},ie={key:0,class:"modal-subtitle"},de={key:1,class:"modal-footer"},ce={class:"footer-left"},ue={class:"footer-right"},re=["disabled"],fe=["disabled"],me={key:0,class:"btn-loading"},pe=S({__name:"BaseBusinessModal",props:{visible:{type:Boolean},title:{default:"业务弹窗"},subtitle:{},width:{default:"600px"},showHeader:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},showCancel:{type:Boolean,default:!0},showConfirm:{type:Boolean,default:!0},cancelText:{default:"取消"},confirmText:{default:"确定"},loading:{type:Boolean,default:!1},confirmDisabled:{type:Boolean,default:!1}},emits:["close","cancel","confirm"],setup(s,{emit:$}){const d=s,f=$,v=()=>{d.loading||f("close")},h=()=>{d.loading||(f("cancel"),f("close"))},B=()=>{f("confirm")};return(u,c)=>(n(),E(Q,{name:"modal-fade"},{default:g(()=>[s.visible?(n(),i("div",{key:0,class:"modal-mask",onClick:Y(v,["self"])},[o("div",{class:"modal-business",style:R({width:s.width})},[s.showHeader?(n(),i("div",ae,[o("div",ne,[o("div",le,p(s.title),1),s.subtitle?(n(),i("div",ie,p(s.subtitle),1)):r("",!0)]),o("button",{class:"modal-close",onClick:v},"×")])):r("",!0),o("div",{class:C(["modal-body",{"no-header":!s.showHeader}])},[x(u.$slots,"default",{},void 0,!0)],2),s.showFooter?(n(),i("div",de,[o("div",ce,[x(u.$slots,"footer-left",{},void 0,!0)]),o("div",ue,[x(u.$slots,"footer-right",{},()=>[s.showCancel?(n(),i("button",{key:0,class:"btn btn-secondary",onClick:h,disabled:s.loading},p(s.cancelText),9,re)):r("",!0),s.showConfirm?(n(),i("button",{key:1,class:"btn btn-primary",onClick:B,disabled:s.loading||s.confirmDisabled},[s.loading?(n(),i("span",me)):r("",!0),w(" "+p(s.confirmText),1)],8,fe)):r("",!0)],!0)])])):r("",!0)],4)])):r("",!0)]),_:3}))}}),ve=A(pe,[["__scopeId","data-v-79bcbf9a"]]),he={class:"coupon-selector-content"},_e={class:"action-header"},ye={class:"header-tip"},ge={class:"coupon-list-container"},ke={key:0,class:"loading-state"},be={key:1,class:"empty-state"},Ce={key:2,class:"coupon-list"},we={class:"coupon-left"},$e=["onClick"],Be={key:0,class:"inapplicable-reason"},xe={key:0,class:"selected-info"},Te={class:"highlight"},De={class:"discount-preview"},Ie={key:1,class:"selected-info"},Ve=S({__name:"CouponSelectorModal",props:{modelValue:{type:Boolean},orderAmount:{},skuIds:{},productIds:{},currentCouponId:{}},emits:["update:modelValue","select"],setup(s,{emit:$}){const d=s,f=$,v=V({get:()=>d.modelValue,set:e=>f("update:modelValue",e)}),h=b(!1),B=b(!1),u=b([]),c=b(null);Z(()=>d.modelValue,e=>{e&&D()});const F=V(()=>[...u.value].sort((e,t)=>{const a=_(e),y=_(t);return a&&!y?-1:!a&&y?1:t.coupon.value-e.coupon.value})),D=async()=>{h.value=!0;try{const e=await se.getUserCoupons();if(e.success&&e.data){const t=new Date;u.value=e.data.filter(a=>a.status==="unused"&&a.coupon.type!=="balance"&&(!a.coupon.end_date||new Date(a.coupon.end_date)>=t)),d.currentCouponId?c.value=u.value.find(a=>a.id===d.currentCouponId)||null:c.value=null}}catch(e){console.error("Failed to load coupons",e)}finally{h.value=!1}},_=e=>{const t=e.coupon;if(d.orderAmount<t.min_usage)return!1;if(t.type==="product"){t.extra;const a=t;if(a.sku_ids&&a.sku_ids.length>0){if(!d.skuIds.some(k=>a.sku_ids.includes(k)))return!1}else if(a.product_ids&&a.product_ids.length>0&&!d.productIds.some(k=>a.product_ids?.includes(k)))return!1}return!0},M=e=>d.orderAmount<e.coupon.min_usage?`还差 ¥${(e.coupon.min_usage-d.orderAmount).toFixed(2)}`:e.coupon.type==="product"?"该商品不可用":"不可用",z=e=>{_(e)&&(c.value=e)},I=()=>{v.value=!1},N=()=>{f("select",c.value),v.value=!1},H=e=>e.type==="flat"?"purple":e.type==="product"?"cyan":e.type==="balance"?"gold":"default",L=e=>{if(e.type==="product"){const t=e.extra;return t&&t.product_name?`${t.product_name} 专用`:"指定商品专用优惠"}return e.min_usage>0?`满 ${e.min_usage} 可用`:"无门槛使用"},G=e=>e.type==="product"&&(!e.value||e.value===0)?"兑换":e.value,P=e=>e.type==="product"&&(!e.value||e.value===0)?"":"点",U=e=>({flat:"立减券",product:"商品券",balance:"额度券"})[e]||"通用券",J=e=>{if(!e)return"永久有效";const t=new Date(e);return`有效期至 ${t.getFullYear()}.${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getDate()).padStart(2,"0")}`};return(e,t)=>{const a=q,y=ee,k=te;return n(),E(ve,{visible:v.value,title:"选择优惠券",width:"600px",confirmText:"确认使用",loading:B.value,confirmDisabled:!1,onClose:I,onCancel:I,onConfirm:N},{"footer-left":g(()=>[c.value?(n(),i("div",xe,[t[5]||(t[5]=w(" 已选择: ",-1)),o("span",Te,p(c.value.coupon.name),1),o("span",De,"-¥"+p(c.value.coupon.value),1)])):(n(),i("div",Ie," 未选择优惠券 "))]),default:g(()=>[o("div",he,[o("div",_e,[o("div",ye,[m(a,null,{default:g(()=>[m(T(j))]),_:1}),t[1]||(t[1]=w(" 仅显示当前订单可用的优惠券 ",-1))]),m(y,{icon:T(K),circle:"",size:"small",class:"refresh-btn",onClick:D,loading:h.value},null,8,["icon","loading"])]),o("div",ge,[h.value?(n(),i("div",ke,[...t[2]||(t[2]=[o("div",{class:"spinner"},null,-1),w(" 正在获取优惠券... ",-1)])])):u.value.length===0?(n(),i("div",be,[m(k,{description:"暂无可用优惠券","image-size":80})])):(n(),i("div",Ce,[o("div",{class:C(["coupon-item no-coupon glass-card",{active:c.value===null}]),onClick:t[0]||(t[0]=l=>c.value=null)},[o("div",we,[m(a,null,{default:g(()=>[m(T(O))]),_:1})]),t[3]||(t[3]=o("div",{class:"coupon-center"},[o("div",{class:"coupon-title"},"不使用优惠券"),o("div",{class:"coupon-desc"},"放弃当前优惠")],-1)),t[4]||(t[4]=o("div",{class:"coupon-right"},[o("div",{class:"radio-check"})],-1))],2),(n(!0),i(W,null,X(F.value,l=>(n(),i("div",{key:l.id,class:C(["ticket-wrapper",{selected:c.value?.id===l.id,disabled:!_(l)}]),onClick:Se=>z(l)},[m(oe,{color:H(l.coupon),value:G(l.coupon),unit:P(l.coupon),title:l.coupon.name,desc:L(l.coupon),"type-label":U(l.coupon.type),"expiry-text":J(l.coupon.end_date),status:"unused",disabled:!_(l),size:"compact",class:"selector-ticket"},{action:g(()=>[o("div",{class:C(["radio-check",{checked:c.value?.id===l.id}])},null,2)]),_:2},1032,["color","value","unit","title","desc","type-label","expiry-text","disabled"]),_(l)?r("",!0):(n(),i("div",Be,p(M(l)),1))],10,$e))),128))]))])])]),_:1},8,["visible","loading","confirmDisabled"])}}}),Ne=A(Ve,[["__scopeId","data-v-36f7881c"]]);export{Ne as C};
