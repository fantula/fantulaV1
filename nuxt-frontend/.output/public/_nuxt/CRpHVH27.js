import{a as z,E as I}from"./CrjkcmUY.js";import{E as R}from"./-Yx_0iEM.js";import{E as U}from"./Ci1VNkC9.js";import{E as $}from"./C8OXdh39.js";import{E as G}from"./DC3lfPj1.js";import{dM as B,r as A,g as S,B as y,f as H,h as j,c as D,b as a,G as L,D as P,i as J,a as o,w as c,l as s,t as p,o as C,cC as K,a_ as Q,d as w,_ as W}from"./o2XBa361.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{P as X}from"./DLUP05ph.js";import{A as Y}from"./DHlfceZi.js";import{A as Z}from"./BrR7l0bw.js";import{B as tt}from"./HhRrCsya.js";/* empty css        *//* empty css        *//* empty css        */import{D as et}from"./Demiahkb.js";import{E as ot}from"./BfOrkIVm.js";import{v as st}from"./BwD4Hz0h.js";import"./qVmxJdp3.js";import"./CqX7ZdKI.js";import"./Dlk0BVst.js";import"./DtTI1xRr.js";import"./Bh6H2ams.js";import"./t2w4jifC.js";import"./Dnj8X3EN.js";import"./ClnTspdU.js";import"./Cq9Fpw4b.js";import"./B8yeDp5P.js";import"./B_FoF6yT.js";import"./BlW_46uR.js";import"./Ds34GQx2.js";import"./Dzr5IOAO.js";import"./Culj45X8.js";import"./1SfIsks3.js";import"./BB_Ol6Sd.js";import"./DVQwC1Y0.js";import"./Z6faUBN3.js";import"./KSqZSeJ0.js";import"./CQuNCUIC.js";import"./C9zJf5rn.js";import"./Bx0EXMjc.js";import"./hXKBSGVD.js";import"./BCItYl8Z.js";import"./COgFiiev.js";/* empty css        */import"./DytS51kl.js";/* empty css        */import"./C1T5KPmY.js";import"./BOgRz4Th.js";/* empty css        *//* empty css        *//* empty css        */import"./FKUjHIpz.js";import"./DwwA_QlG.js";import"./CleHDoLI.js";const V={async getPreOrders(m){const l=B(),i=m.limit||500;let d=l.from("pre_orders").select(`
                id, order_no, status, total_amount, quantity, created_at, product_snapshot, user_id,
                profiles(id, uid, avatar, nickname)
            `,{count:"exact"}).neq("status","pending").order("created_at",{ascending:!1}).limit(i);const{data:_,error:f,count:x}=await d;return f?(console.error("获取预订单列表失败:",f),{success:!1,orders:[],total:0,error:f.message}):{success:!0,orders:(_||[]).map(h=>{const g=h.profiles||h.profile,T=Array.isArray(g)?g[0]:g||null;return{...h,_profile:T}}),total:x||0}},async deletePreOrders(m){const l=B(),{error:i}=await l.from("pre_orders").delete().in("id",m);return i?{success:!1,error:i.message}:{success:!0}}};function rt(){const m=A(!1),l=A([]),i=A([]),d=A("");async function _(){m.value=!0,i.value=[];try{const{success:t,orders:n,error:r}=await V.getPreOrders({limit:500});if(!t){y.error(r||"加载失败");return}l.value=n}catch(t){console.error("加载预订单失败:",t),y.error("系统异常")}finally{m.value=!1}}const f=S(()=>d.value?l.value.filter(t=>t.status===d.value):l.value),x=S(()=>{const t=l.value.filter(u=>u.status==="converted").length,n=l.value.filter(u=>u.status==="expired").length,r=l.value.filter(u=>u.status==="deleted").length;return{converted:t,expired:n,deleted:r,total:t+n+r}});async function b(){if(i.value.length!==0)try{await ot.confirm(`确定要删除选中的 ${i.value.length} 条预订单记录吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"});const{success:t,error:n}=await V.deletePreOrders(i.value);if(!t){y.error(n||"删除失败");return}y.success(`成功删除 ${i.value.length} 条记录`),_()}catch(t){t!=="cancel"&&y.error("操作取消或失败")}}function h(t){i.value=t.map(n=>n.id)}function g(t){t&&(navigator.clipboard.writeText(t),y.success("已复制"))}return{loading:m,list:f,stats:x,statusFilter:d,selectedIds:i,DEFAULT_AVATAR:et,loadList:_,handleBulkDelete:b,handleSelectionChange:h,handleCopy:g,getStatusText:t=>({converted:"已转换",expired:"已过期",deleted:"已删除"})[t]||t,getStatusType:t=>({converted:"success",expired:"info",deleted:"danger"})[t]||"info",formatTime:t=>t?new Date(t).toLocaleString("zh-CN",{hour12:!1}):"-"}}const at={class:"page-container"},it=["onClick"],lt={class:"user-cell"},nt={class:"user-email"},ct={class:"product-cell"},dt=["src"],pt={class:"amount"},ut={class:"stats-row"},mt={class:"stat-card"},_t={class:"stat-value"},ft={class:"stat-card"},vt={class:"stat-value"},ht={class:"stat-card"},gt={class:"stat-value"},yt={class:"stat-card total"},xt={class:"stat-value"},bt=H({__name:"index",setup(m){const{loading:l,list:i,stats:d,statusFilter:_,selectedIds:f,DEFAULT_AVATAR:x,loadList:b,handleBulkDelete:h,handleSelectionChange:g,handleCopy:T,getStatusText:E,getStatusType:k,formatTime:t}=rt();return j(()=>{b()}),(n,r)=>{const u=I,O=z,N=R,v=U,q=$,F=G,M=st;return C(),D("div",at,[a(X,{title:"预订单统计",description:"查看已转换、已过期、已删除的预订单记录，支持批量清理"}),a(Y,null,{actions:c(()=>[a(O,{modelValue:s(_),"onUpdate:modelValue":r[0]||(r[0]=e=>K(_)?_.value=e:null),placeholder:"状态筛选",clearable:"",style:{width:"140px","margin-right":"12px"}},{default:c(()=>[a(u,{label:"已转换",value:"converted"}),a(u,{label:"已过期",value:"expired"}),a(u,{label:"已删除",value:"deleted"})]),_:1},8,["modelValue"]),a(N,{icon:s(Q),onClick:s(b)},{default:c(()=>[...r[1]||(r[1]=[w("刷新",-1)])]),_:1},8,["icon","onClick"])]),_:1}),s(f).length>0?(C(),L(tt,{key:0,count:s(f).length,onDelete:s(h),"delete-text":"批量删除"},null,8,["count","onDelete"])):P("",!0),J((C(),L(Z,{data:s(i),onSelectionChange:s(g)},{default:c(()=>[a(v,{type:"selection",width:"50"}),a(v,{label:"订单号","min-width":"150"},{default:c(({row:e})=>[o("span",{class:"mono-text",onClick:Tt=>s(T)(e.order_no)},p(e.order_no),9,it)]),_:1}),a(v,{label:"用户","min-width":"140"},{default:c(({row:e})=>[o("div",lt,[a(q,{size:24,src:e._profile?.avatar||s(x)},null,8,["src"]),o("span",nt,p(e._profile?.nickname||e._profile?.uid||"未知用户"),1)])]),_:1}),a(v,{label:"商品","min-width":"180"},{default:c(({row:e})=>[o("div",ct,[e.product_snapshot?.image?(C(),D("img",{key:0,src:e.product_snapshot.image,class:"product-thumb"},null,8,dt)):P("",!0),o("span",null,p(e.product_snapshot?.product_name||"未知商品"),1)])]),_:1}),a(v,{label:"金额",width:"100"},{default:c(({row:e})=>[o("span",pt,"¥"+p(e.total_amount),1)]),_:1}),a(v,{label:"数量",prop:"quantity",width:"80"}),a(v,{label:"状态",width:"100"},{default:c(({row:e})=>[a(F,{type:s(k)(e.status),size:"small"},{default:c(()=>[w(p(s(E)(e.status)),1)]),_:2},1032,["type"])]),_:1}),a(v,{label:"创建时间",width:"170"},{default:c(({row:e})=>[w(p(s(t)(e.created_at)),1)]),_:1})]),_:1},8,["data","onSelectionChange"])),[[M,s(l)]]),o("div",ut,[o("div",mt,[o("div",_t,p(s(d).converted),1),r[2]||(r[2]=o("div",{class:"stat-label"},"已转换",-1))]),o("div",ft,[o("div",vt,p(s(d).expired),1),r[3]||(r[3]=o("div",{class:"stat-label"},"已过期",-1))]),o("div",ht,[o("div",gt,p(s(d).deleted),1),r[4]||(r[4]=o("div",{class:"stat-label"},"已删除",-1))]),o("div",yt,[o("div",xt,p(s(d).total),1),r[5]||(r[5]=o("div",{class:"stat-label"},"总计",-1))])])])}}}),De=W(bt,[["__scopeId","data-v-26e55e06"]]);export{De as default};
