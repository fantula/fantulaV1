import{E as T}from"./DrogL690.js";import{E as $,a as L}from"./A8Zj-15Y.js";import{E as N}from"./CswOF4xx.js";import{E as O,a as j}from"./Df-HzxCI.js";import{E as A}from"./BPU0QgcX.js";import{E as P}from"./CjhxNRX1.js";import{f as X,bI as D,r as p,am as g,c as W,b as a,w as o,o as z,a as _,j as F,d as b,t as G,B as t,I,aj as H,_ as J}from"./gYbOYKrZ.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./BB_Ol6Sd.js";import"./BNtqh2Az.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./C5EOtA6j.js";import"./pxhmPWjv.js";import"./BYT9QUPE.js";import"./B-n2-D39.js";import"./Cr8dt13I.js";import"./CoqpTYH6.js";import"./CqTJWtX6.js";import"./-tO7MSA0.js";const Q={class:"login-container"},Y={class:"code-input-group"},Z={class:"login-hint"},ee=X({__name:"login",setup(ae){const c=D(),y=p("password"),i=p(!1),f=p(!1),d=p(0),V=p(),n=g({email:"",password:""}),k=g({email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),v=p(),r=g({email:"",code:""}),R=g({email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:6,max:6,message:"验证码为6位数字",trigger:"blur"}]}),E=async()=>{if(await V.value?.validate().catch(()=>!1)){i.value=!0;try{const e=await c.login(n.email,n.password);if(!e.success){t.error(e.error||"登录失败");return}t.success(`欢迎回来，${c.adminInfo?.name||"管理员"}`),await I("/_mgmt_9Xfa3")}catch(e){t.error(e.message||"登录失败")}finally{i.value=!1}}},S=async()=>{if(await v.value?.validateField("email").catch(()=>!1)){f.value=!0;try{const e=await c.sendOtp(r.email);if(!e.success){t.error(e.error||"发送验证码失败");return}t.success("验证码已发送到您的邮箱"),B()}catch(e){t.error(e.message||"发送验证码失败")}finally{f.value=!1}}},h=async()=>{if(await v.value?.validate().catch(()=>!1)){i.value=!0;try{const e=await c.loginWithOtp(r.email,r.code);if(!e.success){t.error(e.error||"登录失败");return}t.success(`欢迎回来，${c.adminInfo?.name||"管理员"}`),await I("/_mgmt_9Xfa3")}catch(e){t.error(e.message||"登录失败")}finally{i.value=!1}}},B=()=>{d.value=300;const s=H(()=>{d.value--,d.value<=0&&clearInterval(s)},1e3)},M=s=>{const e=Math.floor(s/60),m=s%60;return`${e}:${m.toString().padStart(2,"0")}`};return(s,e)=>{const m=T,u=L,w=N,x=$,C=j,U=O,q=A,K=P;return z(),W("div",Q,[a(K,{class:"login-card"},{header:o(()=>[...e[5]||(e[5]=[_("div",{class:"card-header"},[_("span",null,"后台管理系统登录")],-1)])]),default:o(()=>[a(U,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=l=>y.value=l),class:"login-tabs"},{default:o(()=>[a(C,{label:"密码登录",name:"password"},{default:o(()=>[a(x,{model:n,rules:k,ref_key:"passwordFormRef",ref:V,"label-width":"0px"},{default:o(()=>[a(u,{prop:"email"},{default:o(()=>[a(m,{modelValue:n.email,"onUpdate:modelValue":e[0]||(e[0]=l=>n.email=l),placeholder:"邮箱","prefix-icon":"Message",clearable:""},null,8,["modelValue"])]),_:1}),a(u,{prop:"password"},{default:o(()=>[a(m,{modelValue:n.password,"onUpdate:modelValue":e[1]||(e[1]=l=>n.password=l),placeholder:"密码","prefix-icon":"Lock","show-password":"",clearable:"",onKeyup:F(E,["enter"])},null,8,["modelValue"])]),_:1}),a(u,null,{default:o(()=>[a(w,{type:"primary",class:"login-btn",onClick:E,loading:i.value},{default:o(()=>[...e[6]||(e[6]=[b(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(C,{label:"验证码登录",name:"otp"},{default:o(()=>[a(x,{model:r,rules:R,ref_key:"otpFormRef",ref:v,"label-width":"0px"},{default:o(()=>[a(u,{prop:"email"},{default:o(()=>[a(m,{modelValue:r.email,"onUpdate:modelValue":e[2]||(e[2]=l=>r.email=l),placeholder:"邮箱","prefix-icon":"Message",clearable:""},null,8,["modelValue"])]),_:1}),a(u,{prop:"code"},{default:o(()=>[_("div",Y,[a(m,{modelValue:r.code,"onUpdate:modelValue":e[3]||(e[3]=l=>r.code=l),placeholder:"验证码","prefix-icon":"Key",clearable:"",onKeyup:F(h,["enter"])},null,8,["modelValue"]),a(w,{type:"primary",plain:"",disabled:d.value>0||f.value,loading:f.value,onClick:S},{default:o(()=>[b(G(d.value>0?M(d.value):"发送验证码"),1)]),_:1},8,["disabled","loading"])])]),_:1}),a(u,null,{default:o(()=>[a(w,{type:"primary",class:"login-btn",onClick:h,loading:i.value},{default:o(()=>[...e[7]||(e[7]=[b(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"]),_("div",Z,[a(q,{title:"测试账号：admin@fantula.com / admin123456",type:"info","show-icon":"",closable:!1})])]),_:1})])}}}),Se=J(ee,[["__scopeId","data-v-43229013"]]);export{Se as default};
