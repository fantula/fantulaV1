import{r as d,am as j,B as g,f as F,h as G,G as V,w as a,l as o,o as b,a as s,D as q,b as i,d as v,E as H,b2 as J,t as n,c as w,_ as K}from"./o2XBa361.js";import{E as O}from"./-Yx_0iEM.js";import{E as Q}from"./Ci1VNkC9.js";import{E as R}from"./DC3lfPj1.js";/* empty css        *//* empty css        *//* empty css        */import{A as W}from"./B1H3rxeS.js";import{A as X}from"./DHlfceZi.js";import{A as Y}from"./BrR7l0bw.js";/* empty css        *//* empty css        *//* empty css        */import{a as $,T as Z}from"./DuAQpBsl.js";import{u as tt}from"./CRWHP3jh.js";import{u as et}from"./Ce6k4emn.js";import{E as ot}from"./BfOrkIVm.js";import"./Culj45X8.js";import"./Dnj8X3EN.js";import"./ClnTspdU.js";import"./Cq9Fpw4b.js";import"./CqX7ZdKI.js";import"./Dlk0BVst.js";import"./qVmxJdp3.js";import"./DtTI1xRr.js";import"./Bh6H2ams.js";import"./t2w4jifC.js";import"./C9zJf5rn.js";import"./Bx0EXMjc.js";import"./Z6faUBN3.js";import"./BlW_46uR.js";import"./hXKBSGVD.js";import"./B_FoF6yT.js";import"./BCItYl8Z.js";import"./BB_Ol6Sd.js";import"./Dzr5IOAO.js";import"./DytS51kl.js";import"./CoC-dpTn.js";import"./B8yeDp5P.js";import"./DxBhpsT5.js";import"./CQuNCUIC.js";/* empty css        *//* empty css        */import"./C1T5KPmY.js";import"./BOgRz4Th.js";import"./CrjkcmUY.js";import"./Ds34GQx2.js";import"./1SfIsks3.js";import"./DVQwC1Y0.js";import"./KSqZSeJ0.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./BwD4Hz0h.js";import"./C8OXdh39.js";import"./BTJpnMK3.js";import"./CleHDoLI.js";import"./CziALilw.js";import"./FKUjHIpz.js";import"./D6FW0B1r.js";/* empty css        *//* empty css        *//* empty css        */import"./DwwA_QlG.js";function at(){const _=d(!1),f=d([]),p=j({page:1,pageSize:20,total:0}),r=d("processing"),h=d([]),{formatDate:C}=tt(),{getTicketPriorityLabel:y,getTicketPriorityType:k,getTicketStatusLabel:T,getTicketStatusType:x}=et(),m=async()=>{_.value=!0;try{const e=await $.getList({page:p.page,pageSize:p.pageSize,status:r.value});e.success?(f.value=e.data,p.total=e.total):g.error(e.error||"加载失败")}catch{g.error("系统错误")}finally{_.value=!1}};return{loading:_,list:f,pagination:p,currentTab:r,selectedIds:h,loadList:m,handlePageChange:e=>{p.page=e,m()},handleTabChange:e=>{r.value=e,p.page=1,m()},handleSelectionChange:e=>{h.value=e.map(u=>u.id)},handleCleanup:async()=>{try{await ot.confirm('此操作将永久删除7天前的"已解决"工单中的所有图片附件以释放空间。聊天记录将保留，但图片将无法查看。确定要执行吗？',"清理图片存储",{confirmButtonText:"确定清理",cancelButtonText:"取消",type:"warning"});const e=await $.cleanupImages(7);e.success?g.success(`清理完成，共删除了 ${e.count} 个文件`):g.error(e.error||"清理失败")}catch{}},handleCopy:e=>{e&&(navigator.clipboard.writeText(e),g.success("复制成功"))},formatDate:C,getTicketPriorityLabel:y,getTicketPriorityType:k,getTicketStatusLabel:T,getTicketStatusType:x}}const it={class:"p-6"},st=["onClick"],nt={class:"sub-text mt-1"},lt={key:0},rt=["onClick"],pt=["title"],ct={key:1,class:"sub-text text-gray-400"},dt=["onClick"],mt={class:"sub-text truncate"},ut={class:"user-cell"},gt={class:"w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-xs font-mono text-gray-500"},_t={class:"flex flex-col min-w-0"},ft={class:"mono-text text-xs"},ht=["title"],Ct=F({__name:"index",setup(_){const{loading:f,list:p,pagination:r,currentTab:h,loadList:C,handlePageChange:y,handleTabChange:k,handleSelectionChange:T,handleCleanup:x,formatDate:m,getTicketPriorityLabel:B,getTicketPriorityType:P,getTicketStatusLabel:A,getTicketStatusType:I}=at(),L=[{name:"processing",label:"处理中"},{name:"resolved",label:"已解决"},{name:"all",label:"全部"}],e=d(!1),u=d(""),S=z=>{u.value=z.id,e.value=!0},M=()=>{e.value=!1,u.value="",C()};return G(()=>{C()}),(z,l)=>{const N=H,D=O,c=Q,U=R;return b(),V(W,{title:"工单管理",tabs:L,"default-tab":o(h),onTabChange:o(k)},{default:a(()=>[s("div",it,[i(X,null,{actions:a(()=>[i(D,{type:"warning",plain:"",onClick:o(x)},{default:a(()=>[i(N,null,{default:a(()=>[i(o(J))]),_:1}),l[3]||(l[3]=v(" 清理历史图片 ",-1))]),_:1},8,["onClick"])]),_:1}),i(Y,{data:o(p),loading:o(f),total:o(r).total,"current-page":o(r).page,"onUpdate:currentPage":l[0]||(l[0]=t=>o(r).page=t),"page-size":o(r).pageSize,"onUpdate:pageSize":l[1]||(l[1]=t=>o(r).pageSize=t),onPageChange:o(y),onSelectionChange:o(T)},{default:a(()=>[i(c,{label:"工单ID",width:"160"},{default:a(({row:t})=>[s("span",{class:"mono-text cursor-pointer hover:text-blue-600",onClick:E=>S(t)},n(t.ticket_no||`T-${t.id.substring(0,8).toUpperCase()}`),9,st),s("div",nt,n(o(m)(t.created_at).split(" ")[0]),1)]),_:1}),i(c,{label:"关联订单",width:"160"},{default:a(({row:t})=>[t.orders?(b(),w("div",lt,[s("div",{class:"mono-text cursor-pointer hover:text-blue-600",onClick:E=>z.handleCopy(t.orders.order_no)},n(t.orders.order_no),9,rt),s("div",{class:"sub-text truncate",title:t.orders.product_snapshot?.product_name},n(t.orders.product_snapshot?.product_name),9,pt)])):(b(),w("div",ct,"-"))]),_:1}),i(c,{label:"内容概要","min-width":"200","show-overflow-tooltip":""},{default:a(({row:t})=>[s("div",{class:"font-medium truncate mb-1 cursor-pointer hover:text-blue-500",onClick:E=>S(t)},n(t.title),9,dt),s("div",mt,n(t.ticket_messages?.[0]?.content||"暂无消息"),1)]),_:1}),i(c,{label:"用户",width:"180"},{default:a(({row:t})=>[s("div",ut,[s("div",gt,n(t.user_id.substring(0,2).toUpperCase()),1),s("div",_t,[s("span",ft,"UID: "+n(t.user_id.substring(0,8).toUpperCase()),1),s("span",{class:"sub-text truncate",title:t.profiles?.email},n(t.profiles?.email||"未知用户"),9,ht)])])]),_:1}),i(c,{label:"优先级",width:"100",align:"center"},{default:a(({row:t})=>[i(U,{type:o(P)(t.priority),effect:"plain",size:"small"},{default:a(()=>[v(n(o(B)(t.priority)),1)]),_:2},1032,["type"])]),_:1}),i(c,{label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[i(U,{type:o(I)(t.status),size:"small"},{default:a(()=>[v(n(o(A)(t.status)),1)]),_:2},1032,["type"])]),_:1}),i(c,{label:"操作",width:"100",fixed:"right",align:"center"},{default:a(({row:t})=>[i(D,{link:"",type:"primary",size:"small",onClick:E=>S(t)},{default:a(()=>[...l[4]||(l[4]=[v(" 处理 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","loading","total","current-page","page-size","onPageChange","onSelectionChange"])]),e.value?(b(),V(Z,{key:0,modelValue:e.value,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value=t),ticketId:u.value,onClosed:M},null,8,["modelValue","ticketId"])):q("",!0)]),_:1},8,["default-tab","onTabChange"])}}}),De=K(Ct,[["__scopeId","data-v-7243089b"]]);export{De as default};
