import{E as z}from"./CswOF4xx.js";import{E as F}from"./Dj2lpOJg.js";import{E as H}from"./Di9v79cN.js";import{f as R,r as m,am as D,h as j,c as k,b as i,G as $,D as q,i as J,w as a,B as u,C as K,o as v,l as _,a_ as O,d,p as Q,a as c,t as C,_ as W}from"./gYbOYKrZ.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{c as V}from"./9gheNwfe.js";import{u as Y}from"./CRWHP3jh.js";import{P as Z}from"./BYrpNS1P.js";import{A as tt}from"./Ng33ccKC.js";import{B as ot}from"./D10pjZA7.js";import{A as et}from"./CuEj_ZtV.js";import{C as it,a as at,_ as nt}from"./Dapi5PT3.js";import{v as lt}from"./CUySdIcD.js";import{E as st}from"./DK0lTgRd.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./BSx1rCp4.js";import"./Cq9Fpw4b.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./CaswxL1d.js";import"./BlcygIWm.js";import"./Bh6H2ams.js";import"./CUkNyi1D.js";import"./pxhmPWjv.js";import"./-tO7MSA0.js";import"./CrRq4wwb.js";import"./C5EOtA6j.js";import"./BPYHQo7_.js";import"./Cr8dt13I.js";import"./DtgOm6Sf.js";import"./BB_Ol6Sd.js";import"./BYT9QUPE.js";import"./gVImYNNu.js";import"./DMMqLNeM.js";import"./C6CbiQn9.js";import"./B9zwl8KS.js";import"./BPU0QgcX.js";import"./CqTJWtX6.js";/* empty css        */import"./CzVV9LeR.js";/* empty css        */import"./BO6-pa8Z.js";import"./Cq19oc2c.js";import"./CdHOYNgq.js";import"./BxcDqkou.js";import"./B-n2-D39.js";import"./DxwfhIR6.js";import"./DrogL690.js";import"./BNtqh2Az.js";import"./YvAJPawC.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./B94kvl1B.js";import"./MkrgA_tt.js";import"./A8Zj-15Y.js";import"./Df-HzxCI.js";import"./CoqpTYH6.js";import"./qZy57oqE.js";import"./DEN0lkI5.js";import"./D6FW0B1r.js";import"./Djfz0t-N.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./BpJTCjS8.js";/* empty css        */import"./C-2dxbDp.js";import"./92s3wAHG.js";const rt={class:"coupon-balance-list"},pt={class:"code-info"},mt={class:"code-name"},ut={class:"amount"},dt={key:0,class:"validity-tag"},ct={key:1,class:"validity-range"},ft=R({__name:"index",setup(vt){const{formatDate:E,formatPrice:A}=Y(),B=K(),b=m(!1),h=m([]),N=m(0),n=m([]),y=m(!1),x=m(null),l=D({visible:!1,couponId:"",couponName:""}),f=D({visible:!1,coupon:null}),g=async()=>{b.value=!0;try{const t=await V.coupon.getCoupons({type:"balance"});t.success?(h.value=t.coupons.map(o=>({...o,statusLoading:!1})),N.value=t.total||h.value.length):u.error(t.error||"加载失败")}catch{u.error("加载异常")}finally{b.value=!1}},S=()=>{B.push("/_mgmt_9Xfa3/coupons/balance/post")},L=t=>{B.push(`/_mgmt_9Xfa3/coupons/balance/post?id=${t.id}`)},I=t=>{x.value=t,y.value=!0},U=t=>{l.couponId=t.id,l.couponName=t.name,l.visible=!0},G=t=>{f.coupon=t,f.visible=!0},T=t=>{n.value=t.map(o=>o.id)},w=()=>{n.value.length&&st.confirm(`确定要删除选中的 ${n.value.length} 个优惠券规则吗？`,"批量删除",{type:"warning"}).then(async()=>{let t=0;for(const o of n.value)(await V.coupon.deleteCoupon(o)).success&&t++;u.success(`成功删除 ${t} 个优惠券规则`),g(),n.value=[]})},M=async t=>{t.statusLoading=!0;try{const o=await V.coupon.toggleStatus(t.id,t.status);o.success?u.success(`已${t.status?"启用":"停用"}`):(t.status=!t.status,u.error(o.error||"操作失败"))}catch{t.status=!t.status,u.error("操作异常")}finally{t.statusLoading=!1}};return j(()=>{g()}),(t,o)=>{const s=z,r=F,P=H,X=lt;return v(),k("div",rt,[i(Z,{title:"额度券管理",description:"管理用于充值用户余额的额度券，用户兑换后直接增加账户余额。"}),i(tt,null,{actions:a(()=>[i(s,{icon:_(O),onClick:g},{default:a(()=>[...o[3]||(o[3]=[d("刷新",-1)])]),_:1},8,["icon"]),i(s,{type:"primary",icon:_(Q),onClick:S},{default:a(()=>[...o[4]||(o[4]=[d("新增额度券",-1)])]),_:1},8,["icon"])]),_:1}),n.value.length>0?(v(),$(ot,{key:0,count:n.value.length,onDelete:w},null,8,["count"])):q("",!0),J((v(),$(et,{data:h.value,onSelectionChange:T},{default:a(()=>[i(r,{type:"selection",width:"50",align:"center"}),i(r,{label:"名称","min-width":"200"},{default:a(({row:e})=>[c("div",pt,[c("div",mt,C(e.name),1)])]),_:1}),i(r,{label:"赠送余额",width:"120",align:"right"},{default:a(({row:e})=>[c("span",ut,C(_(A)(e.value)),1)]),_:1}),i(r,{label:"有效期",width:"220",align:"center"},{default:a(({row:e})=>[e.end_date?(v(),k("div",ct,[c("div",null,C(_(E)(e.start_date)),1),o[5]||(o[5]=c("div",{class:"date-sep"},"至",-1)),c("div",null,C(_(E)(e.end_date)),1)])):(v(),k("div",dt,"永久有效"))]),_:1}),i(r,{label:"状态",width:"100",align:"center"},{default:a(({row:e})=>[i(P,{modelValue:e.status,"onUpdate:modelValue":p=>e.status=p,"inline-prompt":"","active-text":"启用","inactive-text":"停用",loading:e.statusLoading,onChange:p=>M(e)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),i(r,{label:"操作",width:"260",align:"center",fixed:"right"},{default:a(({row:e})=>[i(s,{link:"",type:"primary",onClick:p=>L(e)},{default:a(()=>[...o[6]||(o[6]=[d("编辑",-1)])]),_:1},8,["onClick"]),i(s,{link:"",type:"success",onClick:p=>I(e)},{default:a(()=>[...o[7]||(o[7]=[d("发券",-1)])]),_:1},8,["onClick"]),i(s,{link:"",type:"warning",onClick:p=>G(e)},{default:a(()=>[...o[8]||(o[8]=[d("说明",-1)])]),_:1},8,["onClick"]),i(s,{link:"",type:"info",onClick:p=>U(e)},{default:a(()=>[...o[9]||(o[9]=[d("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,b.value]]),i(it,{modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=e=>y.value=e),coupon:x.value},null,8,["modelValue","coupon"]),i(at,{modelValue:l.visible,"onUpdate:modelValue":o[1]||(o[1]=e=>l.visible=e),"coupon-id":l.couponId,"coupon-name":l.couponName},null,8,["modelValue","coupon-id","coupon-name"]),i(nt,{modelValue:f.visible,"onUpdate:modelValue":o[2]||(o[2]=e=>f.visible=e),coupon:f.coupon,onSaved:g},null,8,["modelValue","coupon"])])}}}),Ro=W(ft,[["__scopeId","data-v-491334bb"]]);export{Ro as default};
