import { E as ElButton } from './index-DR2tYDZ3.mjs';
import { _ as _export_sfc, E as ElIcon, bb as delete_default, ah as ElMessage } from './server.mjs';
import { E as ElTableColumn } from './index-BB44-vTK.mjs';
import { E as ElTag } from './index-BOQJCp53.mjs';
import { defineComponent, ref, mergeProps, unref, withCtx, createVNode, createTextVNode, toDisplayString, createBlock, openBlock, createCommentVNode, reactive, useSSRContext } from 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/vue/index.mjs';
import { ssrRenderComponent, ssrInterpolate, ssrRenderAttr } from 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/vue/server-renderer/index.mjs';
import { A as AdminModuleLayout } from './AdminModuleLayout-5BkqoH-c.mjs';
import { A as AdminActionCard } from './AdminActionCard-Dlb_VPyP.mjs';
import { A as AdminDataTable } from './AdminDataTable-BzMTthVf.mjs';
import { T as TicketChatModal, a as adminTicketApi } from './TicketChatModal-DW4iUsSW.mjs';
import { u as useBizFormat } from './useBizFormat-CLwhy_Ih.mjs';
import { u as useBizConfig } from './useBizConfig-DtWyKy4G.mjs';
import { E as ElMessageBox } from './index-Bf6vTHIR.mjs';
import './index-7IYgoTSU.mjs';
import './use-form-common-props-DlCG9pC5.mjs';
import './constants-hAKFmBbq.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/@ctrl/tinycolor/dist/public_api.js';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/ofetch/dist/node.mjs';
import '../_/renderer.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/vue-bundle-renderer/dist/runtime.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/h3/dist/index.mjs';
import '../nitro/nitro.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/destr/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/hookable/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/node-mock-http/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/ufo/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unstorage/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unstorage/drivers/fs.mjs';
import 'node:crypto';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unstorage/drivers/fs-lite.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unstorage/drivers/lru-cache.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/ohash/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/klona/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/defu/dist/defu.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/scule/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unctx/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/radix3/dist/index.mjs';
import 'node:fs';
import 'node:url';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/pathe/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unhead/dist/server.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/devalue/index.js';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unhead/dist/utils.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/unhead/dist/plugins.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/vue-router/vue-router.node.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/@supabase/supabase-js/dist/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/@vueuse/core/index.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/@vue/shared/dist/shared.cjs.prod.js';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/lodash-unified/import.js';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/form-data/lib/form_data.js';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/proxy-from-env/index.js';
import 'node:http';
import 'node:https';
import 'node:http2';
import 'node:util';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/follow-redirects/index.js';
import 'node:zlib';
import 'node:stream';
import 'node:events';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/cookie-es/dist/index.mjs';
import './index-D_b573Qt.mjs';
import './index-Dxw_X3Hq.mjs';
import './index-CIoWkt90.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/@popperjs/core/dist/index.mjs';
import './focus-trap-D_6Xxduc.mjs';
import './aria-B8G3G_75.mjs';
import './index-BlpH41lu.mjs';
import './event-BZTOGHfp.mjs';
import './raf-CQRaPAjg.mjs';
import 'file:///Users/dalin/fantula/nuxt-frontend/node_modules/normalize-wheel-es/dist/index.js';
import './index-QnhSR2oe.mjs';
import './index-DKY_z0U1.mjs';
import './index-Da73tUO2.mjs';
import './index-pXKVpQSb.mjs';
import './strings-D1uxkXhq.mjs';
import './scroll-DcpXtO6O.mjs';
import './index-Bf1ETwA6.mjs';
import './index-ClPmkyX9.mjs';
import './index-DCrMmn3b.mjs';
import './vnode-D0IHQw_9.mjs';
import './directive-tOiqatq5.mjs';
import './index-CzosOSMt.mjs';
import './index-Dg8Z-nTr.mjs';
import './refs-CxYYXu5Q.mjs';
import './index-B-o0CD59.mjs';
import './index-C2DKVZ9g.mjs';
import './index-Dr3RPaW4.mjs';
import './validator-T0bsmJHo.mjs';

function useAdminTicketList() {
  const loading = ref(false);
  const list = ref([]);
  const pagination = reactive({
    page: 1,
    pageSize: 20,
    total: 0
  });
  const currentTab = ref("processing");
  const selectedIds = ref([]);
  const { formatDate } = useBizFormat();
  const {
    getTicketPriorityLabel,
    getTicketPriorityType,
    getTicketStatusLabel,
    getTicketStatusType
  } = useBizConfig();
  const loadList = async () => {
    loading.value = true;
    try {
      const res = await adminTicketApi.getList({
        page: pagination.page,
        pageSize: pagination.pageSize,
        status: currentTab.value
      });
      if (res.success) {
        list.value = res.data;
        pagination.total = res.total;
      } else {
        ElMessage.error(res.error || "\u52A0\u8F7D\u5931\u8D25");
      }
    } catch (e) {
      ElMessage.error("\u7CFB\u7EDF\u9519\u8BEF");
    } finally {
      loading.value = false;
    }
  };
  const handlePageChange = (page) => {
    pagination.page = page;
    loadList();
  };
  const handleTabChange = (val) => {
    currentTab.value = val;
    pagination.page = 1;
    loadList();
  };
  const handleSelectionChange = (rows) => {
    selectedIds.value = rows.map((r) => r.id);
  };
  const handleCleanup = async () => {
    try {
      await ElMessageBox.confirm(
        '\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u96647\u5929\u524D\u7684"\u5DF2\u89E3\u51B3"\u5DE5\u5355\u4E2D\u7684\u6240\u6709\u56FE\u7247\u9644\u4EF6\u4EE5\u91CA\u653E\u7A7A\u95F4\u3002\u804A\u5929\u8BB0\u5F55\u5C06\u4FDD\u7559\uFF0C\u4F46\u56FE\u7247\u5C06\u65E0\u6CD5\u67E5\u770B\u3002\u786E\u5B9A\u8981\u6267\u884C\u5417\uFF1F',
        "\u6E05\u7406\u56FE\u7247\u5B58\u50A8",
        { confirmButtonText: "\u786E\u5B9A\u6E05\u7406", cancelButtonText: "\u53D6\u6D88", type: "warning" }
      );
      const res = await adminTicketApi.cleanupImages(7);
      if (res.success) {
        ElMessage.success(`\u6E05\u7406\u5B8C\u6210\uFF0C\u5171\u5220\u9664\u4E86 ${res.count} \u4E2A\u6587\u4EF6`);
      } else {
        ElMessage.error(res.error || "\u6E05\u7406\u5931\u8D25");
      }
    } catch (e) {
    }
  };
  const handleCopy = (text) => {
    if (!text) return;
    (void 0).clipboard.writeText(text);
    ElMessage.success("\u590D\u5236\u6210\u529F");
  };
  return {
    loading,
    list,
    pagination,
    currentTab,
    selectedIds,
    loadList,
    handlePageChange,
    handleTabChange,
    handleSelectionChange,
    handleCleanup,
    handleCopy,
    // Exported
    formatDate,
    getTicketPriorityLabel,
    getTicketPriorityType,
    getTicketStatusLabel,
    getTicketStatusType
  };
}
const _sfc_main = /* @__PURE__ */ defineComponent({
  __name: "index",
  __ssrInlineRender: true,
  setup(__props) {
    const {
      loading,
      list,
      pagination,
      currentTab,
      loadList,
      handlePageChange,
      handleTabChange,
      handleSelectionChange,
      handleCleanup,
      formatDate,
      getTicketPriorityLabel,
      getTicketPriorityType,
      getTicketStatusLabel,
      getTicketStatusType
    } = useAdminTicketList();
    const tabs = [
      { name: "processing", label: "\u5904\u7406\u4E2D" },
      { name: "resolved", label: "\u5DF2\u89E3\u51B3" },
      { name: "all", label: "\u5168\u90E8" }
    ];
    const showChat = ref(false);
    const selectedTicketId = ref("");
    const openChat = (row) => {
      selectedTicketId.value = row.id;
      showChat.value = true;
    };
    const onChatClosed = () => {
      showChat.value = false;
      selectedTicketId.value = "";
      loadList();
    };
    return (_ctx, _push, _parent, _attrs) => {
      const _component_el_button = ElButton;
      const _component_el_icon = ElIcon;
      const _component_el_table_column = ElTableColumn;
      const _component_el_tag = ElTag;
      _push(ssrRenderComponent(AdminModuleLayout, mergeProps({
        title: "\u5DE5\u5355\u7BA1\u7406",
        tabs,
        "default-tab": unref(currentTab),
        onTabChange: unref(handleTabChange)
      }, _attrs), {
        default: withCtx((_, _push2, _parent2, _scopeId) => {
          if (_push2) {
            _push2(`<div class="p-6" data-v-7243089b${_scopeId}>`);
            _push2(ssrRenderComponent(AdminActionCard, null, {
              actions: withCtx((_2, _push3, _parent3, _scopeId2) => {
                if (_push3) {
                  _push3(ssrRenderComponent(_component_el_button, {
                    type: "warning",
                    plain: "",
                    onClick: unref(handleCleanup)
                  }, {
                    default: withCtx((_3, _push4, _parent4, _scopeId3) => {
                      if (_push4) {
                        _push4(ssrRenderComponent(_component_el_icon, null, {
                          default: withCtx((_4, _push5, _parent5, _scopeId4) => {
                            if (_push5) {
                              _push5(ssrRenderComponent(unref(delete_default), null, null, _parent5, _scopeId4));
                            } else {
                              return [
                                createVNode(unref(delete_default))
                              ];
                            }
                          }),
                          _: 1
                        }, _parent4, _scopeId3));
                        _push4(` \u6E05\u7406\u5386\u53F2\u56FE\u7247 `);
                      } else {
                        return [
                          createVNode(_component_el_icon, null, {
                            default: withCtx(() => [
                              createVNode(unref(delete_default))
                            ]),
                            _: 1
                          }),
                          createTextVNode(" \u6E05\u7406\u5386\u53F2\u56FE\u7247 ")
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                } else {
                  return [
                    createVNode(_component_el_button, {
                      type: "warning",
                      plain: "",
                      onClick: unref(handleCleanup)
                    }, {
                      default: withCtx(() => [
                        createVNode(_component_el_icon, null, {
                          default: withCtx(() => [
                            createVNode(unref(delete_default))
                          ]),
                          _: 1
                        }),
                        createTextVNode(" \u6E05\u7406\u5386\u53F2\u56FE\u7247 ")
                      ]),
                      _: 1
                    }, 8, ["onClick"])
                  ];
                }
              }),
              _: 1
            }, _parent2, _scopeId));
            _push2(ssrRenderComponent(AdminDataTable, {
              data: unref(list),
              loading: unref(loading),
              total: unref(pagination).total,
              "current-page": unref(pagination).page,
              "onUpdate:currentPage": ($event) => unref(pagination).page = $event,
              "page-size": unref(pagination).pageSize,
              "onUpdate:pageSize": ($event) => unref(pagination).pageSize = $event,
              onPageChange: unref(handlePageChange),
              onSelectionChange: unref(handleSelectionChange)
            }, {
              default: withCtx((_2, _push3, _parent3, _scopeId2) => {
                if (_push3) {
                  _push3(ssrRenderComponent(_component_el_table_column, {
                    label: "\u5DE5\u5355ID",
                    width: "160"
                  }, {
                    default: withCtx(({ row }, _push4, _parent4, _scopeId3) => {
                      if (_push4) {
                        _push4(`<span class="mono-text cursor-pointer hover:text-blue-600" data-v-7243089b${_scopeId3}>${ssrInterpolate(row.ticket_no || `T-${row.id.substring(0, 8).toUpperCase()}`)}</span><div class="sub-text mt-1" data-v-7243089b${_scopeId3}>${ssrInterpolate(unref(formatDate)(row.created_at).split(" ")[0])}</div>`);
                      } else {
                        return [
                          createVNode("span", {
                            class: "mono-text cursor-pointer hover:text-blue-600",
                            onClick: ($event) => openChat(row)
                          }, toDisplayString(row.ticket_no || `T-${row.id.substring(0, 8).toUpperCase()}`), 9, ["onClick"]),
                          createVNode("div", { class: "sub-text mt-1" }, toDisplayString(unref(formatDate)(row.created_at).split(" ")[0]), 1)
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                  _push3(ssrRenderComponent(_component_el_table_column, {
                    label: "\u5173\u8054\u8BA2\u5355",
                    width: "160"
                  }, {
                    default: withCtx(({ row }, _push4, _parent4, _scopeId3) => {
                      var _a, _b, _c, _d;
                      if (_push4) {
                        if (row.orders) {
                          _push4(`<div data-v-7243089b${_scopeId3}><div class="mono-text cursor-pointer hover:text-blue-600" data-v-7243089b${_scopeId3}>${ssrInterpolate(row.orders.order_no)}</div><div class="sub-text truncate"${ssrRenderAttr("title", (_a = row.orders.product_snapshot) == null ? void 0 : _a.product_name)} data-v-7243089b${_scopeId3}>${ssrInterpolate((_b = row.orders.product_snapshot) == null ? void 0 : _b.product_name)}</div></div>`);
                        } else {
                          _push4(`<div class="sub-text text-gray-400" data-v-7243089b${_scopeId3}>-</div>`);
                        }
                      } else {
                        return [
                          row.orders ? (openBlock(), createBlock("div", { key: 0 }, [
                            createVNode("div", {
                              class: "mono-text cursor-pointer hover:text-blue-600",
                              onClick: ($event) => _ctx.handleCopy(row.orders.order_no)
                            }, toDisplayString(row.orders.order_no), 9, ["onClick"]),
                            createVNode("div", {
                              class: "sub-text truncate",
                              title: (_c = row.orders.product_snapshot) == null ? void 0 : _c.product_name
                            }, toDisplayString((_d = row.orders.product_snapshot) == null ? void 0 : _d.product_name), 9, ["title"])
                          ])) : (openBlock(), createBlock("div", {
                            key: 1,
                            class: "sub-text text-gray-400"
                          }, "-"))
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                  _push3(ssrRenderComponent(_component_el_table_column, {
                    label: "\u5185\u5BB9\u6982\u8981",
                    "min-width": "200",
                    "show-overflow-tooltip": ""
                  }, {
                    default: withCtx(({ row }, _push4, _parent4, _scopeId3) => {
                      var _a, _b, _c, _d;
                      if (_push4) {
                        _push4(`<div class="font-medium truncate mb-1 cursor-pointer hover:text-blue-500" data-v-7243089b${_scopeId3}>${ssrInterpolate(row.title)}</div><div class="sub-text truncate" data-v-7243089b${_scopeId3}>${ssrInterpolate(((_b = (_a = row.ticket_messages) == null ? void 0 : _a[0]) == null ? void 0 : _b.content) || "\u6682\u65E0\u6D88\u606F")}</div>`);
                      } else {
                        return [
                          createVNode("div", {
                            class: "font-medium truncate mb-1 cursor-pointer hover:text-blue-500",
                            onClick: ($event) => openChat(row)
                          }, toDisplayString(row.title), 9, ["onClick"]),
                          createVNode("div", { class: "sub-text truncate" }, toDisplayString(((_d = (_c = row.ticket_messages) == null ? void 0 : _c[0]) == null ? void 0 : _d.content) || "\u6682\u65E0\u6D88\u606F"), 1)
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                  _push3(ssrRenderComponent(_component_el_table_column, {
                    label: "\u7528\u6237",
                    width: "180"
                  }, {
                    default: withCtx(({ row }, _push4, _parent4, _scopeId3) => {
                      var _a, _b, _c, _d;
                      if (_push4) {
                        _push4(`<div class="user-cell" data-v-7243089b${_scopeId3}><div class="w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-xs font-mono text-gray-500" data-v-7243089b${_scopeId3}>${ssrInterpolate(row.user_id.substring(0, 2).toUpperCase())}</div><div class="flex flex-col min-w-0" data-v-7243089b${_scopeId3}><span class="mono-text text-xs" data-v-7243089b${_scopeId3}>UID: ${ssrInterpolate(row.user_id.substring(0, 8).toUpperCase())}</span><span class="sub-text truncate"${ssrRenderAttr("title", (_a = row.profiles) == null ? void 0 : _a.email)} data-v-7243089b${_scopeId3}>${ssrInterpolate(((_b = row.profiles) == null ? void 0 : _b.email) || "\u672A\u77E5\u7528\u6237")}</span></div></div>`);
                      } else {
                        return [
                          createVNode("div", { class: "user-cell" }, [
                            createVNode("div", { class: "w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-xs font-mono text-gray-500" }, toDisplayString(row.user_id.substring(0, 2).toUpperCase()), 1),
                            createVNode("div", { class: "flex flex-col min-w-0" }, [
                              createVNode("span", { class: "mono-text text-xs" }, "UID: " + toDisplayString(row.user_id.substring(0, 8).toUpperCase()), 1),
                              createVNode("span", {
                                class: "sub-text truncate",
                                title: (_c = row.profiles) == null ? void 0 : _c.email
                              }, toDisplayString(((_d = row.profiles) == null ? void 0 : _d.email) || "\u672A\u77E5\u7528\u6237"), 9, ["title"])
                            ])
                          ])
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                  _push3(ssrRenderComponent(_component_el_table_column, {
                    label: "\u4F18\u5148\u7EA7",
                    width: "100",
                    align: "center"
                  }, {
                    default: withCtx(({ row }, _push4, _parent4, _scopeId3) => {
                      if (_push4) {
                        _push4(ssrRenderComponent(_component_el_tag, {
                          type: unref(getTicketPriorityType)(row.priority),
                          effect: "plain",
                          size: "small"
                        }, {
                          default: withCtx((_3, _push5, _parent5, _scopeId4) => {
                            if (_push5) {
                              _push5(`${ssrInterpolate(unref(getTicketPriorityLabel)(row.priority))}`);
                            } else {
                              return [
                                createTextVNode(toDisplayString(unref(getTicketPriorityLabel)(row.priority)), 1)
                              ];
                            }
                          }),
                          _: 2
                        }, _parent4, _scopeId3));
                      } else {
                        return [
                          createVNode(_component_el_tag, {
                            type: unref(getTicketPriorityType)(row.priority),
                            effect: "plain",
                            size: "small"
                          }, {
                            default: withCtx(() => [
                              createTextVNode(toDisplayString(unref(getTicketPriorityLabel)(row.priority)), 1)
                            ]),
                            _: 2
                          }, 1032, ["type"])
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                  _push3(ssrRenderComponent(_component_el_table_column, {
                    label: "\u72B6\u6001",
                    width: "100",
                    align: "center"
                  }, {
                    default: withCtx(({ row }, _push4, _parent4, _scopeId3) => {
                      if (_push4) {
                        _push4(ssrRenderComponent(_component_el_tag, {
                          type: unref(getTicketStatusType)(row.status),
                          size: "small"
                        }, {
                          default: withCtx((_3, _push5, _parent5, _scopeId4) => {
                            if (_push5) {
                              _push5(`${ssrInterpolate(unref(getTicketStatusLabel)(row.status))}`);
                            } else {
                              return [
                                createTextVNode(toDisplayString(unref(getTicketStatusLabel)(row.status)), 1)
                              ];
                            }
                          }),
                          _: 2
                        }, _parent4, _scopeId3));
                      } else {
                        return [
                          createVNode(_component_el_tag, {
                            type: unref(getTicketStatusType)(row.status),
                            size: "small"
                          }, {
                            default: withCtx(() => [
                              createTextVNode(toDisplayString(unref(getTicketStatusLabel)(row.status)), 1)
                            ]),
                            _: 2
                          }, 1032, ["type"])
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                  _push3(ssrRenderComponent(_component_el_table_column, {
                    label: "\u64CD\u4F5C",
                    width: "100",
                    fixed: "right",
                    align: "center"
                  }, {
                    default: withCtx(({ row }, _push4, _parent4, _scopeId3) => {
                      if (_push4) {
                        _push4(ssrRenderComponent(_component_el_button, {
                          link: "",
                          type: "primary",
                          size: "small",
                          onClick: ($event) => openChat(row)
                        }, {
                          default: withCtx((_3, _push5, _parent5, _scopeId4) => {
                            if (_push5) {
                              _push5(` \u5904\u7406 `);
                            } else {
                              return [
                                createTextVNode(" \u5904\u7406 ")
                              ];
                            }
                          }),
                          _: 2
                        }, _parent4, _scopeId3));
                      } else {
                        return [
                          createVNode(_component_el_button, {
                            link: "",
                            type: "primary",
                            size: "small",
                            onClick: ($event) => openChat(row)
                          }, {
                            default: withCtx(() => [
                              createTextVNode(" \u5904\u7406 ")
                            ]),
                            _: 1
                          }, 8, ["onClick"])
                        ];
                      }
                    }),
                    _: 1
                  }, _parent3, _scopeId2));
                } else {
                  return [
                    createVNode(_component_el_table_column, {
                      label: "\u5DE5\u5355ID",
                      width: "160"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode("span", {
                          class: "mono-text cursor-pointer hover:text-blue-600",
                          onClick: ($event) => openChat(row)
                        }, toDisplayString(row.ticket_no || `T-${row.id.substring(0, 8).toUpperCase()}`), 9, ["onClick"]),
                        createVNode("div", { class: "sub-text mt-1" }, toDisplayString(unref(formatDate)(row.created_at).split(" ")[0]), 1)
                      ]),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u5173\u8054\u8BA2\u5355",
                      width: "160"
                    }, {
                      default: withCtx(({ row }) => {
                        var _a, _b;
                        return [
                          row.orders ? (openBlock(), createBlock("div", { key: 0 }, [
                            createVNode("div", {
                              class: "mono-text cursor-pointer hover:text-blue-600",
                              onClick: ($event) => _ctx.handleCopy(row.orders.order_no)
                            }, toDisplayString(row.orders.order_no), 9, ["onClick"]),
                            createVNode("div", {
                              class: "sub-text truncate",
                              title: (_a = row.orders.product_snapshot) == null ? void 0 : _a.product_name
                            }, toDisplayString((_b = row.orders.product_snapshot) == null ? void 0 : _b.product_name), 9, ["title"])
                          ])) : (openBlock(), createBlock("div", {
                            key: 1,
                            class: "sub-text text-gray-400"
                          }, "-"))
                        ];
                      }),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u5185\u5BB9\u6982\u8981",
                      "min-width": "200",
                      "show-overflow-tooltip": ""
                    }, {
                      default: withCtx(({ row }) => {
                        var _a, _b;
                        return [
                          createVNode("div", {
                            class: "font-medium truncate mb-1 cursor-pointer hover:text-blue-500",
                            onClick: ($event) => openChat(row)
                          }, toDisplayString(row.title), 9, ["onClick"]),
                          createVNode("div", { class: "sub-text truncate" }, toDisplayString(((_b = (_a = row.ticket_messages) == null ? void 0 : _a[0]) == null ? void 0 : _b.content) || "\u6682\u65E0\u6D88\u606F"), 1)
                        ];
                      }),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u7528\u6237",
                      width: "180"
                    }, {
                      default: withCtx(({ row }) => {
                        var _a, _b;
                        return [
                          createVNode("div", { class: "user-cell" }, [
                            createVNode("div", { class: "w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-xs font-mono text-gray-500" }, toDisplayString(row.user_id.substring(0, 2).toUpperCase()), 1),
                            createVNode("div", { class: "flex flex-col min-w-0" }, [
                              createVNode("span", { class: "mono-text text-xs" }, "UID: " + toDisplayString(row.user_id.substring(0, 8).toUpperCase()), 1),
                              createVNode("span", {
                                class: "sub-text truncate",
                                title: (_a = row.profiles) == null ? void 0 : _a.email
                              }, toDisplayString(((_b = row.profiles) == null ? void 0 : _b.email) || "\u672A\u77E5\u7528\u6237"), 9, ["title"])
                            ])
                          ])
                        ];
                      }),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u4F18\u5148\u7EA7",
                      width: "100",
                      align: "center"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode(_component_el_tag, {
                          type: unref(getTicketPriorityType)(row.priority),
                          effect: "plain",
                          size: "small"
                        }, {
                          default: withCtx(() => [
                            createTextVNode(toDisplayString(unref(getTicketPriorityLabel)(row.priority)), 1)
                          ]),
                          _: 2
                        }, 1032, ["type"])
                      ]),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u72B6\u6001",
                      width: "100",
                      align: "center"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode(_component_el_tag, {
                          type: unref(getTicketStatusType)(row.status),
                          size: "small"
                        }, {
                          default: withCtx(() => [
                            createTextVNode(toDisplayString(unref(getTicketStatusLabel)(row.status)), 1)
                          ]),
                          _: 2
                        }, 1032, ["type"])
                      ]),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u64CD\u4F5C",
                      width: "100",
                      fixed: "right",
                      align: "center"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode(_component_el_button, {
                          link: "",
                          type: "primary",
                          size: "small",
                          onClick: ($event) => openChat(row)
                        }, {
                          default: withCtx(() => [
                            createTextVNode(" \u5904\u7406 ")
                          ]),
                          _: 1
                        }, 8, ["onClick"])
                      ]),
                      _: 1
                    })
                  ];
                }
              }),
              _: 1
            }, _parent2, _scopeId));
            _push2(`</div>`);
            if (showChat.value) {
              _push2(ssrRenderComponent(TicketChatModal, {
                modelValue: showChat.value,
                "onUpdate:modelValue": ($event) => showChat.value = $event,
                ticketId: selectedTicketId.value,
                onClosed: onChatClosed
              }, null, _parent2, _scopeId));
            } else {
              _push2(`<!---->`);
            }
          } else {
            return [
              createVNode("div", { class: "p-6" }, [
                createVNode(AdminActionCard, null, {
                  actions: withCtx(() => [
                    createVNode(_component_el_button, {
                      type: "warning",
                      plain: "",
                      onClick: unref(handleCleanup)
                    }, {
                      default: withCtx(() => [
                        createVNode(_component_el_icon, null, {
                          default: withCtx(() => [
                            createVNode(unref(delete_default))
                          ]),
                          _: 1
                        }),
                        createTextVNode(" \u6E05\u7406\u5386\u53F2\u56FE\u7247 ")
                      ]),
                      _: 1
                    }, 8, ["onClick"])
                  ]),
                  _: 1
                }),
                createVNode(AdminDataTable, {
                  data: unref(list),
                  loading: unref(loading),
                  total: unref(pagination).total,
                  "current-page": unref(pagination).page,
                  "onUpdate:currentPage": ($event) => unref(pagination).page = $event,
                  "page-size": unref(pagination).pageSize,
                  "onUpdate:pageSize": ($event) => unref(pagination).pageSize = $event,
                  onPageChange: unref(handlePageChange),
                  onSelectionChange: unref(handleSelectionChange)
                }, {
                  default: withCtx(() => [
                    createVNode(_component_el_table_column, {
                      label: "\u5DE5\u5355ID",
                      width: "160"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode("span", {
                          class: "mono-text cursor-pointer hover:text-blue-600",
                          onClick: ($event) => openChat(row)
                        }, toDisplayString(row.ticket_no || `T-${row.id.substring(0, 8).toUpperCase()}`), 9, ["onClick"]),
                        createVNode("div", { class: "sub-text mt-1" }, toDisplayString(unref(formatDate)(row.created_at).split(" ")[0]), 1)
                      ]),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u5173\u8054\u8BA2\u5355",
                      width: "160"
                    }, {
                      default: withCtx(({ row }) => {
                        var _a, _b;
                        return [
                          row.orders ? (openBlock(), createBlock("div", { key: 0 }, [
                            createVNode("div", {
                              class: "mono-text cursor-pointer hover:text-blue-600",
                              onClick: ($event) => _ctx.handleCopy(row.orders.order_no)
                            }, toDisplayString(row.orders.order_no), 9, ["onClick"]),
                            createVNode("div", {
                              class: "sub-text truncate",
                              title: (_a = row.orders.product_snapshot) == null ? void 0 : _a.product_name
                            }, toDisplayString((_b = row.orders.product_snapshot) == null ? void 0 : _b.product_name), 9, ["title"])
                          ])) : (openBlock(), createBlock("div", {
                            key: 1,
                            class: "sub-text text-gray-400"
                          }, "-"))
                        ];
                      }),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u5185\u5BB9\u6982\u8981",
                      "min-width": "200",
                      "show-overflow-tooltip": ""
                    }, {
                      default: withCtx(({ row }) => {
                        var _a, _b;
                        return [
                          createVNode("div", {
                            class: "font-medium truncate mb-1 cursor-pointer hover:text-blue-500",
                            onClick: ($event) => openChat(row)
                          }, toDisplayString(row.title), 9, ["onClick"]),
                          createVNode("div", { class: "sub-text truncate" }, toDisplayString(((_b = (_a = row.ticket_messages) == null ? void 0 : _a[0]) == null ? void 0 : _b.content) || "\u6682\u65E0\u6D88\u606F"), 1)
                        ];
                      }),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u7528\u6237",
                      width: "180"
                    }, {
                      default: withCtx(({ row }) => {
                        var _a, _b;
                        return [
                          createVNode("div", { class: "user-cell" }, [
                            createVNode("div", { class: "w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-xs font-mono text-gray-500" }, toDisplayString(row.user_id.substring(0, 2).toUpperCase()), 1),
                            createVNode("div", { class: "flex flex-col min-w-0" }, [
                              createVNode("span", { class: "mono-text text-xs" }, "UID: " + toDisplayString(row.user_id.substring(0, 8).toUpperCase()), 1),
                              createVNode("span", {
                                class: "sub-text truncate",
                                title: (_a = row.profiles) == null ? void 0 : _a.email
                              }, toDisplayString(((_b = row.profiles) == null ? void 0 : _b.email) || "\u672A\u77E5\u7528\u6237"), 9, ["title"])
                            ])
                          ])
                        ];
                      }),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u4F18\u5148\u7EA7",
                      width: "100",
                      align: "center"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode(_component_el_tag, {
                          type: unref(getTicketPriorityType)(row.priority),
                          effect: "plain",
                          size: "small"
                        }, {
                          default: withCtx(() => [
                            createTextVNode(toDisplayString(unref(getTicketPriorityLabel)(row.priority)), 1)
                          ]),
                          _: 2
                        }, 1032, ["type"])
                      ]),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u72B6\u6001",
                      width: "100",
                      align: "center"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode(_component_el_tag, {
                          type: unref(getTicketStatusType)(row.status),
                          size: "small"
                        }, {
                          default: withCtx(() => [
                            createTextVNode(toDisplayString(unref(getTicketStatusLabel)(row.status)), 1)
                          ]),
                          _: 2
                        }, 1032, ["type"])
                      ]),
                      _: 1
                    }),
                    createVNode(_component_el_table_column, {
                      label: "\u64CD\u4F5C",
                      width: "100",
                      fixed: "right",
                      align: "center"
                    }, {
                      default: withCtx(({ row }) => [
                        createVNode(_component_el_button, {
                          link: "",
                          type: "primary",
                          size: "small",
                          onClick: ($event) => openChat(row)
                        }, {
                          default: withCtx(() => [
                            createTextVNode(" \u5904\u7406 ")
                          ]),
                          _: 1
                        }, 8, ["onClick"])
                      ]),
                      _: 1
                    })
                  ]),
                  _: 1
                }, 8, ["data", "loading", "total", "current-page", "onUpdate:currentPage", "page-size", "onUpdate:pageSize", "onPageChange", "onSelectionChange"])
              ]),
              showChat.value ? (openBlock(), createBlock(TicketChatModal, {
                key: 0,
                modelValue: showChat.value,
                "onUpdate:modelValue": ($event) => showChat.value = $event,
                ticketId: selectedTicketId.value,
                onClosed: onChatClosed
              }, null, 8, ["modelValue", "onUpdate:modelValue", "ticketId"])) : createCommentVNode("", true)
            ];
          }
        }),
        _: 1
      }, _parent));
    };
  }
});
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("pages/_mgmt_9Xfa3/tickets/index.vue");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};
const index = /* @__PURE__ */ _export_sfc(_sfc_main, [["__scopeId", "data-v-7243089b"]]);

export { index as default };
//# sourceMappingURL=index-CYOPMI85.mjs.map
