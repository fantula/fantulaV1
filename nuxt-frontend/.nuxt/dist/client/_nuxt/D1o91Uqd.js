import{E as R}from"./BTKFVfca.js";import{E as j}from"./CoJKtQsI.js";import{E as O}from"./BCllKHMW.js";import{E as H}from"./PbH8IyH8.js";import{E as J}from"./D2n2RcOH.js";import{E as P}from"./CgQ-l74f.js";import{E as Q}from"./CZLDLz6s.js";import{a as W,E as X}from"./DIhsiPve.js";import{E as Y,a as Z}from"./ClIUVBla.js";import{E as ee}from"./DB7JGTAC.js";import{a as te,E as oe}from"./B77-r_qQ.js";import{f as le,r as u,am as B,h as ae,c as b,a as i,b as t,w as o,o as y,j as se,d as n,D as ie,ay as re,F as ne,k as me,t as f,l as pe,c_ as de,i as ue,G as ce,B as m,_ as fe}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{g as I,h as _e}from"./ByqilF2g.js";import{v as ve}from"./BrE0JoK1.js";import{E as ge}from"./BOUQDXLJ.js";import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./BB_Ol6Sd.js";import"./C6m5ANi3.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./BjbJQEzT.js";import"./wVnq5BSo.js";import"./BC9Y1jC9.js";import"./OwHC_0Ap.js";import"./CNYNJsmX.js";import"./aSYcAdI9.js";import"./B_7HZhJl.js";import"./DW0_wk9g.js";import"./uZ_KtR8H.js";import"./CB_o0Cdi.js";import"./BzZM8Et6.js";import"./CXRxotb2.js";import"./CCDBlmbt.js";import"./DE5qJ7kT.js";import"./CChPPi86.js";import"./D-7LAYt0.js";import"./BPYXJYQz.js";import"./BV_QTDOQ.js";import"./DgMG35os.js";import"./hs4dPNZ2.js";import"./tbxUD7ww.js";import"./DxNR5PDn.js";const ye={class:"message-page"},we={class:"content-layout"},Ee={class:"card-header"},be={class:"recipient-input-area"},he={class:"recipient-list"},ke={class:"recipient-info"},Ve={class:"recipient-name"},Ue={class:"recipient-uid"},xe={key:0,class:"empty-list"},Ce={class:"card-header"},De=le({__name:"index",setup(Be){const _=u(""),h=u(!1),k=u(!1),V=u(!1),r=u([]),C=u([]),w=u(),a=B({type:"system",title:"",content:"",link:""}),M=B({title:[{required:!0,message:"è¯·è¾“å…¥æ¶ˆæ¯æ ‡é¢˜",trigger:"blur"}],content:[{required:!0,message:"è¯·è¾“å…¥æ¶ˆæ¯æ­£æ–‡",trigger:"blur"}]}),T=s=>new Date(s).toLocaleString("zh-CN"),U=async()=>{V.value=!0;try{const s=await I.getMessages({limit:20});s.success&&(C.value=s.messages)}catch(s){console.error("åŠ è½½æ¶ˆæ¯å¤±è´¥:",s)}finally{V.value=!1}},D=async()=>{const s=_.value.trim();if(s){if(s.length!==8){m.warning("UID æ ¼å¼é”™è¯¯ï¼Œåº”ä¸º8ä½æ•°å­—");return}if(r.value.some(e=>e.uid===s)){m.warning("è¯¥ç”¨æˆ·å·²åœ¨åˆ—è¡¨ä¸­"),_.value="";return}h.value=!0;try{const e=await _e.getUserByUid(s);e.success&&e.user?(r.value.unshift({uid:e.user.uid,email:e.user.email}),m.success(`æ·»åŠ ç”¨æˆ· ${e.user.email} æˆåŠŸ`),_.value=""):m.error("ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥UID")}catch(e){m.error(e.message||"æŸ¥è¯¢ç”¨æˆ·å¤±è´¥")}finally{h.value=!1}}},$=s=>{r.value=r.value.filter(e=>e.uid!==s)},z=async()=>{if(r.value.length===0){m.warning("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæŽ¥æ”¶ç”¨æˆ·");return}w.value&&await w.value.validate(async s=>{if(s)try{await ge.confirm(`ç¡®è®¤å‘ ${r.value.length} ä½ç”¨æˆ·å‘é€æ¶ˆæ¯å—ï¼Ÿ
å‘é€åŽä¸å¯æ’¤å›žã€‚`,"å‘é€ç¡®è®¤",{confirmButtonText:"ç¡®è®¤å‘é€",cancelButtonText:"å–æ¶ˆ",type:"warning"}),k.value=!0;let e=0,c=0;for(const p of r.value){const d=await I.sendMessage(p.uid,a.title,a.content,a.type,a.link||void 0);d.success?e++:(c++,console.error(`å‘é€ç»™ ${p.uid} å¤±è´¥:`,d.error))}e>0?m.success(`æˆåŠŸå‘é€ ${e} æ¡æ¶ˆæ¯${c>0?`ï¼Œå¤±è´¥ ${c} æ¡`:""}`):m.error("æ¶ˆæ¯å‘é€å¤±è´¥"),r.value=[],a.type="system",a.title="",a.content="",a.link="",w.value?.resetFields(),await U()}catch{}finally{k.value=!1}})};return ae(()=>{U()}),(s,e)=>{const c=R,p=j,d=O,A=H,F=J,N=P,x=Q,E=X,L=W,v=Z,S=ee,q=Y,g=oe,G=te,K=ve;return y(),b("div",ye,[e[14]||(e[14]=i("div",{class:"page-header"},[i("h2",null,"æ¶ˆæ¯å‘é€ç®¡ç†")],-1)),i("div",we,[t(x,{shadow:"never",class:"recipient-card"},{header:o(()=>[i("div",Ee,[e[5]||(e[5]=i("span",null,"æŽ¥æ”¶ç”¨æˆ·",-1)),t(c,{type:"info",round:""},{default:o(()=>[n(f(r.value.length)+" äºº",1)]),_:1})])]),default:o(()=>[i("div",be,[t(d,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value=l),placeholder:"è¯·è¾“å…¥8ä½ç”¨æˆ·UID",maxlength:"8",clearable:"",onKeyup:se(D,["enter"]),style:{"margin-bottom":"10px"}},{append:o(()=>[t(p,{onClick:D,loading:h.value},{default:o(()=>[...e[6]||(e[6]=[n("æ·»åŠ ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"]),e[7]||(e[7]=i("div",{class:"input-tip"},"è¯·è¾“å…¥ç²¾å‡†UIDï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ ¡éªŒç”¨æˆ·æ˜¯å¦å­˜åœ¨ã€‚",-1))]),t(A,{"content-position":"center"},{default:o(()=>[...e[8]||(e[8]=[n("å·²æ·»åŠ ç”¨æˆ·åˆ—è¡¨",-1)])]),_:1}),i("div",he,[t(re,{name:"list"},{default:o(()=>[(y(!0),b(ne,null,me(r.value,l=>(y(),b("div",{key:l.uid,class:"recipient-item"},[t(F,{size:32,src:l.avatar},{default:o(()=>[n(f(l.email?.charAt(0).toUpperCase()),1)]),_:2},1032,["src"]),i("div",ke,[i("div",Ve,f(l.email||"ç”¨æˆ·"),1),i("div",Ue,"UID: "+f(l.uid),1)]),t(p,{link:"",type:"danger",icon:pe(de),onClick:Ie=>$(l.uid)},null,8,["icon","onClick"])]))),128))]),_:1}),r.value.length===0?(y(),b("div",xe,[t(N,{description:"æš‚æ— æŽ¥æ”¶å¯¹è±¡","image-size":60})])):ie("",!0)])]),_:1}),t(x,{shadow:"never",class:"message-card"},{header:o(()=>[...e[9]||(e[9]=[i("div",{class:"card-header"},[i("span",null,"æ¶ˆæ¯å†…å®¹")],-1)])]),default:o(()=>[t(q,{"label-position":"top",model:a,rules:M,ref_key:"formRef",ref:w},{default:o(()=>[t(v,{label:"æ¶ˆæ¯ç±»åž‹",prop:"type"},{default:o(()=>[t(L,{modelValue:a.type,"onUpdate:modelValue":e[1]||(e[1]=l=>a.type=l),placeholder:"é€‰æ‹©æ¶ˆæ¯ç±»åž‹",style:{width:"100%"}},{default:o(()=>[t(E,{label:"ðŸ“¢ ç³»ç»Ÿé€šçŸ¥",value:"system"}),t(E,{label:"ðŸ“¦ è®¢å•æ¶ˆæ¯",value:"order"}),t(E,{label:"ðŸŽ‰ æ´»åŠ¨æŽ¨å¹¿",value:"activity"}),t(E,{label:"ðŸ”’ å®‰å…¨æé†’",value:"security"})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"æ¶ˆæ¯æ ‡é¢˜",prop:"title"},{default:o(()=>[t(d,{modelValue:a.title,"onUpdate:modelValue":e[2]||(e[2]=l=>a.title=l),placeholder:"è¯·è¾“å…¥æ¶ˆæ¯æ ‡é¢˜"},null,8,["modelValue"])]),_:1}),t(v,{label:"æ¶ˆæ¯æ­£æ–‡",prop:"content"},{default:o(()=>[t(d,{modelValue:a.content,"onUpdate:modelValue":e[3]||(e[3]=l=>a.content=l),type:"textarea",rows:8,placeholder:"è¯·è¾“å…¥æ¶ˆæ¯æ­£æ–‡å†…å®¹...",resize:"none"},null,8,["modelValue"])]),_:1}),t(v,{label:"è·³è½¬é“¾æŽ¥",prop:"link"},{default:o(()=>[t(d,{modelValue:a.link,"onUpdate:modelValue":e[4]||(e[4]=l=>a.link=l),placeholder:"å¯é€‰ï¼Œå¦‚ /profile/orders è®©ç”¨æˆ·ç‚¹å‡»è·³è½¬"},null,8,["modelValue"]),e[10]||(e[10]=i("div",{class:"input-tip"},"ç”¨æˆ·ç‚¹å‡»æ¶ˆæ¯æ—¶å°†è·³è½¬åˆ°æ­¤è·¯å¾„ã€‚ç•™ç©ºåˆ™æ— è·³è½¬ã€‚",-1))]),_:1}),t(v,null,{default:o(()=>[t(S,{title:"å‘é€åŽå°†ç”Ÿæˆç«™å†…ä¿¡ï¼Œä¸å¯æ’¤å›žã€‚",type:"warning","show-icon":"",closable:!1,style:{"margin-bottom":"15px"}}),t(p,{type:"primary",size:"large",onClick:z,loading:k.value,style:{width:"100%"}},{default:o(()=>[...e[11]||(e[11]=[n(" ç¡®è®¤å‘é€æ¶ˆæ¯ ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),t(x,{shadow:"never",class:"history-card",style:{"margin-top":"24px"}},{header:o(()=>[i("div",Ce,[e[13]||(e[13]=i("span",null,"æœ€è¿‘å‘é€è®°å½•",-1)),t(p,{text:"",onClick:U},{default:o(()=>[...e[12]||(e[12]=[n("åˆ·æ–°",-1)])]),_:1})])]),default:o(()=>[ue((y(),ce(G,{data:C.value,style:{width:"100%"}},{default:o(()=>[t(g,{prop:"user_uid",label:"ç”¨æˆ·UID",width:"120"}),t(g,{prop:"title",label:"æ ‡é¢˜","min-width":"200"}),t(g,{prop:"content",label:"å†…å®¹","min-width":"300","show-overflow-tooltip":""}),t(g,{label:"å·²è¯»",width:"80",align:"center"},{default:o(({row:l})=>[t(c,{type:l.is_read?"success":"info",size:"small"},{default:o(()=>[n(f(l.is_read?"å·²è¯»":"æœªè¯»"),1)]),_:2},1032,["type"])]),_:1}),t(g,{label:"å‘é€æ—¶é—´",width:"180"},{default:o(({row:l})=>[n(f(T(l.created_at)),1)]),_:1})]),_:1},8,["data"])),[[K,V.value]])]),_:1})])}}}),St=fe(De,[["__scopeId","data-v-71f69cc6"]]);export{St as default};
