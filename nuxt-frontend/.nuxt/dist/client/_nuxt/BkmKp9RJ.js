import{f as W,r as C,g as F,h as ie,J as oe,c as s,o as t,a as e,b as l,E as K,w,l as S,a3 as Ce,t as v,F as N,k as z,ar as ve,n as Y,p as Re,B as E,ad as ae,_ as X,d as A,aP as De,am as le,D as O,i as ne,v as pe,H as ge,ao as he,aQ as ke,at as Fe,ap as Me,aR as Te,aS as Ve,aT as Oe,G as B,Y as be,aU as je,z as qe,ac as $e,L as Ee,C as we,a1 as Le,a2 as Ae,aV as Ue,aW as Be,Z as Ne,aX as ze,aY as Pe,aZ as ye,a_ as He,W as Ye,X as Je,a$ as We}from"./gYbOYKrZ.js";/* empty css        */import"./CswOF4xx.js";/* empty css        *//* empty css        */import{c as Q}from"./B1GEwpVY.js";import{t as Ie}from"./BBF4N7Iv.js";import{u as Xe}from"./Ce6k4emn.js";import{u as Ze}from"./CRWHP3jh.js";import{E as Qe}from"./CxsxdZaY.js";/* empty css        */import{C as Ge}from"./2W_9f0C5.js";import{B as xe}from"./Cqtiwte7.js";import{E as Ke}from"./DK0lTgRd.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./CUkNyi1D.js";import"./Bh6H2ams.js";import"./BlcygIWm.js";import"./Djfz0t-N.js";import"./Cq9Fpw4b.js";import"./DxwfhIR6.js";import"./BYT9QUPE.js";import"./BPYHQo7_.js";import"./Cr8dt13I.js";import"./BNtqh2Az.js";import"./BO6-pa8Z.js";/* empty css        */import"./Du3BG93F.js";import"./DrogL690.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./BB_Ol6Sd.js";import"./DEN0lkI5.js";import"./CqTJWtX6.js";import"./gVImYNNu.js";const et={class:"glass-card delivery-card"},tt={class:"delivery-content"},st={class:"credential-card"},at={class:"credential-header"},ot={class:"slot-title-badge"},lt={class:"icon-box"},nt={class:"value"},it={class:"credential-body"},rt={class:"row-label"},dt={class:"row-value-group"},ct={class:"row-value large-text"},ut=["onClick"],vt={class:"roommates-section"},pt={class:"roommates-header"},_t={class:"header-count"},ft={class:"profiles-scroll-container"},mt=["src"],ht={key:1,class:"profile-avatar placeholder"},kt={key:2,class:"profile-avatar placeholder empty-icon"},yt={class:"profile-name"},gt={class:"slot-number-tag"},bt=W({__name:"FulfillmentShared",props:{cdkItem:{},slotIndex:{}},setup(V){const R=V,b=C([]),$=F(()=>R.cdkItem&&R.cdkItem.accountData&&R.cdkItem.accountData.max_slots?Number(R.cdkItem.accountData.max_slots):5),k=F(()=>R.slotIndex),I=F(()=>{const n=[];for(let r=1;r<=$.value;r++){const g=b.value.find(p=>p.slot_index===r),i=r===Number(k.value);n.push({index:r,user:g,isMe:i})}return n}),x=F(()=>b.value.length),o=n=>{if(!n)return{};if(n.parsed&&typeof n.parsed=="object")return n.parsed;try{return JSON.parse(n.code)}catch{return{æ¿€æ´»ç :n.code}}},y=n=>{navigator.clipboard.writeText(n).then(()=>E.success("å·²å¤åˆ¶"))},h=n=>n===void 0?"--":String(n).padStart(2,"0"),j=async()=>{if(!R.cdkItem||!R.cdkItem.id)return;const n=R.cdkItem.id;try{const r=ae(),{data:g,error:i}=await r.from("slot_occupancies").select(`
        user_id,
        slot_index,
        profiles:user_id (
          id,
          avatar,
          nickname
        )
      `).eq("cdk_id",n).eq("status","using").not("user_id","is",null);!i&&g&&(b.value=g.filter(p=>p.profiles).map(p=>({id:p.profiles.id,avatar:p.profiles.avatar,nickname:p.profiles.nickname,slot_index:p.slot_index})))}catch(r){console.error("èŽ·å–å…±äº«ç”¨æˆ·å¤±è´¥:",r)}};return ie(()=>{j()}),oe(()=>R.cdkItem,()=>{j()},{deep:!0}),(n,r)=>{const g=K;return t(),s("div",et,[e("div",tt,[e("div",st,[e("div",at,[e("div",ot,[e("div",lt,[l(g,null,{default:w(()=>[l(S(Ce))]),_:1})]),r[0]||(r[0]=e("span",{class:"label"},"æ‚¨çš„ä½ç½®:",-1)),e("span",nt,v(h(V.slotIndex))+"å·",1)])]),e("div",it,[(t(!0),s(N,null,z(o(V.cdkItem),(i,p)=>(t(),s("div",{key:p,class:"credential-row"},[e("div",rt,v(p),1),e("div",dt,[e("span",ct,v(i),1),e("button",{class:"copy-btn-icon",onClick:f=>y(String(i))},[l(g,null,{default:w(()=>[l(S(ve))]),_:1})],8,ut)])]))),128))])]),e("div",vt,[e("div",pt,[r[1]||(r[1]=e("span",{class:"header-title"},"å’Œæ‚¨å…±äº«çš„å‹å‹",-1)),e("span",_t,v(x.value)+"/"+v($.value)+" å·²å…¥åº§",1)]),e("div",ft,[(t(!0),s(N,null,z(I.value,i=>(t(),s("div",{key:i.index,class:Y(["profile-item",{"is-me":i.isMe}])},[e("div",{class:Y(["avatar-ring",{empty:!i.user,active:i.user}])},[i.user&&i.user.avatar?(t(),s("img",{key:0,src:i.user.avatar,class:"profile-avatar"},null,8,mt)):i.user?(t(),s("div",ht,v((i.user.nickname||"U")[0].toUpperCase()),1)):(t(),s("div",kt,[l(g,null,{default:w(()=>[l(S(Re))]),_:1})]))],2),e("span",yt,v(i.isMe?"æˆ‘":i.user?.nickname||"å¾…åŠ å…¥"),1),e("span",gt,v(i.index)+"å·",1)],2))),128))])])])])}}}),$t=X(bt,[["__scopeId","data-v-d65e0ff6"]]),wt={class:"gift-card-container"},It={key:0,class:"gift-cards-wrapper"},xt={class:"gift-card-item"},St={class:"card-content"},Ct={class:"code-display-row"},Rt={class:"the-code"},Dt={class:"action-row"},Ft={key:1,class:"compact-stack-wrapper"},Mt={class:"glass-header"},Tt={class:"header-left"},Vt={class:"stack-title"},Ot={class:"stack-list"},jt={class:"stack-index"},qt={class:"stack-code"},Et=["onClick"],Lt={key:2,class:"empty-state"},At=W({__name:"FulfillmentCdk",props:{cdkList:{}},setup(V){const R=V,b=k=>{navigator.clipboard.writeText(k).then(()=>E.success("å·²å¤åˆ¶"))},$=()=>{const k=R.cdkList.map(I=>I.code).join(`
`);b(k)};return(k,I)=>{const x=K;return t(),s("div",wt,[V.cdkList.length===1?(t(),s("div",It,[e("div",xt,[I[3]||(I[3]=e("div",{class:"card-strip"},[e("span",{class:"strip-text"},"DIGITAL VOUCHER"),e("div",{class:"strip-decoration"})],-1)),e("div",St,[I[2]||(I[2]=e("div",{class:"code-label"},"å…‘æ¢ç  / REDEEM CODE",-1)),e("div",Ct,[e("span",Rt,v(V.cdkList[0].code),1)]),e("div",Dt,[e("button",{class:"copy-pill-btn",onClick:I[0]||(I[0]=o=>b(V.cdkList[0].code))},[l(x,null,{default:w(()=>[l(S(ve))]),_:1}),I[1]||(I[1]=A(" å¤åˆ¶å¡å¯† ",-1))])])]),I[4]||(I[4]=e("div",{class:"shine-effect"},null,-1))])])):V.cdkList.length>1?(t(),s("div",Ft,[e("div",Mt,[e("div",Tt,[l(x,{class:"stack-icon"},{default:w(()=>[l(S(De))]),_:1}),e("span",Vt,"åŒ…å« "+v(V.cdkList.length)+" ç»„æ¿€æ´»ç ",1)]),e("button",{class:"batch-copy-btn",onClick:$}," å¤åˆ¶å…¨éƒ¨ ")]),e("div",Ot,[(t(!0),s(N,null,z(V.cdkList,(o,y)=>(t(),s("div",{key:y,class:"stack-item"},[e("div",jt,v(y+1),1),e("div",qt,v(o.code),1),e("button",{class:"icon-copy-btn",onClick:h=>b(o.code)},[l(x,null,{default:w(()=>[l(S(ve))]),_:1})],8,Et)]))),128))])])):(t(),s("div",Lt," æš‚æ— è¯¦ç»†äº¤ä»˜ä¿¡æ¯ "))])}}}),Ut=X(At,[["__scopeId","data-v-fd8dcbef"]]),Bt={class:"fulfillment-submit-form glass-panel"},Nt={class:"form-area"},zt={class:"form-label"},Pt={class:"input-wrapper"},Ht=["onUpdate:modelValue","placeholder"],Yt={key:0,class:"status-card-wrapper"},Jt={key:0,class:"status-card pending"},Wt={class:"card-icon"},Xt={key:1,class:"status-card success"},Zt={class:"card-icon"},Qt={key:2,class:"status-card error"},Gt={class:"card-icon"},Kt={class:"card-content"},es={class:"card-desc"},ts={class:"action-footer"},ss=["disabled"],as=["disabled"],os=["disabled"],ls=["disabled"],ns=W({__name:"FulfillmentSubmitForm",props:{orderId:{},orderStatus:{},cdkFields:{},cdkId:{}},emits:["submit-success"],setup(V,{expose:R,emit:b}){const $=V,k=b,I=C(null),x=C(!1),o=le({}),y=F(()=>$.cdkFields||[]),h=F(()=>I.value?.status),j=F(()=>I.value?.reject_reason||"æœªå¡«å†™åŽŸå› "),n=()=>{y.value.forEach(p=>{o[p.key]=""}),I.value?.payload&&(h.value==="submitted"||h.value==="rejected")&&Object.entries(I.value.payload).forEach(([p,f])=>{p!=="_cdk_id"&&p in o&&(o[p]=f)})},r=async()=>{if($.orderId)try{let f=ae().from("order_fulfillments").select("*").eq("order_id",$.orderId).order("submitted_at",{ascending:!1});$.cdkId&&(f=f.contains("payload",{_cdk_id:$.cdkId}));const{data:_,error:m}=await f.limit(1).maybeSingle();!m&&_?(I.value=_,n()):(I.value=null,n())}catch(p){console.error("èŽ·å–å›žæ‰§å¤±è´¥:",p)}},g=async()=>{x.value=!0;try{const p=ae(),f={};y.value.forEach(D=>{f[D.key]=o[D.key]||""}),$.cdkId&&(f._cdk_id=$.cdkId);const{data:_,error:m}=await p.from("order_fulfillments").insert({order_id:$.orderId,status:"submitted",payload:f,submitted_at:new Date().toISOString()}).select().single();if(m){E.error("æäº¤å¤±è´¥: "+m.message);return}I.value=_,E.success("å›žæ‰§æäº¤æˆåŠŸï¼Œè¯·ç­‰å¾…å®¡æ ¸"),k("submit-success")}catch(p){E.error(p.message||"æäº¤å¤±è´¥")}finally{x.value=!1}},i=async()=>{if(I.value){x.value=!0;try{const p=ae(),f={};y.value.forEach(m=>{f[m.key]=o[m.key]||""}),$.cdkId&&(f._cdk_id=$.cdkId);const{error:_}=await p.from("order_fulfillments").update({payload:f,submitted_at:new Date().toISOString()}).eq("id",I.value.id);if(_){E.error("ä¿®æ”¹å¤±è´¥: "+_.message);return}E.success("å›žæ‰§ä¿®æ”¹æˆåŠŸ"),await r(),k("submit-success")}catch(p){E.error(p.message||"ä¿®æ”¹å¤±è´¥")}finally{x.value=!1}}};return oe(()=>$.cdkFields,()=>{n()},{immediate:!0}),ie(()=>{r()}),R({refresh:r}),(p,f)=>{const _=K;return t(),s("div",Bt,[f[7]||(f[7]=e("div",{class:"tip-header-glass"},[e("span",{class:"tip-text"},"å›¾æ‹‰æé†’ï¼šæ‚¨è¦å¡«å†™ä»¥ä¸‹ä¿¡æ¯æ‰å¯ä»¥å“¦")],-1)),e("div",Nt,[(t(!0),s(N,null,z(y.value,m=>(t(),s("div",{key:m.key,class:"form-group"},[e("label",zt,v(m.label),1),e("div",Pt,[ne(e("input",{"onUpdate:modelValue":D=>o[m.key]=D,class:"glass-input",placeholder:"è¯·è¾“å…¥"+m.label},null,8,Ht),[[pe,o[m.key]]])])]))),128))]),h.value?(t(),s("div",Yt,[h.value==="submitted"?(t(),s("div",Jt,[e("div",Wt,[l(_,{class:"spin"},{default:w(()=>[l(S(ge))]),_:1})]),f[0]||(f[0]=e("div",{class:"card-content"},[e("div",{class:"card-title"},"å®¡æ ¸ä¸­"),e("div",{class:"card-desc"},"æ‚¨çš„å›žæ‰§å·²æäº¤ï¼Œç®¡ç†å‘˜æ­£åœ¨æ‹¼å‘½å®¡æ ¸ä¸­...")],-1))])):h.value==="approved"?(t(),s("div",Xt,[e("div",Zt,[l(_,null,{default:w(()=>[l(S(he))]),_:1})]),f[1]||(f[1]=e("div",{class:"card-content"},[e("div",{class:"card-title"},"å·²é€šè¿‡"),e("div",{class:"card-desc"},"å……å€¼å·²å®Œæˆï¼Œè¯·æ£€æŸ¥æ‚¨çš„è´¦æˆ·åˆ°è´¦æƒ…å†µã€‚")],-1))])):h.value==="rejected"?(t(),s("div",Qt,[e("div",Gt,[l(_,null,{default:w(()=>[l(S(ke))]),_:1})]),e("div",Kt,[f[2]||(f[2]=e("div",{class:"card-title"},"å·²é©³å›ž",-1)),e("div",es,"åŽŸå› ï¼š"+v(j.value),1)])])):O("",!0)])):O("",!0),e("div",ts,[h.value?O("",!0):(t(),s("button",{key:0,class:"glass-btn primary",disabled:x.value,onClick:g},[l(_,{class:"btn-icon"},{default:w(()=>[l(S(Fe))]),_:1}),f[3]||(f[3]=A(" å¡«å†™å›žæ‰§ ",-1))],8,ss)),h.value==="submitted"?(t(),s("button",{key:1,class:"glass-btn secondary",disabled:x.value,onClick:i},[l(_,{class:"btn-icon"},{default:w(()=>[l(S(Me))]),_:1}),f[4]||(f[4]=A(" ä¿®æ”¹å›žæ‰§ä¿¡æ¯ ",-1))],8,as)):O("",!0),h.value==="rejected"?(t(),s("button",{key:2,class:"glass-btn primary",disabled:x.value,onClick:g},[l(_,{class:"btn-icon"},{default:w(()=>[l(S(Te))]),_:1}),f[5]||(f[5]=A(" é‡æ–°æäº¤ ",-1))],8,os)):O("",!0),h.value==="approved"?(t(),s("button",{key:3,class:"glass-btn secondary",disabled:x.value,onClick:g},[l(_,{class:"btn-icon"},{default:w(()=>[l(S(Ve))]),_:1}),f[6]||(f[6]=A(" å†æ¬¡æäº¤ ",-1))],8,ls)):O("",!0)])])}}}),is=X(ns,[["__scopeId","data-v-cd43b157"]]),rs={key:0,class:"fulfillment-history glass-panel"},ds={class:"history-header"},cs={class:"header-left"},us={class:"count-badge flex-center"},vs={class:"btn-text"},ps={class:"history-list"},_s={class:"card-top"},fs={class:"time-str"},ms={class:"card-payload"},hs={class:"field-label"},ks={class:"field-value"},ys={key:0,class:"reject-alert"},gs=W({__name:"FulfillmentHistory",props:{orderId:{},filterCdkId:{}},setup(V,{expose:R}){const b=V,$=C([]),k=C(!1),I=F(()=>k.value?$.value:$.value.slice(0,1)),x=()=>k.value=!k.value,o=async()=>{if(b.orderId)try{let r=ae().from("order_fulfillments").select("*").eq("order_id",b.orderId).order("submitted_at",{ascending:!1});b.filterCdkId&&(r=r.contains("payload",{_cdk_id:b.filterCdkId}));const{data:g,error:i}=await r;!i&&g&&($.value=g)}catch(n){console.error("èŽ·å–å›žæ‰§åŽ†å²å¤±è´¥:",n)}},y=n=>({submitted:"å®¡æ ¸ä¸­",approved:"å·²é€šè¿‡",rejected:"å·²é©³å›ž"})[n]||n,h=n=>{const r=new Date(n),g=(r.getMonth()+1).toString().padStart(2,"0"),i=r.getDate().toString().padStart(2,"0"),p=r.getHours().toString().padStart(2,"0"),f=r.getMinutes().toString().padStart(2,"0");return`${g}-${i} ${p}:${f}`},j=n=>!n||n.length<=4?n:n.slice(0,2)+"****"+n.slice(-2);return ie(()=>{o()}),R({refresh:o}),(n,r)=>{const g=K;return $.value.length>0?(t(),s("div",rs,[e("div",ds,[e("div",cs,[r[0]||(r[0]=e("span",{class:"icon"},"ðŸ“‹",-1)),r[1]||(r[1]=e("span",{class:"title"},"å›žæ‰§è®°å½•",-1)),e("span",us,v($.value.length),1)]),$.value.length>1?(t(),s("button",{key:0,class:"expand-btn",onClick:x},[e("span",vs,v(k.value?"æ”¶èµ·":"å±•å¼€åŽ†å²"),1),l(g,{class:Y({"rotate-180":k.value})},{default:w(()=>[l(S(Oe))]),_:1},8,["class"])])):O("",!0)]),e("div",ps,[(t(!0),s(N,null,z(I.value,(i,p)=>(t(),s("div",{key:i.id,class:Y(["history-card slide-in",i.status])},[e("div",_s,[e("div",{class:Y(["status-indicator",i.status])},[i.status==="approved"?(t(),B(g,{key:0},{default:w(()=>[l(S(he))]),_:1})):i.status==="rejected"?(t(),B(g,{key:1},{default:w(()=>[l(S(ke))]),_:1})):(t(),B(g,{key:2},{default:w(()=>[l(S(ge))]),_:1})),e("span",null,v(y(i.status)),1)],2),e("span",fs,v(h(i.submitted_at)),1)]),e("div",ms,[(t(!0),s(N,null,z(i.payload,(f,_)=>ne((t(),s("div",{key:_,class:"payload-field"},[e("span",hs,v(_)+":",1),e("span",ks,v(j(f)),1)])),[[je,_!=="_cdk_id"]])),128))]),i.status==="rejected"&&i.reject_reason?(t(),s("div",ys,[l(g,null,{default:w(()=>[l(S(be))]),_:1}),e("span",null,"é©³å›žåŽŸå› : "+v(i.reject_reason),1)])):O("",!0)],2))),128))])])):O("",!0)}}}),bs=X(gs,[["__scopeId","data-v-6aef509b"]]),$s={class:"renewal-content"},ws={key:0,class:"loading-state"},Is={key:1,class:"error-state"},xs={key:2,class:"renewal-form"},Ss={class:"renewal-split-layout"},Cs={class:"refresh-left-col"},Rs={class:"product-header-compact"},Ds={class:"ph-info"},Fs={class:"ph-name"},Ms={class:"ph-expire"},Ts={class:"specs-wrapper"},Vs={key:0},Os={class:"spec-label"},js={class:"spec-values"},qs=["onClick"],Es={key:1,class:"simple-sku-list"},Ls={class:"spec-values"},As=["onClick"],Us={class:"coupon-value"},Bs={key:0,class:"coupon-selected"},Ns={key:1,class:"coupon-placeholder"},zs={class:"refresh-right-col"},Ps={class:"summary-card"},Hs={class:"summary-row"},Ys={key:0,class:"summary-row"},Js={class:"text-danger"},Ws={class:"total-row"},Xs={class:"total-price"},Zs={key:1,class:"new-expire-tip"},Qs=["disabled"],Gs={key:0},Ks={key:1},ea=W({__name:"RenewalModal",props:{modelValue:{type:Boolean},orderId:{}},emits:["update:modelValue","success"],setup(V,{emit:R}){const b=V,$=R,k=we(),I=qe(),x=F({get:()=>b.modelValue,set:c=>$("update:modelValue",c)}),o=C(!1),y=C(""),h=C(!1),j=C(!1),n=C([]),r=C(""),g=C(""),i=C(null),p=C(0),f=le({}),_=le({id:"",name:"å•†å“",image:""}),m=F(()=>{if(n.value.length===0)return[];const c={};return n.value.forEach(d=>{const P=d.spec_combination||{};Object.entries(P).forEach(([U,M])=>{c[U]||(c[U]=new Map),c[U].has(M)||c[U].set(M,{value:M,price:d.price,skuId:d.sku_id})})}),Object.entries(c).map(([d,P])=>({name:d,values:Array.from(P.values())}))}),D=F(()=>g.value?n.value.find(c=>c.sku_id===g.value):m.value.length>0?n.value.find(c=>{const d=c.spec_combination||{};return Object.entries(f).every(([P,U])=>d[P]===U)}):null),L=F(()=>D.value?.price||0),G=F(()=>Math.max(0,L.value-p.value)),ee=F(()=>{if(!r.value||!D.value)return"";const c=new Date(r.value);return c.setDate(c.getDate()+D.value.duration),c.toISOString()});oe(()=>b.modelValue,async c=>{c?await te():(g.value="",i.value=null,p.value=0,Object.keys(f).forEach(d=>delete f[d]))}),oe(f,()=>{if(m.value.length>0){const c=n.value.find(d=>{const P=d.spec_combination||{};return Object.entries(f).every(([U,M])=>P[U]===M)});c&&(g.value=c.sku_id)}},{deep:!0});const te=async()=>{o.value=!0,y.value="";try{const c=await Q.getRenewalSkus(b.orderId);if(!c.success){y.value=c.error||"èŽ·å–ç»­è´¹ä¿¡æ¯å¤±è´¥";return}n.value=c.skus||[],r.value=c.endTime||"",c.product&&(_.id=c.product.id,_.name=c.product.name,_.image=c.product.image),m.value.length>0?m.value.forEach(d=>{d.values.length>0&&(f[d.name]=d.values[0].value)}):n.value.length>0&&(g.value=n.value[0].sku_id)}catch(c){y.value=c.message||"ç³»ç»Ÿå¼‚å¸¸"}finally{o.value=!1}},se=(c,d)=>{f[c]=d,i.value=null,p.value=0},_e=c=>{g.value=c.sku_id,i.value=null,p.value=0},re=async c=>{if(i.value=c,!c){p.value=0;return}c.coupon.type==="flat"?p.value=Math.min(c.coupon.value,L.value):c.coupon.type==="product"?p.value=L.value:p.value=0},fe=async()=>{if(!g.value||h.value)return;const c=I.user?.balance??0;if(c<G.value){E.error(`ä½™é¢ä¸è¶³ï¼Œéœ€ Â¥${G.value.toFixed(2)}ï¼Œå½“å‰ Â¥${c.toFixed(2)}`);return}h.value=!0;try{const d=await Q.createRenewalPreOrder(g.value,b.orderId);if(!d.success){E.error(d.error||"åˆ›å»ºç»­è´¹è®¢å•å¤±è´¥");return}const P=d.preOrderId;i.value&&((await Q.applyCoupon(P,i.value.id)).success||(E.warning("ä¼˜æƒ åˆ¸åº”ç”¨å¤±è´¥ï¼Œå°†æŒ‰åŽŸä»·æ”¯ä»˜"),p.value=0));const U=await Q.confirmPreOrder(P,"balance",i.value?.id);if(!U.success){E.error(U.error||"æ”¯ä»˜å¤±è´¥");return}E.success("ç»­è´¹æˆåŠŸï¼"),await I.fetchUserInfo(),x.value=!1,$("success",U.orderId),k.push(`/profile/order/${U.orderId}`)}catch(d){E.error(d.message||"ç³»ç»Ÿå¼‚å¸¸")}finally{h.value=!1}},de=c=>{if(!c)return"-";const d=new Date(c);return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`};return(c,d)=>{const P=Qe,U=K;return t(),B($e,{visible:x.value,"onUpdate:visible":d[2]||(d[2]=M=>x.value=M),title:"ç»­è´¹è®¢å•",width:"720px",footer:!1,"show-mascot":""},{default:w(()=>[e("div",$s,[o.value?(t(),s("div",ws,[...d[3]||(d[3]=[e("div",{class:"spinner"},null,-1),e("p",null,"åŠ è½½ç»­è´¹é€‰é¡¹...",-1)])])):y.value?(t(),s("div",Is,[d[4]||(d[4]=e("div",{class:"error-icon"},"âš ï¸",-1)),e("p",null,v(y.value),1)])):(t(),s("div",xs,[e("div",Ss,[e("div",Cs,[e("div",Rs,[l(P,{src:_.image,class:"mini-thumb",fit:"cover"},{placeholder:w(()=>[...d[5]||(d[5]=[e("div",{class:"ph"},"IMG",-1)])]),_:1},8,["src"]),e("div",Ds,[e("div",Fs,v(_.name),1),e("div",Ms,"å½“å‰åˆ°æœŸ: "+v(de(r.value)),1)])]),e("div",Ts,[m.value.length>0?(t(),s("div",Vs,[(t(!0),s(N,null,z(m.value,M=>(t(),s("div",{key:M.name,class:"spec-group"},[e("div",Os,v(M.name),1),e("div",js,[(t(!0),s(N,null,z(M.values,Z=>(t(),s("div",{key:Z.value,class:Y(["spec-val-btn",{active:f[M.name]===Z.value}]),onClick:ce=>se(M.name,Z.value)},v(Z.value),11,qs))),128))])]))),128))])):n.value.length>0?(t(),s("div",Es,[d[6]||(d[6]=e("div",{class:"spec-label"},"é€‰æ‹©æ—¶é•¿",-1)),e("div",Ls,[(t(!0),s(N,null,z(n.value,M=>(t(),s("div",{key:M.sku_id,class:Y(["spec-val-btn",{active:g.value===M.sku_id}]),onClick:Z=>_e(M)},v(M.duration)+"å¤© ",11,As))),128))])])):O("",!0)]),e("div",{class:"coupon-section",onClick:d[0]||(d[0]=M=>j.value=!0)},[d[7]||(d[7]=e("div",{class:"coupon-label"},"ä¼˜æƒ åˆ¸",-1)),e("div",Us,[i.value?(t(),s("span",Bs,"-Â¥"+v(p.value.toFixed(2)),1)):(t(),s("span",Ns,"é€‰æ‹©ä¼˜æƒ åˆ¸")),l(U,null,{default:w(()=>[l(S(Ee))]),_:1})])])]),e("div",zs,[e("div",Ps,[d[12]||(d[12]=e("div",{class:"summary-title"},"è®¢å•æ‘˜è¦",-1)),e("div",Hs,[d[8]||(d[8]=e("span",null,"å•†å“é‡‘é¢",-1)),e("span",null,"Â¥"+v(L.value.toFixed(2)),1)]),p.value>0?(t(),s("div",Ys,[d[9]||(d[9]=e("span",null,"ä¼˜æƒ æŠµæ‰£",-1)),e("span",Js,"-Â¥"+v(p.value.toFixed(2)),1)])):O("",!0),d[13]||(d[13]=e("div",{class:"divider"},null,-1)),e("div",Ws,[d[11]||(d[11]=e("div",{class:"total-label"},"åº”ä»˜é‡‘é¢",-1)),e("div",Xs,[d[10]||(d[10]=e("span",{class:"unit"},"Â¥",-1)),A(v(G.value.toFixed(2)),1)])]),ee.value?(t(),s("div",Zs," ç»­è´¹åŽåˆ°æœŸ: "+v(de(ee.value)),1)):O("",!0),e("button",{class:"pay-btn",disabled:!g.value||h.value,onClick:fe},[h.value?(t(),s("span",Gs,"æ”¯ä»˜ä¸­...")):(t(),s("span",Ks,"ç«‹å³æ”¯ä»˜"))],8,Qs)])])])]))]),l(Ge,{modelValue:j.value,"onUpdate:modelValue":d[1]||(d[1]=M=>j.value=M),orderAmount:L.value,skuIds:g.value?[g.value]:[],productIds:_.id?[_.id]:[],currentCouponId:i.value?.id,onSelect:re},null,8,["modelValue","orderAmount","skuIds","productIds","currentCouponId"])]),_:1},8,["visible"])}}}),ta=X(ea,[["__scopeId","data-v-bc6c6b56"]]),sa={class:"refund-form"},aa={class:"info-box"},oa={class:"value"},la={class:"warning-box"},na={class:"form-group"},ia={class:"reason-options"},ra=["onClick"],da={class:"form-group"},ca=W({__name:"RefundModal",props:{modelValue:{type:Boolean},orderId:{},orderNo:{}},emits:["update:modelValue","success"],setup(V,{emit:R}){const b=V,$=R,k=F({get:()=>b.modelValue,set:n=>$("update:modelValue",n)}),I=C(!1),x=le({reason:"",detail:""}),o=["ä¹°é”™äº†/ä¸éœ€è¦äº†","å•†å“æ— æ³•ä½¿ç”¨","å‘è´§é€Ÿåº¦å¤ªæ…¢","å•†å“æè¿°ä¸ç¬¦","å…¶ä»–åŽŸå› "],y=F(()=>!!x.reason),h=()=>{k.value=!1},j=async()=>{if(y.value){I.value=!0;try{const n=await Q.createRefundRequest(b.orderId,x.reason,x.detail);n.success?(E.success("é€€æ¬¾ç”³è¯·å·²æäº¤"),$("success"),h()):E.error(n.error||"æäº¤å¤±è´¥")}catch(n){E.error(n.message||"ç³»ç»Ÿé”™è¯¯")}finally{I.value=!1}}};return oe(()=>b.modelValue,n=>{n&&(x.reason="",x.detail="")}),(n,r)=>{const g=K;return t(),B(xe,{visible:k.value,"onUpdate:visible":r[1]||(r[1]=i=>k.value=i),title:"ç”³è¯·é€€æ¬¾",subtitle:"é€€æ¬¾ç”³è¯·å°†åœ¨ 1-3 ä¸ªå·¥ä½œæ—¥å†…å¤„ç†","submit-text":"æäº¤ç”³è¯·",loading:I.value,"submit-disabled":!y.value,"show-mascot":"",onClose:h,onCancel:h,onSubmit:j},{default:w(()=>[e("div",sa,[e("div",aa,[r[2]||(r[2]=e("div",{class:"label"},"è®¢å•å·",-1)),e("div",oa,v(V.orderNo),1)]),e("div",la,[l(g,null,{default:w(()=>[l(S(be))]),_:1}),r[3]||(r[3]=e("span",null,"ç”³è¯·é€€æ¬¾åŽï¼Œå•†å“å°†ç«‹å³å†»ç»“æ— æ³•ä½¿ç”¨ã€‚å¦‚æœ‰ç–‘é—®å»ºè®®å…ˆè”ç³»å®¢æœã€‚",-1))]),e("div",na,[r[4]||(r[4]=e("label",null,[A("é€€æ¬¾åŽŸå›  "),e("span",{class:"required"},"*")],-1)),e("div",ia,[(t(),s(N,null,z(o,i=>e("div",{key:i,class:Y(["reason-tag",{active:x.reason===i}]),onClick:p=>x.reason=i},v(i),11,ra)),64))])]),e("div",da,[r[5]||(r[5]=e("label",null,"è¡¥å……è¯´æ˜Ž",-1)),ne(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=i=>x.detail=i),class:"form-textarea",rows:"3",placeholder:"è¯·å¡«å†™è¯¦ç»†è¯´æ˜Žï¼ˆé€‰å¡«ï¼‰..."},null,512),[[pe,x.detail]])])])]),_:1},8,["visible","loading","submit-disabled"])}}}),ua=X(ca,[["__scopeId","data-v-0757d71c"]]),va={class:"modal-body"},pa={key:0,class:"order-card-glass"},_a={class:"card-image"},fa=["src"],ma={class:"card-info"},ha={class:"info-top"},ka={class:"order-no"},ya={class:"status-badge"},ga={class:"product-name"},ba={key:0,class:"specs"},$a={class:"price-row"},wa={class:"price"},Ia={class:"quantity"},xa={key:1,class:"order-card-loading"},Sa={class:"form-group"},Ca={class:"form-group"},Ra={class:"priority-options"},Da=["onClick"],Fa={class:"form-group"},Ma={class:"form-group"},Ta={class:"upload-area"},Va=["src"],Oa=["onClick"],ja={key:0},qa={key:1},Ea=W({__name:"TicketApplyModal",props:{orderId:{type:String,required:!0}},emits:["close","success"],setup(V,{emit:R}){const b=V,$=R,k=le({title:"",priority:"medium",content:"",attachments:[]}),I=[{label:"ä¸€èˆ¬",value:"low"},{label:"é‡è¦",value:"medium"},{label:"ç´§æ€¥",value:"high"}],x=C(!1),o=C(!1),y=C(!1),h=C(null),j=C(null),n=F(()=>k.title.trim()&&k.content.trim()),r=_=>({active:"ä½¿ç”¨ä¸­",completed:"å·²å®Œæˆ",pending:"å¤„ç†ä¸­",expired:"å·²è¿‡æœŸ",refunding:"é€€æ¬¾ä¸­",refunded:"å·²é€€æ¬¾"})[_]||_;ie(async()=>{if(b.orderId){y.value=!0;try{const _=await Q.getOrderDetail(b.orderId);_.success&&_.data&&(h.value=_.data)}catch(_){console.error("Fetch order failed",_)}finally{y.value=!1}}});const g=()=>{j.value?.click()},i=async _=>{const m=_.target.files;if(!m||m.length===0)return;const D=m[0];if(D.size>5*1024*1024){alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB");return}try{o.value=!0;const L=ae(),G=`${Date.now()}-${Math.random().toString(36).substring(7)}.${D.name.split(".").pop()}`,{data:ee,error:te}=await L.storage.from("tickets").upload(`${b.orderId}/${G}`,D);if(te)throw te;const{data:{publicUrl:se}}=L.storage.from("tickets").getPublicUrl(ee.path);k.attachments.push(se)}catch(L){console.error(L),alert("ä¸Šä¼ å¤±è´¥: "+L.message)}finally{o.value=!1,j.value&&(j.value.value="")}},p=_=>{k.attachments.splice(_,1)},f=async()=>{if(n.value){x.value=!0;try{const _=await Ie.create(b.orderId,k.title,k.content,k.priority,k.attachments);_.success?($("success"),$("close")):alert(_.error||"æäº¤å¤±è´¥")}catch{alert("ç³»ç»Ÿé”™è¯¯")}finally{x.value=!1}}};return(_,m)=>(t(),B(xe,{visible:!0,title:"ç”³è¯·å·¥å•",subtitle:"æˆ‘ä»¬å°†å°½å¿«å¤„ç†æ‚¨çš„é—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨å·¥å•åˆ—è¡¨æŸ¥çœ‹è¿›åº¦","submit-text":"æäº¤å·¥å•",loading:x.value,"submit-disabled":!n.value,"show-mascot":"","mascot-position":"right",onClose:m[2]||(m[2]=D=>_.$emit("close")),onCancel:m[3]||(m[3]=D=>_.$emit("close")),onSubmit:f},{default:w(()=>[e("div",va,[h.value?(t(),s("div",pa,[e("div",_a,[e("img",{src:h.value.product_snapshot?.image,alt:"Product"},null,8,fa)]),e("div",ma,[e("div",ha,[e("span",ka,"è®¢å•å· #"+v(h.value.order_no),1),e("span",ya,v(r(h.value.status)),1)]),e("div",ga,v(h.value.product_snapshot?.product_name),1),h.value.sku_snapshot?(t(),s("div",ba,[(t(!0),s(N,null,z(h.value.sku_snapshot.spec_combination,(D,L)=>(t(),s("span",{key:L},v(D),1))),128))])):O("",!0),e("div",$a,[e("span",wa,"Â¥"+v(h.value.total_amount?.toFixed(2)),1),e("span",Ia,"x"+v(h.value.quantity),1)])])])):y.value?(t(),s("div",xa,[...m[4]||(m[4]=[e("span",{class:"loading-spinner"},null,-1),A(" åŠ è½½è®¢å•ä¿¡æ¯... ",-1)])])):O("",!0),e("div",Sa,[m[5]||(m[5]=e("label",null,[A("é—®é¢˜æ ‡é¢˜ "),e("span",{class:"required"},"*")],-1)),ne(e("input",{"onUpdate:modelValue":m[0]||(m[0]=D=>k.title=D),class:"form-input",placeholder:"è¯·ç®€è¦æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜"},null,512),[[pe,k.title]])]),e("div",Ca,[m[6]||(m[6]=e("label",null,"ä¼˜å…ˆçº§",-1)),e("div",Ra,[(t(),s(N,null,z(I,D=>e("div",{key:D.value,class:Y(["p-opt",{active:k.priority===D.value,[D.value]:!0}]),onClick:L=>k.priority=D.value},v(D.label),11,Da)),64))])]),e("div",Fa,[m[7]||(m[7]=e("label",null,[A("è¯¦ç»†æè¿° "),e("span",{class:"required"},"*")],-1)),ne(e("textarea",{"onUpdate:modelValue":m[1]||(m[1]=D=>k.content=D),class:"form-textarea",rows:"5",placeholder:"è¯·è¯¦ç»†æè¿°é—®é¢˜ç»†èŠ‚..."},null,512),[[pe,k.content]])]),e("div",Ma,[m[8]||(m[8]=e("label",null,"æˆªå›¾å‡­è¯ (å¯é€‰)",-1)),e("div",Ta,[(t(!0),s(N,null,z(k.attachments,(D,L)=>(t(),s("div",{class:"img-preview",key:L},[e("img",{src:D},null,8,Va),e("div",{class:"remove-btn",onClick:G=>p(L)},"Ã—",8,Oa)]))),128)),k.attachments.length<3?(t(),s("div",{key:0,class:"upload-btn",onClick:g},[o.value?(t(),s("span",ja,"...")):(t(),s("span",qa,"+"))])):O("",!0),e("input",{type:"file",ref_key:"fileInput",ref:j,hidden:"",accept:"image/*",onChange:i},null,544)]),m[9]||(m[9]=e("div",{class:"tip"},"æœ€å¤šä¸Šä¼  3 å¼ å›¾ç‰‡",-1))])])]),_:1},8,["loading","submit-disabled"]))}}),La=X(Ea,[["__scopeId","data-v-23f72434"]]),Aa=W({__name:"ContactModal",emits:["close"],setup(V){return(R,b)=>(t(),B($e,{visible:!0,title:"è”ç³»å®¢æœ",width:"400px","show-footer":!1,"show-mascot":"",onClose:b[0]||(b[0]=$=>R.$emit("close"))},{default:w(()=>[...b[1]||(b[1]=[e("div",{class:"contact-content"},[e("div",{class:"icon-wrapper"},[e("span",{class:"service-icon"},"ðŸŽ§")]),e("p",{class:"desc"},"æ‚¨å¯ä»¥ç›´æŽ¥è”ç³»æˆ‘ä»¬çš„åœ¨çº¿å®¢æœï¼Œæˆ–æ‹¨æ‰“ä¸‹æ–¹çš„æœåŠ¡çƒ­çº¿"),e("div",{class:"contact-card"},[e("div",{class:"card-label"},"æœåŠ¡çƒ­çº¿"),e("div",{class:"card-value"},"400-123-4567")]),e("div",{class:"contact-card"},[e("div",{class:"card-label"},"åœ¨çº¿æ—¶é—´"),e("div",{class:"card-value"},"09:00 - 22:00 (æ¯æ—¥)")])],-1)])]),_:1}))}}),Ua=X(Aa,[["__scopeId","data-v-98727de8"]]),Ba={class:"glass-card product-card"},Na=["src"],za={key:1,class:"placeholder"},Pa={class:"product-details"},Ha={class:"product-name"},Ya={class:"tag qty-tag"},Ja=W({__name:"ProductInfoCard",props:{productSnapshot:{},skuSnapshot:{},quantity:{},orderStatus:{}},setup(V){const R=V,b=F(()=>R.productSnapshot?.image||""),$=F(()=>R.productSnapshot?.product_name||"æœªçŸ¥å•†å“"),k=F(()=>R.quantity||1),I=F(()=>R.skuSnapshot?.spec_combination?Object.values(R.skuSnapshot.spec_combination):[]),x=F(()=>{const y=R.orderStatus;return y==="active"||y==="completed"?"theme-success":y==="pending_delivery"||y==="submitted"?"theme-processing":y==="refunding"||y==="refunded"||y==="rejected"?"theme-error":"theme-default"}),o=()=>{b.value&&window.open(b.value,"_blank")};return(y,h)=>(t(),s("div",Ba,[e("div",{class:"product-thumb-wrapper",onClick:o},[b.value?(t(),s("img",{key:0,src:b.value,class:"product-img"},null,8,Na)):(t(),s("div",za,"ðŸ“¦"))]),e("div",Pa,[e("div",Ha,v($.value),1),e("div",{class:Y(["tags-row",x.value])},[(t(!0),s(N,null,z(I.value,(j,n)=>(t(),s("span",{key:n,class:"tag themed-tag"},v(j),1))),128)),e("span",Ya,"x"+v(k.value),1)],2),h[0]||(h[0]=e("div",{class:"product-footer"},null,-1))])]))}}),Wa=X(Ja,[["__scopeId","data-v-282d55f7"]]),Xa={class:"order-detail-page"},Za={class:"hero-sticky-wrapper"},Qa={class:"status-hero-card"},Ga={class:"hero-content"},Ka={class:"hero-top-row"},eo={class:"top-left-group"},to={class:"order-no-badge"},so={class:"value"},ao={class:"amount-display-top"},oo={class:"amount-integer"},lo={class:"amount-decimal"},no={class:"hero-main-row"},io={class:"status-group"},ro={class:"status-text-wrapper"},co={class:"status-title-row"},uo={class:"status-title"},vo={class:"status-desc"},po={key:0},_o={key:1},fo={key:2},mo={key:3},ho={class:"hero-actions"},ko={class:"content-stream"},yo={key:0,class:"fulfillment-section fade-in-up"},go={key:0,class:"item-separator"},bo={class:"sep-label"},$o={key:2,class:"virtual-item-group"},wo={key:1,class:"glass-tile tutorial-tile fade-in-up"},Io={class:"tile-header"},xo={class:"header-left"},So={class:"image-wrapper"},Co=["src"],Ro={class:"zoom-overlay"},Do={class:"zoom-pill"},Fo=W({__name:"[id]",setup(V){const R=Le(),b=we(),$=R.params.id,k=C(!0),{getOrderStatusLabel:I}=Xe(),{formatDate:x}=Ze(),o=C({}),y=C([]),h=C([]),j=C(""),n=C(null),r=C(null),g=F(()=>{const u=o.value.status;return u==="pending_delivery"?"å¾…å‘è´§":u==="active"?"ä½¿ç”¨ä¸­":u==="refunding"?"é€€æ¬¾ä¸­":u==="refunded"?"å·²é€€æ¬¾":I(u||"")}),i=F(()=>r.value?.reason),p=F(()=>{if(!o.value.expires_at)return null;const u=new Date(o.value.expires_at).getTime()-Date.now();return u<=0?0:Math.ceil(u/(1e3*60*60*24))}),f=u=>u<=3?"critical":u<=7?"warning":"safe",_=F(()=>o.value.orderType==="one_time_cdk"),m=F(()=>{if(_.value)return!1;const u=o.value.status;return["active","expired"].includes(u||"")}),D=F(()=>{if(_.value)return!1;const u=o.value.status;return["pending_delivery","active"].includes(u||"")}),L=u=>Math.floor(u).toLocaleString(),G=u=>(u%1).toFixed(2).split(".")[1]||"00",ee=u=>{let a=[];if(u.parsed&&typeof u.parsed=="object"&&(Array.isArray(u.parsed.fields)&&u.parsed.fields.length>0?a=u.parsed.fields.filter(T=>typeof T=="string"):Object.keys(u.parsed).length>0&&(a=Object.keys(u.parsed))),a.length===0){const T=u.code?.trim()||"";if(!T)return[];a=T.replace(/[\(\)ï¼ˆï¼‰\[\]ã€ã€‘]/g,"").split(/[,ï¼Œã€]/).map(J=>J.trim()).filter(J=>J.length>0)}return a.map(T=>({key:T,label:T,value:""}))},te=u=>!u||!u.cdk_id?{}:y.value.find(a=>a.id===u.cdk_id)||{},se=C(null),_e=()=>{se.value?.refresh()},re=u=>u?x(u):"-",fe=u=>window.open(u,"_blank"),de=u=>{u&&(navigator.clipboard.writeText(u),E.success("å·²å¤åˆ¶"))},c=async u=>{if(u==="contact")me.value=!0;else if(u==="create_ticket")ce.value=!0;else if(u==="view_ticket")n.value&&b.push("/profile/tickets");else if(u==="renew")M.value=!0;else if(u==="apply_refund")Z.value=!0;else if(u==="cancel_refund")try{await Ke.confirm("ç¡®å®šè¦æ’¤é”€é€€æ¬¾ç”³è¯·å¹¶æ¢å¤è®¢å•å—ï¼Ÿ","æ’¤é”€é€€æ¬¾",{confirmButtonText:"ç¡®å®šæ’¤é”€",cancelButtonText:"æš‚ä¸æ’¤é”€",type:"warning"});const a=await Q.cancelRefundRequest($);a.success?(E.success(a.message||"å·²æ’¤é”€"),ue()):E.error(a.error||"æ’¤é”€å¤±è´¥")}catch{}},d=u=>{M.value=!1},P=()=>{E.success("å·¥å•å·²æäº¤"),ue()},U=()=>{ue()},M=C(!1),Z=C(!1),ce=C(!1),me=C(!1);C(0);const ue=async()=>{if($){k.value=!0;try{const u=await Q.getOrderDetail($);if(u.success&&u.data){const a=u.data,T=a.product_snapshot||{},q=a.sku_snapshot||{};if(o.value={id:a.id,order_no:a.order_no,orderType:a.order_type,status:a.status,quantity:a.quantity,totalAmount:a.total_amount,createdAt:a.created_at,expires_at:a.expires_at,productName:T.product_name||"",productImage:T.image||"",skuSpec:q.spec_combination?Object.values(q.spec_combination).join(" "):"é»˜è®¤",product_snapshot:T,sku_snapshot:q},a.cdkList&&Array.isArray(a.cdkList)&&(y.value=a.cdkList.map(H=>({...H})),y.value.length>0)){const H=y.value[0];H.accountData&&(j.value=H.accountData.image||H.accountData.help_image||H.accountData.common_image||"")}if(a.slotList&&Array.isArray(a.slotList)?h.value=a.slotList:h.value=[],a.status==="refunding"||a.status==="active"||a.status==="pending_delivery"){const H=await Q.getRefundRequest($);H.success&&H.data?r.value=H.data:r.value=null}const J=await Ie.getList("processing");if(J.success&&J.data){const H=J.data.find(Se=>Se.order_id===$);H?n.value=H.id:n.value=null}}}catch(u){console.error(u)}finally{k.value=!1}}};return ie(ue),(u,a)=>{const T=K;return t(),s("div",Xa,[e("div",Za,[e("div",Qa,[e("div",{class:Y(["hero-aurora-bg",o.value.status])},null,2),e("div",Ga,[e("div",Ka,[e("div",eo,[e("div",{class:"back-btn",onClick:a[0]||(a[0]=q=>S(b).back())},[l(T,null,{default:w(()=>[l(S(Ae))]),_:1}),a[13]||(a[13]=e("span",{class:"back-text"},"è¿”å›ž",-1))]),e("div",to,[a[14]||(a[14]=e("span",{class:"label"},"è®¢å•å·",-1)),e("span",so,v(o.value.order_no||"---"),1),l(T,{class:"copy-icon",onClick:a[1]||(a[1]=q=>de(o.value.order_no))},{default:w(()=>[l(S(ve))]),_:1})])]),e("div",ao,[e("span",oo,v(L(o.value.totalAmount||0)),1),e("span",lo,"."+v(G(o.value.totalAmount||0)),1),a[15]||(a[15]=e("span",{class:"amount-unit"},"ç‚¹",-1))])]),e("div",no,[e("div",io,[e("div",{class:Y(["status-icon-box",o.value.status])},[o.value.status==="active"||o.value.status==="completed"?(t(),B(T,{key:0},{default:w(()=>[l(S(he))]),_:1})):o.value.status==="pending_delivery"?(t(),B(T,{key:1},{default:w(()=>[l(S(Ue))]),_:1})):o.value.status==="refunding"||o.value.status==="refunded"?(t(),B(T,{key:2},{default:w(()=>[l(S(Be))]),_:1})):(t(),B(T,{key:3},{default:w(()=>[l(S(Ne))]),_:1}))],2),e("div",ro,[e("div",co,[e("h1",uo,v(g.value),1),o.value.status==="active"&&p.value!==null?(t(),s("div",{key:0,class:Y(["time-badge",f(p.value)])},[l(T,null,{default:w(()=>[l(S(ze))]),_:1}),A(" å‰©ä½™ "+v(p.value)+" å¤© ",1)],2)):O("",!0)]),e("div",vo,[o.value.status==="refunding"?(t(),s("span",po,"é€€æ¬¾ç”³è¯·å¾…å®¡æ ¸ï¼š"+v(i.value||"è¯·è€å¿ƒç­‰å¾…"),1)):o.value.status==="pending_delivery"?(t(),s("span",_o,"ç³»ç»Ÿæ­£åœ¨æžé€Ÿé…è´§ä¸­")):o.value.status==="active"?(t(),s("span",fo,"å•†å“çŠ¶æ€æ­£å¸¸ï¼Œåˆ°æœŸæ—¶é—´: "+v(re(o.value.expires_at||"")),1)):(t(),s("span",mo,"ä¸‹å•æ—¶é—´: "+v(re(o.value.createdAt||"")),1))])])]),e("div",ho,[e("button",{class:"hero-btn secondary",onClick:a[2]||(a[2]=q=>c("contact"))},[l(T,null,{default:w(()=>[l(S(Pe))]),_:1}),a[16]||(a[16]=A(" è”ç³»å®¢æœ ",-1))]),n.value?(t(),s("button",{key:0,class:"hero-btn secondary",onClick:a[3]||(a[3]=q=>c("view_ticket"))},[l(T,null,{default:w(()=>[l(S(ye))]),_:1}),a[17]||(a[17]=A(" æŸ¥çœ‹å·¥å• ",-1))])):(t(),s("button",{key:1,class:"hero-btn secondary",onClick:a[4]||(a[4]=q=>c("create_ticket"))},[l(T,null,{default:w(()=>[l(S(ye))]),_:1}),a[18]||(a[18]=A(" ç”³è¯·å·¥å• ",-1))])),m.value?(t(),s("button",{key:2,class:"hero-btn primary",onClick:a[5]||(a[5]=q=>c("renew"))},[l(T,null,{default:w(()=>[l(S(He))]),_:1}),a[19]||(a[19]=A(" ç»­è´¹ ",-1))])):O("",!0),o.value.status==="refunding"||r.value?(t(),s("button",{key:3,class:"hero-btn warning",onClick:a[6]||(a[6]=q=>c("cancel_refund"))},[l(T,null,{default:w(()=>[l(S(ke))]),_:1}),a[20]||(a[20]=A(" å–æ¶ˆé€€æ¬¾ ",-1))])):D.value?(t(),s("button",{key:4,class:"hero-btn danger",onClick:a[7]||(a[7]=q=>c("apply_refund"))},[l(T,null,{default:w(()=>[l(S(Ye))]),_:1}),a[21]||(a[21]=A(" ç”³è¯·é€€æ¬¾ ",-1))])):O("",!0)])])]),a[22]||(a[22]=e("div",{class:"noise-overlay"},null,-1))])]),e("div",ko,[l(Wa,{class:"fade-in-up","product-snapshot":o.value.product_snapshot,"sku-snapshot":o.value.sku_snapshot,quantity:o.value.quantity,"order-status":o.value.status},null,8,["product-snapshot","sku-snapshot","quantity","order-status"]),["pending_delivery","active","completed","refunding"].includes(o.value.status||"")?(t(),s("div",yo,[o.value.orderType==="shared_account"?(t(!0),s(N,{key:0},z(h.value,(q,J)=>(t(),s("div",{key:q.id||J,class:"virtual-item-group"},[h.value.length>1?(t(),s("div",go,[e("span",bo,"è½¦ä½ "+v(J+1),1)])):O("",!0),l($t,{"cdk-item":te(q),"slot-index":q.slot_index},null,8,["cdk-item","slot-index"])]))),128)):o.value.orderType==="one_time_cdk"?(t(),B(Ut,{key:1,"cdk-list":y.value},null,8,["cdk-list"])):o.value.orderType==="virtual"&&y.value.length>0?(t(),s("div",$o,[l(is,{"order-id":o.value.id||"","order-status":o.value.status||"","cdk-fields":ee(y.value[0]),"cdk-id":y.value[0].id,onSubmitSuccess:_e},null,8,["order-id","order-status","cdk-fields","cdk-id"]),l(bs,{ref_key:"historyRef",ref:se,"order-id":o.value.id||"","filter-cdk-id":y.value[0].id},null,8,["order-id","filter-cdk-id"])])):O("",!0)])):O("",!0),j.value?(t(),s("div",wo,[e("div",Io,[e("div",xo,[l(T,{class:"header-icon"},{default:w(()=>[l(S(Je))]),_:1}),a[23]||(a[23]=e("span",{class:"tile-title"},"ä½¿ç”¨è¯´æ˜Ž",-1))])]),e("div",{class:"tutorial-body",onClick:a[8]||(a[8]=q=>fe(j.value))},[e("div",So,[e("img",{src:j.value,loading:"lazy"},null,8,Co)]),e("div",Ro,[e("div",Do,[l(T,null,{default:w(()=>[l(S(We))]),_:1}),a[24]||(a[24]=A(" ç‚¹å‡»æŸ¥çœ‹å¤§å›¾ ",-1))])])])])):O("",!0)]),o.value.id?(t(),B(ta,{key:0,modelValue:M.value,"onUpdate:modelValue":a[9]||(a[9]=q=>M.value=q),"order-id":o.value.id,onSuccess:d},null,8,["modelValue","order-id"])):O("",!0),o.value.id?(t(),B(ua,{key:1,modelValue:Z.value,"onUpdate:modelValue":a[10]||(a[10]=q=>Z.value=q),"order-id":o.value.id,"order-no":o.value.order_no,onSuccess:U},null,8,["modelValue","order-id","order-no"])):O("",!0),ce.value&&o.value.id?(t(),B(La,{key:2,"order-id":o.value.id,"order-info":{order_no:o.value.order_no||"",product_name:o.value.product_snapshot?.product_name||""},onClose:a[11]||(a[11]=q=>ce.value=!1),onSuccess:P},null,8,["order-id","order-info"])):O("",!0),me.value?(t(),B(Ua,{key:3,onClose:a[12]||(a[12]=q=>me.value=!1)})):O("",!0)])}}}),pl=X(Fo,[["__scopeId","data-v-8f9f98d5"]]);export{pl as default};
