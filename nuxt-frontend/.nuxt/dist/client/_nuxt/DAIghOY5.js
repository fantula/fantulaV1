import{cT as Xe,cm as ye,bX as Se,bY as Q,co as Ce,c0 as Te,f as Ne,ca as Ee,cU as Ve,cV as Be,cW as $e,b$ as Oe,cX as Fe,r as p,cY as De,g as d,cZ as He,ba as je,J as ie,K as _e,h as Re,cp as V,G as be,o as I,w as m,b as c,T as Ke,a as k,aA as Le,n as v,l as s,D as S,c as _,aF as N,aD as We,E as P,c_ as Ze,F as ke,a2 as qe,L as Ge,d as Ue,t as xe,c$ as Je,aY as Qe,M as ea,aT as aa,aO as sa,c5 as ta,c6 as Z,d0 as oa,c3 as Ae,cq as na,cF as la,cg as J,bt as ra,d1 as ia,c1 as ze,aZ as ca,d2 as we,d3 as he,ck as ua,bk as da,cE as fa,d4 as va}from"./CEI0siaN.js";import{E as ma}from"./BC9Y1jC9.js";import{E as pa}from"./wVnq5BSo.js";import{u as ga}from"./DxNR5PDn.js";import{d as wa}from"./CChPPi86.js";import{u as ha}from"./C6m5ANi3.js";import{a as ya}from"./uZ_KtR8H.js";var ba="Expected a function";function re(i,B,$){var u=!0,f=!0;if(typeof i!="function")throw new TypeError(ba);return Xe($)&&(u="leading"in $?!!$.leading:u,f="trailing"in $?!!$.trailing:f),wa(i,B,{leading:u,maxWait:B,trailing:f})}const ka=Se({urlList:{type:Q(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),Ia={close:()=>!0,error:i=>i instanceof Event,switch:i=>ye(i),rotate:i=>ye(i)},Ea=["src","crossorigin"],La=Ne({name:"ElImageViewer",__name:"image-viewer",props:ka,emits:Ia,setup(i,{expose:B,emit:$}){var u;const f={CONTAIN:{name:"contain",icon:Ee(Be)},ORIGINAL:{name:"original",icon:Ee(Ve)}},r=i,g=$;let q;const{t:ee}=$e(),n=Oe("image-viewer"),{nextZIndex:G}=Fe(),E=p(),O=p(),F=De(),R=d(()=>{const{scale:e,minScale:t,maxScale:l}=r;return He(e,t,l)}),w=p(!0),Y=p(!1),x=p(!1),h=p(r.initialIndex),D=je(f.CONTAIN),o=p({scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ce=p((u=r.zIndex)!=null?u:G());ga(x,{ns:n});const ae=d(()=>{const{urlList:e}=r;return e.length<=1}),H=d(()=>h.value===0),se=d(()=>h.value===r.urlList.length-1),j=d(()=>r.urlList[h.value]),ue=d(()=>[n.e("btn"),n.e("prev"),n.is("disabled",!r.infinite&&H.value)]),te=d(()=>[n.e("btn"),n.e("next"),n.is("disabled",!r.infinite&&se.value)]),oe=d(()=>{const{scale:e,deg:t,offsetX:l,offsetY:z,enableTransition:C}=o.value;let b=l/e,T=z/e;const W=t*Math.PI/180,X=Math.cos(W),U=Math.sin(W);b=b*X+T*U,T=T*X-l/e*U;const ge={transform:`scale(${e}) rotate(${t}deg) translate(${b}px, ${T}px)`,transition:C?"transform .3s":""};return D.value.name===f.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),ne=d(()=>`${h.value+1} / ${r.urlList.length}`);function M(){fe(),q?.(),x.value=!1,g("close")}function de(){const e=re(l=>{switch(ta(l)){case Z.esc:r.closeOnPressEscape&&M();break;case Z.space:ve();break;case Z.left:me();break;case Z.up:A("zoomIn");break;case Z.right:pe();break;case Z.down:A("zoomOut");break}}),t=re(l=>{const z=l.deltaY||l.deltaX;A(z<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});F.run(()=>{V(document,"keydown",e),V(E,"wheel",t)})}function fe(){F.stop()}function a(){w.value=!1}function L(e){Y.value=!0,w.value=!1,g("error",e),e.target.alt=ee("el.image.error")}function y(e){if(w.value||e.button!==0||!E.value)return;o.value.enableTransition=!1;const{offsetX:t,offsetY:l}=o.value,z=e.pageX,C=e.pageY,b=re(X=>{o.value={...o.value,offsetX:t+X.pageX-z,offsetY:l+X.pageY-C}}),T=V(document,"mousemove",b),W=V(document,"mouseup",()=>{T(),W()});e.preventDefault()}function K(e){if(w.value||!E.value||e.touches.length!==1)return;o.value.enableTransition=!1;const{offsetX:t,offsetY:l}=o.value,{pageX:z,pageY:C}=e.touches[0],b=re(X=>{const U=X.touches[0];o.value={...o.value,offsetX:t+U.pageX-z,offsetY:l+U.pageY-C}}),T=V(document,"touchmove",b),W=V(document,"touchend",()=>{T(),W()});e.preventDefault()}function Ie(){o.value={scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ve(){if(w.value||Y.value)return;const e=oa(f),t=Object.values(f),l=D.value.name,C=(t.findIndex(b=>b.name===l)+1)%e.length;D.value=f[e[C]],Ie()}function le(e){Y.value=!1;const t=r.urlList.length;h.value=(e+t)%t}function me(){H.value&&!r.infinite||le(h.value-1)}function pe(){se.value&&!r.infinite||le(h.value+1)}function A(e,t={}){if(w.value||Y.value)return;const{minScale:l,maxScale:z}=r,{zoomRate:C,rotateDeg:b,enableTransition:T}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":o.value.scale>l&&(o.value.scale=Number.parseFloat((o.value.scale/C).toFixed(3)));break;case"zoomIn":o.value.scale<z&&(o.value.scale=Number.parseFloat((o.value.scale*C).toFixed(3)));break;case"clockwise":o.value.deg+=b,g("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=b,g("rotate",o.value.deg);break}o.value.enableTransition=T}function Pe(e){var t;((t=e.detail)==null?void 0:t.focusReason)==="pointer"&&e.preventDefault()}function Ye(){r.closeOnPressEscape&&M()}function Me(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ie(()=>R.value,e=>{o.value.scale=e}),ie(j,()=>{_e(()=>{const e=O.value;e?.complete||(w.value=!0)})}),ie(h,e=>{Ie(),g("switch",e)}),Re(()=>{x.value=!0,de(),q=V("wheel",Me,{passive:!1})}),B({setActiveItem:le}),(e,t)=>(I(),be(s(pa),{to:"body",disabled:!e.teleported},{default:m(()=>[c(Ke,{name:"viewer-fade",appear:""},{default:m(()=>[k("div",{ref_key:"wrapper",ref:E,tabindex:-1,class:v(s(n).e("wrapper")),style:Le({zIndex:ce.value})},[c(s(ma),{loop:"",trapped:"","focus-trap-el":E.value,"focus-start-el":"container",onFocusoutPrevented:Pe,onReleaseRequested:Ye},{default:m(()=>[k("div",{class:v(s(n).e("mask")),onClick:t[0]||(t[0]=We(l=>e.hideOnClickModal&&M(),["self"]))},null,2),S(" CLOSE "),k("span",{class:v([s(n).e("btn"),s(n).e("close")]),onClick:M},[c(s(P),null,{default:m(()=>[c(s(Ze))]),_:1})],2),S(" ARROW "),ae.value?S("v-if",!0):(I(),_(ke,{key:0},[k("span",{class:v(ue.value),onClick:me},[c(s(P),null,{default:m(()=>[c(s(qe))]),_:1})],2),k("span",{class:v(te.value),onClick:pe},[c(s(P),null,{default:m(()=>[c(s(Ge))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(I(),_("div",{key:1,class:v([s(n).e("btn"),s(n).e("progress")])},[N(e.$slots,"progress",{activeIndex:h.value,total:e.urlList.length},()=>[Ue(xe(ne.value),1)])],2)):S("v-if",!0),S(" ACTIONS "),k("div",{class:v([s(n).e("btn"),s(n).e("actions")])},[k("div",{class:v(s(n).e("actions__inner"))},[N(e.$slots,"toolbar",{actions:A,prev:me,next:pe,reset:ve,activeIndex:h.value,setActiveItem:le},()=>[c(s(P),{onClick:t[1]||(t[1]=l=>A("zoomOut"))},{default:m(()=>[c(s(Je))]),_:1}),c(s(P),{onClick:t[2]||(t[2]=l=>A("zoomIn"))},{default:m(()=>[c(s(Qe))]),_:1}),k("i",{class:v(s(n).e("actions__divider"))},null,2),c(s(P),{onClick:ve},{default:m(()=>[(I(),be(ea(D.value.icon)))]),_:1}),k("i",{class:v(s(n).e("actions__divider"))},null,2),c(s(P),{onClick:t[3]||(t[3]=l=>A("anticlockwise"))},{default:m(()=>[c(s(aa))]),_:1}),c(s(P),{onClick:t[4]||(t[4]=l=>A("clockwise"))},{default:m(()=>[c(s(sa))]),_:1})])],2)],2),S(" CANVAS "),k("div",{class:v(s(n).e("canvas"))},[Y.value&&e.$slots["viewer-error"]?N(e.$slots,"viewer-error",{key:0,activeIndex:h.value,src:j.value}):(I(),_("img",{ref_key:"imgRef",ref:O,key:j.value,src:j.value,style:Le(oe.value),class:v(s(n).e("img")),crossorigin:e.crossorigin,onLoad:a,onError:L,onMousedown:y,onTouchstart:K},null,46,Ea))],2),N(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var za=Te(La,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const Sa=Ae(za),Ca=Se({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Q([String,Object])},previewSrcList:{type:Q(Array),default:()=>Ce([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),Ta={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ye(i),close:()=>!0,show:()=>!0},Na=["src","loading","crossorigin"],$a={key:0},Oa=Ne({name:"ElImage",inheritAttrs:!1,__name:"image",props:Ca,emits:Ta,setup(i,{expose:B,emit:$}){const u=i,f=$,{t:r}=$e(),g=Oe("image"),q=na(),ee=d(()=>la(Object.entries(q).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),n=ha({excludeListeners:!0,excludeKeys:d(()=>Object.keys(ee.value))}),G=p(),E=p(!1),O=p(!0),F=p(!1),R=p(),w=p(),Y=J&&"loading"in HTMLImageElement.prototype;let x;const h=d(()=>[g.e("inner"),o.value&&g.e("preview"),O.value&&g.is("loading")]),D=d(()=>{const{fit:a}=u;return J&&a?{objectFit:a}:{}}),o=d(()=>{const{previewSrcList:a}=u;return ra(a)&&a.length>0}),ce=d(()=>{const{previewSrcList:a,initialIndex:L}=u;let y=L;return L>a.length-1&&(y=0),y}),ae=d(()=>u.loading==="eager"?!1:!Y&&u.loading==="lazy"||u.lazy),H=()=>{J&&(O.value=!0,E.value=!1,G.value=u.src)};function se(a){O.value=!1,E.value=!1,f("load",a)}function j(a){O.value=!1,E.value=!0,f("error",a)}function ue(a){a&&(H(),ne())}const te=ia(ue,200,!0);async function oe(){var a;if(!J)return;await _e();const{scrollContainer:L}=u;if(ua(L))w.value=L;else if(da(L)&&L!=="")w.value=(a=document.querySelector(L))!=null?a:void 0;else if(R.value){const K=ya(R.value);w.value=fa(K)?void 0:K}const{stop:y}=va(R,([K])=>{te(K.isIntersecting)},{root:w});x=y}function ne(){!J||!te||(x?.(),w.value=void 0,x=void 0)}function M(){o.value&&(F.value=!0,f("show"))}function de(){F.value=!1,f("close")}function fe(a){f("switch",a)}return ie(()=>u.src,()=>{ae.value?(O.value=!0,E.value=!1,ne(),oe()):H()}),Re(()=>{ae.value?oe():H()}),B({showPreview:M}),(a,L)=>(I(),_("div",ze({ref_key:"container",ref:R},ee.value,{class:[s(g).b(),a.$attrs.class]}),[E.value?N(a.$slots,"error",{key:0},()=>[k("div",{class:v(s(g).e("error"))},xe(s(r)("el.image.error")),3)]):(I(),_(ke,{key:1},[G.value!==void 0?(I(),_("img",ze({key:0},s(n),{src:G.value,loading:a.loading,style:D.value,class:h.value,crossorigin:a.crossorigin,onClick:M,onLoad:se,onError:j}),null,16,Na)):S("v-if",!0),O.value?(I(),_("div",{key:1,class:v(s(g).e("wrapper"))},[N(a.$slots,"placeholder",{},()=>[k("div",{class:v(s(g).e("placeholder"))},null,2)])],2)):S("v-if",!0)],64)),o.value?(I(),_(ke,{key:2},[F.value?(I(),be(s(Sa),{key:0,"z-index":a.zIndex,"initial-index":ce.value,infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,scale:a.scale,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:de,onSwitch:fe},ca({toolbar:m(y=>[N(a.$slots,"toolbar",we(he(y)))]),default:m(()=>[a.$slots.viewer?(I(),_("div",$a,[N(a.$slots,"viewer")])):S("v-if",!0)]),_:2},[a.$slots.progress?{name:"progress",fn:m(y=>[N(a.$slots,"progress",we(he(y)))]),key:"0"}:void 0,a.$slots["viewer-error"]?{name:"viewer-error",fn:m(y=>[N(a.$slots,"viewer-error",we(he(y)))]),key:"1"}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):S("v-if",!0)],64)):S("v-if",!0)],16))}});var _a=Te(Oa,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Va=Ae(_a);export{Va as E,Ca as a,Ia as b,ka as c,Sa as d,Ta as i,re as t};
