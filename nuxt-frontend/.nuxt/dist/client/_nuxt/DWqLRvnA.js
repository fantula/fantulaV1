import{E as L}from"./DB7JGTAC.js";import{E as j}from"./CoJKtQsI.js";import{a as H,E as J}from"./B77-r_qQ.js";import{E as K}from"./aU3tz_xb.js";import{E as P}from"./b7hvKMAc.js";import{E as Q}from"./CZLDLz6s.js";import{E as W,a as X}from"./ClIUVBla.js";import{E as Y}from"./CP47LeNR.js";import{f as Z,r as m,g as tt,am as O,h as et,c as k,b as r,w as a,B as l,o as E,a as h,l as ot,p as rt,d as _,i as st,G as at,t as T,_ as lt}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{f as d}from"./ByqilF2g.js";import{A as nt}from"./Jf5bIUYa.js";import{v as it}from"./BrE0JoK1.js";import{E as ut}from"./BOUQDXLJ.js";import"./OwHC_0Ap.js";import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./CNYNJsmX.js";import"./Cq9Fpw4b.js";import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./BjbJQEzT.js";import"./wVnq5BSo.js";import"./Bh6H2ams.js";import"./BC9Y1jC9.js";import"./CCDBlmbt.js";import"./DE5qJ7kT.js";import"./BzZM8Et6.js";import"./DW0_wk9g.js";import"./CChPPi86.js";import"./B_7HZhJl.js";import"./D-7LAYt0.js";import"./BB_Ol6Sd.js";import"./CB_o0Cdi.js";import"./BCllKHMW.js";import"./C6m5ANi3.js";import"./CCoZ80-G.js";import"./tbxUD7ww.js";import"./hs4dPNZ2.js";import"./D6FW0B1r.js";import"./DxNR5PDn.js";import"./uZ_KtR8H.js";import"./BPYXJYQz.js";import"./BV_QTDOQ.js";import"./DgMG35os.js";import"./PbH8IyH8.js";/* empty css        */const mt={class:"recharge-tiers-page"},dt={class:"action-container"},pt={style:{"font-weight":"bold","font-size":"16px"}},ct={key:0,style:{color:"#67C23A"}},ft={key:1,style:{color:"#909399"}},_t={class:"dialog-footer"},gt=Z({__name:"tiers",setup(bt){const C=m(!1),x=m(!1),n=m(!1),g=m(!1),p=m(),b=m([]),B=tt(()=>[...b.value].sort((e,t)=>e.sortOrder-t.sortOrder)),s=O({id:"",amount:6,bonus:0,sortOrder:0,status:!0}),U=O({amount:[{required:!0,message:"请输入充值金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],bonus:[{required:!0,message:"请输入赠送金额",trigger:"blur"}]}),v=async()=>{C.value=!0;try{const e=await d.getTiers();e.success?b.value=e.data.map(t=>({id:t.id,amount:Number(t.amount),bonus:Number(t.bonus),sortOrder:t.sort_order,status:t.status==="on",createTime:t.created_at})):l.error(e.error||"加载失败")}catch{l.error("加载充值档位失败")}finally{C.value=!1}};et(v);const A=()=>{g.value=!1,s.id="",s.amount=6,s.bonus=0,s.sortOrder=b.value.length+1,s.status=!0,n.value=!0},D=e=>{g.value=!0,s.id=e.id,s.amount=e.amount,s.bonus=e.bonus,s.sortOrder=e.sortOrder,s.status=e.status,n.value=!0},N=async()=>{p.value&&await p.value.validate(async e=>{if(e){x.value=!0;try{const t={amount:s.amount,bonus:s.bonus,sort_order:s.sortOrder,status:s.status?"on":"off"};if(g.value){const i=await d.updateTier(s.id,t);i.success?(l.success("更新成功"),n.value=!1,await v()):l.error(i.error||"更新失败")}else{const i=await d.createTier(t);i.success?(l.success("添加成功"),n.value=!1,await v()):l.error(i.error||"添加失败")}}finally{x.value=!1}}})},F=()=>{p.value&&p.value.resetFields()},$=async()=>{for(const e of b.value)await d.updateTier(e.id,{sort_order:e.sortOrder});l.success("排序已保存")},S=async e=>{const t=await d.updateTier(e.id,{status:e.status?"on":"off"});t.success?l.success(e.status?"已启用":"已停用"):(l.error(t.error||"状态更新失败"),e.status=!e.status)},I=e=>{ut.confirm(`确认删除充值档位 "¥${e.amount}" 吗？`,"删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const t=await d.deleteTier(e.id);t.success?(l.success("删除成功"),await v()):l.error(t.error||"删除失败")})};return(e,t)=>{const i=L,c=j,f=J,y=K,w=P,M=H,R=Q,V=X,q=W,z=Y,G=it;return E(),k("div",mt,[r(nt,null,{default:a(()=>[h("div",dt,[r(i,{title:"提示：此处配置的充值档位将在客户端充值页面展示，排序值越小越靠前。",type:"info","show-icon":"",closable:!1,style:{"margin-right":"20px",flex:"1"}}),r(c,{type:"primary",icon:ot(rt),onClick:A},{default:a(()=>[...t[6]||(t[6]=[_("新增充值档位",-1)])]),_:1},8,["icon"])])]),_:1}),r(R,{shadow:"never",class:"list-card mt-4"},{default:a(()=>[st((E(),at(M,{data:B.value,style:{width:"100%"},border:"",stripe:""},{default:a(()=>[r(f,{prop:"amount",label:"充值金额 (元)","min-width":"150",align:"center"},{default:a(({row:o})=>[h("span",pt,"¥"+T(o.amount),1)]),_:1}),r(f,{prop:"bonus",label:"赠送金额 (元)","min-width":"150",align:"center"},{default:a(({row:o})=>[o.bonus>0?(E(),k("span",ct,"+ ¥"+T(o.bonus),1)):(E(),k("span",ft,"-"))]),_:1}),r(f,{label:"排序值",width:"150",align:"center"},{default:a(({row:o})=>[r(y,{modelValue:o.sortOrder,"onUpdate:modelValue":u=>o.sortOrder=u,min:0,max:999,size:"small","controls-position":"right",onChange:$},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(f,{label:"状态",width:"100",align:"center"},{default:a(({row:o})=>[r(w,{modelValue:o.status,"onUpdate:modelValue":u=>o.status=u,onChange:u=>S(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),r(f,{label:"操作",width:"150",fixed:"right",align:"center"},{default:a(({row:o})=>[r(c,{link:"",type:"primary",onClick:u=>D(o)},{default:a(()=>[...t[7]||(t[7]=[_("编辑",-1)])]),_:1},8,["onClick"]),r(c,{link:"",type:"danger",onClick:u=>I(o)},{default:a(()=>[...t[8]||(t[8]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,C.value]])]),_:1}),r(z,{modelValue:n.value,"onUpdate:modelValue":t[5]||(t[5]=o=>n.value=o),title:g.value?"编辑充值档位":"新增充值档位",width:"500px",onClosed:F,"append-to-body":""},{footer:a(()=>[h("span",_t,[r(c,{onClick:t[4]||(t[4]=o=>n.value=!1)},{default:a(()=>[...t[10]||(t[10]=[_("取消",-1)])]),_:1}),r(c,{type:"primary",onClick:N,loading:x.value},{default:a(()=>[...t[11]||(t[11]=[_("确认",-1)])]),_:1},8,["loading"])])]),default:a(()=>[r(q,{model:s,rules:U,ref_key:"formRef",ref:p,"label-width":"100px"},{default:a(()=>[r(V,{label:"充值金额",prop:"amount"},{default:a(()=>[r(y,{modelValue:s.amount,"onUpdate:modelValue":t[0]||(t[0]=o=>s.amount=o),min:1,precision:2,step:1,style:{width:"100%"},placeholder:"请输入充值金额"},null,8,["modelValue"])]),_:1}),r(V,{label:"赠送金额",prop:"bonus"},{default:a(()=>[r(y,{modelValue:s.bonus,"onUpdate:modelValue":t[1]||(t[1]=o=>s.bonus=o),min:0,precision:2,step:1,style:{width:"100%"},placeholder:"请输入赠送金额"},null,8,["modelValue"])]),_:1}),r(V,{label:"排序值",prop:"sortOrder"},{default:a(()=>[r(y,{modelValue:s.sortOrder,"onUpdate:modelValue":t[2]||(t[2]=o=>s.sortOrder=o),min:0,max:999,"controls-position":"right"},null,8,["modelValue"]),t[9]||(t[9]=h("div",{class:"form-tip"},"数值越小越靠前",-1))]),_:1}),r(V,{label:"状态",prop:"status"},{default:a(()=>[r(w,{modelValue:s.status,"onUpdate:modelValue":t[3]||(t[3]=o=>s.status=o),"active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),we=lt(gt,[["__scopeId","data-v-84952097"]]);export{we as default};
