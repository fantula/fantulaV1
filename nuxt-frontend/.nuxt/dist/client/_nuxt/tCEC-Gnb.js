import{E as j}from"./DrogL690.js";import{E as z,a as A}from"./A8Zj-15Y.js";import{E as G,a as H}from"./DILJPjji.js";import{E as J}from"./B94kvl1B.js";import{E as P}from"./DR2PtzNo.js";import{a as T}from"./DtgOm6Sf.js";import{E as K}from"./CzVV9LeR.js";import{E as L}from"./Di9v79cN.js";import{E as O}from"./CjhxNRX1.js";import{f as W,r as g,a1 as X,g as Z,am as tt,J as et,h as ot,c as k,b as o,a,l as M,w as s,B as d,C as at,o as f,d as C,D as Y,G as st,t as _,_ as lt}from"./gYbOYKrZ.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./CswOF4xx.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{d as i}from"./C-2dxbDp.js";import{S as rt}from"./CFKNQiB6.js";import{c as E}from"./9gheNwfe.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./BB_Ol6Sd.js";import"./BNtqh2Az.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./C5EOtA6j.js";import"./pxhmPWjv.js";import"./MkrgA_tt.js";import"./92s3wAHG.js";import"./CaswxL1d.js";import"./BlcygIWm.js";import"./CUkNyi1D.js";import"./BSx1rCp4.js";import"./BPYHQo7_.js";import"./Cr8dt13I.js";import"./YvAJPawC.js";import"./-tO7MSA0.js";import"./gVImYNNu.js";import"./DMMqLNeM.js";import"./C6CbiQn9.js";import"./B9zwl8KS.js";const nt={class:"coupon-post-page"},it={class:"form-content"},mt={class:"date-picker-wrapper"},ut={key:0,class:"date-text"},dt={class:"value"},pt={key:0,class:"form-tip"},ct={class:"preview-container"},ft={class:"coupon-ticket"},_t={class:"ticket-left"},vt={class:"ticket-amount"},Dt={class:"ticket-right"},bt={class:"ticket-name"},yt={class:"ticket-date"},gt=W({__name:"post",setup(kt){const B=X(),v=at(),D=g(),b=g(!1),p=B.query.id,u=Z(()=>!!p),r=g(!1),e=tt({name:"",value:0,startDate:i().format("YYYY-MM-DD"),endDate:"",totalQuantity:1e3,status:!0}),h={name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],value:[{required:!0,message:"请输入赠送金额",trigger:"blur"}]},V=l=>i(l).format("YYYY-MM-DD"),N=l=>i(l).isBefore(i(),"day");et(r,l=>{l&&(e.endDate="")});const S=async()=>{if(!p)return;const l=await E.coupon.getCouponById(p);if(l.success&&l.coupon){const t=l.coupon;e.name=t.name,e.value=Number(t.value),e.status=t.status,e.startDate=t.start_date?i(t.start_date).format("YYYY-MM-DD"):i().format("YYYY-MM-DD"),e.totalQuantity=t.total_quantity||1e3,t.end_date?(r.value=!1,e.endDate=i(t.end_date).format("YYYY-MM-DD")):(r.value=!0,e.endDate="")}else d.error(l.error||"获取详情失败")},U=async()=>{D.value&&await D.value.validate(async l=>{if(l){if(!r.value&&!e.endDate){d.warning("请选择结束日期");return}b.value=!0;try{const t={name:e.name,type:"balance",value:e.value,product_ids:[],min_usage:0,total_quantity:0,start_date:r.value?null:e.startDate,end_date:r.value?null:e.endDate,status:e.status};let m;u.value?m=await E.coupon.updateCoupon(p,t):m=await E.coupon.createCoupon(t),m.success?(d.success(u.value?"更新成功":"创建成功"),v.back()):d.error(m.error||"保存失败")}catch{d.error("保存异常")}finally{b.value=!1}}})};return ot(()=>{S()}),(l,t)=>{const m=j,c=A,y=H,w=G,q=J,I=P,R=T,$=K,F=L,x=O,Q=z;return f(),k("div",nt,[o(rt,{title:u.value?"编辑额度券":"新增额度券","sub-title":u.value?"修改额度券信息":"创建一个新的余额充值券","submit-text":u.value?"保存":"新增",loading:b.value,onSubmit:U,onCancel:t[0]||(t[0]=n=>M(v).back()),onBack:t[1]||(t[1]=n=>M(v).back())},null,8,["title","sub-title","submit-text","loading"]),a("div",it,[o(Q,{ref_key:"formRef",ref:D,model:e,rules:h,"label-width":"120px","label-position":"top",size:"large"},{default:s(()=>[o(x,{shadow:"never",class:"form-card"},{header:s(()=>[...t[7]||(t[7]=[a("div",{class:"card-header"},[a("span",null,"基础信息")],-1)])]),default:s(()=>[o(w,{gutter:24},{default:s(()=>[o(y,{span:12},{default:s(()=>[o(c,{label:"优惠券名称",prop:"name"},{default:s(()=>[o(m,{modelValue:e.name,"onUpdate:modelValue":t[2]||(t[2]=n=>e.name=n),placeholder:"例如：新用户首充福利"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(w,{gutter:24},{default:s(()=>[o(y,{span:12},{default:s(()=>[o(c,{label:"赠送余额 (元)",prop:"value"},{default:s(()=>[o(q,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=n=>e.value=n),min:.01,precision:2,"controls-position":"right",style:{width:"100%"}},{prefix:s(()=>[...t[8]||(t[8]=[C("¥",-1)])]),_:1},8,["modelValue"]),t[9]||(t[9]=a("div",{class:"form-tip"},"用户领券后直接增加到账户余额的金额",-1))]),_:1})]),_:1}),o(y,{span:12},{default:s(()=>[o(c,{label:"有效期"},{default:s(()=>[a("div",mt,[r.value?Y("",!0):(f(),k("div",ut,[t[10]||(t[10]=a("span",{class:"label"},"开始：",-1)),a("span",dt,_(V(e.startDate)),1)])),r.value?Y("",!0):(f(),st(I,{key:1,modelValue:e.endDate,"onUpdate:modelValue":t[4]||(t[4]=n=>e.endDate=n),type:"date",placeholder:"选择结束日期","value-format":"YYYY-MM-DD",style:{flex:"1",margin:"0 12px"},"disabled-date":N},null,8,["modelValue"])),o(R,{modelValue:r.value,"onUpdate:modelValue":t[5]||(t[5]=n=>r.value=n),label:"永久有效",border:""},null,8,["modelValue"])]),r.value?Y("",!0):(f(),k("div",pt,"默认从今日开始生效，请选择截止日期"))]),_:1})]),_:1})]),_:1}),o($,{"content-position":"left"},{default:s(()=>[...t[11]||(t[11]=[C("发放规则",-1)])]),_:1}),o(c,{label:"状态",prop:"status"},{default:s(()=>[o(F,{modelValue:e.status,"onUpdate:modelValue":t[6]||(t[6]=n=>e.status=n),"active-text":"立即启用","inactive-text":"暂不启用"},null,8,["modelValue"])]),_:1})]),_:1}),o(x,{shadow:"never",class:"form-card",style:{"margin-top":"24px"}},{header:s(()=>[...t[12]||(t[12]=[a("div",{class:"card-header"},[a("span",null,"效果预览")],-1)])]),default:s(()=>[a("div",ct,[a("div",ft,[a("div",_t,[a("div",vt,"¥"+_(e.value||"0"),1),t[13]||(t[13]=a("div",{class:"ticket-label"},"余额红包",-1))]),a("div",Dt,[a("div",bt,_(e.name||"优惠券名称"),1),a("div",yt,_(r.value?"永久有效":`${V(e.startDate)} 至 ${e.endDate||"?"}`),1)])])])]),_:1})]),_:1},8,["model"])])])}}}),De=lt(gt,[["__scopeId","data-v-84cbc459"]]);export{De as default};
