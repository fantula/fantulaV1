import{E as W}from"./aU3tz_xb.js";import{E as Y,a as F}from"./ClIUVBla.js";import{a as Z,E as O}from"./BHHTv4u8.js";import{E as A}from"./CoJKtQsI.js";import{E as H}from"./BCllKHMW.js";import{E as L}from"./CP47LeNR.js";import{f as P,g as ee,r as p,G as N,w as a,o as z,c as oe,D as te,b as o,a as v,t as x,l as I,ez as ae,d as b,B as c,_ as X,eA as le,J as T,i as ne,eB as se,a$ as ue,aX as ie,E as de,ar as re}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{c as j,d as M}from"./ByqilF2g.js";import{a as ce,E as pe}from"./B77-r_qQ.js";import{E as me}from"./Ct1yoKpA.js";import{E as ve}from"./DwL2e8cc.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{d as fe}from"./C-2dxbDp.js";import{v as _e}from"./BrE0JoK1.js";import{E as G}from"./BOUQDXLJ.js";const ge={key:0,class:"coupon-info"},be={class:"info-value"},Ce={class:"tab-content"},ye={class:"tab-content"},Ve={class:"dialog-footer"},Ee=P({__name:"CouponCodeGenerator",props:{modelValue:{type:Boolean},coupon:{}},emits:["update:modelValue","success"],setup(C,{emit:B}){const f=C,E=B,m=ee({get:()=>f.modelValue,set:d=>E("update:modelValue",d)}),u=p("random"),V=p(!1),s=p(50),l=p(""),y=p(1e3),i=()=>{m.value=!1},h=()=>{const d="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let e="";for(let w=0;w<12;w++)e+=d.charAt(Math.floor(Math.random()*d.length));l.value=`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6,9)}-${e.slice(9,12)}`},_=async()=>{if(f.coupon?.id){if(u.value==="universal"&&(!l.value||l.value.length<3)){c.warning("通用码至少需要3个字符");return}V.value=!0;try{const d=await j.coupon.generateCouponCodes(f.coupon.id,u.value==="random"?s.value:1,u.value,u.value==="universal"?l.value:void 0,u.value==="universal"?y.value:void 0);d.success?(c.success(`成功生成 ${d.count} 个兑换码`),E("success"),i(),l.value="",s.value=50):c.error(d.error||"生成失败")}catch(d){c.error("系统异常"),console.error(d)}finally{V.value=!1}}};return(d,e)=>{const w=W,D=F,U=Y,S=Z,t=A,n=H,k=O,$=L;return z(),N($,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=g=>m.value=g),title:"生成兑换码",width:"500px",onClose:i,"append-to-body":""},{footer:a(()=>[v("span",Ve,[o(t,{onClick:i},{default:a(()=>[...e[10]||(e[10]=[b("取消",-1)])]),_:1}),o(t,{type:"primary",loading:V.value,onClick:_},{default:a(()=>[b(x(u.value==="random"?`生成 ${s.value} 个`:"创建通用码"),1)]),_:1},8,["loading"])])]),default:a(()=>[C.coupon?(z(),oe("div",ge,[e[5]||(e[5]=v("div",{class:"info-label"},"当前优惠券：",-1)),v("div",be,x(C.coupon.name),1)])):te("",!0),o(k,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=g=>u.value=g),class:"generator-tabs"},{default:a(()=>[o(S,{label:"批量随机生成",name:"random"},{default:a(()=>[v("div",Ce,[e[6]||(e[6]=v("p",{class:"desc"},"系统将自动生成指定数量的唯一兑换码（如 X7A9-B2C1），每个码仅限使用一次。",-1)),o(U,{"label-position":"top"},{default:a(()=>[o(D,{label:"生成数量"},{default:a(()=>[o(w,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=g=>s.value=g),min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),o(S,{label:"创建通用码",name:"universal"},{default:a(()=>[v("div",ye,[e[9]||(e[9]=v("p",{class:"desc"},"创建一个固定的兑换码（如 VIP888），可多人使用或单人多次使用，直到达到总次数限制。",-1)),o(U,{"label-position":"top"},{default:a(()=>[o(D,{label:"自定义兑换码"},{default:a(()=>[o(n,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=g=>l.value=g),placeholder:"例如：VIP888","show-word-limit":"",maxlength:"20",clearable:""},{prefix:a(()=>[...e[7]||(e[7]=[b("#",-1)])]),append:a(()=>[o(t,{icon:I(ae),onClick:h,title:"随机生成"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),o(D,{label:"最大使用次数"},{default:a(()=>[o(w,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=g=>y.value=g),min:1,max:1e5,style:{width:"100%"}},null,8,["modelValue"]),e[8]||(e[8]=v("div",{class:"form-help"},"限制该码总共可被兑换多少次",-1))]),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),so=X(Ee,[["__scopeId","data-v-b9b2ddbe"]]),we={class:"code-list-container"},$e={class:"toolbar"},xe={class:"toolbar-left"},he={class:"code-text"},ke={class:"pagination-footer"},Be=P({__name:"CouponCodeDrawer",props:{modelValue:{type:Boolean},couponId:{},couponName:{}},emits:["update:modelValue"],setup(C,{emit:B}){const f=C,E=B,m=p(!1),u=p([]),V=p(!1),s=p(0),l=p(1),y=p(20),i=p([]),{copy:h}=le();T(()=>f.modelValue,t=>{m.value=t,t&&f.couponId&&_()}),T(m,t=>{E("update:modelValue",t)});const _=async()=>{if(f.couponId){V.value=!0,i.value=[];try{const t=await M.getCouponCodes(f.couponId,{page:l.value,size:y.value,status:"available"});t.success?(u.value=t.codes,s.value=t.total):c.error(t.error||"加载失败")}catch{c.error("网络异常")}finally{V.value=!1}}},d=t=>{i.value=t.map(n=>n.id)},e=t=>{h(t),c.success("已复制")},w=()=>{const t=u.value.filter(n=>i.value.includes(n.id)).map(n=>n.code).join(`
`);h(t),c.success(`已复制 ${i.value.length} 个兑换码`)},D=async t=>{try{await G.confirm("确定要删除这个兑换码吗？","删除确认",{type:"warning"});const n=await M.deleteCouponCodes([t]);n.success?(c.success("删除成功"),_()):c.error(n.error||"删除失败")}catch{}},U=async()=>{try{await G.confirm(`确定要删除选中的 ${i.value.length} 个兑换码吗？`,"批量删除",{type:"warning"});const t=await M.deleteCouponCodes(i.value);t.success?(c.success(`成功删除 ${t.count} 个兑换码`),_()):c.error(t.error||"删除失败")}catch{}},S=t=>t?fe(t).format("YYYY-MM-DD HH:mm:ss"):"-";return(t,n)=>{const k=A,$=pe,g=de,J=ce,R=me,q=ve,K=_e;return z(),N(q,{modelValue:m.value,"onUpdate:modelValue":n[2]||(n[2]=r=>m.value=r),title:`兑换码列表 - ${C.couponName}`,size:"800px","destroy-on-close":""},{default:a(()=>[v("div",we,[v("div",$e,[v("div",xe,[o(k,{type:"primary",icon:I(se),onClick:w,disabled:i.value.length===0},{default:a(()=>[b(" 批量复制 ("+x(i.value.length)+") ",1)]),_:1},8,["icon","disabled"]),o(k,{type:"danger",icon:I(ue),onClick:U,disabled:i.value.length===0},{default:a(()=>[...n[3]||(n[3]=[b(" 批量删除 ",-1)])]),_:1},8,["icon","disabled"])]),o(k,{icon:I(ie),circle:"",onClick:_},null,8,["icon"])]),ne((z(),N(J,{data:u.value,border:"",stripe:"",height:"calc(100vh - 200px)",onSelectionChange:d},{default:a(()=>[o($,{type:"selection",width:"55"}),o($,{prop:"code",label:"兑换码",width:"200"},{default:a(({row:r})=>[v("div",he,[b(x(r.code)+" ",1),o(g,{class:"copy-icon",onClick:Q=>e(r.code)},{default:a(()=>[o(I(re))]),_:1},8,["onClick"])])]),_:1}),o($,{label:"使用次数",width:"120",align:"center"},{default:a(({row:r})=>[b(x(r.used_count)+" / "+x(r.max_usage),1)]),_:1}),o($,{label:"生成时间",width:"180"},{default:a(({row:r})=>[b(x(S(r.created_at)),1)]),_:1}),o($,{label:"操作",width:"100",align:"center"},{default:a(({row:r})=>[o(k,{type:"danger",size:"small",text:"",onClick:Q=>D(r.id)},{default:a(()=>[...n[4]||(n[4]=[b("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,V.value]]),v("div",ke,[o(R,{"current-page":l.value,"onUpdate:currentPage":n[0]||(n[0]=r=>l.value=r),"page-size":y.value,"onUpdate:pageSize":n[1]||(n[1]=r=>y.value=r),total:s.value,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue","title"])}}}),uo=X(Be,[["__scopeId","data-v-4d3ad756"]]),io=P({__name:"CouponCodeEditor",props:{modelValue:{type:Boolean},coupon:{}},emits:["update:modelValue","saved"],setup(C,{emit:B}){const f=C,E=B,m=p(""),u=p(!1);T(()=>f.coupon,s=>{m.value=s?.code||""},{immediate:!0});const V=async()=>{if(f.coupon){u.value=!0;try{const s=await j.coupon.updateCouponCode(f.coupon.id,m.value);s.success?(c.success("保存成功"),E("update:modelValue",!1),E("saved")):c.error(s.error||"保存失败")}catch{c.error("保存异常")}finally{u.value=!1}}};return(s,l)=>{const y=H,i=F,h=Y,_=A,d=L;return z(),N(d,{"model-value":C.modelValue,"onUpdate:modelValue":l[2]||(l[2]=e=>s.$emit("update:modelValue",e)),title:"编辑优惠券说明",width:"500px","destroy-on-close":""},{footer:a(()=>[o(_,{onClick:l[1]||(l[1]=e=>s.$emit("update:modelValue",!1))},{default:a(()=>[...l[3]||(l[3]=[b("取消",-1)])]),_:1}),o(_,{type:"primary",loading:u.value,onClick:V},{default:a(()=>[...l[4]||(l[4]=[b("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[o(h,{"label-position":"top"},{default:a(()=>[o(i,{label:"优惠券名称"},{default:a(()=>[o(y,{"model-value":C.coupon?.name,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"使用说明"},{default:a(()=>[o(y,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),type:"textarea",rows:4,placeholder:"请输入优惠券使用说明，如：仅限新用户使用、限购1次等"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{so as C,io as _,uo as a};
