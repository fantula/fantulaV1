import{E as H}from"./1SfIsks3.js";import{E as K}from"./-Yx_0iEM.js";import{E as O}from"./DFiWfk7u.js";import{E as P}from"./BTJpnMK3.js";import{f as Q,g as W,r as s,J as X,G as I,w as f,o as l,a as i,c as n,n as C,k as x,t as B,F as D,i as Y,b as c,l as k,ew as Z,af as ee,d as ae,D as A,ag as te,E as oe,B as w,_ as le}from"./o2XBa361.js";import{E as se}from"./C1T5KPmY.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{b as ie,a as ne}from"./XmVVhx5S.js";import{A as ce}from"./DeKxUs28.js";import{v as re}from"./BwD4Hz0h.js";const de={class:"selector-body"},ue={class:"category-sidebar"},me=["onClick"],pe={class:"main-content"},ve={class:"toolbar"},fe={class:"image-grid"},_e=["onClick"],ge={class:"image-name"},ye={key:0,class:"check-mark"},he=Q({__name:"AdminImageSelector",props:{modelValue:{type:Boolean},multiple:{type:Boolean},limit:{}},emits:["update:modelValue","select"],setup(S,{emit:U}){const r=S,_=U,d=W({get:()=>r.modelValue,set:e=>_("update:modelValue",e)}),u=s(!1),m=s(!1),E=s([]),p=s([]),v=s(""),g=s(""),o=s([]),N=async()=>{const e=await ne.getCategories();e.success&&(E.value=e.categories)},y=async()=>{u.value=!0;try{const e=await ie.getImages({category_id:v.value||void 0,keyword:g.value||void 0});e.success&&(p.value=e.images)}finally{u.value=!1}},V=e=>{v.value=e,y()},$=async e=>{m.value=!0;try{const t=e.file;new FormData().append("file",t),w.info("Upload functionality requires specific R2 integration check.")}finally{m.value=!1}},h=e=>o.value.some(t=>t.id===e.id),F=e=>{if(r.multiple)if(h(e))o.value=o.value.filter(t=>t.id!==e.id);else{if(r.limit&&o.value.length>=r.limit){w.warning(`最多选择 ${r.limit} 张图片`);return}o.value.push(e)}else o.value=[e]},q=()=>{if(o.value.length===0){w.warning("请选择图片");return}_("select",o.value.map(e=>e.url)),d.value=!1},z=()=>{o.value=[],_("update:modelValue",!1)};return X(d,e=>{e&&p.value.length===0&&(N(),y())}),(e,t)=>{const b=H,L=K,G=O,J=P,M=oe,R=se,T=re;return l(),I(ce,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=a=>d.value=a),title:"选择图片",width:"900px",class:"image-selector-dialog","show-footer":!0,"confirm-text":"确定选择",onConfirm:q,onClosed:z},{default:f(()=>[i("div",de,[i("div",ue,[i("div",{class:C(["cat-item",{active:!v.value}]),onClick:t[0]||(t[0]=a=>V(""))}," 全部图片 ",2),(l(!0),n(D,null,x(E.value,a=>(l(),n("div",{key:a.id,class:C(["cat-item",{active:v.value===a.id}]),onClick:j=>V(a.id)},B(a.name),11,me))),128))]),i("div",pe,[i("div",ve,[c(b,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),placeholder:"搜索图片名称","prefix-icon":k(Z),clearable:"",style:{width:"200px"},onChange:y},null,8,["modelValue","prefix-icon"]),c(G,{action:"#","show-file-list":!1,"http-request":$,disabled:m.value,multiple:""},{default:f(()=>[c(L,{type:"primary",loading:m.value,icon:k(ee)},{default:f(()=>[...t[3]||(t[3]=[ae("上传图片",-1)])]),_:1},8,["loading","icon"])]),_:1},8,["disabled"])]),Y((l(),n("div",fe,[(l(!0),n(D,null,x(p.value,a=>(l(),n("div",{key:a.id,class:C(["image-item",{selected:h(a)}]),onClick:j=>F(a)},[c(J,{src:a.url,fit:"cover",class:"thumb",loading:"lazy"},null,8,["src"]),i("div",ge,B(a.name),1),h(a)?(l(),n("div",ye,[c(M,null,{default:f(()=>[c(k(te))]),_:1})])):A("",!0)],10,_e))),128)),!u.value&&p.value.length===0?(l(),I(R,{key:0,description:"暂无图片"})):A("",!0)])),[[T,u.value]])])])]),_:1},8,["modelValue"])}}}),$e=le(he,[["__scopeId","data-v-1eb78c59"]]);export{$e as A};
