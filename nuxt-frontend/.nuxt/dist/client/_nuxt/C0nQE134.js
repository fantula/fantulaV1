import{E as L}from"./CoJKtQsI.js";import{E as X,a as W}from"./C7QSzEzh.js";import{E as q}from"./DB7JGTAC.js";import{a as H,E as J}from"./DIhsiPve.js";import{a1 as Q,r as c,g as $,h as Y,C as I,B as S,f as Z,c as h,a as l,i as ee,b as m,D as M,l as o,t as K,w as k,G as N,cz as O,o as p,a2 as te,d as b,F as oe,k as ae,_ as se}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{S as re}from"./jWYXtKgl.js";import{a as U}from"./CoAo9xwI.js";import{a as ie}from"./DCP3zBTZ.js";import{v as ne}from"./BrE0JoK1.js";import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./BB_Ol6Sd.js";import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./Cq9Fpw4b.js";import"./DE5qJ7kT.js";import"./CCDBlmbt.js";import"./OwHC_0Ap.js";import"./BjbJQEzT.js";import"./wVnq5BSo.js";import"./Bh6H2ams.js";import"./BC9Y1jC9.js";import"./CNYNJsmX.js";import"./BTKFVfca.js";import"./aSYcAdI9.js";import"./B_7HZhJl.js";import"./DW0_wk9g.js";import"./uZ_KtR8H.js";import"./CB_o0Cdi.js";import"./BCllKHMW.js";import"./C6m5ANi3.js";import"./BzZM8Et6.js";import"./CXRxotb2.js";import"./PbH8IyH8.js";import"./B77-r_qQ.js";import"./CChPPi86.js";import"./D-7LAYt0.js";import"./aU3tz_xb.js";import"./CCoZ80-G.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./CRKKFZAQ.js";import"./bAK5vGBC.js";import"./DAIghOY5.js";import"./DxNR5PDn.js";import"./CgQ-l74f.js";/* empty css        *//* empty css        *//* empty css        */import"./BV_QTDOQ.js";import"./DcAryAeI.js";import"./CP47LeNR.js";import"./hs4dPNZ2.js";import"./D6FW0B1r.js";/* empty css        *//* empty css        */function le(){const P=Q(),w=I(),_=P.params.id,E=c(!0),y=c(!1),V=c(null),n=c("custom"),r=c(void 0),u=c([]),v=c([]),g=c([]),x=$(()=>`${n.value}-${r.value||"custom"}`),G=$(()=>n.value==="custom"?!0:n.value==="shared"&&!!r.value),B=async()=>{const a=await ie.getSharedSkuGroups();a.success&&(u.value=a.groups||[],n.value==="shared"&&r.value&&C(r.value))},R=async()=>{if(!_){w.back();return}try{const a=await U.getProductWithSkus(_);if(a.success&&a.product){if(V.value=a.product,a.skus&&a.skus.length>0){const e=a.skus[0].tag;e&&a.skus.every(t=>t.tag===e)?(n.value="shared",r.value=e):(n.value="custom",v.value=a.specs?a.specs.map(t=>({name:t.name,values:t.values.map(s=>s.value),inputVisible:!1,inputValue:""})):[],g.value=a.skus.map(t=>({id:t.id,key:Object.values(t.spec_combination||{}).join("::"),specValues:t.spec_combination||{},product_type:t.product_type,price:t.price,duration:t.duration,intro:t.intro,image:t.image,tag:t.tag})))}}else S.error(a.error||"商品加载失败")}catch(a){S.error(a.message||"系统错误")}finally{E.value=!1}},T=a=>{a==="custom"?(r.value=void 0,v.value=[],g.value=[]):(v.value=[],g.value=[])},C=a=>{const e=u.value.find(i=>i.tag===a);if(e){const i=new Map,t=e.skus.map(s=>(Object.entries(s.spec_combination).forEach(([f,D])=>{i.has(f)||i.set(f,new Set),i.get(f).add(D)}),{id:s.id,key:Object.values(s.spec_combination||{}).join("::"),specValues:s.spec_combination,product_type:s.product_type,price:s.price,duration:s.duration,intro:s.intro,image:s.image,tag:s.tag}));v.value=Array.from(i.entries()).map(([s,f])=>({name:s,values:Array.from(f),inputVisible:!1,inputValue:""})),g.value=t}},A=async a=>{let e=[];if(n.value==="custom"){if(!a)return;const i=a.getSkus();if(i.length===0){S.warning("请至少配置一种规格");return}e=i.map((t,s)=>({id:t.id,spec_combination:t.specValues,product_type:t.product_type,price:t.price,duration:t.duration,image:t.image,intro:t.intro,sort_order:s}))}y.value=!0;try{const i=await U.updateProductSkus(_,{mode:n.value,sharedTag:r.value||void 0,skus:e});i.success?(S.success("配置已保存"),w.push("/_mgmt_9Xfa3/products")):S.error(i.error)}finally{y.value=!1}},j=()=>window.open("/_mgmt_9Xfa3/products/shared-sku");return Y(async()=>{await Promise.all([R(),B()])}),{productId:_,loading:E,saving:y,product:V,specMode:n,sharedSkuTag:r,sharedGroups:u,currentSpecs:v,currentSkus:g,editorKey:x,shouldShowEditor:G,handleSpecModeChange:T,handleSharedGroupChange:C,goToSharedManager:j,saveSkus:A}}const ue={class:"sku-manager-page"},de={class:"page-header"},pe={class:"header-left"},ce={key:0,class:"product-info"},me=["src"],_e={class:"product-details"},ve={class:"page-title"},ge={class:"product-id"},fe={class:"header-actions"},he={class:"main-content"},ke={class:"content-card"},ye={class:"spec-editor-header"},Se={class:"spec-mode-switch"},be={key:0,class:"shared-spec-selector"},we={class:"selector-row"},Ee={key:2,class:"empty-tip"},Ve=Z({__name:"[id]",setup(P){const w=I(),_=c(null),{productId:E,loading:y,saving:V,product:n,specMode:r,sharedSkuTag:u,sharedGroups:v,currentSpecs:g,currentSkus:x,editorKey:G,shouldShowEditor:B,handleSpecModeChange:R,handleSharedGroupChange:T,goToSharedManager:C,saveSkus:A}=le(),j=()=>A(_.value);return(a,e)=>{const i=L,t=W,s=X,f=q,D=J,z=H,F=ne;return p(),h("div",ue,[l("div",de,[l("div",pe,[m(i,{onClick:e[0]||(e[0]=d=>o(w).back()),icon:o(te),circle:"",class:"back-btn"},null,8,["icon"]),o(n)?(p(),h("div",ce,[o(n).image?(p(),h("img",{key:0,src:o(n).image,class:"product-thumb"},null,8,me)):M("",!0),l("div",_e,[l("h1",ve,"规格管理: "+K(o(n).product_name),1),l("span",ge,"ID: "+K(o(n).id),1)])])):M("",!0)]),l("div",fe,[m(i,{type:"primary",size:"large",onClick:j,loading:o(V)},{default:k(()=>[...e[3]||(e[3]=[b("保存配置",-1)])]),_:1},8,["loading"])])]),ee((p(),h("div",he,[l("div",ke,[l("div",ye,[e[6]||(e[6]=l("div",{class:"panel-title"},"配置模式",-1)),l("div",Se,[m(s,{modelValue:o(r),"onUpdate:modelValue":e[1]||(e[1]=d=>O(r)?r.value=d:null),onChange:o(R)},{default:k(()=>[m(t,{label:"custom"},{default:k(()=>[...e[4]||(e[4]=[b("自定义规格",-1)])]),_:1}),m(t,{label:"shared"},{default:k(()=>[...e[5]||(e[5]=[b("引用共享规格",-1)])]),_:1})]),_:1},8,["modelValue","onChange"])])]),o(r)==="shared"?(p(),h("div",be,[m(f,{type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}},{title:k(()=>[...e[7]||(e[7]=[b("引用共享规格组后，此商品的 SKU 将自动与该组保持同步。如需修改，请前往“共享规格库”。",-1)])]),_:1}),l("div",we,[e[9]||(e[9]=l("span",{class:"label"},"选择规格组:",-1)),m(z,{modelValue:o(u),"onUpdate:modelValue":e[2]||(e[2]=d=>O(u)?u.value=d:null),placeholder:"请选择共享规格组",style:{width:"300px"},onChange:o(T)},{default:k(()=>[(p(!0),h(oe,null,ae(o(v),d=>(p(),N(D,{key:d.tag,label:`#${d.tag} (${d.skus.length} SKU)`,value:d.tag},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),m(i,{type:"primary",link:"",onClick:o(C),style:{"margin-left":"10px"}},{default:k(()=>[...e[8]||(e[8]=[b("管理共享库",-1)])]),_:1},8,["onClick"])])])):M("",!0),o(B)?(p(),N(re,{ref_key:"skuEditorRef",ref:_,key:o(G),mode:o(r)==="shared"?"linked":"standalone","read-only":o(r)==="shared","initial-specs":o(g),"initial-skus":o(x),"product-id":o(E),tag:o(r)==="shared"?o(u):void 0},null,8,["mode","read-only","initial-specs","initial-skus","product-id","tag"])):o(r)==="shared"&&!o(u)?(p(),h("div",Ee," 请选择一个共享规格组预览 ")):M("",!0)])])),[[F,o(y)]])])}}}),Ot=se(Ve,[["__scopeId","data-v-d96cd549"]]);export{Ot as default};
