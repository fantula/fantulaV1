import{dM as a}from"./o2XBa361.js";const i={async getDepartments(){const e=a(),{data:s,error:t}=await e.from("admin_departments").select("*").order("created_at",{ascending:!0});return t?{success:!1,departments:[],error:t.message}:{success:!0,departments:await Promise.all((s||[]).map(async n=>{const{count:c}=await e.from("admin_users").select("*",{count:"exact",head:!0}).eq("department_id",n.id);return{...n,user_count:c||0}}))}},async createDepartment(e){const s=a(),{data:t,error:r}=await s.from("admin_departments").insert({name:e.name,permissions:e.permissions??[]}).select().single();return r?{success:!1,error:r.message}:{success:!0,department:t}},async updateDepartment(e,s){const t=a(),{error:r}=await t.from("admin_departments").update(s).eq("id",e);return r?{success:!1,error:r.message}:{success:!0}},async deleteDepartment(e){const s=a(),{count:t}=await s.from("admin_users").select("*",{count:"exact",head:!0}).eq("department_id",e);if(t&&t>0)return{success:!1,error:`该部门下有 ${t} 个用户，请先移除或重新分配`};const{error:r}=await s.from("admin_departments").delete().eq("id",e);return r?{success:!1,error:r.message}:{success:!0}}};export{i as a};
