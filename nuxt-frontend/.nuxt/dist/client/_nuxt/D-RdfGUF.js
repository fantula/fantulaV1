import{E as j}from"./DrogL690.js";import{E as z,a as A}from"./A8Zj-15Y.js";import{E as G,a as H}from"./DILJPjji.js";import{E as J}from"./B94kvl1B.js";import{E as P}from"./Di9v79cN.js";import{E as T}from"./CzVV9LeR.js";import{E as K}from"./DR2PtzNo.js";import{a as L}from"./DtgOm6Sf.js";import{E as O}from"./CjhxNRX1.js";import{f as W,r as y,a1 as X,g as Z,am as tt,J as et,h as ot,c as Y,b as o,a,l as C,w as s,B as p,C as at,o as v,d as D,D as E,G as st,t as c,_ as lt}from"./gYbOYKrZ.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./CswOF4xx.js";/* empty css        *//* empty css        *//* empty css        */import{d as i}from"./C-2dxbDp.js";import{S as rt}from"./CFKNQiB6.js";import{c as V}from"./9gheNwfe.js";import"./BdJc3h2o.js";import"./C3yI_83l.js";import"./BB_Ol6Sd.js";import"./BNtqh2Az.js";import"./D4AXxtJy.js";import"./Dnj8X3EN.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./C5EOtA6j.js";import"./pxhmPWjv.js";import"./MkrgA_tt.js";import"./gVImYNNu.js";import"./92s3wAHG.js";import"./CaswxL1d.js";import"./BlcygIWm.js";import"./CUkNyi1D.js";import"./BSx1rCp4.js";import"./BPYHQo7_.js";import"./Cr8dt13I.js";import"./YvAJPawC.js";import"./-tO7MSA0.js";import"./DMMqLNeM.js";import"./C6CbiQn9.js";import"./B9zwl8KS.js";const nt={class:"coupon-post-page"},it={class:"form-content"},mt={class:"date-picker-wrapper"},dt={key:0,class:"date-text"},ut={class:"value"},pt={key:0,class:"form-tip"},ct={class:"preview-container"},ft={class:"coupon-ticket flat-ticket"},_t={class:"ticket-left"},vt={class:"ticket-amount"},Dt={class:"ticket-cond"},bt={class:"ticket-right"},gt={class:"ticket-name"},kt={class:"ticket-date"},yt=W({__name:"post",setup(Yt){const B=X(),b=at(),g=y(),k=y(!1),f=B.query.id,d=Z(()=>!!f),n=y(!1),e=tt({name:"",value:0,minUsage:0,startDate:i().format("YYYY-MM-DD"),endDate:"",totalQuantity:1e3,status:!0}),N={name:[{required:!0,message:"请输入名称",trigger:"blur"}],value:[{required:!0,message:"请输入减免金额",trigger:"blur"}]},w=l=>i(l).format("YYYY-MM-DD"),S=l=>i(l).isBefore(i(),"day");et(n,l=>{l&&(e.endDate="")});const q=async()=>{if(!f)return;const l=await V.coupon.getCouponById(f);if(l.success&&l.coupon){const t=l.coupon;e.name=t.name,e.value=Number(t.value),e.minUsage=Number(t.min_usage),e.status=t.status,e.startDate=t.start_date?i(t.start_date).format("YYYY-MM-DD"):i().format("YYYY-MM-DD"),e.totalQuantity=t.total_quantity||1e3,t.end_date?(n.value=!1,e.endDate=i(t.end_date).format("YYYY-MM-DD")):(n.value=!0,e.endDate="")}else p.error(l.error||"获取详情失败")},I=async()=>{g.value&&await g.value.validate(async l=>{if(l){if(!n.value&&!e.endDate){p.warning("请选择结束日期");return}k.value=!0;try{const t={name:e.name,type:"flat",value:e.value,product_ids:[],min_usage:e.minUsage,total_quantity:0,start_date:n.value?null:e.startDate,end_date:n.value?null:e.endDate,status:e.status};let m;d.value?m=await V.coupon.updateCoupon(f,t):m=await V.coupon.createCoupon(t),m.success?(p.success(d.value?"更新成功":"创建成功"),b.back()):p.error(m.error||"保存失败")}catch{p.error("保存异常")}finally{k.value=!1}}})};return ot(()=>{q()}),(l,t)=>{const m=j,u=A,_=H,x=G,M=J,R=P,h=T,$=K,F=L,U=O,Q=z;return v(),Y("div",nt,[o(rt,{title:d.value?"编辑立减券":"新增立减券","sub-title":d.value?"修改立减券信息":"创建一个新的满减优惠券","submit-text":d.value?"保存":"新增",loading:k.value,onSubmit:I,onCancel:t[0]||(t[0]=r=>C(b).back()),onBack:t[1]||(t[1]=r=>C(b).back())},null,8,["title","sub-title","submit-text","loading"]),a("div",it,[o(Q,{ref_key:"formRef",ref:g,model:e,rules:N,"label-width":"120px","label-position":"top",size:"large"},{default:s(()=>[o(U,{shadow:"never",class:"form-card"},{header:s(()=>[...t[8]||(t[8]=[a("div",{class:"card-header"},[a("span",null,"基础信息")],-1)])]),default:s(()=>[o(x,{gutter:24},{default:s(()=>[o(_,{span:12},{default:s(()=>[o(u,{label:"优惠券名称",prop:"name"},{default:s(()=>[o(m,{modelValue:e.name,"onUpdate:modelValue":t[2]||(t[2]=r=>e.name=r),placeholder:"例如：满100减10促销"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(x,{gutter:24},{default:s(()=>[o(_,{span:8},{default:s(()=>[o(u,{label:"减免金额",prop:"value"},{default:s(()=>[o(M,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=r=>e.value=r),min:.01,precision:2,"controls-position":"right",style:{width:"100%"}},{prefix:s(()=>[...t[9]||(t[9]=[D("¥",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(_,{span:8},{default:s(()=>[o(u,{label:"最低使用金额",prop:"minUsage"},{default:s(()=>[o(M,{modelValue:e.minUsage,"onUpdate:modelValue":t[4]||(t[4]=r=>e.minUsage=r),min:0,precision:2,"controls-position":"right",style:{width:"100%"}},{prefix:s(()=>[...t[10]||(t[10]=[D("¥",-1)])]),_:1},8,["modelValue"]),t[11]||(t[11]=a("div",{class:"form-tip"},"订单满多少元可用（0表示无门槛）",-1))]),_:1})]),_:1}),o(_,{span:8},{default:s(()=>[o(u,{label:"状态",prop:"status"},{default:s(()=>[o(R,{modelValue:e.status,"onUpdate:modelValue":t[5]||(t[5]=r=>e.status=r),"active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(h,{"content-position":"left"},{default:s(()=>[...t[12]||(t[12]=[D("发放规则",-1)])]),_:1}),o(u,{label:"有效期"},{default:s(()=>[a("div",mt,[n.value?E("",!0):(v(),Y("div",dt,[t[13]||(t[13]=a("span",{class:"label"},"开始：",-1)),a("span",ut,c(w(e.startDate)),1)])),n.value?E("",!0):(v(),st($,{key:1,modelValue:e.endDate,"onUpdate:modelValue":t[6]||(t[6]=r=>e.endDate=r),type:"date",placeholder:"选择结束日期","value-format":"YYYY-MM-DD",style:{flex:"1",margin:"0 12px"},"disabled-date":S},null,8,["modelValue"])),o(F,{modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=r=>n.value=r),label:"永久有效",border:""},null,8,["modelValue"])]),n.value?E("",!0):(v(),Y("div",pt,"默认从今日开始生效，请选择截止日期"))]),_:1})]),_:1}),o(U,{shadow:"never",class:"form-card",style:{"margin-top":"24px"}},{header:s(()=>[...t[14]||(t[14]=[a("div",{class:"card-header"},[a("span",null,"效果预览")],-1)])]),default:s(()=>[a("div",ct,[a("div",ft,[a("div",_t,[a("div",vt,[t[15]||(t[15]=a("small",null,"¥",-1)),D(c(e.value||"0"),1)]),a("div",Dt,"满 "+c(e.minUsage)+" 可用",1)]),a("div",bt,[a("div",gt,c(e.name||"优惠券名称"),1),a("div",kt,c(n.value?"永久有效":`${w(e.startDate)} 至 ${e.endDate||"?"}`),1),t[16]||(t[16]=a("div",{class:"ticket-btn"},"立即领取",-1))])])])]),_:1})]),_:1},8,["model"])])])}}}),be=lt(yt,[["__scopeId","data-v-2ae7ba5d"]]);export{be as default};
