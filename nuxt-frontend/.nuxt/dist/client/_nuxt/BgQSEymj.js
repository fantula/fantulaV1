import{a as ee,E as te}from"./CrjkcmUY.js";import{E as ae}from"./1SfIsks3.js";import{E as oe}from"./-Yx_0iEM.js";import{E as le}from"./Ci1VNkC9.js";import{E as ne}from"./BTJpnMK3.js";import{E as se}from"./DC3lfPj1.js";import{E as ie}from"./C8ZH7i_a.js";import{f as X,c as C,a as g,D as I,t as c,n as T,F as R,k as j,o as m,_ as G,r as V,am as re,h as de,B as f,b as o,l as a,w as n,b0 as ue,cC as N,C as ce,a_ as me,d as u,p as pe,j as fe,ew as ge,G as F}from"./o2XBa361.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{A as ye}from"./DHlfceZi.js";import{A as _e}from"./BrR7l0bw.js";import{B as ve}from"./HhRrCsya.js";/* empty css        *//* empty css        */import{a as B}from"./BC24M6Nq.js";import{a as he}from"./Di05QSSe.js";import{E as M}from"./BfOrkIVm.js";import"./qVmxJdp3.js";import"./CqX7ZdKI.js";import"./Dlk0BVst.js";import"./DtTI1xRr.js";import"./Bh6H2ams.js";import"./t2w4jifC.js";import"./Dnj8X3EN.js";import"./ClnTspdU.js";import"./Cq9Fpw4b.js";import"./B8yeDp5P.js";import"./B_FoF6yT.js";import"./BlW_46uR.js";import"./Ds34GQx2.js";import"./Dzr5IOAO.js";import"./Culj45X8.js";import"./BB_Ol6Sd.js";import"./Z6faUBN3.js";import"./KSqZSeJ0.js";import"./CQuNCUIC.js";import"./DVQwC1Y0.js";import"./C9zJf5rn.js";import"./Bx0EXMjc.js";import"./hXKBSGVD.js";import"./BCItYl8Z.js";import"./CleHDoLI.js";import"./DwwA_QlG.js";import"./DytS51kl.js";/* empty css        */import"./C1T5KPmY.js";import"./BOgRz4Th.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./BwD4Hz0h.js";import"./Bdid5VjX.js";import"./XmVVhx5S.js";import"./CM1YTunQ.js";import"./FKUjHIpz.js";const Ce={class:"category-pills-scroll"},ke={key:0,class:"count"},be=["onClick"],Ve={key:0,class:"count"},xe=X({__name:"CategoryPills",props:{modelValue:{},items:{},labelKey:{default:"name"},valueKey:{default:"id"},countKey:{default:"count"},allLabel:{default:"全部"},totalCount:{},showTotalCount:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(s){return(r,k)=>(m(),C("div",Ce,[g("div",{class:T(["pill-item",{active:s.modelValue===""}]),onClick:k[0]||(k[0]=i=>r.$emit("update:modelValue",""))},[g("span",null,c(s.allLabel),1),s.showTotalCount?(m(),C("span",ke,c(s.totalCount),1)):I("",!0)],2),(m(!0),C(R,null,j(s.items,i=>(m(),C("div",{key:i[s.valueKey],class:T(["pill-item",{active:s.modelValue===i[s.valueKey]}]),onClick:x=>r.$emit("update:modelValue",i[s.valueKey])},[g("span",null,c(i[s.labelKey]),1),i[s.countKey]?(m(),C("span",Ve,c(i[s.countKey]),1)):I("",!0)],10,be))),128))]))}}),Ee=G(xe,[["__scopeId","data-v-34a4f06b"]]);function $e(){const s=V(!1),r=V([]),k=V(0),i=V(1),x=V(20),E=V([]),d=V([]),b=re({category_id:"",status:"",keyword:""}),y=async()=>{const t=await he.getCategories();t.success&&(E.value=t.categories||[])},_=async()=>{s.value=!0,d.value=[];try{const t=await B.getProducts({page:i.value,page_size:x.value,category_id:b.category_id||void 0,status:b.status||void 0,keyword:b.keyword||void 0});t.success?(r.value=t.products,k.value=t.total):f.error(t.error||"加载失败")}catch(t){f.error(t.message||"系统错误")}finally{s.value=!1}},$=()=>{i.value=1,_()},D=t=>{b.category_id=t,$()},z=async t=>{t.statusLoading=!0;try{const p=await B.toggleStatus(t.id,t.status);p.success?f.success(t.status==="on"?"上架成功":"下架成功"):(t.status=t.status==="on"?"off":"on",f.error(p.error))}catch{t.status=t.status==="on"?"off":"on",f.error("操作失败")}finally{t.statusLoading=!1}},K=t=>{M.confirm(`确认删除 "${t.product_name}" 吗?`,"警告",{type:"warning"}).then(async()=>{const p=await B.deleteProducts([t.id]);p.success?(f.success("删除成功"),_()):f.error(p.error)})},P=()=>{d.value.length&&M.confirm(`确认批量删除 ${d.value.length} 项? 此操作不可撤销。`,"高风险警告",{type:"error"}).then(async()=>{const t=await B.deleteProducts(d.value);t.success?(f.success("批量删除成功"),_()):f.error(t.error)})},A=t=>{d.value=t.map(p=>p.id)};return de(()=>{y(),_()}),{loading:s,list:r,total:k,currentPage:i,pageSize:x,categories:E,filters:b,selectedIds:d,loadList:_,selectCategory:D,handleFilterChange:$,handleStatusChange:z,handleDelete:K,handleBulkDelete:P,handleSelectionChange:A}}const Se={class:"product-list-page"},we={class:"product-cell"},ze={class:"info"},Be=["title"],De={class:"id"},Ke={key:1,class:"text-secondary"},Pe={style:{display:"flex","flex-wrap":"wrap",gap:"4px"}},Ae=X({__name:"index",setup(s){const r=ce(),{loading:k,list:i,total:x,currentPage:E,pageSize:d,categories:b,filters:y,selectedIds:_,loadList:$,selectCategory:D,handleFilterChange:z,handleStatusChange:K,handleDelete:P,handleBulkDelete:A,handleSelectionChange:t}=$e(),p=()=>r.push("/_mgmt_9Xfa3/products/post"),O=S=>r.push(`/_mgmt_9Xfa3/products/post?id=${S.id}`),q=S=>r.push(`/_mgmt_9Xfa3/products/sku/${S.id}`),H=S=>r.push(`/_mgmt_9Xfa3/products/post?copy_from_id=${S.id}`);return(S,l)=>{const U=te,J=ee,Q=ae,w=oe,v=le,W=ne,L=se,Y=ie;return m(),C("div",Se,[o(Ee,{modelValue:a(y).category_id,"onUpdate:modelValue":[l[0]||(l[0]=e=>a(y).category_id=e),a(D)],items:a(b),"label-key":"name","value-key":"id","count-key":"product_count","total-count":a(x)},null,8,["modelValue","items","total-count","onUpdate:modelValue"]),o(ye,null,{default:n(()=>[o(J,{modelValue:a(y).status,"onUpdate:modelValue":l[1]||(l[1]=e=>a(y).status=e),placeholder:"状态: 全部",clearable:"",style:{width:"120px"},onChange:a(z)},{default:n(()=>[o(U,{label:"上架",value:"on"}),o(U,{label:"下架",value:"off"})]),_:1},8,["modelValue","onChange"]),o(Q,{modelValue:a(y).keyword,"onUpdate:modelValue":l[2]||(l[2]=e=>a(y).keyword=e),placeholder:"搜索商品名称 (回车)",clearable:"",style:{width:"200px"},"prefix-icon":a(ge),onKeyup:fe(a(z),["enter"]),onClear:a(z)},null,8,["modelValue","prefix-icon","onKeyup","onClear"])]),actions:n(()=>[o(w,{onClick:a($),icon:a(me)},{default:n(()=>[...l[5]||(l[5]=[u("刷新",-1)])]),_:1},8,["onClick","icon"]),o(w,{type:"primary",onClick:p,icon:a(pe)},{default:n(()=>[...l[6]||(l[6]=[u("添加商品",-1)])]),_:1},8,["icon"])]),_:1}),o(_e,{data:a(i),loading:a(k),total:a(x),"current-page":a(E),"onUpdate:currentPage":[l[3]||(l[3]=e=>N(E)?E.value=e:null),a($)],"page-size":a(d),"onUpdate:pageSize":[l[4]||(l[4]=e=>N(d)?d.value=e:null),a($)],onSelectionChange:a(t)},ue({default:n(()=>[o(v,{type:"selection",width:"50",align:"center"}),o(v,{label:"商品信息","min-width":"250"},{default:n(({row:e})=>[g("div",we,[o(W,{src:e.image,class:"thumb",fit:"cover"},{error:n(()=>[...l[7]||(l[7]=[g("div",{class:"no-img"},"无图",-1)])]),_:1},8,["src"]),g("div",ze,[g("div",{class:"name",title:e.product_name},c(e.product_name),9,Be),g("div",De,"ID: "+c(e.id.slice(0,8))+"...",1)])])]),_:1}),o(v,{label:"角标",width:"100",align:"center"},{default:n(({row:e})=>[e.badge_label?(m(),F(L,{key:0,type:"warning",effect:"plain",size:"small"},{default:n(()=>[u(c(e.badge_label),1)]),_:2},1024)):(m(),C("span",Ke,"-"))]),_:1}),o(v,{label:"排序",width:"80",align:"center",prop:"sort_order",sortable:""}),o(v,{label:"包含规格","min-width":"200"},{default:n(({row:e})=>[g("div",Pe,[o(L,{type:"info",effect:"dark",size:"small",style:{"margin-right":"4px"}},{default:n(()=>[u(c(e.sku_count||0)+"个",1)]),_:2},1024),(m(!0),C(R,null,j(e.sku_details,(h,Z)=>(m(),F(L,{key:Z,size:"small",type:"info",effect:"plain"},{default:n(()=>[u(c(h),1)]),_:2},1024))),128))])]),_:1}),o(v,{label:"状态",width:"100",align:"center"},{default:n(({row:e})=>[o(Y,{modelValue:e.status,"onUpdate:modelValue":h=>e.status=h,"active-value":"on","inactive-value":"off",loading:e.statusLoading,onChange:h=>a(K)(e),"inline-prompt":"","active-text":"上架","inactive-text":"下架"},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),o(v,{label:"创建时间",width:"160",align:"center"},{default:n(({row:e})=>[u(c(new Date(e.created_at).toLocaleString("zh-CN",{fontSize:"12px"})),1)]),_:1}),o(v,{label:"操作",width:"220",fixed:"right",align:"center"},{default:n(({row:e})=>[o(w,{link:"",type:"primary",onClick:h=>O(e)},{default:n(()=>[...l[8]||(l[8]=[u("编辑",-1)])]),_:1},8,["onClick"]),o(w,{link:"",type:"success",onClick:h=>H(e)},{default:n(()=>[...l[9]||(l[9]=[u("同款",-1)])]),_:1},8,["onClick"]),o(w,{link:"",type:"warning",onClick:h=>q(e)},{default:n(()=>[...l[10]||(l[10]=[u("规格",-1)])]),_:1},8,["onClick"]),o(w,{link:"",type:"danger",onClick:h=>a(P)(e)},{default:n(()=>[...l[11]||(l[11]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:2},[a(_).length>0?{name:"toolbar",fn:n(()=>[o(ve,{count:a(_).length,onDelete:a(A)},null,8,["count","onDelete"])]),key:"0"}:void 0]),1032,["data","loading","total","current-page","page-size","onUpdate:currentPage","onUpdate:pageSize","onSelectionChange"])])}}}),Gt=G(Ae,[["__scopeId","data-v-df4b1a1f"]]);export{Gt as default};
