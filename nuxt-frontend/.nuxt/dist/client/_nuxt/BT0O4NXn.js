const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./gYbOYKrZ.js","./entry.DI7xQWfr.css"])))=>i.map(i=>d[i]);
import{ax as m,fc as g,fd as l}from"./gYbOYKrZ.js";async function T(o,p="uploads",c){try{if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(o.type))return{success:!1,error:"只支持 JPG、PNG、GIF、WebP 格式的图片"};const d=10*1024*1024;if(o.size>d)return{success:!1,error:"图片大小不能超过 10MB"};let t=null;try{const{getAdminAuthToken:r}=await m(async()=>{const{getAdminAuthToken:e}=await import("./gYbOYKrZ.js").then(s=>s.fe);return{getAdminAuthToken:e}},__vite__mapDeps([0,1]),import.meta.url);t=await r()}catch(r){console.warn("Failed to load admin token logic",r)}if(t||(t=await g()),!t)return{success:!1,error:"请先登录后台管理员账号"};const a=new FormData;if(a.append("file",o),a.append("folder",p),c)return new Promise(r=>{const e=new XMLHttpRequest;e.upload.onprogress=s=>{if(s.lengthComputable){const f=Math.round(s.loaded/s.total*100);c(f)}},e.onload=()=>{try{const s=JSON.parse(e.responseText);e.status>=200&&e.status<300?r({success:!0,url:s.url}):r({success:!1,error:s.error||`上传失败 (HTTP ${e.status})`})}catch{r({success:!1,error:"解析响应失败"})}},e.onerror=()=>{r({success:!1,error:"网络错误"})},e.open("POST",`${l}/upload-r2`),e.setRequestHeader("Authorization",`Bearer ${t}`),e.send(a)});const u=await fetch(`${l}/upload-r2`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:a}),i=await u.json();return u.ok?{success:!0,url:i.url}:{success:!1,error:i.error||`上传失败 (HTTP ${u.status})`}}catch(n){return console.error("Upload exception:",n),{success:!1,error:n.message||"上传失败"}}}export{T as uploadImageToStorage};
