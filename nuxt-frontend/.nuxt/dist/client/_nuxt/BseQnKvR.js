import{P as O}from"./BSp69RIM.js";import{E as U}from"./CoJKtQsI.js";import{A as G}from"./Jf5bIUYa.js";import{E as H}from"./BTKFVfca.js";import{E as J}from"./CgQ-l74f.js";import{E as L}from"./BCllKHMW.js";import{E as R,a as j}from"./ClIUVBla.js";import{E as q,a as X}from"./D-7LAYt0.js";import{E as $}from"./CZLDLz6s.js";import{f as K,r as d,h as Q,c as i,b as t,w as n,B as l,o as r,l as E,aX as W,d as p,p as Y,a as m,D as Z,F as b,k as h,n as ee,t as k,G as te,_ as se}from"./CEI0siaN.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{a as _}from"./ArlG8wtU.js";import{g as oe}from"./CmG9FMVi.js";import"./DB7JGTAC.js";import"./OwHC_0Ap.js";/* empty css        */import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./PbH8IyH8.js";/* empty css        */import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./BB_Ol6Sd.js";import"./C6m5ANi3.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./DW0_wk9g.js";import"./CCDBlmbt.js";import"./DE5qJ7kT.js";const ae={class:"page-container"},ne={class:"dept-manager"},re={class:"dept-list-pane"},ie={class:"dept-list"},le=["onClick"],me={class:"dept-name"},pe={key:0,class:"empty-list"},ce={class:"dept-config-pane"},de={key:0,class:"config-form"},ue={key:1,class:"empty-selection"},_e=K({name:"UserDepartments",__name:"index",setup(fe){const w=oe(),f=d([]),v=d(""),s=d(null),x=d(),g=d(!1),c=async()=>{try{const e=await _.getDepartments();e.success&&(f.value=e.departments)}catch(e){l.error(e.message||"加载部门失败")}},C=e=>{v.value=e.id,s.value=JSON.parse(JSON.stringify(e))},V=async()=>{const e=await _.createDepartment({name:"新部门",permissions:[]});e.success&&e.department?(await c(),C(e.department),l.success("部门已创建")):l.error(e.error||"创建失败")},A=async()=>{if(!s.value)return;const e=await _.deleteDepartment(s.value.id);e.success?(l.success("部门已删除"),v.value="",s.value=null,await c()):l.error(e.error||"删除失败")},B=async()=>{if(s.value){g.value=!0;try{const e=await _.updateDepartment(s.value.id,{name:s.value.name,permissions:s.value.permissions});e.success?(l.success("部门配置已保存"),await c()):l.error(e.error||"保存失败")}finally{g.value=!1}}};return Q(async()=>{await c()}),(e,o)=>{const F=O,u=U,N=G,I=H,D=J,T=L,y=j,z=X,P=q,S=R,M=$;return r(),i("div",ae,[t(F,{title:"部门管理",description:"创建和管理后台部门，配置可访问的页面权限"}),t(N,null,{actions:n(()=>[t(u,{icon:E(W),onClick:c},{default:n(()=>[...o[2]||(o[2]=[p("刷新",-1)])]),_:1},8,["icon"]),t(u,{type:"primary",icon:E(Y),onClick:V},{default:n(()=>[...o[3]||(o[3]=[p("新增部门",-1)])]),_:1},8,["icon"])]),_:1}),t(M,{shadow:"never",class:"dept-manager-card"},{default:n(()=>[m("div",ne,[m("div",re,[o[4]||(o[4]=m("div",{class:"pane-header"},[m("span",null,"部门列表")],-1)),m("div",ie,[(r(!0),i(b,null,h(f.value,a=>(r(),i("div",{key:a.id,class:ee(["dept-item",{active:v.value===a.id}]),onClick:ve=>C(a)},[m("span",me,k(a.name),1),t(I,{size:"small",effect:"plain"},{default:n(()=>[p(k(a.user_count||0)+" 人",1)]),_:2},1024)],10,le))),128)),f.value.length===0?(r(),i("div",pe,[t(D,{description:"暂无部门","image-size":60})])):Z("",!0)])]),m("div",ce,[s.value?(r(),i("div",de,[t(S,{"label-position":"top",model:s.value,ref_key:"deptFormRef",ref:x},{default:n(()=>[t(y,{label:"部门名称",prop:"name",rules:[{required:!0,message:"请输入部门名称",trigger:"blur"}]},{default:n(()=>[t(T,{modelValue:s.value.name,"onUpdate:modelValue":o[0]||(o[0]=a=>s.value.name=a)},null,8,["modelValue"])]),_:1}),t(y,{label:"权限配置 (勾选允许访问的后台页面)"},{default:n(()=>[t(P,{modelValue:s.value.permissions,"onUpdate:modelValue":o[1]||(o[1]=a=>s.value.permissions=a),class:"perm-list"},{default:n(()=>[(r(!0),i(b,null,h(E(w),a=>(r(),te(z,{key:a.path,value:a.path},{default:n(()=>[p(k(a.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:n(()=>[t(u,{type:"primary",onClick:B,loading:g.value},{default:n(()=>[...o[5]||(o[5]=[p("保存配置",-1)])]),_:1},8,["loading"]),t(u,{type:"danger",plain:"",onClick:A,disabled:(s.value.user_count||0)>0},{default:n(()=>[...o[6]||(o[6]=[p(" 删除部门 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])):(r(),i("div",ue,[t(D,{description:"请选择左侧部门进行配置","image-size":80})]))])])]),_:1})])}}}),We=se(_e,[["__scopeId","data-v-271de961"]]);export{We as default};
