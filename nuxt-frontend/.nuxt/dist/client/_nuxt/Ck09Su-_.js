import{E as Y}from"./1SfIsks3.js";import{E as Z,a as ee}from"./0BTaD5f-.js";import{a as te,E as le}from"./CrjkcmUY.js";import{E as oe,a as ae}from"./C-z4Dfo0.js";import{E as ie}from"./Cq9RPQ5L.js";import{E as se}from"./C8ZH7i_a.js";import{E as re}from"./BTJpnMK3.js";import{r as C,g as de,am as ne,h as ue,a1 as me,C as pe,B as I,f as ce,c as _,b as e,a as m,l as t,w as l,cC as ge,o as g,F as z,k as G,G as A,D as H,E as _e,bM as fe,d as B,t as be,ei as ye,aT as ve,b2 as ke,b1 as K,V as Ve,_ as we}from"./o2XBa361.js";import{E as Ee}from"./CFoaU_UR.js";import{E as Se}from"./Bb48cPEN.js";import{a as Ce}from"./BCItYl8Z.js";import{E as Ie}from"./-Yx_0iEM.js";import{E as Me}from"./DC3lfPj1.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{A as Pe}from"./Tzes-zbc.js";import{S as Ue}from"./D70lOtiA.js";import{T as he}from"./CUFVETmy.js";import{a as xe}from"./Di05QSSe.js";import{a as D}from"./BC24M6Nq.js";import"./CqX7ZdKI.js";import"./Dlk0BVst.js";import"./BB_Ol6Sd.js";import"./DVQwC1Y0.js";import"./Culj45X8.js";import"./Dnj8X3EN.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./BlW_46uR.js";import"./C9zJf5rn.js";import"./qVmxJdp3.js";import"./DtTI1xRr.js";import"./t2w4jifC.js";import"./ClnTspdU.js";import"./B8yeDp5P.js";import"./B_FoF6yT.js";import"./Ds34GQx2.js";import"./Dzr5IOAO.js";import"./Z6faUBN3.js";import"./KSqZSeJ0.js";import"./CQuNCUIC.js";import"./BHSqheQV.js";import"./DwwA_QlG.js";import"./CleHDoLI.js";import"./hXKBSGVD.js";import"./Bx0EXMjc.js";import"./DFiWfk7u.js";import"./C1T5KPmY.js";/* empty css        *//* empty css        *//* empty css        */import"./XmVVhx5S.js";import"./DeKxUs28.js";import"./CziALilw.js";import"./FKUjHIpz.js";import"./D6FW0B1r.js";/* empty css        *//* empty css        */import"./BwD4Hz0h.js";import"./Bdid5VjX.js";import"./CM1YTunQ.js";function Ae(){const N=pe(),b=me(),s=C(),q=de(()=>!!b.query.id),k=C(!1),V=C([]),M=C(!1),f=C("image"),a=ne({id:"",name:"",categoryId:void 0,image:"",sortOrder:0,displayPrice:0,tags:[],initialSales:0,badgeLabel:void 0,rating:100,allowAddon:!1,addonUnit:"",status:!0,detailModules:[],copySkus:[]}),P={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],categoryId:[{required:!0,message:"请选择分类",trigger:"change"}],image:[{required:!0,message:"请上传商品头图",trigger:"change"}]},R=async()=>{const r=await xe.getCategories();r.success&&(V.value=r.categories||[])},U=async(r,u)=>{const d=await D.getProductWithSkus(r);if(d.success&&d.product){const n=d.product;u||(a.id=n.id),a.name=u?`${n.product_name} (副本)`:n.product_name,a.categoryId=n.category_id||void 0,a.image=n.image||"",a.sortOrder=n.sort_order,a.displayPrice=n.display_price,a.tags=n.tags||[],a.initialSales=n.initial_sales,a.badgeLabel=n.badge_label||void 0,a.rating=n.rating,a.allowAddon=n.allow_addon,a.detailModules=n.detail_modules||[],a.status=u?!1:n.status==="on",u&&d.skus&&d.skus.length>0&&(a.copySkus=d.skus.map(c=>({spec_combination:c.spec_combination,product_type:c.product_type,price:c.price,duration:c.duration,image:c.image,intro:c.intro,sort_order:c.sort_order||0,tag:c.tag})))}else I.error(d.error||"商品加载失败")},T=async()=>{s.value&&await s.value.validate(async r=>{if(r){k.value=!0;try{const u={product_name:a.name,category_id:a.categoryId,image:a.image,sort_order:a.sortOrder,display_price:a.displayPrice,tags:a.tags,initial_sales:a.initialSales,badge_label:a.badgeLabel||null,rating:a.rating,allow_addon:a.allowAddon,detail_modules:a.detailModules,status:a.status?"on":"off"},d=a.id?await D.updateProduct(a.id,u):await D.createProduct(u);if(d.success){if(!a.id&&a.copySkus.length>0&&d.product){const n=await D.createProductSkus(d.product.id,a.copySkus);n.success||I.warning("商品已创建但SKU复制失败: "+n.error)}I.success("保存成功"),w()}else I.error(d.error||"保存失败")}catch(u){I.error(u.message||"保存异常")}finally{k.value=!1}}})},w=()=>N.push("/_mgmt_9Xfa3/products"),h=()=>a.detailModules.push({type:"text",content:""}),F=()=>a.detailModules.push({type:"image",content:""}),O=r=>a.detailModules.splice(r,1),o=(r,u)=>{const d=a.detailModules[r];a.detailModules[r]=a.detailModules[r+u],a.detailModules[r+u]=d},x=r=>{f.value=r,M.value=!0},p=r=>{if(r.length===0)return;const u=r[0];f.value==="image"?a.image=u:typeof f.value=="number"&&(a.detailModules[f.value].content=u)};return ue(async()=>{R(),b.query.copy_from_id?U(b.query.copy_from_id,!0):b.query.id&&U(b.query.id,!1)}),{formRef:s,form:a,rules:P,loading:k,isEdit:q,categories:V,imagePickerVisible:M,submitProduct:T,goBack:w,addDetailText:h,addDetailImage:F,removeDetailModule:O,moveDetailModule:o,openImagePicker:x,handleImageSelected:p}}const Be={class:"product-post-page"},De={class:"main-body"},qe={class:"content-wrapper"},Re={key:1,class:"trigger-content"},Te={key:2,class:"trigger-overlay"},Fe={class:"card-header"},Le={class:"header-actions"},Ne={class:"detail-module-list"},Oe={class:"module-actions"},$e={class:"action-btns"},ze={class:"module-display"},Ge=["onClick"],He={key:1,class:"image-placeholder"},Ke={key:0,class:"empty-detail-tip"},We=ce({__name:"post",setup(N){const{formRef:b,form:s,rules:q,loading:k,isEdit:V,categories:M,imagePickerVisible:f,submitProduct:a,goBack:P,addDetailText:R,addDetailImage:U,removeDetailModule:T,moveDetailModule:w,openImagePicker:h,handleImageSelected:F}=Ae();return(O,o)=>{const x=Y,p=ee,r=le,u=te,d=ae,n=ie,c=oe,W=se,$=re,y=_e,L=Ee,X=Se,j=Ce,E=Ie,J=Me,Q=Z;return g(),_("div",Be,[e(Ue,{title:t(V)?"编辑商品":"创建商品",subtitle:t(V)?"Edit Product":"New Product",loading:t(k),"submit-text":"保存商品",onBack:t(P),onCancel:t(P),onSubmit:t(a)},null,8,["title","subtitle","loading","onBack","onCancel","onSubmit"]),m("div",De,[m("div",qe,[e(Q,{model:t(s),rules:t(q),ref_key:"formRef",ref:b,"label-width":"120px",class:"main-form"},{default:l(()=>[e(L,{shadow:"never",class:"form-card"},{header:l(()=>[...o[12]||(o[12]=[m("div",{class:"card-header"},"基本信息",-1)])]),default:l(()=>[e(c,{gutter:40},{default:l(()=>[e(d,{span:16},{default:l(()=>[e(p,{label:"商品名称",prop:"name"},{default:l(()=>[e(x,{modelValue:t(s).name,"onUpdate:modelValue":o[0]||(o[0]=i=>t(s).name=i),placeholder:"请输入商品主标题",size:"large"},null,8,["modelValue"])]),_:1}),e(c,{gutter:20},{default:l(()=>[e(d,{span:12},{default:l(()=>[e(p,{label:"商品分类",prop:"categoryId"},{default:l(()=>[e(u,{modelValue:t(s).categoryId,"onUpdate:modelValue":o[1]||(o[1]=i=>t(s).categoryId=i),placeholder:"请选择分类",style:{width:"100%"}},{default:l(()=>[(g(!0),_(z,null,G(t(M),i=>(g(),A(r,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(p,{label:"商品排序"},{default:l(()=>[e(n,{modelValue:t(s).sortOrder,"onUpdate:modelValue":o[2]||(o[2]=i=>t(s).sortOrder=i),min:0,style:{width:"100%"},placeholder:"数值越小越靠前"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{label:"商品标签"},{default:l(()=>[e(he,{modelValue:t(s).tags,"onUpdate:modelValue":o[3]||(o[3]=i=>t(s).tags=i),"add-button-text":"+ 新标签"},null,8,["modelValue"])]),_:1}),e(p,{label:"上架状态"},{default:l(()=>[e(W,{modelValue:t(s).status,"onUpdate:modelValue":o[4]||(o[4]=i=>t(s).status=i),"active-text":"立即上架","inactive-text":"暂不上架"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(p,{label:"商品图片",prop:"image",class:"img-upload-item"},{default:l(()=>[m("div",{class:"image-gallery-trigger",onClick:o[5]||(o[5]=i=>t(h)("image"))},[t(s).image?(g(),A($,{key:0,src:t(s).image,class:"trigger-img",fit:"cover"},null,8,["src"])):(g(),_("div",Re,[e(y,{class:"trigger-icon"},{default:l(()=>[e(t(fe))]),_:1}),o[13]||(o[13]=m("span",null,"封面图",-1))])),t(s).image?(g(),_("div",Te,"更换图片")):H("",!0)]),o[14]||(o[14]=m("div",{class:"form-tip"},"建议尺寸 800x800",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{shadow:"never",class:"form-card"},{header:l(()=>[...o[15]||(o[15]=[m("div",{class:"card-header"},"营销与展示",-1)])]),default:l(()=>[e(c,{gutter:40},{default:l(()=>[e(d,{span:8},{default:l(()=>[e(p,{label:"展示价格"},{default:l(()=>[e(n,{modelValue:t(s).displayPrice,"onUpdate:modelValue":o[6]||(o[6]=i=>t(s).displayPrice=i),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"]),o[16]||(o[16]=m("div",{class:"form-tip"},"列表页起步价",-1))]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(p,{label:"初始销量"},{default:l(()=>[e(n,{modelValue:t(s).initialSales,"onUpdate:modelValue":o[7]||(o[7]=i=>t(s).initialSales=i),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:l(()=>[e(p,{label:"好评度(%)"},{default:l(()=>[e(X,{modelValue:t(s).rating,"onUpdate:modelValue":o[8]||(o[8]=i=>t(s).rating=i),min:80,max:100,"show-input":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:40},{default:l(()=>[e(d,{span:8},{default:l(()=>[e(p,{label:"角标标签"},{default:l(()=>[e(u,{modelValue:t(s).badgeLabel,"onUpdate:modelValue":o[9]||(o[9]=i=>t(s).badgeLabel=i),placeholder:"请选择",clearable:"",style:{width:"100%"}},{default:l(()=>[e(r,{label:"热卖",value:"热卖"}),e(r,{label:"新品",value:"新品"}),e(r,{label:"推荐",value:"推荐"}),e(r,{label:"限量",value:"限量"}),e(r,{label:"优惠",value:"优惠"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:16},{default:l(()=>[e(p,{label:"加购配置"},{default:l(()=>[e(j,{modelValue:t(s).allowAddon,"onUpdate:modelValue":o[10]||(o[10]=i=>t(s).allowAddon=i)},{default:l(()=>[...o[17]||(o[17]=[B("允许用户在下单时增加购买数量",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{shadow:"never",class:"form-card"},{header:l(()=>[m("div",Fe,[o[20]||(o[20]=m("span",null,"商品详情",-1)),m("div",Le,[e(E,{size:"small",onClick:t(R)},{default:l(()=>[e(y,null,{default:l(()=>[e(t(Ve))]),_:1}),o[18]||(o[18]=B(" 添加文本",-1))]),_:1},8,["onClick"]),e(E,{size:"small",onClick:t(U)},{default:l(()=>[e(y,null,{default:l(()=>[e(t(K))]),_:1}),o[19]||(o[19]=B(" 添加图片",-1))]),_:1},8,["onClick"])])])]),default:l(()=>[m("div",Ne,[(g(!0),_(z,null,G(t(s).detailModules,(i,v)=>(g(),_("div",{key:v,class:"detail-module-item"},[m("div",Oe,[e(J,{size:"small",effect:"plain"},{default:l(()=>[B(be(i.type==="image"?"图片模块":"文本模块"),1)]),_:2},1024),m("div",$e,[e(E,{link:"",disabled:v===0,onClick:S=>t(w)(v,-1)},{default:l(()=>[e(y,null,{default:l(()=>[e(t(ye))]),_:1})]),_:1},8,["disabled","onClick"]),e(E,{link:"",disabled:v===t(s).detailModules.length-1,onClick:S=>t(w)(v,1)},{default:l(()=>[e(y,null,{default:l(()=>[e(t(ve))]),_:1})]),_:1},8,["disabled","onClick"]),e(E,{link:"",type:"danger",onClick:S=>t(T)(v)},{default:l(()=>[e(y,null,{default:l(()=>[e(t(ke))]),_:1})]),_:1},8,["onClick"])])]),m("div",ze,[i.type==="image"?(g(),_("div",{key:0,class:"module-image-trigger",onClick:S=>t(h)(v)},[i.content?(g(),A($,{key:0,src:i.content,class:"module-img-preview",fit:"contain"},null,8,["src"])):(g(),_("div",He,[e(y,null,{default:l(()=>[e(t(K))]),_:1}),o[21]||(o[21]=m("span",null,"点击选择图片",-1))]))],8,Ge)):(g(),A(x,{key:1,modelValue:i.content,"onUpdate:modelValue":S=>i.content=S,type:"textarea",rows:3,placeholder:"请输入段落文本"},null,8,["modelValue","onUpdate:modelValue"]))])]))),128)),t(s).detailModules.length===0?(g(),_("div",Ke," 暂无详情内容，请点击上方按钮添加 ")):H("",!0)])]),_:1})]),_:1},8,["model","rules"])])]),e(Pe,{modelValue:t(f),"onUpdate:modelValue":o[11]||(o[11]=i=>ge(f)?f.value=i:null),multiple:!1,onSelect:t(F)},null,8,["modelValue","onSelect"])])}}}),pl=we(We,[["__scopeId","data-v-4f08649c"]]);export{pl as default};
