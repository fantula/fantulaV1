import{f as B,g as v,G as S,w as _,ac as X,o as u,a as o,c as r,D as w,n as V,aI as R,t as $,_ as q,C as F,z as Z,r as k,h as ee,b as h,i as te,v as se,j as ae,F as Y,k as z,B as C,E as oe,l as K,a6 as L,d as A,M as ne}from"./gYbOYKrZ.js";import{B as N,c as T}from"./Du3BG93F.js";import{B as j}from"./DfUoue4O.js";const le={class:"result-body"},ie={key:0},ue={key:1},ce={key:2},re={key:3},de={key:0,class:"result-message"},pe={key:1,class:"result-content"},ve={class:"result-actions"},me=B({__name:"BaseResultModal",props:{visible:{type:Boolean},type:{default:"success"},title:{default:"操作成功"},message:{},primaryText:{default:"确定"},secondaryText:{default:"返回"},showSecondary:{type:Boolean,default:!1},showMascot:{type:Boolean,default:!1},mascotPosition:{default:"bottom"}},emits:["close","primary","secondary","update:visible"],setup(a,{emit:D}){const e=a,c=D,d=v(()=>`icon-${e.type}`),p=v(()=>({"btn-success":e.type==="success","btn-danger":e.type==="error","btn-warning":e.type==="warning","btn-primary":e.type==="info"})),b=()=>{c("close"),c("update:visible",!1)},y=()=>{c("primary"),b()},m=()=>{c("secondary")};return(g,l)=>(u(),S(X,{visible:a.visible,title:a.title,width:"500px","show-footer":!1,"show-mascot":a.showMascot,"mascot-position":a.mascotPosition,onClose:b},{default:_(()=>[o("div",le,[o("div",{class:V(["result-icon",d.value])},[R(g.$slots,"icon",{},()=>[a.type==="success"?(u(),r("span",ie,"✓")):a.type==="error"?(u(),r("span",ue,"✕")):a.type==="warning"?(u(),r("span",ce,"!")):(u(),r("span",re,"i"))],!0)],2),a.message?(u(),r("div",de,$(a.message),1)):w("",!0),g.$slots.default?(u(),r("div",pe,[R(g.$slots,"default",{},void 0,!0)])):w("",!0),o("div",ve,[a.showSecondary?(u(),r("button",{key:0,class:"btn btn-secondary",onClick:m},$(a.secondaryText),1)):w("",!0),o("button",{class:V(["btn",p.value]),onClick:y},$(a.primaryText),3)])])]),_:3},8,["visible","title","show-mascot","mascot-position"]))}}),ye=q(me,[["__scopeId","data-v-7a5915cb"]]),fe=B({__name:"CouponBalance",props:{couponData:{},isExpired:{type:Boolean}},emits:["use","click"],setup(a,{emit:D}){const e=a,c=D,d=v(()=>e.couponData.status==="used"?"used":e.isExpired||e.couponData.status==="expired"?"expired":"unused"),p=v(()=>{if(!e.couponData.coupon.end_date)return"永久有效";const m=new Date(e.couponData.coupon.end_date);return`有效期至 ${m.getFullYear()}.${String(m.getMonth()+1).padStart(2,"0")}.${String(m.getDate()).padStart(2,"0")}`}),b=()=>{c("use",e.couponData)},y=()=>{c("click",e.couponData)};return(m,g)=>(u(),S(N,{color:"gold",value:a.couponData.coupon.value,unit:"点",title:a.couponData.coupon.name,desc:"直接存入余额，可购买任意服务","type-label":"额度券","expiry-text":p.value,status:d.value,disabled:a.isExpired,"action-text":"立即充值",onClick:y,onAction:b},null,8,["value","title","expiry-text","status","disabled"]))}}),G=B({__name:"CouponFlat",props:{couponData:{},isExpired:{type:Boolean}},emits:["click"],setup(a,{emit:D}){const e=a,c=D,d=F(),p=v(()=>e.couponData.status==="used"?"used":e.isExpired||e.couponData.status==="expired"?"expired":"unused"),b=v(()=>{const l=e.couponData.coupon.min_usage;return l&&l>0?`满 ${l} 点可用`:"无门槛使用"}),y=v(()=>{if(!e.couponData.coupon.end_date)return"永久有效";const l=new Date(e.couponData.coupon.end_date);return`有效期至 ${l.getFullYear()}.${String(l.getMonth()+1).padStart(2,"0")}.${String(l.getDate()).padStart(2,"0")}`}),m=()=>{d.push("/")},g=()=>{c("click",e.couponData)};return(l,x)=>(u(),S(N,{color:"purple",value:a.couponData.coupon.value,unit:"点",title:a.couponData.coupon.name,desc:b.value,"type-label":"立减券","expiry-text":y.value,status:p.value,disabled:a.isExpired,"action-text":"去使用",onClick:g,onAction:m},null,8,["value","title","desc","expiry-text","status","disabled"]))}}),xe=B({__name:"CouponProduct",props:{couponData:{},isExpired:{type:Boolean}},emits:["click"],setup(a,{emit:D}){const e=a,c=D,d=F(),p=v(()=>e.couponData.status==="used"?"used":e.isExpired||e.couponData.status==="expired"?"expired":"unused"),b=v(()=>{if(!e.couponData.coupon.end_date)return"永久有效";const n=new Date(e.couponData.coupon.end_date);return`有效期至 ${n.getFullYear()}.${String(n.getMonth()+1).padStart(2,"0")}.${String(n.getDate()).padStart(2,"0")}`}),y=v(()=>{const n=e.couponData.coupon.value;return!n||Number(n)===0?"兑换":n}),m=v(()=>{const n=e.couponData.coupon.value;return!n||Number(n)===0?"":"点"}),g=v(()=>{const n=e.couponData.coupon.extra;return n&&n.product_name?`${n.product_name} 专用`:"指定商品专用优惠"}),l=()=>{const n=e.couponData.coupon.extra;n&&n.product_id?d.push(`/product/${n.product_id}`):d.push("/")},x=()=>{c("click",e.couponData)};return(n,U)=>(u(),S(N,{color:"cyan",value:y.value,unit:m.value,title:a.couponData.coupon.name,desc:g.value,"type-label":"商品券","expiry-text":b.value,status:p.value,disabled:a.isExpired,"action-text":"去购买",onClick:x,onAction:l},null,8,["value","unit","title","desc","expiry-text","status","disabled"]))}}),be={class:"exchange-section"},ge={class:"redemption-card"},ke={class:"redemption-header"},De={class:"redemption-body"},he={class:"input-group"},Ce=["disabled"],_e={key:0},we={key:1},$e={class:"coupon-tabs"},Be=["onClick"],Se={key:0,class:"active-indicator"},Me={class:"coupon-list-container"},Ee={class:"coupon-list"},Te={key:0,class:"empty-state"},Ue={key:0,class:"modal-text"},Ae={class:"highlight"},Ve=B({__name:"exchange",setup(a){const D=Z();F();const e=k([]),c=k(""),d=k(!1),p=k("all"),b=[{key:"all",label:"全部"},{key:"unused",label:"未使用"},{key:"used",label:"已使用"},{key:"expired",label:"已过期"}],y=async()=>{const s=await T.getUserCoupons();s.success&&s.data&&(e.value=s.data)};ee(y);const m=v(()=>{const s=new Date;let t=e.value;return p.value==="used"?t.filter(f=>f.status==="used"):p.value==="expired"?t.filter(f=>f.status==="expired"||f.coupon.end_date&&new Date(f.coupon.end_date)<s):p.value==="unused"?t.filter(f=>f.status==="unused"&&(!f.coupon.end_date||new Date(f.coupon.end_date)>=s)):t}),g=s=>{switch(s){case"balance":return fe;case"product":return xe;case"flat":return G;default:return G}},l=k(!1),x=k(null),n=k(!1),U=k(null),H=v(()=>{const s=U.value;return s?`恭喜您获得 ${s.name}，包含 ${s.value}点 权益`:"恭喜您获得一张优惠券！"}),I=async()=>{if(!(!c.value||d.value)){d.value=!0;try{const s=await T.redeemCoupon(c.value);s.success?(U.value=s.data,n.value=!0,c.value="",y()):C.error(s.msg||"兑换失败")}finally{d.value=!1}}},M=k(!1),J=s=>{x.value=s,M.value=!0},O=async()=>{if(!(!x.value||l.value)){l.value=!0;try{const s=await T.useBalanceCoupon(x.value.id);s.success?(C.success("金额已成功存入您的钱包"),M.value=!1,y(),D.getUserInfo()):C.error(s.msg||"操作失败")}finally{l.value=!1}}},E=k(!1),Q=s=>{(s.status==="used"||s.status==="expired"||P(s))&&(x.value=s,E.value=!0)},W=async()=>{if(!(!x.value||l.value)){l.value=!0;try{const s=await T.deleteUserCoupon(x.value.id);s.success?(C.success("删除成功"),E.value=!1,y()):C.error(s.msg||"删除失败")}finally{l.value=!1}}},P=s=>s.coupon.end_date?new Date(s.coupon.end_date)<new Date:!1;return(s,t)=>{const f=oe;return u(),r("div",be,[t[14]||(t[14]=o("div",{class:"section-header"},[o("h2",{class:"section-title"},"兑换中心"),o("div",{class:"section-subtitle"},"Digital Vault")],-1)),o("div",ge,[o("div",ke,[h(f,{class:"redemption-icon"},{default:_(()=>[h(K(L))]),_:1}),t[5]||(t[5]=o("div",{class:"redemption-title"},"兑换优惠券",-1))]),o("div",De,[o("div",he,[te(o("input",{type:"text",class:"redemption-input",placeholder:"请输入兑换码","onUpdate:modelValue":t[0]||(t[0]=i=>c.value=i),onKeyup:ae(I,["enter"])},null,544),[[se,c.value]]),o("button",{class:"redemption-btn",onClick:I,disabled:!c.value||d.value},[d.value?(u(),r("span",_e,"兑换中...")):(u(),r("span",we,"立即兑换"))],8,Ce)]),t[6]||(t[6]=o("p",{class:"redemption-tips"},"兑换码通常由16位字母和数字组成，区分大小写",-1))])]),o("div",$e,[(u(),r(Y,null,z(b,i=>o("div",{key:i.key,class:V(["tab-item",{active:p.value===i.key}]),onClick:Fe=>p.value=i.key},[A($(i.label)+" ",1),p.value===i.key?(u(),r("div",Se)):w("",!0)],10,Be)),64))]),o("div",Me,[o("div",Ee,[m.value.length===0?(u(),r("div",Te,[h(f,{class:"empty-icon"},{default:_(()=>[h(K(L))]),_:1}),t[7]||(t[7]=o("div",{class:"empty-text"},"暂无优惠券",-1)),t[8]||(t[8]=o("div",{class:"empty-desc"},"快去兑换或参与活动获取吧~",-1))])):(u(!0),r(Y,{key:1},z(m.value,i=>(u(),S(ne(g(i.coupon.type)),{key:i.id,"coupon-data":i,"is-expired":P(i)||i.status==="expired",onClick:Q,onUse:J},null,40,["coupon-data","is-expired"]))),128))])]),h(j,{visible:M.value,"onUpdate:visible":t[1]||(t[1]=i=>M.value=i),title:"确认使用额度券","confirm-text":"确定兑换",loading:l.value,onConfirm:O,"show-mascot":""},{default:_(()=>[x.value?(u(),r("div",Ue,[t[9]||(t[9]=A(" 确定要将这张面值为 ",-1)),o("span",Ae,$(x.value.coupon.value)+" 点",1),t[10]||(t[10]=A(" 的额度券兑换到您的账户余额中吗？ ",-1)),t[11]||(t[11]=o("br",null,null,-1)),t[12]||(t[12]=o("span",{class:"warning"},"兑换后优惠券将自动失效。",-1))])):w("",!0)]),_:1},8,["visible","loading"]),h(j,{visible:E.value,"onUpdate:visible":t[2]||(t[2]=i=>E.value=i),title:"删除优惠券","confirm-text":"确认删除","confirm-type":"danger",loading:l.value,onConfirm:W,"show-mascot":""},{default:_(()=>[...t[13]||(t[13]=[o("div",{class:"modal-text"},"确定要永久删除这张优惠券记录吗？此操作无法撤销。",-1)])]),_:1},8,["visible","loading"]),h(ye,{visible:n.value,"onUpdate:visible":t[3]||(t[3]=i=>n.value=i),type:"success",title:"兑换成功",message:H.value,"primary-text":"太棒了",onPrimary:t[4]||(t[4]=i=>n.value=!1),"show-mascot":"","mascot-position":"bottom"},null,8,["visible","message"])])}}}),Re=q(Ve,[["__scopeId","data-v-c5b0608c"]]);export{Re as default};
