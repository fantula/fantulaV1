const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CEI0siaN.js","./entry.CxLesyFg.css"])))=>i.map(i=>d[i]);
import{f as w,r as u,am as N,h as k,c as Y,b as o,w as a,B as p,o as d,i as b,a as c,G as f,D as L,E as x,l as R,aE as O,cs as M,ag as P,d as y,aw as F,ax as I,_ as h}from"./CEI0siaN.js";import{E as W}from"./DB7JGTAC.js";import{E as $}from"./BCllKHMW.js";import{E as j,a as q}from"./ClIUVBla.js";import{E as G}from"./CoJKtQsI.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import{c as U}from"./BV_QTDOQ.js";import{A as z}from"./Jf5bIUYa.js";import{v as H}from"./BrE0JoK1.js";import"./OwHC_0Ap.js";import"./97-vZjNt.js";import"./DqBrY_lx.js";import"./BB_Ol6Sd.js";import"./C6m5ANi3.js";import"./Cp1EI20B.js";import"./Dnj8X3EN.js";import"./Bh6H2ams.js";import"./Cq9Fpw4b.js";import"./DW0_wk9g.js";import"./CCDBlmbt.js";import"./PbH8IyH8.js";/* empty css        */const J={class:"r2-settings-page"},Q=w({__name:"storage",setup(X){const S=u(!1),A=u(!1),E=u(!1),g=u(!1),_=u(null),v=u(""),t=N({R2_ACCOUNT_ID:"",R2_ACCESS_KEY_ID:"",R2_SECRET_ACCESS_KEY:"",R2_BUCKET_NAME:"fantula2601",R2_PUBLIC_BASE_URL:"https://img.fantula.com"}),T=async()=>{S.value=!0;try{const l=await U.getR2Settings();l.success&&l.settings&&(Object.assign(t,l.settings),v.value=l.settings.R2_SECRET_ACCESS_KEY||"")}catch(l){p.error("加载配置失败: "+l.message)}finally{S.value=!1}},K=async()=>{A.value=!0;try{const l={R2_ACCOUNT_ID:t.R2_ACCOUNT_ID,R2_ACCESS_KEY_ID:t.R2_ACCESS_KEY_ID,R2_BUCKET_NAME:t.R2_BUCKET_NAME,R2_PUBLIC_BASE_URL:t.R2_PUBLIC_BASE_URL};t.R2_SECRET_ACCESS_KEY!==v.value&&(l.R2_SECRET_ACCESS_KEY=t.R2_SECRET_ACCESS_KEY);const e=await U.updateR2Settings(l);e.success?(p.success("配置保存成功"),await T()):p.error("保存失败: "+e.error)}catch(l){p.error("保存失败: "+l.message)}finally{A.value=!1}},B=async()=>{g.value=!0,_.value=null;try{const{callEdgeFunction:l}=await I(async()=>{const{callEdgeFunction:m}=await import("./CEI0siaN.js").then(i=>i.ff);return{callEdgeFunction:m}},__vite__mapDeps([0,1]),import.meta.url),{getAdminAuthToken:e}=await I(async()=>{const{getAdminAuthToken:m}=await import("./CEI0siaN.js").then(i=>i.fe);return{getAdminAuthToken:m}},__vite__mapDeps([0,1]),import.meta.url),C=await e(),{data:r,error:n}=await l("test-r2-connection",{method:"POST",body:{R2_ACCOUNT_ID:t.R2_ACCOUNT_ID,R2_ACCESS_KEY_ID:t.R2_ACCESS_KEY_ID,R2_SECRET_ACCESS_KEY:t.R2_SECRET_ACCESS_KEY,R2_BUCKET_NAME:t.R2_BUCKET_NAME},requireAuth:!0,token:C||void 0});n?_.value={success:!1,message:n}:_.value={success:r.success,message:r.message||(r.success?"连接成功":"未知错误")}}catch(l){console.error("Test connection exception:",l),_.value={success:!1,message:"前端异常: "+(l.message||"未知错误")}}finally{g.value=!1}};return k(()=>{T()}),(l,e)=>{const C=W,r=$,n=q,m=x,i=G,D=j,V=H;return d(),Y("div",J,[o(z,{title:"R2 存储配置"},{default:a(()=>[o(C,{title:"安全提示",type:"warning",closable:!1,"show-icon":"",class:"mb-4"},{default:a(()=>[...e[7]||(e[7]=[c("ul",{class:"safe-tips"},[c("li",null,"R2 密钥存储在数据库中，仅允许后端 Edge Function 读取"),c("li",null,"前端无法直接获取这些密钥，所有上传操作都通过服务端完成"),c("li",null,"R2 存储桶不直接暴露公网，所有访问必须通过 Cloudflare Worker 代理")],-1)])]),_:1}),b((d(),f(D,{model:t,"label-width":"180px","label-position":"left"},{default:a(()=>[o(n,{label:"Cloudflare 账号 ID"},{default:a(()=>[o(r,{modelValue:t.R2_ACCOUNT_ID,"onUpdate:modelValue":e[0]||(e[0]=s=>t.R2_ACCOUNT_ID=s),placeholder:"请输入 Cloudflare Account ID"},null,8,["modelValue"])]),_:1}),o(n,{label:"Access Key ID"},{default:a(()=>[o(r,{modelValue:t.R2_ACCESS_KEY_ID,"onUpdate:modelValue":e[1]||(e[1]=s=>t.R2_ACCESS_KEY_ID=s),placeholder:"请输入 R2 Access Key ID"},null,8,["modelValue"])]),_:1}),o(n,{label:"Secret Access Key"},{default:a(()=>[o(r,{modelValue:t.R2_SECRET_ACCESS_KEY,"onUpdate:modelValue":e[3]||(e[3]=s=>t.R2_SECRET_ACCESS_KEY=s),type:E.value?"text":"password",placeholder:"请输入 R2 Secret Access Key"},{suffix:a(()=>[o(m,{class:"cursor-pointer",onClick:e[2]||(e[2]=s=>E.value=!E.value)},{default:a(()=>[E.value?(d(),f(R(M),{key:1})):(d(),f(R(O),{key:0}))]),_:1})]),_:1},8,["modelValue","type"]),e[8]||(e[8]=c("div",{class:"form-tip"},"密钥仅在服务端使用，不会暴露给前端",-1))]),_:1}),o(n,{label:"存储桶名称"},{default:a(()=>[o(r,{modelValue:t.R2_BUCKET_NAME,"onUpdate:modelValue":e[4]||(e[4]=s=>t.R2_BUCKET_NAME=s),placeholder:"fantula2601"},null,8,["modelValue"])]),_:1}),o(n,{label:"公开访问域名"},{default:a(()=>[o(r,{modelValue:t.R2_PUBLIC_BASE_URL,"onUpdate:modelValue":e[5]||(e[5]=s=>t.R2_PUBLIC_BASE_URL=s),placeholder:"https://img.fantula.com"},null,8,["modelValue"]),e[9]||(e[9]=c("div",{class:"form-tip"},"通过 Cloudflare Worker 代理的自定义域名",-1))]),_:1}),o(n,null,{default:a(()=>[o(i,{type:"primary",loading:A.value,onClick:K,icon:R(P)},{default:a(()=>[...e[10]||(e[10]=[y("保存配置",-1)])]),_:1},8,["loading","icon"]),o(i,{loading:g.value,onClick:B,icon:R(F),style:{"margin-left":"12px"}},{default:a(()=>[...e[11]||(e[11]=[y("测试连接",-1)])]),_:1},8,["loading","icon"])]),_:1}),_.value?(d(),f(n,{key:0},{default:a(()=>[o(C,{title:_.value.message,type:_.value.success?"success":"error",closable:!0,onClose:e[6]||(e[6]=s=>_.value=null),"show-icon":""},null,8,["title","type"])]),_:1})):L("",!0)]),_:1},8,["model"])),[[V,S.value]])]),_:1})])}}}),ye=h(Q,[["__scopeId","data-v-c3239d1c"]]);export{ye as default};
