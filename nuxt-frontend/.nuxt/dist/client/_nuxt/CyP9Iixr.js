import{E as j}from"./-Yx_0iEM.js";import{E as K}from"./DC3lfPj1.js";import{a as W,E as O}from"./Ci1VNkC9.js";import{E as X}from"./1SfIsks3.js";import{f as q,r as n,J as L,G as T,w as o,o as k,a as _,i as Y,b as a,l as A,a_ as H,E as Z,b1 as ee,t as v,d as c,B as h,_ as J,h as te,c as G,p as ae,D as R,F as oe,k as re}from"./o2XBa361.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{e as E}from"./Di05QSSe.js";import{A as ie}from"./DHlfceZi.js";import{A as le}from"./BrR7l0bw.js";import{A as se}from"./DeKxUs28.js";import{P as ne}from"./DLUP05ph.js";import{S as ue}from"./DuEV31L_.js";import{E as pe}from"./BTJpnMK3.js";import{E as me}from"./BFBDJNh1.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{v as ce}from"./BwD4Hz0h.js";import{E as de}from"./BfOrkIVm.js";import"./Culj45X8.js";import"./Dnj8X3EN.js";import"./ClnTspdU.js";import"./Cq9Fpw4b.js";import"./CqX7ZdKI.js";import"./Dlk0BVst.js";import"./qVmxJdp3.js";import"./DtTI1xRr.js";import"./Bh6H2ams.js";import"./t2w4jifC.js";import"./C9zJf5rn.js";import"./Bx0EXMjc.js";import"./Z6faUBN3.js";import"./BlW_46uR.js";import"./hXKBSGVD.js";import"./B_FoF6yT.js";import"./BCItYl8Z.js";import"./BB_Ol6Sd.js";import"./Dzr5IOAO.js";import"./DVQwC1Y0.js";import"./Bdid5VjX.js";import"./XmVVhx5S.js";import"./CM1YTunQ.js";import"./DytS51kl.js";/* empty css        */import"./C1T5KPmY.js";import"./BOgRz4Th.js";import"./CrjkcmUY.js";import"./B8yeDp5P.js";import"./Ds34GQx2.js";import"./KSqZSeJ0.js";import"./CQuNCUIC.js";/* empty css        *//* empty css        *//* empty css        */import"./CziALilw.js";import"./FKUjHIpz.js";import"./D6FW0B1r.js";import"./CleHDoLI.js";/* empty css        */import"./COgFiiev.js";/* empty css        */import"./Cq9RPQ5L.js";import"./BHSqheQV.js";/* empty css        */import"./Tzes-zbc.js";import"./DFiWfk7u.js";/* empty css        */import"./DwwA_QlG.js";const fe={class:"drawer-container"},_e={class:"toolbar"},ge={class:"product-cell"},ve={class:"image-slot"},ye={class:"p-info"},ke={class:"p-name"},he={class:"p-id"},be=q({__name:"LinkedProductDrawer",props:{modelValue:{type:Boolean},tag:{},tagName:{}},emits:["update:modelValue"],setup(D,{emit:S}){const g=D,C=S,m=n(!1),y=n([]),d=n(!1);L(()=>g.modelValue,s=>{m.value=s,s&&g.tag&&f()}),L(m,s=>{C("update:modelValue",s)});const f=async()=>{if(g.tag){d.value=!0;try{const s=await E.getProductsBySharedTag(g.tag);s.success?y.value=s.products||[]:h.error(s.error||"加载失败")}catch(s){console.error("getProductsBySharedTag Error:",s),h.error(s.message||"网络异常")}finally{d.value=!1}}};return(s,b)=>{const w=j,V=Z,B=pe,$=O,N=K,P=W,I=me,M=ce;return k(),T(I,{modelValue:m.value,"onUpdate:modelValue":b[0]||(b[0]=p=>m.value=p),title:`关联商品列表 - ${D.tagName||"#"+D.tag}`,size:"600px","destroy-on-close":""},{default:o(()=>[_("div",fe,[_("div",_e,[a(w,{icon:A(H),circle:"",onClick:f},null,8,["icon"])]),Y((k(),T(P,{data:y.value,border:"",stripe:"",height:"calc(100vh - 150px)"},{default:o(()=>[a($,{label:"商品信息","min-width":"250"},{default:o(({row:p})=>[_("div",ge,[a(B,{src:p.image,class:"p-thumb",fit:"cover"},{error:o(()=>[_("div",ve,[a(V,null,{default:o(()=>[a(A(ee))]),_:1})])]),_:1},8,["src"]),_("div",ye,[_("div",ke,v(p.product_name),1),_("div",he,"ID: "+v(p.id.substring(0,8))+"...",1)])])]),_:1}),a($,{label:"状态",width:"80",align:"center"},{default:o(({row:p})=>[a(N,{type:p.status==="on"?"success":"info",size:"small"},{default:o(()=>[c(v(p.status==="on"?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[M,d.value]])])]),_:1},8,["modelValue","title"])}}}),Ve=J(be,[["__scopeId","data-v-c3045899"]]),Ee={class:"shared-sku-page"},Se={key:0,style:{"font-size":"12px","margin-top":"5px",color:"#909399"}},we={class:"spec-preview"},xe={style:{"margin-bottom":"20px"}},De=q({__name:"shared-sku",setup(D){const S=n(!1),g=n(!1),C=n([]),m=n(!1),y=n(!1),d=n(0),f=n(""),s=n([]),b=n([]),w=n(),V=async()=>{S.value=!0;try{const r=await E.getSharedSkuGroups();r.success&&(C.value=r.groups)}finally{S.value=!1}},B=r=>{const e=new Set;return r.skus.forEach(l=>Object.keys(l.spec_combination).forEach(t=>e.add(t))),Array.from(e)},$=r=>{if(!r.skus.length)return"-";const e=r.skus.map(u=>u.price),l=Math.min(...e),t=Math.max(...e);return l===t?`¥${l}`:`¥${l} - ¥${t}`},N=async()=>{y.value=!1;const r=await E.getNextTag();d.value=r.tag||0,f.value="",s.value=[],b.value=[],m.value=!0},P=r=>{y.value=!0,d.value=r.tag,f.value=r.tag_name||"";const e=new Map,l=r.skus.map(t=>(Object.entries(t.spec_combination).forEach(([u,U])=>{e.has(u)||e.set(u,new Set),e.get(u).add(U)}),{id:t.id,specValues:t.spec_combination,product_type:t.product_type,price:t.price,duration:t.duration,intro:t.intro,image:t.image,tag:t.tag}));b.value=Array.from(e.entries()).map(([t,u])=>({name:t,values:Array.from(u),inputVisible:!1,inputValue:""})),s.value=l,m.value=!0},I=async()=>{if(w.value){g.value=!0;try{const r=w.value.getSkus();if(r.length===0){h.warning("请至少添加一个SKU");return}const e=r.map((t,u)=>({id:t.id,spec_combination:t.specValues,product_type:t.product_type,price:t.price,duration:t.duration,image:t.image,intro:t.intro,sort_order:u}));let l;y.value?l=await E.updateSharedSkuGroup(d.value,e,f.value):l=await E.createSharedSkuGroup(d.value,e,f.value),l.success?(h.success("保存成功"),m.value=!1,V()):h.error(l.error)}finally{g.value=!1}}},M=r=>{de.confirm(`确认删除规格组 #${r.tag}? 此操作无法恢复。`,"警告",{type:"warning"}).then(async()=>{const e=await E.deleteSharedSkuGroup(r.tag);e.success?(h.success("删除成功"),V()):h.error(e.error)})},p=n(!1),z=n(0),F=n(""),Q=r=>{z.value=r.tag,F.value=r.tag_name,p.value=!0};return te(V),(r,e)=>{const l=j,t=K,u=O,U=X;return k(),G("div",Ee,[a(ne,{title:"共享规格组可被多个商品引用，修改此处将同步更新所有关联商品。",type:"warning"}),a(ie,null,{actions:o(()=>[a(l,{onClick:V,icon:A(H)},{default:o(()=>[...e[3]||(e[3]=[c("刷新",-1)])]),_:1},8,["icon"]),a(l,{type:"primary",icon:A(ae),onClick:N},{default:o(()=>[...e[4]||(e[4]=[c("新建共享规格组",-1)])]),_:1},8,["icon"])]),_:1}),a(le,{data:C.value,loading:S.value},{default:o(()=>[a(u,{label:"组 ID",prop:"tag",width:"100",align:"center"},{default:o(({row:i})=>[a(t,{type:"info",effect:"dark"},{default:o(()=>[c("#"+v(i.tag),1)]),_:2},1024),i.tag_name?(k(),G("div",Se,v(i.tag_name),1)):R("",!0)]),_:1}),a(u,{label:"SKU 数量",width:"120",align:"center"},{default:o(({row:i})=>[a(t,null,{default:o(()=>[c(v(i.skus.length)+" 个规格",1)]),_:2},1024)]),_:1}),a(u,{label:"包含规格项","min-width":"250"},{default:o(({row:i})=>[_("div",we,[(k(!0),G(oe,null,re(B(i),x=>(k(),T(t,{key:x,size:"small",type:"warning",effect:"plain",class:"spec-tag"},{default:o(()=>[c(v(x),1)]),_:2},1024))),128))])]),_:1}),a(u,{label:"价格范围",width:"180",align:"center"},{default:o(({row:i})=>[c(v($(i)),1)]),_:1}),a(u,{label:"操作",width:"150",fixed:"right",align:"center"},{default:o(({row:i})=>[a(l,{link:"",type:"primary",onClick:x=>P(i)},{default:o(()=>[...e[5]||(e[5]=[c("管理规格",-1)])]),_:1},8,["onClick"]),a(l,{link:"",type:"info",onClick:x=>Q(i)},{default:o(()=>[...e[6]||(e[6]=[c("查看引用",-1)])]),_:1},8,["onClick"]),a(l,{link:"",type:"danger",onClick:x=>M(i)},{default:o(()=>[...e[7]||(e[7]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","loading"]),a(se,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=i=>m.value=i),title:y.value?`编辑规格组 #${d.value}`:"新建共享规格组",width:"900px","show-footer":!0,"confirm-text":"保存更改",loading:g.value,onConfirm:I},{default:o(()=>[_("div",xe,[a(U,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=i=>f.value=i),placeholder:"请输入共享组标签名（可选，方便记忆）"},{prepend:o(()=>[...e[8]||(e[8]=[c("标签名",-1)])]),_:1},8,["modelValue"])]),m.value?(k(),T(ue,{key:0,ref_key:"editorRef",ref:w,mode:"standalone",tag:d.value,"initial-skus":s.value,"initial-specs":b.value},null,8,["tag","initial-skus","initial-specs"])):R("",!0)]),_:1},8,["modelValue","title","loading"]),a(Ve,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=i=>p.value=i),tag:z.value,"tag-name":F.value},null,8,["modelValue","tag","tag-name"])])}}}),Wt=J(De,[["__scopeId","data-v-71f13eae"]]);export{Wt as default};
