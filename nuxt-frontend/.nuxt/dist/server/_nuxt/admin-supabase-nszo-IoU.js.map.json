{"file":"admin-supabase-nszo-IoU.js","mappings":"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","names":[],"sources":["../../../../api/admin/coupon.ts","../../../../api/admin-supabase.ts"],"sourcesContent":["/**\n * ‰ºòÊÉ†Âà∏ÁÆ°ÁêÜ API\n * ‰ªé admin-supabase.ts Áã¨Á´ãÊãÜÂàÜ\n */\n\nimport { getAdminSupabaseClient } from '@/utils/supabase-admin'\n\n// ========================================\n// Á±ªÂûãÂÆö‰πâ\n// ========================================\nexport interface AdminCoupon {\n    id: string\n    name: string\n    type: 'flat' | 'balance' | 'product'\n    value: number\n    min_usage: number\n    sku_ids: string[]\n    total_quantity: number | null\n    start_date: string | null\n    end_date: string | null\n    status: boolean\n    created_at: string\n}\n\n// ========================================\n// API ÂÆûÁé∞\n// ========================================\nexport const adminCouponApi = {\n    /**\n     * Ëé∑Âèñ‰ºòÊÉ†Âà∏ËßÑÂàôÂàóË°®\n     */\n    async getCoupons(params?: {\n        type?: string\n        status?: boolean\n        limit?: number\n        offset?: number\n    }): Promise<{ success: boolean; coupons: AdminCoupon[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        let query = client.from('coupons').select('*', { count: 'exact' })\n\n        if (params?.type) query = query.eq('type', params.type)\n        if (params?.status !== undefined) query = query.eq('status', params.status)\n\n        query = query.order('created_at', { ascending: false })\n\n        if (params?.limit) {\n            const offset = params.offset || 0\n            query = query.range(offset, offset + params.limit - 1)\n        }\n\n        const { data, error, count } = await query\n\n        if (error) return { success: false, coupons: [], total: 0, error: error.message }\n        return { success: true, coupons: data || [], total: count || 0 }\n    },\n\n    /**\n     * Ëé∑ÂèñÂçï‰∏™‰ºòÊÉ†Âà∏ËØ¶ÊÉÖ\n     */\n    async getCouponById(id: string): Promise<{ success: boolean; coupon?: AdminCoupon; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { data, error } = await client.from('coupons').select('*').eq('id', id).single()\n        if (error) return { success: false, error: error.message }\n        return { success: true, coupon: data }\n    },\n\n    /**\n     * ÂàõÂª∫‰ºòÊÉ†Âà∏ËßÑÂàô\n     */\n    async createCoupon(data: {\n        name: string\n        type: 'flat' | 'balance' | 'product'\n        value: number\n        product_ids?: string[]\n        sku_ids?: string[]\n        min_usage?: number\n        total_quantity?: number\n        start_date?: string | null\n        end_date?: string | null\n        status?: boolean\n    }): Promise<{ success: boolean; coupon?: AdminCoupon; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const payload = {\n            name: data.name,\n            type: data.type,\n            value: data.value,\n            sku_ids: data.sku_ids || data.product_ids || [],\n            min_usage: data.min_usage || 0,\n            total_quantity: data.total_quantity || null,\n            start_date: data.start_date || null,\n            end_date: data.end_date || null,\n            status: data.status !== undefined ? data.status : true,\n        }\n\n        const { data: coupon, error } = await client.from('coupons').insert(payload).select().single()\n        if (error) return { success: false, error: error.message }\n        return { success: true, coupon }\n    },\n\n    /**\n     * Êõ¥Êñ∞‰ºòÊÉ†Âà∏ËßÑÂàô\n     */\n    async updateCoupon(id: string, data: Partial<AdminCoupon>): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const payload: any = { ...data }\n        if (payload.product_ids) {\n            payload.sku_ids = payload.product_ids\n            delete payload.product_ids\n        }\n\n        const { error } = await client.from('coupons').update(payload).eq('id', id)\n        if (error) return { success: false, error: error.message }\n        return { success: true }\n    },\n\n    /**\n     * ÁîüÊàê‰ºòÊÉ†Âà∏Á†Å\n     */\n    async generateCouponCodes(\n        couponId: string,\n        quantity: number = 1,\n        mode: 'random' | 'universal' = 'random',\n        customCode?: string,\n        usageLimit?: number\n    ): Promise<{ success: boolean; count?: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const payload: any = { p_coupon_id: couponId, p_quantity: quantity, p_mode: mode }\n        if (mode === 'universal') {\n            payload.p_custom_code = customCode\n            payload.p_usage_limit = usageLimit\n        }\n\n        const { data, error } = await client.rpc('admin_generate_coupon_codes', payload)\n        if (error) return { success: false, error: error.message }\n\n        const res = data as any\n        if (res.success) return { success: true, count: res.count }\n        return { success: false, error: res.error }\n    },\n\n    /**\n     * Âà†Èô§‰ºòÊÉ†Âà∏ËßÑÂàô\n     */\n    async deleteCoupon(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { error } = await client.from('coupons').delete().eq('id', id)\n        if (error) return { success: false, error: error.message }\n        return { success: true }\n    },\n\n    /**\n     * Ëé∑ÂèñÊüê‰ºòÊÉ†Âà∏ÁöÑÂÆû‰æãÁ†ÅÂàóË°®\n     */\n    async getCouponCodes(couponId: string, params?: {\n        page?: number\n        size?: number\n        status?: string\n    }): Promise<{ success: boolean; codes: any[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const page = params?.page || 1\n        const pageSize = params?.size || 20\n        const offset = (page - 1) * pageSize\n\n        let query = client.from('coupon_codes').select('*', { count: 'exact' }).eq('coupon_id', couponId)\n        if (params?.status) query = query.eq('status', params.status)\n        query = query.order('created_at', { ascending: false }).range(offset, offset + pageSize - 1)\n\n        const { data, error, count } = await query\n        if (error) return { success: false, codes: [], total: 0, error: error.message }\n        return { success: true, codes: data || [], total: count || 0 }\n    },\n\n    /**\n     * ÂàáÊç¢Áä∂ÊÄÅ\n     */\n    async toggleStatus(id: string, status: boolean): Promise<{ success: boolean; error?: string }> {\n        return this.updateCoupon(id, { status })\n    },\n\n    /**\n     * ÊâπÈáèÂà†Èô§ÂÖëÊç¢Á†Å\n     */\n    async deleteCouponCodes(ids: string[]): Promise<{ success: boolean; count?: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { data, error } = await client.rpc('admin_delete_coupon_codes', { p_ids: ids })\n        if (error) return { success: false, error: error.message }\n\n        const res = data as any\n        if (res.success) return { success: true, count: res.count }\n        return { success: false, error: res.error }\n    },\n\n    /**\n     * Ëé∑Âèñ‰ºòÊÉ†Âà∏‰ΩøÁî®ÁªüËÆ°\n     */\n    async getCouponStats(params: {\n        page: number\n        pageSize: number\n        code?: string\n        userUid?: string\n    }): Promise<{ success: boolean; data: any[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const page = params.page\n        const pageSize = params.pageSize\n        const offset = (page - 1) * pageSize\n\n        // Êü•ËØ¢ coupon_codes Ë°®ÔºåËøáÊª§Êéâ 'available' Áä∂ÊÄÅ\n        // ÂÖ≥ËÅî coupons Ë°®Ëé∑ÂèñÂêçÂ≠óÂíåÁ±ªÂûã\n        let query = client\n            .from('coupon_codes')\n            .select(`\n                id,\n                code,\n                status,\n                used_at,\n                user_uid,\n                order_id,\n                coupon:coupons(name, type, value)\n            `, { count: 'exact' })\n            .neq('status', 'available') // ËøáÊª§ÊéâÊú™‰ΩøÁî®ÁöÑ\n\n        if (params.code) query = query.ilike('code', `%${params.code}%`)\n\n        // Â¶ÇÊûúÈúÄË¶ÅÊåâ user_uid ÊêúÁ¥¢ÔºåÂõ†‰∏∫ user_uid Âú® coupon_codes Ë°®ÈáåÊúâ (Ê†πÊçÆ‰πãÂâçÁöÑ dump)\n        if (params.userUid) {\n            query = query.eq('user_uid', params.userUid) // ÂÅáËÆæÊêúÁ¥¢Â≠òÁöÑÊòØ uid Â≠óÁ¨¶‰∏≤ÊàñËÄÖÊ†πÊçÆ id\n            // Ê†πÊçÆ dump, user_uid Á±ªÂûãÊòØ uuid, ÂèØËÉΩÊòØ user_id„ÄÇ\n            // ‰πãÂâçÁöÑ dump ÊòæÁ§∫ user_uid uuid, Êàë‰ª¨ÂÖàÂÅáËÆæÂÆÉÊòØÂèØ‰ª•Áõ¥Êé•ÊêúÁ¥¢ÁöÑÂ≠óÊÆµ„ÄÇ\n            // Â¶ÇÊûúÊòØÊ®°Á≥äÊêúÁ¥¢Ôºåuuid Â≠óÊÆµ‰∏çËÉΩÁî® ilikeÔºåÂè™ËÉΩ eq„ÄÇÊöÇÊó∂ÂÅáËÆæÊòØ eq„ÄÇ\n        }\n\n        query = query.order('used_at', { ascending: false }).range(offset, offset + pageSize - 1)\n\n        const { data, error, count } = await query\n\n        if (error) return { success: false, data: [], total: 0, error: error.message }\n\n        // Ê†ºÂºèÂåñËøîÂõûÊï∞ÊçÆ‰ª•ÂåπÈÖçÂâçÁ´ØÊúüÊúõ\n        const formattedData = (data || []).map((item: any) => ({\n            id: item.id,\n            user_uid: item.user_uid,\n            used_at: item.used_at,\n            created_at: item.created_at,\n            order_id: item.order_id,\n            code: item.code,\n            status: item.status,\n            coupon_name: item.coupon?.name,\n            coupon_type: item.coupon?.type,\n            value: item.coupon?.value\n        }))\n\n        return { success: true, data: formattedData, total: count || 0 }\n    },\n\n    /**\n     * ÊâπÈáèÂà†Èô§‰ΩøÁî®ËÆ∞ÂΩï\n     */\n    async deleteCouponUsages(ids: string[]): Promise<{ success: boolean; count?: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n        // Áõ¥Êé•Âà†Èô§ coupon_codes Ë°®ËÆ∞ÂΩï\n        const { error, count } = await client.from('coupon_codes').delete().in('id', ids)\n\n        if (error) return { success: false, error: error.message }\n        return { success: true, count: count || ids.length }\n    },\n\n    /**\n     * Êõ¥Êñ∞‰ºòÊÉ†Âà∏ËØ¥ÊòéÔºàcode Â≠óÊÆµÔºâ\n     */\n    async updateCouponCode(id: string, code: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { error } = await client.from('coupons').update({ code }).eq('id', id)\n        if (error) return { success: false, error: error.message }\n        return { success: true }\n    }\n}\n","/**\n * ÁÆ°ÁêÜÂêéÂè∞ Supabase API ÊúçÂä°\n * ‰ΩøÁî®Áã¨Á´ãÁöÑ Admin Supabase ClientÔºà‰∏éÂÆ¢Êà∑Á´ØÂÆåÂÖ®ÂàÜÁ¶ªÔºâ\n * \n * NOTE: ÈÉ®ÂàÜ API Â∑≤ÊãÜÂàÜÂà∞Áã¨Á´ãÊñá‰ª∂ÔºåÊ≠§Â§ÑÈáçÊñ∞ÂØºÂá∫‰øùÊåÅÂÖºÂÆπ\n * Êú¨Âú∞ÂÆö‰πâÁöÑ API (adminCategoryApi, adminUserApi Á≠â) ‰ªçÂú®Ê≠§Êñá‰ª∂‰∏≠\n */\n\nimport { getAdminSupabaseClient } from '@/utils/supabase-admin'\n\n// ÂØºÂÖ•Â∑≤ÊãÜÂàÜÁöÑÊ®°Âùó (For local use in adminApi object)\nimport { adminCdkApi } from './admin/cdk'\nimport { adminCouponApi } from './admin/coupon'\nimport { adminImageApi, adminImageCategoryApi, adminBannerApi, adminSettingsApi } from './admin/media'\nimport { adminFaqApi } from './admin/help-center'\nimport { adminOrderApi } from './admin/order'\n\n// ÈáçÊñ∞ÂØºÂá∫Â∑≤ÊãÜÂàÜÁöÑÊ®°Âùó (Backward Compatibility)\nexport { adminCdkApi, type AdminCDK } from './admin/cdk'\nexport { adminCouponApi, type AdminCoupon as AdminCouponNew } from './admin/coupon'\nexport { adminOrderApi, type AdminOrder, type AdminOrderDelivery } from './admin/order'\nexport { adminFaqApi } from './admin/help-center'\n\n\n// ========================================\n// ËΩÆÊí≠Âõæ‰∏éÂõæÁâáÁÆ°ÁêÜÁ±ªÂûãÂÆö‰πâ\n// ========================================\n\nexport interface AdminImage {\n    id: string\n    name: string\n    url: string\n    category_id: string | null\n    created_at: string\n    category?: AdminImageCategory\n}\n\nexport interface AdminImageCategory {\n    id: string\n    name: string\n    sort_order: number\n    created_at: string\n}\n\nexport interface AdminBanner {\n    id: string\n    image_id: string\n    title: string | null\n    link: string | null\n    sort_order: number\n    status: 'on' | 'off'\n    created_at: string\n    image?: AdminImage\n}\n\n// ========================================\n// Á±ªÂûãÂÆö‰πâ\n// ========================================\n\nexport interface AdminProduct {\n    id: string\n    product_name: string\n    status: 'on' | 'off'\n    category_id: string | null\n    image: string | null         // ÂïÜÂìÅÂ§¥Âõæ\n    sort_order: number           // ÊéíÂ∫è\n    display_price: number        // ËôöÂÅáÂ±ïÁ§∫‰ª∑Ê†º\n    tags: string[]               // ÂïÜÂìÅÊ†áÁ≠æÁªÑ\n    initial_sales: number        // ÂàùÂßãÈîÄÈáè\n    badge_label: string | null   // ËßíÊ†áÊ†áÁ≠æ (Â¶ÇÔºöÁÉ≠Âçñ„ÄÅÊñ∞ÂìÅ)\n    rating: number               // Â•ΩËØÑÂ∫¶\n    allow_addon: boolean         // ÊòØÂê¶ÊîØÊåÅÂä†Ë¥≠\n    detail_modules: any[]        // ËØ¶ÊÉÖÈ°µÂÜÖÂÆπÊ®°Âùó (JSONB)\n    created_at: string\n    stock?: number\n    category?: ProductCategory\n}\n\nexport interface ProductCategory {\n    id: string\n    name: string\n    sort_order: number\n    status: 'on' | 'off'\n    created_at: string\n    product_count?: number\n}\n\nexport interface AdminDepartment {\n    id: string\n    name: string\n    permissions: string[]\n    created_at: string\n    user_count?: number\n}\n\nexport interface AdminBackendUser {\n    id: string\n    name: string\n    email: string\n    department_id: string | null\n    status: 'enabled' | 'disabled'\n    created_at: string\n    department?: AdminDepartment\n}\n\nexport interface AdminCDK {\n    id: string\n    product_id: string\n    code: string\n    cdk_type: 'virtual' | 'shared' | 'one_time'\n    stock: number\n    max_slots: number\n    account_data: Record<string, any> | null\n    status: 'idle' | 'using' | 'used'\n    created_at: string\n    used_at: string | null\n    product?: AdminProduct\n    // ‰ªé cdk_sku_map Êò†Â∞ÑË°®Ëé∑ÂèñÁöÑ SKU ÁªëÂÆöÂÖ≥Á≥ª\n    sku_mappings?: { id: string; sku_id: string; sku?: any }[]\n}\n\nexport interface AdminOrder {\n    id: string\n    order_no: string | null\n    user_uid: string\n    product_id: string\n    sku_id: string | null\n    order_type: 'virtual' | 'shared_account' | 'one_time_cdk' // Updated values\n    purchase_mode?: 'new' | 'renew' // Optional if we kept it or for backward compat? No, DB dropped default and we reused order_type column.\n    // Actually we reused the column 'order_type' for product type.\n    // 'purchase_mode' concept is removed from DB schema.\n    related_order_id: string | null\n    total_amount: number | null // Renamed from amount_paid\n    payment_method: 'wallet' | 'alipay' | 'wechat' | null\n    start_time: string\n    end_time: string\n    status: 'pending_delivery' | 'active' | 'refunding' | 'refunded' | 'expired' // Updated\n    created_at: string\n    product?: AdminProduct\n    sku?: any\n    slot_occupancy_ids?: string[] // [Updated] ËΩ¶‰ΩçIDÊï∞ÁªÑ\n    // ‰ªé order_deliveries Ëé∑ÂèñÁöÑ‰∫§‰ªòËÆ∞ÂΩï\n    deliveries?: AdminOrderDelivery[]\n}\n\nexport interface AdminOrderDelivery {\n    id: string\n    order_id: string\n    order_no: string | null\n    product_id: string\n    sku_id: string | null\n    cdk_id: string | null\n    delivery_content: Record<string, any> | null\n    delivery_status: 'delivered' | 'released' | 'refunded' | 'failed'\n    delivered_at: string | null\n    released_at: string | null\n    created_at: string\n}\n\nexport interface AdminUser {\n    id: string\n    uid: string\n    email: string\n    status: 'active' | 'disabled'\n    created_at: string\n}\n\nexport interface AdminMessage {\n    id: string\n    user_uid: string\n    title: string\n    content: string\n    is_read: boolean\n    created_at: string\n}\n\nexport interface AdminCoupon {\n    id: string\n    code: string\n    name: string\n    type: 'flat' | 'balance' | 'product'\n    value: number\n    min_usage: number\n    product_ids: string[]\n    total_quantity: number\n    used_quantity: number\n    start_date: string | null\n    end_date: string | null\n    status: boolean\n    created_at: string\n}\n\n// ========================================\n// ÂïÜÂìÅÁÆ°ÁêÜ API\n// ========================================\n/**\n * ÂïÜÂìÅÂ≠óÊÆµÈÄªËæëËØ¥ÊòéÔºö\n * - badge_label: È¶ñÈ°µ/ÂàóË°®Â±ïÁ§∫ÁöÑËßíÊ†áÊñáÂ≠óÔºàÂ¶ÇÔºöÁÉ≠Âçñ„ÄÅÊñ∞ÂìÅÔºâ\n * - detail_modules: JSONBÊï∞ÁªÑÔºåÂ≠òÂÇ®ËØ¶ÊÉÖÈ°µÂõæÊñáÊéíÁâà„ÄÇ\n */\nexport const adminProductApi = {\n    /**\n     * Ëé∑ÂèñÂïÜÂìÅÂàóË°®ÔºàÁÆ°ÁêÜÂëòËßÜËßíÔºåÊîØÊåÅÂàÜÈ°µÂíåÊúçÂä°Á´ØÁ≠õÈÄâÔºâ\n     * @param params Á≠õÈÄâÂíåÂàÜÈ°µÂèÇÊï∞\n     */\n    async getProducts(params?: {\n        category_id?: string\n        product_type?: string\n        status?: string\n        keyword?: string\n        page?: number\n        page_size?: number\n    }): Promise<{ success: boolean; products: AdminProduct[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const page = params?.page || 1\n        const pageSize = params?.page_size || 20\n        const offset = (page - 1) * pageSize\n\n        // ÊûÑÂª∫Êü•ËØ¢ÔºàÊîØÊåÅÊúçÂä°Á´ØÁ≠õÈÄâÔºâ\n        let query = client\n            .from('products')\n            .select('*', { count: 'exact' })\n\n        if (params?.category_id) {\n            query = query.eq('category_id', params.category_id)\n        }\n        // product_type ËøáÊª§Â∑≤ÁßªÈô§ÔºàÁ±ªÂûãÁé∞Âú®Âú® SKU Á∫ßÂà´Ôºâ\n        if (params?.status) {\n            query = query.eq('status', params.status)\n        }\n        if (params?.keyword) {\n            query = query.ilike('product_name', `%${params.keyword}%`)\n        }\n\n        // ÊéíÂ∫èÂíåÂàÜÈ°µ\n        query = query\n            .order('created_at', { ascending: false })\n            .range(offset, offset + pageSize - 1)\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, products: [], total: 0, error: error.message }\n        }\n\n        const products = data || []\n        const productIds = products.map(p => p.id)\n\n        // ÊâπÈáèÊü•ËØ¢ SKU ËØ¶ÊÉÖ\n        let skuCountMap: Record<string, number> = {}\n        let skuDetailsMap: Record<string, string[]> = {}\n\n        if (productIds.length > 0) {\n            const { data: skuMapData } = await client\n                .from('product_sku_map')\n                .select('product_id, sku:product_skus (tag, tag_name, spec_combination)')\n                .in('product_id', productIds)\n\n            // ÁªüËÆ°\n            skuMapData?.forEach((item: any) => {\n                const pid = item.product_id\n                skuCountMap[pid] = (skuCountMap[pid] || 0) + 1\n\n                if (!skuDetailsMap[pid]) skuDetailsMap[pid] = []\n                const sku = item.sku\n                if (sku) {\n                    let label = ''\n                    if (sku.tag_name) label = `üîñ ${sku.tag_name}`\n                    else if (sku.spec_combination && Object.values(sku.spec_combination).length > 0) {\n                        label = Object.values(sku.spec_combination).join(' / ')\n                    } else {\n                        label = 'ÈªòËÆ§ËßÑÊ†º'\n                    }\n                    if (label && !skuDetailsMap[pid].includes(label)) {\n                        skuDetailsMap[pid].push(label)\n                    }\n                }\n            })\n        }\n\n        const productsWithSkuCount = products.map(product => ({\n            ...product,\n            sku_count: skuCountMap[product.id] || 0,\n            sku_details: skuDetailsMap[product.id] || []\n        }))\n\n        return { success: true, products: productsWithSkuCount, total: count || 0 }\n    },\n\n    /**\n     * Ëé∑ÂèñÂçï‰∏™ÂïÜÂìÅËØ¶ÊÉÖÔºàÁî®‰∫éÁºñËæëÔºâ\n     */\n    async getProductById(id: string): Promise<{ success: boolean; product?: AdminProduct; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('products')\n            .select('*, category:product_categories(id, name)')\n            .eq('id', id)\n            .single()\n\n        if (error || !data) {\n            return { success: false, error: error?.message || 'ÂïÜÂìÅ‰∏çÂ≠òÂú®' }\n        }\n\n        return { success: true, product: data }\n    },\n\n    /**\n     * ÂàõÂª∫ÂïÜÂìÅ\n     */\n    async createProduct(data: {\n        product_name: string\n        category_id?: string | null\n        image?: string | null\n        sort_order?: number\n        display_price?: number\n        tags?: string[]\n        initial_sales?: number\n        badge_label?: string | null\n        rating?: number\n        allow_addon?: boolean\n        detail_modules?: any[]\n        status?: 'on' | 'off'\n    }): Promise<{ success: boolean; product?: AdminProduct; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data: product, error } = await client\n            .from('products')\n            .insert({\n                product_name: data.product_name,\n                category_id: data.category_id,\n                image: data.image,\n                sort_order: data.sort_order || 0,\n                display_price: data.display_price || 0,\n                tags: data.tags || [],\n                initial_sales: data.initial_sales || 0,\n                badge_label: data.badge_label,\n                rating: data.rating || 100,\n                allow_addon: data.allow_addon || false,\n                detail_modules: data.detail_modules || [],\n                status: data.status || 'on',\n            })\n            .select()\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, product }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÂïÜÂìÅÔºàÊ≥®ÊÑèÔºöproduct_type ‰∏çÂèØ‰øÆÊîπÔºâ\n     */\n    async updateProduct(id: string, data: {\n        product_name?: string\n        status?: 'on' | 'off'\n        category_id?: string | null\n        image?: string | null\n        sort_order?: number\n        display_price?: number\n        tags?: string[]\n        initial_sales?: number\n        badge_label?: string | null\n        rating?: number\n        allow_addon?: boolean\n        detail_modules?: any[]\n    }): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { error } = await client\n            .from('products')\n            .update(data)\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * ÂàáÊç¢ÂïÜÂìÅÁä∂ÊÄÅ\n     */\n    async toggleStatus(id: string, status: 'on' | 'off'): Promise<{ success: boolean; error?: string }> {\n        return this.updateProduct(id, { status })\n    },\n\n    /**\n     * Âà†Èô§ÂïÜÂìÅÔºàÊîØÊåÅÊâπÈáèÔºâ\n     * Âè™Âà†Èô§ products Ë°®Âíå product_sku_map Êò†Â∞ÑÔºå‰øùÁïô product_skus\n     * @param ids ÂïÜÂìÅIDÊï∞ÁªÑ\n     */\n    async deleteProducts(ids: string[]): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // 1. ÂÖàÂà†Èô§ÂïÜÂìÅ-SKU Êò†Â∞Ñ\n        await client\n            .from('product_sku_map')\n            .delete()\n            .in('product_id', ids)\n\n        // 2. ÂÜçÂà†Èô§ÂïÜÂìÅ\n        const { error } = await client\n            .from('products')\n            .delete()\n            .in('id', ids)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    // createProductSpecs Â∑≤Â∫üÂºÉÔºåËßÑÊ†ºÁé∞Âú®Áõ¥Êé•ÂåÖÂê´Âú® product_skus ÁöÑ spec_combination ‰∏≠\n\n    /**\n     * ÂàõÂª∫ÂïÜÂìÅ SKU ÁªÑÂêà\n     * @param productId ÂïÜÂìÅID\n     * @param skus SKU Êï∞ÁªÑÔºàÊØèÊù°ÈúÄÊåáÂÆö product_typeÔºâ\n     */\n    async createProductSkus(productId: string, skus: {\n        spec_combination: Record<string, string>\n        product_type: 'virtual' | 'shared_account' | 'one_time_cdk'  // ÊØèÊù° SKU ÊåáÂÆöÁ±ªÂûã\n        image?: string\n        intro?: string\n        price: number\n        duration?: number\n        sort_order: number\n        tag?: number  // ÂèØÈÄâÁöÑÂàÜÁªÑÊ†áÁ≠æ\n    }[]): Promise<{ success: boolean; count?: number; skuIds?: string[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // 1. ÊûÑÈÄ† SKU Êï∞ÊçÆÔºà‰∏çÂê´ product_idÔºâ\n        const skuData = skus.map(sku => ({\n            product_type: sku.product_type,\n            spec_combination: sku.spec_combination,\n            image: sku.image || null,\n            intro: sku.intro || null,\n            price: sku.price,\n            duration: sku.duration || null,\n            sort_order: sku.sort_order,\n            tag: sku.tag || null\n        }))\n\n        // 2. ÊèíÂÖ• SKU\n        const { data: createdSkus, error: skuError } = await client\n            .from('product_skus')\n            .insert(skuData)\n            .select('id')\n\n        if (skuError) {\n            return { success: false, error: skuError.message }\n        }\n\n        // 3. ÂàõÂª∫ÂïÜÂìÅ-SKU Êò†Â∞Ñ\n        const mappings = (createdSkus || []).map((sku, index) => ({\n            product_id: productId,\n            sku_id: sku.id,\n            sort_order: skus[index]?.sort_order || index\n        }))\n\n        if (mappings.length > 0) {\n            const { error: mapError } = await client\n                .from('product_sku_map')\n                .insert(mappings)\n\n            if (mapError) {\n                console.error('SKU Êò†Â∞ÑÂàõÂª∫Â§±Ë¥•:', mapError)\n                return { success: true, count: createdSkus?.length || 0, skuIds: createdSkus?.map(s => s.id), error: `SKU Â∑≤ÂàõÂª∫‰ΩÜÊò†Â∞ÑÂ§±Ë¥•: ${mapError.message}` }\n            }\n        }\n\n        return { success: true, count: createdSkus?.length || 0, skuIds: createdSkus?.map(s => s.id) }\n    },\n\n    /**\n     * Êô∫ËÉΩÊõ¥Êñ∞ÂïÜÂìÅ SKUÔºàÊõ¥Êñ∞Â∑≤Êúâ„ÄÅÂà†Èô§ÁßªÈô§„ÄÅÊèíÂÖ•Êñ∞Â¢ûÔºâ\n     * @param productId ÂïÜÂìÅID\n     * @param skus SKU Êï∞ÁªÑÔºàÂê´ id ÁöÑ‰∏∫Êõ¥Êñ∞Ôºå‰∏çÂê´ÁöÑ‰∏∫Êñ∞Â¢ûÔºâ\n     */\n    /**\n     * Êõ¥Êñ∞ÂïÜÂìÅ SKU ÈÖçÁΩÆÔºàÊîØÊåÅËá™ÂÆö‰πâÊ®°ÂºèÂíåÂÖ±‰∫´Ê®°ÂºèÔºâ\n     * @param productId ÂïÜÂìÅID\n     * @param options ÈÖçÁΩÆÈÄâÈ°π\n     */\n    async updateProductSkus(productId: string, options: {\n        mode: 'custom' | 'shared'\n        skus?: {\n            id?: string\n            spec_combination: Record<string, string>\n            product_type: 'virtual' | 'shared_account' | 'one_time_cdk'\n            image?: string\n            intro?: string\n            price: number\n            duration?: number\n            sort_order: number\n        }[]\n        sharedTag?: number\n    }): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // 1. ÂÖ±‰∫´Ê®°ÂºèÔºöÁõ¥Êé•ÈáçÁΩÆÊò†Â∞ÑÂÖ≥Á≥ª\n        if (options.mode === 'shared') {\n            if (!options.sharedTag) return { success: false, error: 'Áº∫Â∞ëÂÖ±‰∫´ËßÑÊ†ºÁªÑ Tag' }\n\n            // Ëé∑ÂèñÂÖ±‰∫´ÁªÑÁöÑ SKU\n            const { data: sharedSkus, error: fetchError } = await client\n                .from('product_skus')\n                .select('id, sort_order')\n                .eq('tag', options.sharedTag)\n\n            if (fetchError) return { success: false, error: fetchError.message }\n            if (!sharedSkus || sharedSkus.length === 0) return { success: false, error: 'ËØ•ÂÖ±‰∫´ÁªÑÊ≤°Êúâ SKU' }\n\n            // ‰∫ãÂä°ÊÄßÊìç‰ΩúÔºöÂà†Èô§ÊóßÊò†Â∞Ñ -> Âª∫Á´ãÊñ∞Êò†Â∞Ñ\n            // Delete old mappings\n            const { error: delError } = await client\n                .from('product_sku_map')\n                .delete()\n                .eq('product_id', productId)\n\n            if (delError) return { success: false, error: delError.message }\n\n            // Insert new mappings\n            const mappings = sharedSkus.map(sku => ({\n                product_id: productId,\n                sku_id: sku.id,\n                sort_order: sku.sort_order\n            }))\n\n            const { error: mapError } = await client\n                .from('product_sku_map')\n                .insert(mappings)\n\n            if (mapError) return { success: false, error: mapError.message }\n\n            return { success: true }\n        }\n\n        // 2. Ëá™ÂÆö‰πâÊ®°ÂºèÔºöÊô∫ËÉΩÊõ¥Êñ∞\n        // Ëé∑ÂèñÂΩìÂâçÊò†Â∞Ñ\n        const { data: currentMappings } = await client\n            .from('product_sku_map')\n            .select('sku_id, sku:product_skus!inner(tag)')\n            .eq('product_id', productId)\n\n        const currentSkuIds = new Set((currentMappings || []).map(m => m.sku_id))\n        const newSkus = options.skus || []\n        const newSkuIds = new Set(newSkus.filter(s => s.id).map(s => s.id))\n\n        // A. Â§ÑÁêÜÈúÄË¶ÅÁßªÈô§ÁöÑ SKU\n        const toRemoveIds = [...currentSkuIds].filter(id => !newSkuIds.has(id))\n        if (toRemoveIds.length > 0) {\n            // Âà†Èô§Êò†Â∞Ñ\n            await client.from('product_sku_map')\n                .delete()\n                .eq('product_id', productId)\n                .in('sku_id', toRemoveIds)\n\n            // ÂèØÈÄâÔºöÊ∏ÖÁêÜÂ≠§ÂÑø SKU (tag ‰∏∫ null ‰∏îÊó†ÂÖ∂‰ªñÂºïÁî®ÁöÑ)\n            // ËøôÈáåÊöÇ‰∏çÂÆûÁé∞Â§çÊùÇÁöÑÂ≠§ÂÑøÊ∏ÖÁêÜÔºåÈÅøÂÖçËØØÂà†\n        }\n\n        // B. Êõ¥Êñ∞Â∑≤Êúâ SKU (‰ªÖÈôêÁßÅÊúâ SKUÔºåÂç≥ tag ‰∏∫Á©∫ÁöÑ)\n        // ÂÆûÈôÖ‰∏ä we trust the client logic: if it sends an ID, we update it.\n        // But we should verify ownership? For now simplified.\n        const toUpdate = newSkus.filter(s => s.id && currentSkuIds.has(s.id))\n        for (const sku of toUpdate) {\n            await client.from('product_skus')\n                .update({\n                    product_type: sku.product_type,\n                    spec_combination: sku.spec_combination,\n                    image: sku.image || null,\n                    intro: sku.intro || null,\n                    price: sku.price,\n                    duration: sku.duration || null,\n                    sort_order: sku.sort_order\n                })\n                .eq('id', sku.id)\n                .is('tag', null) // ‰ªÖÊõ¥Êñ∞ÁßÅÊúâ SKU\n        }\n\n        // C. ÊèíÂÖ•Êñ∞ SKU\n        const toInsert = newSkus.filter(s => !s.id)\n        if (toInsert.length > 0) {\n            const insertData = toInsert.map(sku => ({\n                product_type: sku.product_type, // Ëá™ÂÆö‰πâ SKU ÂøÖÈ°ªÊê∫Â∏¶Á±ªÂûã\n                spec_combination: sku.spec_combination,\n                image: sku.image || null,\n                intro: sku.intro || null,\n                price: sku.price,\n                duration: sku.duration || null,\n                sort_order: sku.sort_order,\n                tag: null // ÁßÅÊúâ SKU\n            }))\n\n            const { data: createdSkus, error: createError } = await client\n                .from('product_skus')\n                .insert(insertData)\n                .select('id')\n\n            if (createError) return { success: false, error: createError.message }\n\n            // Âª∫Á´ãÊò†Â∞Ñ\n            const newMappings = (createdSkus || []).map((sku, idx) => ({\n                product_id: productId,\n                sku_id: sku.id,\n                sort_order: toInsert[idx].sort_order\n            }))\n\n            if (newMappings.length > 0) {\n                await client.from('product_sku_map').insert(newMappings)\n            }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Ëé∑ÂèñÂïÜÂìÅÂÆåÊï¥Êï∞ÊçÆÔºàÂê´ËßÑÊ†ºÂíåSKUÔºâ\n     * ÈÄöËøá product_sku_map Êò†Â∞ÑË°®Êü•ËØ¢\n     * @param productId ÂïÜÂìÅID\n     */\n    async getProductWithSkus(productId: string): Promise<{\n        success: boolean\n        product?: AdminProduct\n        specs?: { name: string; values: { id: string; value: string; sort_order: number }[] }[]\n        skus?: any[]\n        error?: string\n    }> {\n        const client = getAdminSupabaseClient()\n\n        // Ëé∑ÂèñÂïÜÂìÅÂü∫Êú¨‰ø°ÊÅØ\n        const { data: product, error: productError } = await client\n            .from('products')\n            .select('*')\n            .eq('id', productId)\n            .single()\n\n        if (productError) {\n            return { success: false, error: productError.message }\n        }\n\n        // ÈÄöËøá product_sku_map Êò†Â∞ÑË°®Êü•ËØ¢ SKU\n        const { data: skuMappings, error: skuError } = await client\n            .from('product_sku_map')\n            .select('*, product_skus(*)')\n            .eq('product_id', productId)\n            .order('sort_order', { ascending: true })\n\n        console.log('[getProductWithSkus] productId:', productId)\n        console.log('[getProductWithSkus] skuMappings:', skuMappings)\n        console.log('[getProductWithSkus] skuError:', skuError)\n\n        if (skuError) {\n            console.error('SKU query error:', skuError)\n            return { success: false, error: skuError.message }\n        }\n\n        // ÊèêÂèñ SKU Êï∞ÊçÆ\n        const skus = (skuMappings || []).map(m => (m as any).product_skus).filter(Boolean)\n        console.log('[getProductWithSkus] extracted skus:', skus)\n\n        // ‰ªé SKU ‰∏≠Êé®ÂØºËßÑÊ†º\n        const specsMap = new Map<string, Set<string>>()\n\n        if (skus && skus.length > 0) {\n            skus.forEach(sku => {\n                if (sku.spec_combination) {\n                    Object.entries(sku.spec_combination).forEach(([key, value]) => {\n                        if (!specsMap.has(key)) {\n                            specsMap.set(key, new Set())\n                        }\n                        specsMap.get(key)?.add(String(value))\n                    })\n                }\n            })\n        }\n\n        const specs = Array.from(specsMap.entries()).map(([name, valuesSet]) => ({\n            id: name,\n            name,\n            sort_order: 0,\n            values: Array.from(valuesSet).map((v, i) => ({\n                id: v,\n                value: v,\n                sort_order: i\n            }))\n        }))\n\n        return { success: true, product, specs, skus: skus || [] }\n    },\n\n    /**\n     * @deprecated ËØ∑‰ΩøÁî® product_sku_map ÁÆ°ÁêÜ SKU ÂÖ≥ËÅî\n     */\n    async clearProductSpecsAndSkus(productId: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Âà†Èô§ SKU Êò†Â∞Ñ\n        const { error } = await client\n            .from('product_sku_map')\n            .delete()\n            .eq('product_id', productId)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * ÊâπÈáèËé∑Âèñ SKU ËØ¶ÊÉÖÔºàÁî®‰∫éÂõûÊòæÔºâ\n     */\n    async getSkusByIds(ids: string[]): Promise<{ success: boolean; skus?: any[]; error?: string }> {\n        if (!ids.length) return { success: true, skus: [] }\n        const client = getAdminSupabaseClient()\n\n        // Need to join product to get product Name\n        // product_skus does not have product_id directly (it's via map)\n        // BUT wait, `product_skus` table in my thought process earlier had `product_type`.\n        // `product_sku_map` connects Product -> SKU.\n        // So I need to query `product_sku_map` to get product info.\n\n        const { data, error } = await client\n            .from('product_sku_map')\n            .select(`\n                sku_id,\n                product:products(id, product_name),\n                sku:product_skus(*)\n            `)\n            .in('sku_id', ids)\n\n        if (error) return { success: false, error: error.message }\n\n        // Flatten\n        const skus = data?.map((item: any) => ({\n            ...item.sku,\n            productId: item.product?.id,\n            productName: item.product?.product_name\n        })) || []\n\n        return { success: true, skus }\n    }\n}\n\n// ========================================\n// CDK ÁÆ°ÁêÜ API\n// ========================================\n// NOTE: adminCdkApi Â∑≤ËøÅÁßªÂà∞ @/api/admin/cdk.ts\n// ‰ª•‰∏ã‰ª£Á†Å‰øùÁïô‰æõÂèÇËÄÉÔºå‰ΩÜ‰∏çÂÜçÂØºÂá∫\nconst _legacyAdminCdkApi = {\n    /**\n     * Ëé∑Âèñ CDK ÂàóË°®ÔºàÂåÖÂê´ SKU Êò†Â∞ÑÂÖ≥Á≥ªÔºâ\n     */\n    async getCdks(params?: {\n        product_id?: string\n        cdk_type?: string  // Êñ∞Â¢ûÔºöCDK Á±ªÂûãÁ≠õÈÄâ\n        status?: string\n        limit?: number\n        offset?: number\n    }): Promise<{ success: boolean; cdks: AdminCDK[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        let query = client\n            .from('cdks')\n            .select(`\n                *,\n                product:products(id, product_name),\n                sku_mappings:cdk_sku_map(id, sku_id, sku:product_skus(id, spec_combination, price)),\n                slot_occupancies(id, slot_index, status)\n            `, { count: 'exact' })\n\n        if (params?.product_id) {\n            query = query.eq('product_id', params.product_id)\n        }\n        if (params?.cdk_type) {\n            query = query.eq('cdk_type', params.cdk_type)\n        }\n        if (params?.status) {\n            query = query.eq('status', params.status)\n        }\n\n        query = query.order('created_at', { ascending: false })\n\n        if (params?.limit) {\n            const offset = params.offset || 0\n            query = query.range(offset, offset + params.limit - 1)\n        }\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, cdks: [], total: 0, error: error.message }\n        }\n\n        return { success: true, cdks: data || [], total: count || 0 }\n    },\n\n    /**\n     * ÊâπÈáèÂàõÂª∫ CDKÔºà‰ΩøÁî® cdk_sku_map Êò†Â∞ÑË°®Ôºâ\n     * @param data.sku_ids ÂÖ≥ËÅîÁöÑ SKU ID Êï∞ÁªÑ\n     * @param data.product_id ÂÖ≥ËÅîÁöÑÂïÜÂìÅ ID\n     * @param data.cdk_type CDK Á±ªÂûã\n     * @param data.codes ÊøÄÊ¥ªÁ†ÅÊï∞ÁªÑ\n     * @param data.max_slots Ë¥¶Âè∑ÂêàÁßüÁ±ªÂûãÁöÑÊúÄÂ§ßËΩ¶‰ΩçÊï∞\n     * @param data.stock ËôöÊãüÂÖÖÂÄºÁ±ªÂûãÁöÑÂ∫ìÂ≠òÊï∞Èáè\n     * @param data.account_data Ë¥¶Âè∑Êï∞ÊçÆ JSON\n     */\n    async createCdks(data: {\n        sku_ids: string[]  // Êîπ‰∏∫ sku_ids\n        product_id: string\n        cdk_type: 'virtual' | 'shared' | 'one_time'\n        codes: string[]\n        max_slots?: number\n        stock?: number\n        account_data?: Record<string, any>\n    }): Promise<{ success: boolean; count: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Virtual Á±ªÂûãÊ£ÄÊü•ÔºöÊ£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÂåπÈÖçËøô‰∫õ SKU ÁöÑ Virtual CDK\n        if (data.cdk_type === 'virtual') {\n            // Êü•ËØ¢Â∑≤ÊúâÁöÑ virtual CDK ÂèäÂÖ∂ SKU Êò†Â∞Ñ\n            const { data: existingMappings } = await client\n                .from('cdk_sku_map')\n                .select(`\n                    sku_id,\n                    cdk:cdks!inner(id, cdk_type, product_id)\n                `)\n                .in('sku_id', data.sku_ids)\n                .eq('cdk.product_id', data.product_id)\n                .eq('cdk.cdk_type', 'virtual')\n\n            if (existingMappings && existingMappings.length > 0) {\n                return {\n                    success: false,\n                    count: 0,\n                    error: 'Â≠òÂú® SKU Â∑≤ÊúâËôöÊãüÂ∫ìÂ≠òËµÑÊ∫êÔºåËØ∑Âú® CDK ÂàóË°®‰∏≠ÁºñËæëÁé∞ÊúâËµÑÊ∫ê'\n                }\n            }\n        }\n\n        let cdksToInsert: any[] = []\n\n        if (data.cdk_type === 'shared') {\n            // Shared Á±ªÂûãÔºöÊØèÊù° CDK ‰ª£Ë°®‰∏Ä‰∏™ÁúüÂÆûË¥¶Âè∑Ôºåstock ‰øùÊåÅÈªòËÆ§ 1\n            cdksToInsert = data.codes.map(code => ({\n                product_id: data.product_id,\n                code,\n                cdk_type: data.cdk_type,\n                max_slots: data.max_slots || 1,\n                stock: 1, // ÂêàÁßüÁ±ªÂûãÂ∫ìÂ≠òÁî± max_slots ÊéßÂà∂Ôºåstock Âõ∫ÂÆö‰∏∫ 1\n                account_data: data.account_data || null,\n                status: 'idle',\n            }))\n        } else if (data.cdk_type === 'virtual') {\n            // Virtual Á±ªÂûãÔºöÂè™ÂàõÂª∫ 1 Êù°\n            const virtualStock = data.stock || 1\n            cdksToInsert = [{\n                product_id: data.product_id,\n                code: data.codes[0] || `VIRTUAL-${data.product_id}-${Date.now()}`,\n                cdk_type: data.cdk_type,\n                max_slots: 1,\n                stock: virtualStock,\n                account_data: data.account_data || null,\n                status: 'idle',\n            }]\n        } else {\n            // One-time Á±ªÂûãÔºöÊØèÊù° code ‰∏ÄÊù° CDKÔºåÊØè‰∏™Âè™ËÉΩÁî®‰∏ÄÊ¨°\n            cdksToInsert = data.codes.map(code => ({\n                product_id: data.product_id,\n                code,\n                cdk_type: data.cdk_type,\n                max_slots: 1,\n                stock: 1, // ‰∏ÄÊ¨°ÊÄßÊøÄÊ¥ªÁ†Å stock Âõ∫ÂÆö‰∏∫ 1\n                account_data: data.account_data || null,\n                status: 'idle',\n            }))\n        }\n\n        // 1. ÂàõÂª∫ CDK ËÆ∞ÂΩï\n        const { data: createdCdks, error: cdkError } = await client\n            .from('cdks')\n            .insert(cdksToInsert)\n            .select('id')\n\n        if (cdkError) {\n            return { success: false, count: 0, error: cdkError.message }\n        }\n\n        // 2. ÂàõÂª∫ CDK ‚Üî SKU Êò†Â∞Ñ\n        const mappings: { cdk_id: string; sku_id: string }[] = []\n        for (const cdk of createdCdks || []) {\n            for (const skuId of data.sku_ids) {\n                mappings.push({\n                    cdk_id: cdk.id,\n                    sku_id: skuId\n                })\n            }\n        }\n\n        if (mappings.length > 0) {\n            const { error: mapError } = await client\n                .from('cdk_sku_map')\n                .insert(mappings)\n\n            if (mapError) {\n                // Êò†Â∞ÑÂ§±Ë¥•Ôºå‰ΩÜ CDK Â∑≤ÂàõÂª∫ÔºåËøîÂõûË≠¶Âëä\n                console.error('CDK SKU Êò†Â∞ÑÂàõÂª∫Â§±Ë¥•:', mapError)\n                return { success: true, count: createdCdks?.length || 0, error: `CDK Â∑≤ÂàõÂª∫‰ΩÜ SKU Êò†Â∞ÑÂ§±Ë¥•: ${mapError.message}` }\n            }\n        }\n\n        // 3. ÂêàÁßüÁ±ªÂûãÔºöÂàõÂª∫ slot_occupancies ËÆ∞ÂΩï\n        if (data.cdk_type === 'shared' && createdCdks && createdCdks.length > 0) {\n            const maxSlots = Math.min(Math.max(data.max_slots || 1, 1), 10) // ÈôêÂà∂ 1~10\n            const slotRecords: { cdk_id: string; slot_index: number; status: string }[] = []\n\n            for (const cdk of createdCdks) {\n                for (let i = 1; i <= maxSlots; i++) {\n                    slotRecords.push({\n                        cdk_id: cdk.id,\n                        slot_index: i,\n                        status: 'idle'\n                    })\n                }\n            }\n\n            if (slotRecords.length > 0) {\n                const { error: slotError } = await client\n                    .from('slot_occupancies')\n                    .insert(slotRecords)\n\n                if (slotError) {\n                    console.error('ÊßΩ‰ΩçËÆ∞ÂΩïÂàõÂª∫Â§±Ë¥•:', slotError)\n                    return { success: true, count: createdCdks?.length || 0, error: `CDK Â∑≤ÂàõÂª∫‰ΩÜÊßΩ‰ΩçÂàõÂª∫Â§±Ë¥•: ${slotError.message}` }\n                }\n            }\n        }\n\n        return { success: true, count: createdCdks?.length || 0 }\n    },\n\n    /**\n     * Âà†Èô§ CDKÔºà‰ªÖÂÖÅËÆ∏Âà†Èô§ idle Áä∂ÊÄÅÔºâ\n     */\n    async deleteCdk(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // ÂÖàÊ£ÄÊü•Áä∂ÊÄÅ\n        const { data: cdk } = await client\n            .from('cdks')\n            .select('status')\n            .eq('id', id)\n            .single()\n\n        if (cdk?.status !== 'idle') {\n            return { success: false, error: 'Âè™ËÉΩÂà†Èô§Êú™‰ΩøÁî®ÁöÑ CDK' }\n        }\n\n        // Ê£ÄÊü•ÊòØÂê¶ÊúâÂÖ≥ËÅîËÆ¢Âçï\n        const { count: orderCount } = await client\n            .from('order_deliveries')\n            .select('*', { count: 'exact', head: true })\n            .eq('cdk_id', id)\n\n        if (orderCount && orderCount > 0) {\n            return { success: false, error: `Êó†Ê≥ïÂà†Èô§ÔºöÊúâ ${orderCount} Á¨îËÆ¢ÂçïÂÖ≥ËÅîÂà∞Ê≠§ CDK` }\n        }\n\n        const { error } = await client\n            .from('cdks')\n            .delete()\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * ÊâπÈáèÂà†Èô§ CDKÔºà‰ªÖÂÖÅËÆ∏Âà†Èô§ idle Áä∂ÊÄÅÔºâ\n     */\n    async deleteCdks(ids: string[]): Promise<{ success: boolean; count: number; error?: string }> {\n        if (!ids.length) return { success: true, count: 0 }\n\n        const client = getAdminSupabaseClient()\n\n        // ÊâπÈáèÊâßË°åÂà†Èô§ÔºåÊï∞ÊçÆÂ∫ì RLS Êàñ status Ê£ÄÊü•Âª∫ËÆÆÁî±ÂêéÁ´ØÈÄªËæëÊàñ RPC Â§ÑÁêÜÔºå\n        // ËøôÈáåÈááÁî®ÁÆÄÂçïÁöÑÁõ¥Êé•Âà†Èô§Á¨¶ÂêàÊù°‰ª∂ÁöÑËÆ∞ÂΩï\n        const { data, error, count } = await client\n            .from('cdks')\n            .delete({ count: 'exact' })\n            .in('id', ids)\n            .eq('status', 'idle')\n\n        if (error) {\n            return { success: false, count: 0, error: error.message }\n        }\n\n        return { success: true, count: count || 0 }\n    },\n\n    /**\n     * CDK ‰∏äÊû∂ÔºàÊÅ¢Â§ç‰∏∫ÂèØÁî®Áä∂ÊÄÅÔºâ\n     * ‰ªÖÂÖÅËÆ∏Â∞Ü disabled Áä∂ÊÄÅÁöÑ CDK ‰∏äÊû∂\n     */\n    async enableCdk(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data: cdk } = await client\n            .from('cdks')\n            .select('status')\n            .eq('id', id)\n            .single()\n\n        if (cdk?.status !== 'disabled') {\n            return { success: false, error: 'Âè™ËÉΩ‰∏äÊû∂Â∑≤‰∏ãÊû∂ÁöÑ CDK' }\n        }\n\n        const { error } = await client\n            .from('cdks')\n            .update({ status: 'idle' })\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * CDK ‰∏ãÊû∂ÔºàÁ¶ÅÁî®Ôºâ\n     * ‰ªÖÂÖÅËÆ∏Â∞Ü idle Áä∂ÊÄÅÁöÑ CDK ‰∏ãÊû∂\n     */\n    async disableCdk(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data: cdk } = await client\n            .from('cdks')\n            .select('status')\n            .eq('id', id)\n            .single()\n\n        if (cdk?.status !== 'idle') {\n            return { success: false, error: 'Âè™ËÉΩ‰∏ãÊû∂Á©∫Èó≤Áä∂ÊÄÅÁöÑ CDK' }\n        }\n\n        const { error } = await client\n            .from('cdks')\n            .update({ status: 'disabled' })\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * ÊâπÈáè‰∏äÊû∂ CDK\n     */\n    async enableCdks(ids: string[]): Promise<{ success: boolean; count: number; error?: string }> {\n        if (!ids.length) return { success: true, count: 0 }\n\n        const client = getAdminSupabaseClient()\n\n        const { error, count } = await client\n            .from('cdks')\n            .update({ status: 'idle' })\n            .in('id', ids)\n            .eq('status', 'disabled')\n\n        if (error) {\n            return { success: false, count: 0, error: error.message }\n        }\n\n        return { success: true, count: count || 0 }\n    },\n\n    /**\n     * ÊâπÈáè‰∏ãÊû∂ CDK\n     */\n    async disableCdks(ids: string[]): Promise<{ success: boolean; count: number; error?: string }> {\n        if (!ids.length) return { success: true, count: 0 }\n\n        const client = getAdminSupabaseClient()\n\n        const { error, count } = await client\n            .from('cdks')\n            .update({ status: 'disabled' })\n            .in('id', ids)\n            .eq('status', 'idle')\n\n        if (error) {\n            return { success: false, count: 0, error: error.message }\n        }\n\n        return { success: true, count: count || 0 }\n    },\n\n    /**\n     * Ëé∑ÂèñÂçï‰∏™ CDK ËØ¶ÊÉÖÔºàÂåÖÂê´ SKU Êò†Â∞ÑÔºâ\n     */\n    async getCdkById(id: string): Promise<{ success: boolean; cdk?: AdminCDK; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('cdks')\n            .select(`\n                *,\n                product:products(id, product_name, category_id),\n                sku_mappings:cdk_sku_map(id, sku_id, sku:product_skus(id, spec_combination, price, product_type))\n            `)\n            .eq('id', id)\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, cdk: data }\n    },\n\n    /**\n     * Êõ¥Êñ∞ CDK (ÂÖÅËÆ∏‰øÆÊîπ max_slots, code, account_data, stock)\n     * Ê≥®ÊÑèÔºöSKU ÁªëÂÆöÁé∞Âú®ÈÄöËøáÊò†Â∞ÑË°®ÁÆ°ÁêÜÔºå‰∏çÂÜçÂú®Ê≠§ÂáΩÊï∞Â§ÑÁêÜ\n     */\n    async updateCdk(id: string, data: {\n        max_slots?: number\n        code?: string\n        account_data?: Record<string, any>\n        stock?: number\n    }): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Ëé∑ÂèñÂΩìÂâç CDK ‰ø°ÊÅØ\n        const { data: currentCdk } = await client\n            .from('cdks')\n            .select('cdk_type, max_slots')\n            .eq('id', id)\n            .single()\n\n        if (!currentCdk) {\n            return { success: false, error: 'CDK ‰∏çÂ≠òÂú®' }\n        }\n\n        // ÂêàÁßüÁ±ªÂûãÔºöÈ™åËØÅÂíåÁÆ°ÁêÜ max_slots\n        if (currentCdk.cdk_type === 'shared' && data.max_slots !== undefined) {\n            const newMaxSlots = Math.min(Math.max(data.max_slots, 1), 10) // ÈôêÂà∂ 1~10\n            const oldMaxSlots = currentCdk.max_slots || 1\n\n            // Ëé∑ÂèñÂ∑≤Âç†Áî®ÊßΩ‰ΩçÊï∞\n            const { count: occupiedCount } = await client\n                .from('slot_occupancies')\n                .select('*', { count: 'exact', head: true })\n                .eq('cdk_id', id)\n                .eq('status', 'occupied')\n\n            if (newMaxSlots < (occupiedCount || 0)) {\n                return { success: false, error: `‰∏çËÉΩÂáèÂ∞ëÂà∞ ${newMaxSlots}ÔºåÂΩìÂâçÂ∑≤‰ΩøÁî® ${occupiedCount} ‰∏™ËΩ¶‰Ωç` }\n            }\n\n            // Ê£ÄÊü•Áé∞ÊúâÊßΩ‰ΩçÊï∞Èáè\n            const { count: existingSlotCount } = await client\n                .from('slot_occupancies')\n                .select('*', { count: 'exact', head: true })\n                .eq('cdk_id', id)\n\n            // Â¶ÇÊûúÊ≤°Êúâ‰ªª‰ΩïÊßΩ‰ΩçÔºàÊóßÊï∞ÊçÆÔºâÔºåÂàõÂª∫ÂÖ®ÈÉ®\n            if (!existingSlotCount || existingSlotCount === 0) {\n                const allSlots: { cdk_id: string; slot_index: number; status: string }[] = []\n                for (let i = 0; i < newMaxSlots; i++) {\n                    allSlots.push({ cdk_id: id, slot_index: i, status: 'idle' })\n                }\n                if (allSlots.length > 0) {\n                    const { error: slotError } = await client.from('slot_occupancies').insert(allSlots)\n                    if (slotError) {\n                        return { success: false, error: `ÂàõÂª∫ÊßΩ‰ΩçÂ§±Ë¥•: ${slotError.message}` }\n                    }\n                }\n            }\n            // Â¶ÇÊûúÂ¢ûÂä†\n            else if (newMaxSlots > oldMaxSlots) {\n                const newSlots: { cdk_id: string; slot_index: number; status: string }[] = []\n                for (let i = oldMaxSlots; i < newMaxSlots; i++) {\n                    newSlots.push({ cdk_id: id, slot_index: i, status: 'idle' })\n                }\n                if (newSlots.length > 0) {\n                    const { error: slotError } = await client.from('slot_occupancies').insert(newSlots)\n                    if (slotError) {\n                        return { success: false, error: `Â¢ûÂä†ÊßΩ‰ΩçÂ§±Ë¥•: ${slotError.message}` }\n                    }\n                }\n            }\n\n            // Â¶ÇÊûúÂáèÂ∞ëÔºàÂè™Âà†Èô§ idle ÁöÑÔºâ\n            if (newMaxSlots < oldMaxSlots) {\n                const { error: delError } = await client\n                    .from('slot_occupancies')\n                    .delete()\n                    .eq('cdk_id', id)\n                    .gte('slot_index', newMaxSlots)\n                    .eq('status', 'idle')\n\n                if (delError) {\n                    return { success: false, error: `Âà†Èô§ÊßΩ‰ΩçÂ§±Ë¥•: ${delError.message}` }\n                }\n            }\n\n            data.max_slots = newMaxSlots\n        }\n\n        // ÊûÑÂª∫Êõ¥Êñ∞ÂØπË±°\n        const updateData: Record<string, any> = {}\n        if (data.max_slots !== undefined) updateData.max_slots = data.max_slots\n        if (data.code !== undefined) updateData.code = data.code\n        if (data.account_data !== undefined) updateData.account_data = data.account_data\n        if (data.stock !== undefined) updateData.stock = data.stock\n\n        if (Object.keys(updateData).length === 0) {\n            return { success: false, error: 'Ê≤°ÊúâÂèØÊõ¥Êñ∞ÁöÑÊï∞ÊçÆ' }\n        }\n\n        const { error } = await client\n            .from('cdks')\n            .update(updateData)\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Ëé∑Âèñ CDK ÁöÑ SKU ÁªëÂÆöÂàóË°®\n     */\n    async getCdkSkuMappings(cdkId: string): Promise<{ success: boolean; mappings: any[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('cdk_sku_map')\n            .select(`\n                id,\n                sku_id,\n                sku:product_skus(id, spec_combination, price, product_type),\n                created_at\n            `)\n            .eq('cdk_id', cdkId)\n\n        if (error) {\n            return { success: false, mappings: [], error: error.message }\n        }\n\n        return { success: true, mappings: data || [] }\n    },\n\n    /**\n     * Ê∑ªÂä† CDK ‚Üî SKU ÁªëÂÆö\n     * ÁÆÄÂåñÁâàÔºöÂÆåÂÖ®‰ø°‰ªªÂâçÁ´Ø‰º†ÂèÇÔºå‰ªÖÊ£ÄÊü•ÈáçÂ§çÂêéÁõ¥Êé•ÊèíÂÖ•\n     */\n    async addCdkSkuMapping(cdkId: string, skuId: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        console.log('[addCdkSkuMapping] params:', { cdkId, skuId })\n\n        // 1. Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®Êò†Â∞ÑÔºà‰ΩøÁî® maybeSingle ÈÅøÂÖç PGRST116 ÈîôËØØÔºâ\n        const { data: existing } = await client\n            .from('cdk_sku_map')\n            .select('id')\n            .eq('cdk_id', cdkId)\n            .eq('sku_id', skuId)\n            .maybeSingle()\n\n        if (existing) {\n            console.log('[addCdkSkuMapping] Already exists, skipping')\n            return { success: true } // ÈùôÈªòÊàêÂäüÔºåÂπÇÁ≠âÊìç‰Ωú\n        }\n\n        // 2. Áõ¥Êé•ÊèíÂÖ•\n        const { error: insertError } = await client\n            .from('cdk_sku_map')\n            .insert({ cdk_id: cdkId, sku_id: skuId })\n\n        console.log('[addCdkSkuMapping] Insert result:', { insertError })\n\n        if (insertError) {\n            return { success: false, error: insertError.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Âà†Èô§ CDK ‚Üî SKU ÁªëÂÆö\n     */\n    async removeCdkSkuMapping(mappingId: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { error } = await client\n            .from('cdk_sku_map')\n            .delete()\n            .eq('id', mappingId)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n}\n\n// ========================================\n// ËÆ¢ÂçïÁÆ°ÁêÜ API\n// ========================================\n// NOTE: adminOrderApi Â∑≤ËøÅÁßªÂà∞ @/api/admin/order.ts\n// ‰ª•‰∏ã‰ª£Á†Å‰øùÁïô‰æõÂèÇËÄÉÔºå‰ΩÜ‰∏çÂÜçÂØºÂá∫\nconst _legacyAdminOrderApi = {\n    /**\n     * Ëé∑ÂèñËÆ¢ÂçïÂàóË°®ÔºàÁÆ°ÁêÜÂëòËßÜËßíÔºâ\n     */\n    async getOrders(params?: {\n        user_uid?: string\n        order_no?: string\n        product_id?: string\n        order_type?: 'virtual' | 'shared_account' | 'one_time_cdk' // Áõ¥Êé•Êåâ order_type Á≠õÈÄâ\n        status?: 'active' | 'expired'\n        limit?: number\n        offset?: number\n    }): Promise<{ success: boolean; orders: AdminOrder[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        let query = client\n            .from('orders')\n            .select(`\n                *,\n                product:products(id, product_name, image),\n                sku:product_skus(id, spec_combination, price, product_type),\n                deliveries:order_deliveries(id, delivery_status, delivered_at, cdk_id, expires_at),\n                profile:profiles!user_id(id, uid, nickname, email)\n            `, { count: 'exact' })\n\n        // Áî®Êà∑UIDÁ≠õÈÄâ\n        if (params?.user_uid) {\n            query = query.eq('profile.uid', params.user_uid)\n        }\n        if (params?.order_no) {\n            query = query.eq('order_no', params.order_no)\n        }\n        if (params?.product_id) {\n            query = query.eq('product_id', params.product_id)\n        }\n        // Áõ¥Êé•Êåâ order_type Â≠óÊÆµËøáÊª§\n        if (params?.order_type) {\n            query = query.eq('order_type', params.order_type)\n        }\n\n        query = query.order('created_at', { ascending: false })\n\n        if (params?.limit) {\n            const offset = params.offset || 0\n            query = query.range(offset, offset + params.limit - 1)\n        }\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, orders: [], total: 0, error: error.message }\n        }\n\n        // Ê∑ªÂä†Áä∂ÊÄÅËÆ°ÁÆó\n        const now = new Date()\n        let ordersWithStatus = (data || []).map(order => {\n            const endTime = new Date(order.end_time)\n            return {\n                ...order,\n                status: endTime < now ? 'expired' : 'active',\n            }\n        })\n\n        if (params?.status) {\n            ordersWithStatus = ordersWithStatus.filter(o => o.status === params.status)\n        }\n\n        return { success: true, orders: ordersWithStatus, total: count || 0 }\n    },\n\n    /**\n     * Ëé∑ÂèñËôöÊãüÂÖÖÂÄºËÆ¢Âçï\n     */\n    async getVirtualRechargeList(params?: { page?: number; size?: number }) {\n        return this.getOrders({\n            order_type: 'virtual',\n            limit: params?.size,\n            offset: params && params.page ? (params.page - 1) * (params.size || 20) : 0\n        })\n    },\n\n    /**\n     * Ëé∑ÂèñÊãºËΩ¶ÂêàÁßüËÆ¢Âçï\n     */\n    async getShareOrderList(params?: { page?: number; size?: number }) {\n        return this.getOrders({\n            order_type: 'shared_account',\n            limit: params?.size,\n            offset: params && params.page ? (params.page - 1) * (params.size || 20) : 0\n        })\n    },\n\n    /**\n     * Ëé∑Âèñ CDK/ÊøÄÊ¥ªÁ†ÅËÆ¢Âçï\n     */\n    async getCdkOrderList(params?: { page?: number; size?: number }) {\n        return this.getOrders({\n            order_type: 'one_time_cdk',\n            limit: params?.size,\n            offset: params && params.page ? (params.page - 1) * (params.size || 20) : 0\n        })\n    },\n\n    /**\n     * Âà†Èô§ËÆ¢Âçï\n     */\n    async deleteOrder(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { error } = await client.from('orders').delete().eq('id', id)\n        if (error) return { success: false, error: error.message }\n        return { success: true }\n    },\n\n    /**\n     * ÊâπÈáèÂà†Èô§ËÆ¢Âçï\n     */\n    async deleteOrders(ids: string[]): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { error } = await client.from('orders').delete().in('id', ids)\n        if (error) return { success: false, error: error.message }\n        return { success: true }\n    },\n}\n\n// ========================================\n// Áî®Êà∑ÁÆ°ÁêÜ API\n// ========================================\nexport const adminUserApi = {\n    /**\n     * Ëé∑ÂèñÁî®Êà∑ÂàóË°®\n     */\n    async getUsers(params?: {\n        status?: 'active' | 'disabled'\n        limit?: number\n        offset?: number\n    }): Promise<{ success: boolean; users: AdminUser[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        let query = client\n            .from('profiles')\n            .select('*', { count: 'exact' })\n\n        if (params?.status) {\n            query = query.eq('status', params.status)\n        }\n\n        query = query.order('created_at', { ascending: false })\n\n        if (params?.limit) {\n            const offset = params.offset || 0\n            query = query.range(offset, offset + params.limit - 1)\n        }\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, users: [], total: 0, error: error.message }\n        }\n\n        return { success: true, users: data || [], total: count || 0 }\n    },\n\n    /**\n     * Ê†πÊçÆ UID Êü•ËØ¢Áî®Êà∑\n     */\n    async getUserByUid(uid: string): Promise<{ success: boolean; user?: AdminUser; error?: string }> {\n        const client = getAdminSupabaseClient()\n        console.log('[getUserByUid] Querying profiles for UID:', uid)\n\n        const { data, error } = await client\n            .from('profiles')\n            .select('*')\n            .eq('uid', uid)\n            .single()\n\n        if (error) {\n            console.error('[getUserByUid] Error:', error.message, error.code, error.details)\n            return { success: false, error: `Áî®Êà∑‰∏çÂ≠òÂú® (${error.code}: ${error.message})` }\n        }\n\n        console.log('[getUserByUid] Found user:', data)\n        return { success: true, user: data }\n    },\n\n    /**\n     * Á¶ÅÁî®/ÂêØÁî®Áî®Êà∑\n     */\n    async toggleStatus(id: string, status: 'active' | 'disabled'): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { error } = await client\n            .from('profiles')\n            .update({ status })\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n}\n\n// ========================================\n// Ê∂àÊÅØÁÆ°ÁêÜ API\n// ========================================\nexport const adminMessageApi = {\n    /**\n     * Ëé∑ÂèñÊ∂àÊÅØÂàóË°®\n     */\n    async getMessages(params?: {\n        user_uid?: string\n        limit?: number\n        offset?: number\n    }): Promise<{ success: boolean; messages: AdminMessage[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        let query = client\n            .from('messages')\n            .select('*', { count: 'exact' })\n\n        if (params?.user_uid) {\n            query = query.eq('user_uid', params.user_uid)\n        }\n\n        query = query.order('created_at', { ascending: false })\n\n        if (params?.limit) {\n            const offset = params.offset || 0\n            query = query.range(offset, offset + params.limit - 1)\n        }\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, messages: [], total: 0, error: error.message }\n        }\n\n        return { success: true, messages: data || [], total: count || 0 }\n    },\n\n    /**\n     * ÂèëÈÄÅÊ∂àÊÅØÔºàÂ¢ûÂº∫ÁâàÔºöÊîØÊåÅ type, link, Ëá™Âä®Ëß£Êûê user_idÔºâ\n     */\n    async sendMessage(\n        userUid: string,\n        title: string,\n        content: string,\n        type: 'system' | 'order' | 'activity' | 'security' = 'system',\n        link?: string\n    ): Promise<{\n        success: boolean\n        message_id?: string\n        error?: string\n    }> {\n        const client = getAdminSupabaseClient()\n\n        // ÂÖàÊ£ÄÊü•Áî®Êà∑ÊòØÂê¶Â≠òÂú®Âπ∂Ëé∑Âèñ user_id (UUID)\n        const { data: profile, error: profileError } = await client\n            .from('profiles')\n            .select('id, uid')\n            .eq('uid', userUid)\n            .single()\n\n        if (profileError || !profile) {\n            return { success: false, error: 'Áî®Êà∑‰∏çÂ≠òÂú®ÔºåÁ¶ÅÊ≠¢ÂèëÈÄÅÊ∂àÊÅØ' }\n        }\n\n        const { data, error } = await client\n            .from('messages')\n            .insert({\n                user_id: profile.id,  // UUID for RLS\n                user_uid: userUid,    // Keep for legacy/display\n                title,\n                content,\n                type,\n                link: link || null,\n            })\n            .select('id')\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, message_id: data.id }\n    },\n}\n\n// ========================================\n// ÂÖ±‰∫´ËßÑÊ†ºÁÆ°ÁêÜ API\n// ========================================\nexport interface SharedSkuGroup {\n    tag: number\n    tag_name?: string\n    skus: {\n        id: string\n        product_type: string\n        spec_combination: Record<string, string>\n        price: number\n        duration: number | null\n        intro: string | null\n        image: string | null\n        created_at: string\n    }[]\n}\n\nexport const adminSharedSkuApi = {\n    /**\n     * Ëé∑ÂèñÊâÄÊúâÂÖ±‰∫´ËßÑÊ†ºÁªÑÔºàÊåâ tag ÂàÜÁªÑÔºâ\n     */\n    async getSharedSkuGroups(): Promise<{ success: boolean; groups: SharedSkuGroup[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Êü•ËØ¢ÊâÄÊúâÊúâ tag ÁöÑ SKUÔºàÊú™ÂÖ≥ËÅîÂïÜÂìÅÁöÑÁã¨Á´ã SKUÔºâ\n        const { data, error } = await client\n            .from('product_skus')\n            .select('*')\n            .not('tag', 'is', null)\n            .order('tag', { ascending: true })\n            .order('sort_order', { ascending: true })\n\n        if (error) {\n            return { success: false, groups: [], error: error.message }\n        }\n\n        // Êåâ tag ÂàÜÁªÑ\n        const groupMap = new Map<number, SharedSkuGroup>()\n        for (const sku of data || []) {\n            const tag = sku.tag as number\n            if (!groupMap.has(tag)) {\n                groupMap.set(tag, {\n                    tag,\n                    tag_name: sku.tag_name || '', // ËØªÂèñ tag_name\n                    skus: []\n                })\n            }\n            groupMap.get(tag)!.skus.push(sku)\n        }\n\n        return { success: true, groups: Array.from(groupMap.values()) }\n    },\n\n    /**\n     * Ëé∑Âèñ‰∏ã‰∏Ä‰∏™ÂèØÁî®ÁöÑ tag ÁºñÂè∑\n     */\n    async getNextTag(): Promise<{ success: boolean; tag: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('product_skus')\n            .select('tag')\n            .not('tag', 'is', null)\n            .order('tag', { ascending: false })\n            .limit(1)\n\n        if (error) {\n            return { success: false, tag: 1, error: error.message }\n        }\n\n        const maxTag = data?.[0]?.tag || 0\n        return { success: true, tag: maxTag + 1 }\n    },\n\n    /**\n     * ÂàõÂª∫ÂÖ±‰∫´ËßÑÊ†ºÁªÑÔºàÂè™ÂÜô product_skus Ë°®Ôºâ\n     */\n    async createSharedSkuGroup(tag: number, skus: {\n        product_type: 'virtual' | 'shared_account' | 'one_time_cdk'\n        spec_combination: Record<string, string>\n        price: number\n        duration?: number | null\n        intro?: string\n        image?: string\n        sort_order: number\n    }[], tagName?: string): Promise<{ success: boolean; count: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const skuData = skus.map(sku => ({\n            tag,\n            tag_name: tagName || null, // ÂÜôÂÖ• tag_name\n            product_type: sku.product_type,\n            spec_combination: sku.spec_combination,\n            price: sku.price,\n            duration: sku.duration || null,\n            intro: sku.intro || null,\n            image: sku.image || null,\n            sort_order: sku.sort_order\n        }))\n\n        const { error } = await client\n            .from('product_skus')\n            .insert(skuData)\n\n        if (error) {\n            return { success: false, count: 0, error: error.message }\n        }\n\n        return { success: true, count: skuData.length }\n    },\n\n    /**\n     * Ëé∑ÂèñÊåáÂÆö tag ÁöÑËßÑÊ†ºÁªÑËØ¶ÊÉÖ\n     */\n    async getSkusByTag(tag: number): Promise<{ success: boolean; skus: any[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('product_skus')\n            .select('*')\n            .eq('tag', tag)\n            .order('sort_order', { ascending: true })\n\n        if (error) {\n            return { success: false, skus: [], error: error.message }\n        }\n\n        return { success: true, skus: data || [] }\n    },\n\n    /**\n     * Ëé∑Âèñ‰ΩøÁî®ÊüêÂÖ±‰∫´ÁªÑÁöÑÊâÄÊúâÂïÜÂìÅ (Áî®‰∫éÊü•Áúã)\n     */\n    async getProductsBySharedTag(tag: number): Promise<{ success: boolean; products?: any[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Step 1: Find all SKU IDs for this tag\n        const { data: skus } = await client\n            .from('product_skus')\n            .select('id')\n            .eq('tag', tag)\n\n        if (!skus || !skus.length) return { success: true, products: [] }\n        const skuIds = skus.map(s => s.id)\n\n        // Step 2: Find all product_ids from map\n        const { data: maps, error: mapError } = await client\n            .from('product_sku_map')\n            .select('product_id')\n            .in('sku_id', skuIds)\n\n        if (mapError) return { success: false, error: mapError.message }\n        if (!maps || !maps.length) return { success: true, products: [] }\n\n        // Deduplicate product IDs\n        const productIds = [...new Set(maps.map(m => m.product_id))]\n\n        // Step 3: Fetch products\n        const { data: products, error: prodError } = await client\n            .from('products')\n            .select('id, product_name, image, status')\n            .in('id', productIds)\n\n        if (prodError) return { success: false, error: prodError.message }\n        return { success: true, products: products || [] }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÂÖ±‰∫´ËßÑÊ†ºÁªÑÔºàÊô∫ËÉΩÊõ¥Êñ∞ÔºöÂ¢ûÂà†ÊîπÔºâ\n     */\n    async updateSharedSkuGroup(tag: number, skus: {\n        id?: string\n        product_type: 'virtual' | 'shared_account' | 'one_time_cdk'\n        spec_combination: Record<string, string>\n        price: number\n        duration?: number | null\n        intro?: string\n        image?: string\n        sort_order: number\n    }[], tagName?: string): Promise<{ success: boolean; updated: number; inserted: number; deleted: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // 1. Ëé∑ÂèñÁé∞Êúâ SKU\n        const { data: existingSkus } = await client\n            .from('product_skus')\n            .select('id')\n            .eq('tag', tag)\n\n        // 0. È¢ÑÂÖàÊü•ÊâæÂÖ≥ËÅî‰∫ÜËØ•ÂÖ±‰∫´ÁªÑÁöÑÊâÄÊúâÂïÜÂìÅ ID\n        // Áî®‰∫éÂΩìÊúâÊñ∞ SKU ÊèíÂÖ•Êó∂ÔºåËá™Âä®ÂêåÊ≠•Âª∫Á´ãÊò†Â∞Ñ\n        let linkedProductIds: string[] = []\n        const existingIdsArr = (existingSkus || []).map(s => s.id)\n\n        if (existingIdsArr.length > 0) {\n            const { data: linked } = await client\n                .from('product_sku_map')\n                .select('product_id')\n                .in('sku_id', existingIdsArr)\n\n            if (linked) {\n                // ÂéªÈáç\n                linkedProductIds = [...new Set(linked.map(l => l.product_id))]\n            }\n        }\n\n        const existingIds = new Set(existingIdsArr)\n        const keepIds = new Set(skus.filter(s => s.id).map(s => s.id))\n\n        // Âà†Èô§‰∏çÂú®Êñ∞ÂàóË°®‰∏≠ÁöÑ\n        const toDelete = [...existingIds].filter(id => !keepIds.has(id))\n        let deletedCount = 0\n        if (toDelete.length > 0) {\n            const { count } = await client\n                .from('product_skus')\n                .delete({ count: 'exact' })\n                .in('id', toDelete)\n            deletedCount = count || 0\n        }\n\n        // Êõ¥Êñ∞Â∑≤Êúâ\n        let updatedCount = 0\n        for (const sku of skus.filter(s => s.id && existingIds.has(s.id))) {\n            const { error } = await client\n                .from('product_skus')\n                .update({\n                    tag_name: tagName || null, // ÂêåÊ≠•Êõ¥Êñ∞ tag_name\n                    product_type: sku.product_type,\n                    spec_combination: sku.spec_combination,\n                    price: sku.price,\n                    duration: sku.duration || null,\n                    intro: sku.intro || null,\n                    image: sku.image || null,\n                    sort_order: sku.sort_order\n                })\n                .eq('id', sku.id)\n            if (!error) updatedCount++\n        }\n\n        // ÊèíÂÖ•Êñ∞ÁöÑÔºåÂπ∂‰º†Êí≠ÁªôÂÖ≥ËÅîÂïÜÂìÅ\n        const toInsert = skus.filter(s => !s.id)\n        let insertedCount = 0\n        if (toInsert.length > 0) {\n            const insertData = toInsert.map(sku => ({\n                tag,\n                tag_name: tagName || null, // ÂÜôÂÖ• tag_name\n                product_type: sku.product_type,\n                spec_combination: sku.spec_combination,\n                price: sku.price,\n                duration: sku.duration || null,\n                intro: sku.intro || null,\n                image: sku.image || null,\n                sort_order: sku.sort_order\n            }))\n\n            const { data: newSkus, error } = await client\n                .from('product_skus')\n                .insert(insertData)\n                .select('id, sort_order') // ÂøÖÈ°ªËøîÂõû id ‰ª•Âª∫Á´ãÊò†Â∞Ñ\n\n            if (!error && newSkus) {\n                insertedCount = newSkus.length\n\n                // Â¶ÇÊûúÊúâÂïÜÂìÅÂÖ≥ËÅî‰∫ÜÊ≠§ÂÖ±‰∫´ÁªÑÔºåËá™Âä®‰∏∫ÂÆÉ‰ª¨Ê∑ªÂä†Êñ∞ SKU ÁöÑÊò†Â∞Ñ\n                if (linkedProductIds.length > 0) {\n                    const newMappings: any[] = []\n                    for (const pid of linkedProductIds) {\n                        for (const ns of newSkus) {\n                            newMappings.push({\n                                product_id: pid,\n                                sku_id: ns.id,\n                                sort_order: ns.sort_order ?? 0\n                            })\n                        }\n                    }\n\n                    if (newMappings.length > 0) {\n                        await client.from('product_sku_map').insert(newMappings)\n                    }\n                }\n            }\n        }\n\n        return { success: true, updated: updatedCount, inserted: insertedCount, deleted: deletedCount }\n    },\n\n    /**\n     * Âà†Èô§ÂÖ±‰∫´ËßÑÊ†ºÁªÑ\n     */\n    async deleteSharedSkuGroup(tag: number): Promise<{ success: boolean; count: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Ê£ÄÊü•ÊòØÂê¶ÊúâÂïÜÂìÅÂÖ≥ËÅî\n        const { data: mappings } = await client\n            .from('product_sku_map')\n            .select('id, sku:product_skus!inner(tag)')\n            .eq('sku.tag', tag)\n            .limit(1)\n\n        if (mappings && mappings.length > 0) {\n            return { success: false, count: 0, error: 'ËØ•ËßÑÊ†ºÁªÑÂ∑≤Ë¢´ÂïÜÂìÅÂÖ≥ËÅîÔºåËØ∑ÂÖàËß£Èô§ÂÖ≥ËÅî' }\n        }\n\n        const { count, error } = await client\n            .from('product_skus')\n            .delete({ count: 'exact' })\n            .eq('tag', tag)\n\n        if (error) {\n            return { success: false, count: 0, error: error.message }\n        }\n\n        return { success: true, count: count || 0 }\n    },\n}\n\n// ========================================\n// ÂïÜÂìÅÂàÜÁ±ªÁÆ°ÁêÜ API\n// ========================================\nexport const adminCategoryApi = {\n    /**\n     * Ëé∑ÂèñÂàÜÁ±ªÂàóË°®ÔºàÂê´ÂïÜÂìÅÊï∞ÈáèÔºåÊâπÈáèÊü•ËØ¢‰ºòÂåñÔºâ\n     */\n    async getCategories(): Promise<{ success: boolean; categories: ProductCategory[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('product_categories')\n            .select('*')\n            .order('sort_order', { ascending: true })\n\n        if (error) {\n            return { success: false, categories: [], error: error.message }\n        }\n\n        const categories = data || []\n        const categoryIds = categories.map(c => c.id)\n\n        // ÊâπÈáèÊü•ËØ¢ÊØè‰∏™ÂàÜÁ±ªÁöÑÂïÜÂìÅÊï∞ÈáèÔºàÊ∂àÈô§ N+1Ôºâ\n        let countMap: Record<string, number> = {}\n        if (categoryIds.length > 0) {\n            const { data: products } = await client\n                .from('products')\n                .select('category_id')\n                .in('category_id', categoryIds)\n\n            // ÁªüËÆ°ÊØè‰∏™ÂàÜÁ±ªÁöÑÂïÜÂìÅÊï∞Èáè\n            products?.forEach(p => {\n                if (p.category_id) {\n                    countMap[p.category_id] = (countMap[p.category_id] || 0) + 1\n                }\n            })\n        }\n\n        const categoriesWithCount = categories.map(cat => ({\n            ...cat,\n            product_count: countMap[cat.id] || 0\n        }))\n\n        return { success: true, categories: categoriesWithCount }\n    },\n\n    /**\n     * ÂàõÂª∫ÂàÜÁ±ª\n     */\n    async createCategory(data: {\n        name: string\n        sort_order?: number\n        status?: 'on' | 'off'\n    }): Promise<{ success: boolean; category?: ProductCategory; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data: category, error } = await client\n            .from('product_categories')\n            .insert({\n                name: data.name,\n                sort_order: data.sort_order ?? 0,\n                status: data.status ?? 'on',\n            })\n            .select()\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, category }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÂàÜÁ±ª\n     */\n    async updateCategory(id: string, data: {\n        name?: string\n        sort_order?: number\n        status?: 'on' | 'off'\n    }): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { error } = await client\n            .from('product_categories')\n            .update(data)\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Âà†Èô§ÂàÜÁ±ªÔºàÊúâÂïÜÂìÅÊó∂Á¶ÅÊ≠¢Âà†Èô§Ôºâ\n     */\n    async deleteCategory(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Ê£ÄÊü•ÊòØÂê¶ÊúâÂïÜÂìÅ\n        const { count } = await client\n            .from('products')\n            .select('*', { count: 'exact', head: true })\n            .eq('category_id', id)\n\n        if (count && count > 0) {\n            return { success: false, error: `ËØ•ÂàÜÁ±ª‰∏ãÊúâ ${count} ‰∏™ÂïÜÂìÅÔºåËØ∑ÂÖàÁßªÈô§ÊàñÈáçÊñ∞ÂàÜÈÖç` }\n        }\n\n        const { error } = await client\n            .from('product_categories')\n            .delete()\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * ÊâπÈáèÊõ¥Êñ∞ÂàÜÁ±ªÊéíÂ∫è\n     */\n    async batchUpdateSort(items: { id: string; sort_order: number }[]): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // ‰ΩøÁî®‰∫ãÂä°ÊâπÈáèÊõ¥Êñ∞\n        for (const item of items) {\n            const { error } = await client\n                .from('product_categories')\n                .update({ sort_order: item.sort_order })\n                .eq('id', item.id)\n\n            if (error) {\n                return { success: false, error: error.message }\n            }\n        }\n\n        return { success: true }\n    },\n}\n\n// ========================================\n// ÂêéÂè∞ÈÉ®Èó®ÁÆ°ÁêÜ API\n// ========================================\nexport const adminDepartmentApi = {\n    /**\n     * Ëé∑ÂèñÈÉ®Èó®ÂàóË°®\n     */\n    async getDepartments(): Promise<{ success: boolean; departments: AdminDepartment[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('admin_departments')\n            .select('*')\n            .order('created_at', { ascending: true })\n\n        if (error) {\n            return { success: false, departments: [], error: error.message }\n        }\n\n        // Êü•ËØ¢ÊØè‰∏™ÈÉ®Èó®‰∏ãÁöÑÁî®Êà∑Êï∞Èáè\n        const departmentsWithCount = await Promise.all(\n            (data || []).map(async (dept) => {\n                const { count } = await client\n                    .from('admin_users')\n                    .select('*', { count: 'exact', head: true })\n                    .eq('department_id', dept.id)\n\n                return { ...dept, user_count: count || 0 }\n            })\n        )\n\n        return { success: true, departments: departmentsWithCount }\n    },\n\n    /**\n     * ÂàõÂª∫ÈÉ®Èó®\n     */\n    async createDepartment(data: {\n        name: string\n        permissions?: string[]\n    }): Promise<{ success: boolean; department?: AdminDepartment; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data: department, error } = await client\n            .from('admin_departments')\n            .insert({\n                name: data.name,\n                permissions: data.permissions ?? [],\n            })\n            .select()\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, department }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÈÉ®Èó®\n     */\n    async updateDepartment(id: string, data: {\n        name?: string\n        permissions?: string[]\n    }): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { error } = await client\n            .from('admin_departments')\n            .update(data)\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Âà†Èô§ÈÉ®Èó®ÔºàÊúâÁî®Êà∑Êó∂Á¶ÅÊ≠¢Âà†Èô§Ôºâ\n     */\n    async deleteDepartment(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Ê£ÄÊü•ÊòØÂê¶ÊúâÁî®Êà∑\n        const { count } = await client\n            .from('admin_users')\n            .select('*', { count: 'exact', head: true })\n            .eq('department_id', id)\n\n        if (count && count > 0) {\n            return { success: false, error: `ËØ•ÈÉ®Èó®‰∏ãÊúâ ${count} ‰∏™Áî®Êà∑ÔºåËØ∑ÂÖàÁßªÈô§ÊàñÈáçÊñ∞ÂàÜÈÖç` }\n        }\n\n        const { error } = await client\n            .from('admin_departments')\n            .delete()\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n}\n\n// ========================================\n// ÂêéÂè∞Áî®Êà∑ÁÆ°ÁêÜ API\n// ========================================\nexport const adminBackendUserApi = {\n    /**\n     * Ëé∑ÂèñÂêéÂè∞Áî®Êà∑ÂàóË°®\n     */\n    async getUsers(): Promise<{ success: boolean; users: AdminBackendUser[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client\n            .from('admin_users')\n            .select(`\n                *,\n                department:admin_departments(id, name, permissions)\n            `)\n            .order('created_at', { ascending: false })\n\n        if (error) {\n            return { success: false, users: [], error: error.message }\n        }\n\n        return { success: true, users: data || [] }\n    },\n\n    /**\n     * ÂàõÂª∫ÂêéÂè∞Áî®Êà∑\n     */\n    async createUser(data: {\n        name: string\n        email: string\n        password: string\n        department_id?: string\n        status?: 'enabled' | 'disabled'\n    }): Promise<{ success: boolean; user?: AdminBackendUser; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // ÁÆÄÂçïÁöÑÂØÜÁ†ÅÂìàÂ∏åÔºàÁîü‰∫ßÁéØÂ¢ÉÂ∫î‰ΩøÁî® bcryptÔºâ\n        const encoder = new TextEncoder()\n        const hashBuffer = await crypto.subtle.digest('SHA-256', encoder.encode(data.password))\n        const hashArray = Array.from(new Uint8Array(hashBuffer))\n        const password_hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('')\n\n        const { data: user, error } = await client\n            .from('admin_users')\n            .insert({\n                name: data.name,\n                email: data.email,\n                password_hash,\n                department_id: data.department_id ?? null,\n                status: data.status ?? 'enabled',\n            })\n            .select()\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, user }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÂêéÂè∞Áî®Êà∑\n     */\n    async updateUser(id: string, data: {\n        name?: string\n        email?: string\n        department_id?: string\n        status?: 'enabled' | 'disabled'\n    }): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { error } = await client\n            .from('admin_users')\n            .update(data)\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Âà†Èô§ÂêéÂè∞Áî®Êà∑\n     */\n    async deleteUser(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { error } = await client\n            .from('admin_users')\n            .delete()\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * ÂêéÂè∞Áî®Êà∑ÁôªÂΩï\n     */\n    async login(email: string, password: string): Promise<{\n        success: boolean\n        user?: AdminBackendUser\n        error?: string\n    }> {\n        const client = getAdminSupabaseClient()\n\n        // ËÆ°ÁÆóÂØÜÁ†ÅÂìàÂ∏å\n        const encoder = new TextEncoder()\n        const hashBuffer = await crypto.subtle.digest('SHA-256', encoder.encode(password))\n        const hashArray = Array.from(new Uint8Array(hashBuffer))\n        const password_hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('')\n\n        const { data, error } = await client\n            .from('admin_users')\n            .select(`\n                *,\n                department:admin_departments(id, name, permissions)\n            `)\n            .eq('email', email)\n            .eq('password_hash', password_hash)\n            .eq('status', 'enabled')\n            .single()\n\n        if (error || !data) {\n            return { success: false, error: 'ÈÇÆÁÆ±ÊàñÂØÜÁ†ÅÈîôËØØÔºåÊàñË¥¶Âè∑Â∑≤Á¶ÅÁî®' }\n        }\n\n        return { success: true, user: data }\n    },\n}\n\n// ========================================\n// ÂõæÁâáÂàÜÁ±ªÁÆ°ÁêÜ API\n// ========================================\n\n\n// ========================================\n// ÂõæÁâáÁÆ°ÁêÜ API\n// ========================================\n\n\n// ========================================\n// ËΩÆÊí≠ÂõæÁÆ°ÁêÜ API\n// ========================================\n\n\n// ========================================\n// Á≥ªÁªüÈÖçÁΩÆÁÆ°ÁêÜ API (R2 ÂØÜÈí•Á≠â)\n// ========================================\n\n\nexport interface AdminCoupon {\n    id: string\n    name: string\n    type: 'flat' | 'balance' | 'product'\n    value: number\n    min_usage: number\n    sku_ids: string[] // Changed from product_ids\n    total_quantity: number | null // Plan quantity, nullable\n\n    start_date: string | null\n    end_date: string | null\n    status: boolean\n    created_at: string\n}\n\n// ========================================\n// ‰ºòÊÉ†Âà∏ÁÆ°ÁêÜ API\n// ========================================\n// NOTE: adminCouponApi Â∑≤ËøÅÁßªÂà∞ @/api/admin/coupon.ts\n// ‰ª•‰∏ã‰ª£Á†Å‰øùÁïô‰æõÂèÇËÄÉÔºå‰ΩÜ‰∏çÂÜçÂØºÂá∫\nconst _legacyAdminCouponApi = {\n    /**\n     * Ëé∑Âèñ‰ºòÊÉ†Âà∏ËßÑÂàôÂàóË°®\n     */\n    async getCoupons(params?: {\n        type?: string\n        status?: boolean\n        limit?: number\n        offset?: number\n    }): Promise<{ success: boolean; coupons: AdminCoupon[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        let query = client\n            .from('coupons')\n            .select('*', { count: 'exact' })\n\n        if (params?.type) {\n            query = query.eq('type', params.type)\n        }\n        if (params?.status !== undefined) {\n            query = query.eq('status', params.status)\n        }\n\n        query = query.order('created_at', { ascending: false })\n\n        if (params?.limit) {\n            const offset = params.offset || 0\n            query = query.range(offset, offset + params.limit - 1)\n        }\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, coupons: [], total: 0, error: error.message }\n        }\n\n        return { success: true, coupons: data || [], total: count || 0 }\n    },\n\n    /**\n     * Ëé∑ÂèñÂçï‰∏™‰ºòÊÉ†Âà∏ËØ¶ÊÉÖ\n     */\n    async getCouponById(id: string): Promise<{ success: boolean; coupon?: AdminCoupon; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { data, error } = await client\n            .from('coupons')\n            .select('*')\n            .eq('id', id)\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, coupon: data }\n    },\n\n    /**\n     * ÂàõÂª∫‰ºòÊÉ†Âà∏ËßÑÂàôÔºà‰∏çÁîüÊàêÁ†ÅÔºâ\n     */\n    async createCoupon(data: {\n        name: string\n        type: 'flat' | 'balance' | 'product'\n        value: number\n        product_ids?: string[] // Compatible wrapper, but internally we map to sku_ids\n        sku_ids?: string[]\n        min_usage?: number\n        total_quantity?: number // Optional plan quantity\n        start_date?: string | null\n        end_date?: string | null\n        status?: boolean\n    }): Promise<{ success: boolean; coupon?: AdminCoupon; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const payload = {\n            name: data.name,\n            type: data.type,\n            value: data.value,\n            sku_ids: data.sku_ids || data.product_ids || [], // Map to sku_ids\n            min_usage: data.min_usage || 0,\n            total_quantity: data.total_quantity || null,\n            start_date: data.start_date || null,\n            end_date: data.end_date || null,\n            status: data.status !== undefined ? data.status : true,\n        }\n\n        const { data: coupon, error } = await client\n            .from('coupons')\n            .insert(payload)\n            .select()\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, coupon }\n    },\n\n    /**\n     * Êõ¥Êñ∞‰ºòÊÉ†Âà∏ËßÑÂàô\n     */\n    async updateCoupon(id: string, data: Partial<AdminCoupon>): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Prepare payload: map product_ids to sku_ids if legacy key used (though Typescript might block it if strict)\n        const payload: any = { ...data }\n        if (payload.product_ids) {\n            payload.sku_ids = payload.product_ids\n            delete payload.product_ids\n        }\n        // Remove keys not in DB if interface has extras\n        // (Assuming data matches DB columns)\n\n        const { error } = await client\n            .from('coupons')\n            .update(payload)\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * ÁîüÊàê‰ºòÊÉ†Âà∏Á†Å (Áªü‰∏ÄÊé•Âè£)\n     * @param couponId ‰ºòÊÉ†Âà∏ËßÑÂàôID\n     * @param quantity Êï∞Èáè (BatchÊ®°Âºè)\n     * @param mode 'random' | 'universal'\n     * @param customCode ÈÄöÁî®Á†ÅÂ≠óÁ¨¶‰∏≤ (UniversalÊ®°Âºè)\n     * @param usageLimit ÊúÄÂ§ß‰ΩøÁî®Ê¨°Êï∞ (UniversalÊ®°Âºè)\n     */\n    async generateCouponCodes(\n        couponId: string,\n        quantity: number = 1,\n        mode: 'random' | 'universal' = 'random',\n        customCode?: string,\n        usageLimit?: number\n    ): Promise<{ success: boolean; count?: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const payload: any = {\n            p_coupon_id: couponId,\n            p_quantity: quantity,\n            p_mode: mode\n        }\n\n        if (mode === 'universal') {\n            payload.p_custom_code = customCode\n            payload.p_usage_limit = usageLimit\n        }\n\n        const { data, error } = await client.rpc('admin_generate_coupon_codes', payload)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        const res = data as any\n        if (res.success) {\n            return { success: true, count: res.count }\n        } else {\n            return { success: false, error: res.error }\n        }\n    },\n\n    /**\n     * Âà†Èô§‰ºòÊÉ†Âà∏ËßÑÂàô\n     */\n    async deleteCoupon(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // Check if codes exist? DB constraint ON DELETE CASCADE will handle it, or we can warn.\n        // User asked to optimize, likely cascade delete is fine or expected.\n\n        const { error } = await client\n            .from('coupons')\n            .delete()\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n\n\n    /**\n     * Ëé∑ÂèñÊüê‰ºòÊÉ†Âà∏ÁöÑÂÆû‰æãÁ†ÅÂàóË°®\n     */\n    async getCouponCodes(couponId: string, params?: {\n        page?: number,\n        size?: number,\n        status?: string\n    }): Promise<{ success: boolean; codes: any[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const page = params?.page || 1\n        const pageSize = params?.size || 20\n        const offset = (page - 1) * pageSize\n\n        let query = client\n            .from('coupon_codes')\n            .select('*', { count: 'exact' })\n            .eq('coupon_id', couponId)\n\n        if (params?.status) {\n            query = query.eq('status', params.status)\n        }\n\n        query = query\n            .order('created_at', { ascending: false })\n            .range(offset, offset + pageSize - 1)\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, codes: [], total: 0, error: error.message }\n        }\n\n        return { success: true, codes: data || [], total: count || 0 }\n    },\n\n    /**\n     * ÂàáÊç¢Áä∂ÊÄÅ\n     */\n    async toggleStatus(id: string, status: boolean): Promise<{ success: boolean; error?: string }> {\n        return this.updateCoupon(id, { status })\n    },\n\n    /**\n     * ÊâπÈáèÂà†Èô§ÂÖëÊç¢Á†Å\n     */\n    async deleteCouponCodes(ids: string[]): Promise<{ success: boolean; count?: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client.rpc('admin_delete_coupon_codes', {\n            p_ids: ids\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        const res = data as any\n        if (res.success) {\n            return { success: true, count: res.count }\n        } else {\n            return { success: false, error: res.error }\n        }\n    },\n\n    /**\n     * Get used coupon statistics (Usage Log)\n     */\n    async getCouponStats(params: {\n        page: number\n        pageSize: number\n        code?: string\n        userUid?: string\n    }): Promise<{ success: boolean; data: any[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client.rpc('admin_get_coupon_stats', {\n            p_page: params.page,\n            p_page_size: params.pageSize,\n            p_code: params.code || null,\n            p_user_uid: params.userUid || null\n        })\n\n        if (error) {\n            return { success: false, data: [], total: 0, error: error.message }\n        }\n\n        const res = data as any\n        if (res.success) {\n            return { success: true, data: res.data, total: res.total }\n        } else {\n            return { success: false, data: [], total: 0, error: res.error }\n        }\n    },\n\n    /**\n     * Batch delete coupon usage logs\n     */\n    async deleteCouponUsages(ids: string[]): Promise<{ success: boolean; count?: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const { data, error } = await client.rpc('admin_delete_coupon_usages', {\n            p_ids: ids\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        const res = data as any\n        if (res.success) {\n            return { success: true, count: res.count }\n        } else {\n            return { success: false, error: res.error }\n        }\n    }\n}\n\n// ========================================\n// ÂÖÖÂÄºÊ°£‰ΩçÁÆ°ÁêÜ API\n// ========================================\n\nexport interface RechargeTier {\n    id: string\n    amount: number\n    bonus: number\n    sort_order: number\n    status: 'on' | 'off'\n    created_at: string\n}\n\nexport const adminRechargeApi = {\n    /**\n     * Ëé∑ÂèñÊâÄÊúâÂÖÖÂÄºÊ°£‰Ωç\n     */\n    async getTiers(): Promise<{ success: boolean; data: RechargeTier[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { data, error } = await client\n            .from('recharge_tiers')\n            .select('*')\n            .order('sort_order', { ascending: true })\n\n        if (error) {\n            return { success: false, data: [], error: error.message }\n        }\n\n        return { success: true, data: data || [] }\n    },\n\n    /**\n     * ÂàõÂª∫ÂÖÖÂÄºÊ°£‰Ωç\n     */\n    async createTier(tierData: {\n        amount: number\n        bonus: number\n        sort_order: number\n        status: 'on' | 'off'\n    }): Promise<{ success: boolean; data?: RechargeTier; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { data, error } = await client\n            .from('recharge_tiers')\n            .insert(tierData)\n            .select()\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, data }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÂÖÖÂÄºÊ°£‰Ωç\n     */\n    async updateTier(id: string, tierData: Partial<{\n        amount: number\n        bonus: number\n        sort_order: number\n        status: 'on' | 'off'\n    }>): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { error } = await client\n            .from('recharge_tiers')\n            .update(tierData)\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Âà†Èô§ÂÖÖÂÄºÊ°£‰Ωç\n     */\n    async deleteTier(id: string): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { error } = await client\n            .from('recharge_tiers')\n            .delete()\n            .eq('id', id)\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    },\n\n}\n\n// ÂØºÂá∫ÊâÄÊúâÁÆ°ÁêÜ API\nexport const adminApi = {\n    product: adminProductApi,\n    cdk: adminCdkApi,\n    order: adminOrderApi,\n    user: adminUserApi,\n    message: adminMessageApi,\n    category: adminCategoryApi,\n    department: adminDepartmentApi,\n    backendUser: adminBackendUserApi,\n    image: adminImageApi,\n    banner: adminBannerApi,\n    imageCategory: adminImageCategoryApi,\n    settings: adminSettingsApi,\n    coupon: adminCouponApi,\n    recharge: adminRechargeApi,\n}\n\nexport default adminApi\n\n// ========================================\n// Â∏∏ËßÅÈóÆÈ¢ò (FAQ) ÁÆ°ÁêÜ API\n// ========================================\n\nexport interface AdminFaqCategory {\n    id: string\n    name: string\n    sort_order: number\n    is_active: boolean\n    created_at: string\n}\n\nexport interface AdminFaq {\n    id: string\n    category_id: string | null\n    question: string\n    answer: string\n    product_id: string | null\n    sort_order: number\n    is_active: boolean\n    created_at: string\n    category?: AdminFaqCategory\n    product?: AdminProduct\n}\n\n\n\n// ========================================\n// SKU ÂÖ®Â±ÄÁÆ°ÁêÜ API\n// ========================================\nexport const adminGlobalSkuApi = {\n    /**\n     * Ëé∑ÂèñÊâÄÊúâ SKU (ÂÖ®Â±ÄÁÆ°ÁêÜ)\n     */\n    async getAllSkus(params?: { showUnlinkedOnly?: boolean }): Promise<{ success: boolean; skus: any[]; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const query = client\n            .from('product_skus')\n            .select(`\n                *,\n                product_sku_map (\n                    product:products (id, product_name)\n                )\n            `)\n            .is('tag', null) // Filter out shared SKUs (they are managed in Shared SKU Groups)\n            .order('created_at', { ascending: false })\n\n        const { data, error } = await query\n        if (error) return { success: false, skus: [], error: error.message }\n\n        // Transform and filter in memory\n        let result = data.map((s: any) => {\n            const products = s.product_sku_map?.map((m: any) => m.product).filter((p: any) => p) || []\n            return {\n                ...s,\n                linked_products: products,\n                product_names: products.map((p: any) => p.product_name).join(', '),\n                is_linked: products.length > 0\n            }\n        })\n\n        if (params?.showUnlinkedOnly) {\n            result = result.filter(s => !s.is_linked)\n        }\n\n        return { success: true, skus: result }\n    },\n\n    /**\n     * ÊâπÈáèÂà†Èô§ SKU\n     * ‰ºöÂêåÊó∂Âà†Èô§ CDK-SKU Êò†Â∞ÑË°®‰∏≠ÁöÑÂÖ≥ËÅîËÆ∞ÂΩï\n     */\n    async deleteSkus(ids: string[]): Promise<{ success: boolean; error?: string }> {\n        if (!ids.length) return { success: true }\n\n        const client = getAdminSupabaseClient()\n\n        // 1. ÂÖàÂà†Èô§ CDK-SKU Êò†Â∞Ñ\n        await client\n            .from('cdk_sku_map')\n            .delete()\n            .in('sku_id', ids)\n\n        // 2. ÂÜçÂà†Èô§ SKU\n        const { error } = await client\n            .from('product_skus')\n            .delete()\n            .in('id', ids)\n\n        return { success: !error, error: error?.message }\n    }\n}\n"],"version":3}