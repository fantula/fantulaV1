{"version":3,"file":"favorites-CPIQFUaX.js","sources":["../../../../pages/profile/favorites.vue"],"sourcesContent":["<template>\n  <div class=\"favorites-section\">\n    <!-- Header (Same as Exchange) -->\n    <div class=\"section-header\">\n      <h2 class=\"section-title\">我的收藏</h2>\n      <div class=\"section-subtitle\">My Collection</div>\n    </div>\n\n    <!-- Tabs (Scrollable) -->\n    <div class=\"favorites-tabs\">\n      <div \n        v-for=\"cat in categories\" \n        :key=\"cat.id\"\n        class=\"tab-item\"\n        :class=\"{ active: activeTab === cat.id }\"\n        @click=\"activeTab = cat.id\"\n      >\n        {{ cat.name }}\n        <div class=\"active-indicator\" v-if=\"activeTab === cat.id\"></div>\n      </div>\n    </div>\n\n    <!-- Scrollable Content Area -->\n    <div class=\"favorites-list-container\">\n      <!-- Loading -->\n      <div v-if=\"loading\" class=\"loading-grid\">\n        <el-skeleton animated class=\"skeleton-item\" v-for=\"i in 6\" :key=\"i\">\n          <template #template>\n            <el-skeleton-item variant=\"image\" class=\"skeleton-img\" />\n            <div style=\"padding: 14px\">\n              <el-skeleton-item variant=\"h3\" style=\"width: 50%\" />\n              <div style=\"margin-top: 10px\"><el-skeleton-item variant=\"text\" style=\"width: 30%\" /></div>\n            </div>\n          </template>\n        </el-skeleton>\n      </div>\n\n      <!-- Empty State -->\n      <div v-else-if=\"filteredFavorites.length === 0\" class=\"empty-state\">\n        <el-icon class=\"empty-icon\"><StarFilled /></el-icon>\n        <div class=\"empty-text\">暂无收藏商品</div>\n        <div class=\"empty-desc\">去探索更多好物，填满您的收藏夹吧</div>\n        <button class=\"go-shopping-btn\" @click=\"goShopping\">\n          前往商城\n          <el-icon><Right /></el-icon>\n        </button>\n      </div>\n\n      <!-- List Grid -->\n      <div v-else class=\"favorites-grid\">\n        <transition-group name=\"list\">\n          <div \n            v-for=\"item in filteredFavorites\" \n            :key=\"item.id\" \n            class=\"favorite-card\"\n            @click=\"goToProduct(item.productId)\"\n          >\n            <!-- Image Area (Homepage Style) -->\n            <div class=\"card-image-container\">\n              <img :src=\"item.productImage\" :alt=\"item.productName\" class=\"product-img\" />\n            </div>\n\n            <!-- Content Area -->\n            <div class=\"card-content\">\n              <h3 class=\"product-title\">{{ item.productName }}</h3>\n              \n              <!-- Specs -->\n              <div class=\"spec-row\" v-if=\"item.specName\">\n                <el-icon class=\"spec-icon\"><Operation /></el-icon>\n                <span class=\"spec-text\">{{ item.specName }}</span>\n              </div>\n              \n              <!-- Price -->\n              <div class=\"price-row\">\n                <span class=\"amount\">{{ Number(item.price).toFixed(2) }}</span>\n                <span class=\"unit\">点</span>\n              </div>\n\n              <!-- Actions -->\n              <div class=\"card-actions\">\n                <button class=\"action-btn cancel-btn\" @click.stop=\"removeFavorite(item.id)\">\n                  取消收藏\n                </button>\n                <button class=\"action-btn buy-btn\" @click.stop=\"buyNow(item)\" :disabled=\"submitting\">\n                  {{ submitting ? '处理中...' : '立即购买' }}\n                </button>\n              </div>\n            </div>\n          </div>\n        </transition-group>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * 收藏页面\n * 重构版 - 使用 clientOrderApi\n */\nimport { ref, onMounted, computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { favoriteApi } from '@/api/common'\nimport { clientOrderApi } from '@/api/client'\nimport { useUserStore } from '@/stores/user'\nimport { useModalStore } from '@/stores/modal'\nimport { ElMessage } from 'element-plus'\nimport { StarFilled, Right, Operation } from '@element-plus/icons-vue'\n\nconst router = useRouter()\nconst userStore = useUserStore()\nconst modal = useModalStore()\n\nconst loading = ref(true)\nconst submitting = ref(false)\nconst categories = ref<any[]>([])\nconst favorites = ref<any[]>([])\nconst activeTab = ref('all')\n\nconst fetchFavorites = async () => {\n  loading.value = true\n  try {\n    const res = await favoriteApi.getFavoritesData()\n    if (res.success && res.data) {\n      categories.value = res.data.categories\n      favorites.value = res.data.favorites\n    }\n  } finally {\n    loading.value = false\n  }\n}\n\nonMounted(fetchFavorites)\n\nconst filteredFavorites = computed(() => {\n  if (activeTab.value === 'all') return favorites.value\n  return favorites.value.filter(item => item.categoryId === activeTab.value)\n})\n\nconst goToProduct = (id: string) => {\n  router.push(`/goods/${id}`)\n}\n\nconst removeFavorite = async (favoriteId: string) => {\n  const res = await favoriteApi.removeFavorite(favoriteId)\n  if (res.success) {\n    favorites.value = favorites.value.filter(item => item.id !== favoriteId)\n    ElMessage.success('已取消收藏')\n  }\n}\n\nconst buyNow = async (item: any) => {\n  if (!userStore.isLoggedIn) {\n    modal.showLogin = true\n    return\n  }\n  if (!item.skuId) {\n    ElMessage.warning('请先选择商品规格')\n    router.push(`/goods/${item.productId}`)\n    return\n  }\n  \n  if (submitting.value) return\n  submitting.value = true\n  \n  try {\n    const result = await clientOrderApi.createPreOrder(\n      item.skuId,\n      1,\n      'buy_now'\n    )\n    \n    if (!result.success) {\n      if (result.error?.includes('DUPLICATE_ORDER') || result.error?.includes('未支付')) {\n        ElMessage.warning('您已经下过该商品的订单了')\n        router.push('/profile/orders?tab=待支付')\n        return\n      }\n      ElMessage.error(result.error || '创建订单失败')\n      return\n    }\n    router.push(`/checkout/${result.preOrderId}`)\n  } catch (e) {\n    ElMessage.error('创建订单失败')\n  } finally {\n    submitting.value = false\n  }\n}\n\nconst goShopping = () => {\n  router.push('/')\n}\n</script>\n\n<style scoped>\n/* Main Layout - Same as Exchange */\n.favorites-section {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  padding: 0;\n  overflow: hidden; /* Important */\n}\n\n/* Header */\n.section-header {\n  flex-shrink: 0;\n  display: flex;\n  align-items: baseline;\n  gap: 12px;\n  padding: 24px 32px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  color: #fff;\n  margin: 0;\n}\n\n.section-subtitle {\n  font-size: 12px;\n  font-family: 'Outfit', sans-serif;\n  color: #64748B;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n/* Tabs */\n.favorites-tabs {\n  flex-shrink: 0;\n  display: flex;\n  gap: 32px;\n  padding: 0 32px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n  overflow-x: auto;\n  scrollbar-width: none;\n}\n.favorites-tabs::-webkit-scrollbar { display: none; }\n\n.tab-item {\n  padding: 16px 0;\n  color: #94A3B8;\n  cursor: pointer;\n  font-size: 16px; /* Increased from 14px */\n  font-weight: 500;\n  position: relative;\n  transition: all 0.3s;\n  white-space: nowrap;\n}\n\n.tab-item:hover { color: #CBD5E1; }\n.tab-item.active { color: #fff; font-weight: 600; }\n\n.active-indicator {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 2px;\n  background: #3B82F6;\n  box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);\n  border-radius: 2px;\n}\n\n/* Content Container */\n.favorites-list-container {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px 32px 64px 32px;\n  min-height: 0;\n}\n\n/* Grid - Slightly more compact */\n.favorites-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); /* Reduced from 240px */\n  gap: 20px; /* Reduced gap */\n}\n\n/* --- Card Design (Refined V4) --- */\n.favorite-card {\n  background: rgba(30, 41, 59, 0.4);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid rgba(255, 255, 255, 0.05);\n  border-radius: 16px; /* Slightly reduced radius for compact feel */\n  overflow: hidden;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  display: flex;\n  flex-direction: column;\n  cursor: pointer;\n}\n\n.favorite-card:hover {\n  transform: translateY(-4px);\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(255, 255, 255, 0.1);\n  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);\n}\n\n/* Image Container (Dark + Highlight) */\n.card-image-container {\n  position: relative;\n  width: 100%;\n  padding-top: 80%;\n  /* Changed from white radial gradient to dark glass subtle gradient */\n  background: radial-gradient(circle at center, rgba(255, 255, 255, 0.05) 0%, rgba(0, 0, 0, 0.1) 100%);\n  overflow: hidden;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.03);\n}\n\n.product-img {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: auto;\n  height: 65%; /* Increased slightly from 60% to keep it prominent in smaller card */\n  aspect-ratio: 1 / 1;\n  border-radius: 12px;\n  border: 2px solid #3B82F6;\n  box-sizing: border-box;\n  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3)); /* Darker shadow for dark bg */\n  transition: transform 0.6s cubic-bezier(0.2, 0, 0.2, 1);\n}\n\n.favorite-card:hover .product-img {\n  transform: translate(-50%, -50%) scale(1.1) rotate(3deg);\n  border-color: #F97316;\n}\n\n/* Content */\n.card-content {\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  gap: 8px;\n}\n\n.product-title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #F1F5F9;\n  margin: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.spec-row {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n}\n.spec-icon { font-size: 12px; color: #64748B; }\n.spec-text { font-size: 12px; color: #94A3B8; }\n\n.price-row {\n  margin-top: 4px;\n  display: flex;\n  align-items: baseline;\n  gap: 2px;\n}\n.amount {\n  font-size: 20px;\n  font-weight: 700;\n  color: #FB923C;\n  font-family: 'DIN Alternate', sans-serif;\n}\n.unit { font-size: 12px; color: #fff; opacity: 0.8; }\n\n/* Buttons */\n.card-actions {\n  margin-top: auto;\n  display: flex;\n  gap: 8px;\n  padding-top: 12px;\n}\n\n.action-btn {\n  flex: 1;\n  padding: 8px 0; /* Slimmer */\n  border-radius: 100px; /* Pill Shape */\n  font-size: 12px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n  border: 1px solid transparent;\n}\n\n.cancel-btn {\n  background: transparent;\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94A3B8;\n}\n.cancel-btn:hover {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n  color: #EF4444;\n}\n\n.buy-btn {\n  background: linear-gradient(135deg, #3B82F6, #2563EB); /* Blue Gradient */\n  color: #fff;\n  border: none;\n  box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);\n}\n.buy-btn:hover {\n  background: linear-gradient(135deg, #F97316, #EA580C); /* Orange Gradient */\n  transform: translateY(-1px);\n  box-shadow: 0 6px 15px rgba(249, 115, 22, 0.4);\n}\n.buy-btn:disabled { opacity: 0.6; cursor: not-allowed; }\n\n/* Responsive */\n@media (max-width: 1400px) { .favorites-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); } }\n@media (max-width: 768px) { .favorites-grid { grid-template-columns: repeat(2, 1fr); } }\n\n/* Empty/Loading */\n.loading-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 24px; }\n.skeleton-item { background: rgba(255, 255, 255, 0.02) !important; border-radius: 20px; overflow: hidden; }\n.skeleton-img { width: 100%; padding-top: 80%; }\n\n.empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 0; }\n.empty-icon { font-size: 48px; color: #475569; margin-bottom: 16px; }\n.empty-text { font-size: 16px; font-weight: 600; color: #CBD5E1; margin-bottom: 8px; }\n.empty-desc { font-size: 13px; color: #64748B; margin-bottom: 24px; }\n.go-shopping-btn { display: flex; align-items: center; gap: 8px; padding: 10px 24px; background: linear-gradient(135deg, #3B82F6, #2563EB); border: none; border-radius: 100px; color: #fff; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }\n\n.list-move, .list-enter-active, .list-leave-active { transition: all 0.5s ease; }\n.list-enter-from, .list-leave-to { opacity: 0; transform: scale(0.9); }\n.list-leave-active { position: absolute; }\n</style>"],"names":["favorites","_ssrRenderAttrs","_mergeProps","_ssrRenderList","_createVNode","_ssrRenderComponent","_withCtx","_ssrInterpolate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6GA,cAAA;AACA,iBAAA;AACA,kBAAA;AAEA,UAAA,UAAA,IAAA,IAAA;AACA,UAAA,aAAA,IAAA,KAAA;AACA,UAAA,aAAA,IAAA,EAAA;AACA,UAAAA,aAAA,IAAA,EAAA;AACA,UAAA,YAAA,IAAA,KAAA;AAiBA,UAAA,oBAAA,SAAA,MAAA;AACE,UAAA,UAAA,UAAA,MAAA,QAAAA,WAAA;AACA,aAAAA,WAAA,MAAA,OAAA,CAAA,SAAA,KAAA,eAAA,UAAA,KAAA;AAAA,IAAyE,CAAA;;;;;AAvIpE,YAAA,OAAAC,eAAAC,WAAA,EAAA,OAAA,uBAAA,MAAA,CAAA,CAAA,6OAAA;AAUeC,oBAAA,WAAA,OAAA,CAAA,QAAA;;;;;;;;;;;;AAe0CA,sBAAA,GAAA,CAAA,MAAA;;;YAA3C,OAAA;AAAA,YAAe,KAAA;AAAA,UAAqC,GAAA;AAAA;;;;kBAEnC,OAAA;AAAA,gBAAc,GAAA,MAAA,UAAA,QAAA,CAAA;;;;kBAEZ,OAAA,EAAA,SAAA,MAAA;AAAA,gBAAK,GAAA,MAAA,UAAA,QAAA,CAAA;;;;kBACyB,OAAA,EAAA,SAAA,MAAA;AAAA,gBAAO,GAAA,MAAA,UAAA,QAAA,CAAA;;;;;oBAHR,SAAA;AAAA,oBAA/B,OAAA;AAAA,kBAAc,CAAA;AAAA;oBACdC,YAAA,6BAAA;AAAA,sBAC4B,SAAA;AAAA,sBAA1B,OAAA,EAAA,SAAA,MAAA;AAAA,oBAAK,CAAA;AAAA;sBACFA,YAAA,6BAAA;AAAA,wBAAuD,SAAA;AAAA,wBAA5B,OAAA,EAAA,SAAA,MAAA;AAAA,sBAAO,CAAA;AAAA;;;;;;;;;;;AAQ5D,cAAAC,mBAAA,oBAAA,EAAA,OAAA,aAAA,GAAA;AAAA,UAAkB,SAAAC,QAAA,CAAA,GAAA,QAAA,UAAA,aAAA;;;;;;cAAe;AAAA;;;;;;;;;;;;cAKtB;AAAA;;;;;;;AAQDH,sBAAA,kBAAA,OAAA,CAAA,SAAA;;AAee,cAAA,KAAA,UAAA;;AACjB,kBAAAE,mBAAA,oBAAA,EAAA,OAAA,YAAA,GAAA;AAAA,cAAiB,SAAAC,QAAA,CAAA,GAAA,QAAA,UAAA,aAAA;;;;;;kBAAc;AAAA;;;;AACb,kBAAA,2CAAAC,eAAA,KAAA,QAAA,CAAA,eAAA;AAAA,UAAa,OAAA;;;;;;;;;;;;;;;;;;"}