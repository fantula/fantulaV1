{"version":3,"file":"index-BxbV-7sZ.js","sources":["../../../../pages/_mgmt_9Xfa3/article/index.vue"],"sourcesContent":["<template>\n  <div class=\"admin-page\">\n    <div class=\"page-header\">\n      <h2 class=\"page-title\">社区文章管理</h2>\n      <el-button type=\"primary\" @click=\"router.push('/_mgmt_9Xfa3/article/post')\">\n        <el-icon class=\"mr-1\"><Plus /></el-icon> 发布文章\n      </el-button>\n    </div>\n\n    <div class=\"filter-section\">\n      <!-- 可以在这里添加筛选功能 -->\n    </div>\n\n    <div class=\"table-container\" v-loading=\"loading\">\n      <el-table :data=\"articles\" border style=\"width: 100%\">\n        <el-table-column prop=\"id\" label=\"ID\" width=\"180\" show-overflow-tooltip />\n        <el-table-column label=\"封面\" width=\"100\">\n          <template #default=\"{ row }\">\n            <el-image \n              style=\"width: 60px; height: 40px; border-radius: 4px\" \n              :src=\"row.cover_image\" \n              :preview-src-list=\"[row.cover_image]\"\n              fit=\"cover\"\n            />\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"title\" label=\"标题\" min-width=\"200\" show-overflow-tooltip />\n        <el-table-column prop=\"category\" label=\"分类\" width=\"140\">\n          <template #default=\"{ row }\">\n            <el-tag :style=\"{ borderColor: getCategoryColor(row.category), color: getCategoryColor(row.category), backgroundColor: 'transparent' }\" effect=\"plain\">\n              {{ getCategoryLabel(row.category) }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"views\" label=\"阅读量\" width=\"100\" />\n        <el-table-column label=\"状态\" width=\"100\">\n          <template #default=\"{ row }\">\n            <el-tag :type=\"row.is_published ? 'success' : 'info'\">\n              {{ row.is_published ? '已发布' : '草稿' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"created_at\" label=\"创建时间\" width=\"180\">\n          <template #default=\"{ row }\">\n            {{ formatDate(row.created_at) }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\n          <template #default=\"{ row }\">\n            <el-button link type=\"primary\" @click=\"handleEdit(row)\">编辑</el-button>\n            <el-button link type=\"success\" @click=\"handleTogglePublish(row)\">\n              {{ row.is_published ? '下架' : '发布' }}\n            </el-button>\n            <el-button link type=\"danger\" @click=\"handleDelete(row)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <div class=\"pagination-container\">\n        <el-pagination\n          v-model:current-page=\"currentPage\"\n          v-model:page-size=\"pageSize\"\n          :total=\"total\"\n          :page-sizes=\"[10, 20, 50]\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          @size-change=\"fetchArticles\"\n          @current-change=\"fetchArticles\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { adminCommunityApi, type Category } from '@/api/community'\nimport { Plus } from '@element-plus/icons-vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\n\nconst router = useRouter()\nconst loading = ref(false)\nconst articles = ref([])\nconst total = ref(0)\nconst currentPage = ref(1)\nconst pageSize = ref(20)\nconst categories = ref<Category[]>([])\n\nconst formatDate = (date: string) => {\n  return new Date(date).toLocaleString()\n}\n\nconst getCategoryLabel = (id: string) => {\n  const cat = categories.value.find(c => c.id === id)\n  return cat ? cat.name : (id || '未分类')\n}\n\nconst getCategoryColor = (id: string) => {\n  const cat = categories.value.find(c => c.id === id)\n  return cat ? cat.color : 'var(--el-text-color-secondary)'\n}\n\nconst fetchCategories = async () => {\n  try {\n    const { data } = await adminCommunityApi.getCategories()\n    categories.value = data || []\n  } catch (error) {\n    console.error('Failed to fetch categories', error)\n  }\n}\n\nconst fetchArticles = async () => {\n  loading.value = true\n  try {\n    const { data, total: count, error } = await adminCommunityApi.getArticles(currentPage.value, pageSize.value)\n    if (error) throw error\n    articles.value = data || []\n    total.value = count || 0\n  } catch (error: any) {\n    ElMessage.error('获取列表失败: ' + error.message)\n  } finally {\n    loading.value = false\n  }\n}\n\nconst handleEdit = (row: any) => {\n  router.push({\n    path: '/_mgmt_9Xfa3/article/post',\n    query: { id: row.id }\n  })\n}\n\nconst handleTogglePublish = async (row: any) => {\n  const newState = !row.is_published\n  try {\n    const { error } = await adminCommunityApi.updateArticle(row.id, { is_published: newState })\n    if (error) throw error\n    row.is_published = newState\n    ElMessage.success(newState ? '已发布' : '已下架')\n  } catch (error: any) {\n    ElMessage.error('操作失败: ' + error.message)\n  }\n}\n\nconst handleDelete = (row: any) => {\n  ElMessageBox.confirm('确定要删除这篇文章吗？此类操作不可恢复', '警告', {\n    confirmButtonText: '确定删除',\n    cancelButtonText: '取消',\n    type: 'warning'\n  }).then(async () => {\n    try {\n      const { error } = await adminCommunityApi.deleteArticle(row.id)\n      if (error) throw error\n      ElMessage.success('删除成功')\n      fetchArticles()\n    } catch (error: any) {\n      ElMessage.error('删除失败: ' + error.message)\n    }\n  })\n}\n\nonMounted(async () => {\n  await fetchCategories()\n  await fetchArticles()\n})\n</script>\n\n<style scoped>\n.admin-page {\n  padding: 20px;\n  background: var(--el-bg-color);\n  border-radius: 8px;\n  min-height: calc(100vh - 100px);\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n  padding-bottom: 20px;\n  border-bottom: 1px solid var(--el-border-color-lighter);\n}\n\n.page-title {\n  font-size: 18px;\n  font-weight: 600;\n  color: var(--el-text-color-primary);\n}\n\n.pagination-container {\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n}\n</style>\n"],"names":["_ssrRenderAttrs","_mergeProps","_unref","_ssrRenderComponent","_withCtx","_createVNode","Plus","_createTextVNode","_toDisplayString","_ssrInterpolate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgFA,UAAA,SAAA,UAAA;AACA,UAAA,UAAA,IAAA,KAAA;AACA,UAAA,WAAA,IAAA,EAAA;AACA,UAAA,QAAA,IAAA,CAAA;AACA,UAAA,cAAA,IAAA,CAAA;AACA,UAAA,WAAA,IAAA,EAAA;AACA,UAAA,aAAA,IAAA,EAAA;AAEA,UAAA,aAAA,CAAA,SAAA;AACE,aAAA,IAAA,KAAA,IAAA,EAAA,eAAA;AAAA,IAAqC;AAGvC,UAAA,mBAAA,CAAA,OAAA;AACE,YAAA,MAAA,WAAA,MAAA,KAAA,CAAA,MAAA,EAAA,OAAA,EAAA;AACA,aAAA,MAAA,IAAA,OAAA,MAAA;AAAA,IAA+B;AAGjC,UAAA,mBAAA,CAAA,OAAA;AACE,YAAA,MAAA,WAAA,MAAA,KAAA,CAAA,MAAA,EAAA,OAAA,EAAA;AACA,aAAA,MAAA,IAAA,QAAA;AAAA,IAAyB;AAY3B,UAAA,gBAAA,YAAA;AACE,cAAA,QAAA;AACA,UAAA;AACE,cAAA,EAAA,MAAA,OAAA,OAAA,MAAA,IAAA,MAAA,kBAAA,YAAA,YAAA,OAAA,SAAA,KAAA;AACA,YAAA,MAAA,OAAA;AACA,iBAAA,QAAA,QAAA,CAAA;AACA,cAAA,QAAA,SAAA;AAAA,MAAuB,SAAA,OAAA;AAEvB,kBAAA,MAAA,aAAA,MAAA,OAAA;AAAA,MAA0C,UAAA;AAE1C,gBAAA,QAAA;AAAA,MAAgB;AAAA,IAClB;AAGF,UAAA,aAAA,CAAA,QAAA;AACE,aAAA,KAAA;AAAA,QAAY,MAAA;AAAA,QACJ,OAAA,EAAA,IAAA,IAAA,GAAA;AAAA,MACc,CAAA;AAAA,IACrB;AAGH,UAAA,sBAAA,OAAA,QAAA;AACE,YAAA,WAAA,CAAA,IAAA;AACA,UAAA;AACE,cAAA,EAAA,UAAA,MAAA,kBAAA,cAAA,IAAA,IAAA,EAAA,cAAA,UAAA;AACA,YAAA,MAAA,OAAA;AACA,YAAA,eAAA;AACA,kBAAA,QAAA,WAAA,QAAA,KAAA;AAAA,MAA0C,SAAA,OAAA;AAE1C,kBAAA,MAAA,WAAA,MAAA,OAAA;AAAA,MAAwC;AAAA,IAC1C;AAGF,UAAA,eAAA,CAAA,QAAA;AACE,mBAAA,QAAA,uBAAA,MAAA;AAAA,QAAkD,mBAAA;AAAA,QAC7B,kBAAA;AAAA,QACD,MAAA;AAAA,MACZ,CAAA,EAAA,KAAA,YAAA;AAEN,YAAA;AACE,gBAAA,EAAA,MAAA,IAAA,MAAA,kBAAA,cAAA,IAAA,EAAA;AACA,cAAA,MAAA,OAAA;AACA,oBAAA,QAAA,MAAA;AACA,wBAAA;AAAA,QAAc,SAAA,OAAA;AAEd,oBAAA,MAAA,WAAA,MAAA,OAAA;AAAA,QAAwC;AAAA,MAC1C,CAAA;AAAA,IACD;;;;;;;;;;AA7JI,YAAA,OAAAA,eAAAC,WAAA,EAAA,OAAA,gBAAA,MAAA,CAAA,CAAA,8GAAA;;;QAGe,SAAA,CAAA,WAAAC,MAAA,MAAA,EAAA,KAAA,2BAAA;AAAA,MAA6B,GAAA;AAAA;;AAClC,mBAAAC,mBAAA,oBAAA,EAAA,OAAA,OAAA,GAAA;AAAA,cAAY,SAAAC,QAAA,CAAA,IAAA,QAAA,UAAA,cAAA;;;;;;kBAAS;AAAA;;;;;;;;gBAAT,SAAAA,QAAA,MAAA;AAAA,kBAASC,YAAAH,MAAAI,YAAA,CAAA;AAAA,gBAAA,CAAA;AAAA;;;YAChC;AAAA;;;;;;;QAQiB,QAAA;AAAA,QAAU,OAAA,EAAA,SAAA,OAAA;AAAA,MAAO,GAAA;AAAA;;;;cACV,OAAA;AAAA,cAAW,OAAA;AAAA,cAAW,yBAAA;AAAA,YAAM,GAAA,MAAA,UAAA,QAAA,CAAA;;;cAC3B,OAAA;AAAA,YAAW,GAAA;AAAA;;;;oBAG5B,KAAA,IAAA;AAAA,oBACU,oBAAA,CAAA,IAAA,WAAA;AAAA,oBACyB,KAAA;AAAA,kBAC/B,GAAA,MAAA,UAAA,SAAA,CAAA;AAAA;;;sBACJ,OAAA,EAAA,SAAA,QAAA,UAAA,QAAA,iBAAA,MAAA;AAAA,sBAJA,KAAA,IAAA;AAAA,sBACU,oBAAA,CAAA,IAAA,WAAA;AAAA,sBACyB,KAAA;AAAA,oBAC/B,GAAA,MAAA,GAAA,CAAA,OAAA,kBAAA,CAAA;AAAA;;;;;;;cAIY,OAAA;AAAA,cAAc,aAAA;AAAA,cAAe,yBAAA;AAAA,YAAM,GAAA,MAAA,UAAA,QAAA,CAAA;;;cACnC,OAAA;AAAA,cAAiB,OAAA;AAAA,YAAW,GAAA;AAAA;;;;oBAEqD,QAAA;AAAA,kBAA4C,GAAA;AAAA;;;sBAC7G,OAAA;;;wBAAA;AAAA;;;;;;;sBACzB,OAAA,EAAA,aAAA,iBAAA,IAAA,QAAA,GAAA,OAAA,iBAAA,IAAA,QAAA,GAAA,iBAAA,cAAA;AAAA,sBAF0F,QAAA;AAAA,oBAA4C,GAAA;AAAA;wBACzGC,gBAAAC,gBAAA,iBAAA,IAAA,QAAA,CAAA,GAAA,CAAA;AAAA,sBAAJ,CAAA;AAAA;;;;;;;;;cAIhB,OAAA;AAAA,cAAc,OAAA;AAAA,YAAY,GAAA,MAAA,UAAA,QAAA,CAAA;;;cACzB,OAAA;AAAA,YAAW,GAAA;AAAA;;;;kBAEC,GAAA;AAAA;;AAC1B,+BAAA,GAAAC,eAAA,IAAA,eAAA,QAAA,IAAA,CAAA,EAAA;AAAA,sBAAgB,OAAA;;;wBAAA;AAAA;;;;;;;sBACZ,MAAA,IAAA,eAAA,YAAA;AAAA,oBAFsB,GAAA;AAAA;wBACQF,gBAAAC,gBAAA,IAAA,eAAA,QAAA,IAAA,GAAA,CAAA;AAAA,sBAAlB,CAAA;AAAA;;;;;;;;;cAIH,OAAA;AAAA,cAAmB,OAAA;AAAA,YAAa,GAAA;AAAA;;;gBAEtB,OAAA;;;kBAAA;AAAA;;;;;;cAGT,OAAA;AAAA,cAAW,OAAA;AAAA,YAAY,GAAA;AAAA;;;;oBAE/B,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,WAAA,GAAA;AAAA,kBAAgC,GAAA;AAAA;;;;;;wBAAK;AAAA;;;;;;oBAC/C,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,oBAAA,GAAA;AAAA,kBAAyC,GAAA;AAAA;;AACzD,+BAAA,GAAAC,eAAA,IAAA,eAAA,OAAA,IAAA,CAAA,EAAA;AAAA,sBAAgB,OAAA;;;wBAAA;AAAA;;;;;;oBAEV,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,aAAA,GAAA;AAAA,kBAAiC,GAAA;AAAA;;;;;;wBAAK;AAAA;;;;;;;sBAJW,MAAA;AAAA,sBAA3D,MAAA;AAAA,sBAAU,SAAA,CAAA,WAAA,WAAA,GAAA;AAAA,oBAAgC,GAAA;AAAA;wBAAKF,gBAAA,IAAA;AAAA,sBAAA,CAAA;AAAA;;;sBAG9C,MAAA;AAAA,sBAFD,MAAA;AAAA,sBAAU,SAAA,CAAA,WAAA,oBAAA,GAAA;AAAA,oBAAyC,GAAA;AAAA;wBACxBA,gBAAAC,gBAAA,IAAA,eAAA,OAAA,IAAA,GAAA,CAAA;AAAA,sBAAjB,CAAA;AAAA;;;sBAEkD,MAAA;AAAA,sBAA5D,MAAA;AAAA,sBAAU,SAAA,CAAA,WAAA,aAAA,GAAA;AAAA,oBAAiC,GAAA;AAAA;wBAAKD,gBAAA,IAAA;AAAA,sBAAA,CAAA;AAAA;;;;;;;;;;gBAtCW,MAAA;AAAA,gBAApD,OAAA;AAAA,gBAAW,OAAA;AAAA,gBAAW,yBAAA;AAAA,cAAM,CAAA;AAAA;gBAUhC,OAAA;AAAA,gBATK,OAAA;AAAA,cAAW,GAAA;AAAA;kBACPF,YAAA,qBAAA;AAAA,oBAMrB,OAAA,EAAA,SAAA,QAAA,UAAA,QAAA,iBAAA,MAAA;AAAA,oBAJA,KAAA,IAAA;AAAA,oBACU,oBAAA,CAAA,IAAA,WAAA;AAAA,oBACyB,KAAA;AAAA,kBAC/B,GAAA,MAAA,GAAA,CAAA,OAAA,kBAAA,CAAA;AAAA;;;;gBAIuE,MAAA;AAAA,gBAA3D,OAAA;AAAA,gBAAc,aAAA;AAAA,gBAAe,yBAAA;AAAA,cAAM,CAAA;AAAA;gBAOvC,MAAA;AAAA,gBANI,OAAA;AAAA,gBAAiB,OAAA;AAAA,cAAW,GAAA;AAAA;kBACvBA,YAAA,mBAAA;AAAA,oBAGd,OAAA,EAAA,aAAA,iBAAA,IAAA,QAAA,GAAA,OAAA,iBAAA,IAAA,QAAA,GAAA,iBAAA,cAAA;AAAA,oBAF0F,QAAA;AAAA,kBAA4C,GAAA;AAAA;sBACzGE,gBAAAC,gBAAA,iBAAA,IAAA,QAAA,CAAA,GAAA,CAAA;AAAA,oBAAJ,CAAA;AAAA;;;;;;gBAIkB,MAAA;AAAA,gBAAlC,OAAA;AAAA,gBAAc,OAAA;AAAA,cAAY,CAAA;AAAA;gBAO9B,OAAA;AAAA,gBANK,OAAA;AAAA,cAAW,GAAA;AAAA;kBACPH,YAAA,mBAAA;AAAA,oBAGd,MAAA,IAAA,eAAA,YAAA;AAAA,kBAFsB,GAAA;AAAA;sBACQE,gBAAAC,gBAAA,IAAA,eAAA,QAAA,IAAA,GAAA,CAAA;AAAA,oBAAlB,CAAA;AAAA;;;;;;gBAQP,MAAA;AAAA,gBAJI,OAAA;AAAA,gBAAmB,OAAA;AAAA,cAAa,GAAA;AAAA;kBAC3BD,gBAAAC,gBAAA,WAAA,IAAA,UAAA,CAAA,GAAA,CAAA;AAAA,gBACK,CAAA;AAAA;;;gBAWd,OAAA;AAAA,gBARK,OAAA;AAAA,gBAAW,OAAA;AAAA,cAAY,GAAA;AAAA;kBACnBH,YAAA,sBAAA;AAAA,oBAC+C,MAAA;AAAA,oBAA3D,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,WAAA,GAAA;AAAA,kBAAgC,GAAA;AAAA;sBAAKE,gBAAA,IAAA;AAAA,oBAAA,CAAA;AAAA;;;oBAG9C,MAAA;AAAA,oBAFD,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,oBAAA,GAAA;AAAA,kBAAyC,GAAA;AAAA;sBACxBA,gBAAAC,gBAAA,IAAA,eAAA,OAAA,IAAA,GAAA,CAAA;AAAA,oBAAjB,CAAA;AAAA;;;oBAEkD,MAAA;AAAA,oBAA5D,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,aAAA,GAAA;AAAA,kBAAiC,GAAA;AAAA;sBAAKD,gBAAA,IAAA;AAAA,oBAAA,CAAA;AAAA;;;;;;;;;;;;;QAOvC,wBAAA,CAAA,WAAA,YAAA,QAAA;AAAA,QAAW,aAAA,SAAA;AAAA,QACd,qBAAA,CAAA,WAAA,SAAA,QAAA;AAAA,QAAQ,OAAA,MAAA;AAAA,QACnB,cAAA,CAAA,IAAA,IAAA,EAAA;AAAA,QACK,QAAA;AAAA,QACN,cAAA;AAAA,QACO,iBAAA;AAAA,MACG,GAAA,MAAA,OAAA,CAAA;;;;;;;;;;;;"}