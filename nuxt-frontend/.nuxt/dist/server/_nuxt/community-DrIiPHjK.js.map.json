{"file":"community-DrIiPHjK.js","mappings":";AAyHO,MAAM,oBAAoB;AAAA;AAAA,EAE/B,MAAM,YAAY,OAAO,GAAG,WAAW,IAAI;AACzC,UAAM,SAAS,uBAAA;AAEf,UAAM,QAAQ,OAAO,KAAK;AAC1B,UAAM,KAAK,OAAO,WAAW;AAE7B,UAAM,EAAE,MAAM,OAAO,UAAU,MAAM,OAClC,KAAK,oBAAoB,EACzB,OAAO,KAAK,EAAE,OAAO,SAAS,EAC9B,MAAM,cAAc,EAAE,WAAW,MAAA,CAAO,EACxC,MAAM,MAAM,EAAE;AAEjB,WAAO,EAAE,MAAM,OAAO,OAAO,MAAA;AAAA,EAC/B;AAAA,EAEA,MAAM,cAAc,SAA2B;AAC7C,UAAM,SAAS,uBAAA;AACf,WAAO,MAAM,OAAO,KAAK,oBAAoB,EAAE,OAAO,CAAC,OAAO,CAAC,EAAE,OAAA;AAAA,EACnE;AAAA,EAEA,MAAM,cAAc,IAAY,SAA2B;AACzD,UAAM,SAAS,uBAAA;AACf,WAAO,MAAM,OAAO,KAAK,oBAAoB,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,EAAE,EAAE,OAAA;AAAA,EAC9E;AAAA,EAEA,MAAM,cAAc,IAAY;AAC9B,UAAM,SAAS,uBAAA;AACf,WAAO,MAAM,OAAO,KAAK,oBAAoB,EAAE,SAAS,GAAG,MAAM,EAAE;AAAA,EACrE;AAAA;AAAA,EAGA,MAAM,eAAe,IAAY;AAC/B,UAAM,SAAS,uBAAA;AACf,UAAM,EAAE,MAAM,MAAA,IAAU,MAAM,OAC3B,KAAK,oBAAoB,EACzB,OAAO,GAAG,EACV,GAAG,MAAM,EAAE,EACX,OAAA;AAEH,QAAI,OAAO;AACT,aAAO,EAAE,SAAS,OAAO,MAAM,MAAM,KAAK,MAAM,QAAA;AAAA,IAClD;AACA,WAAO,EAAE,SAAS,MAAM,MAAM,KAAK,GAAA;AAAA,EACrC;AAAA;AAAA,EAGA,MAAM,gBAAgB;AACpB,UAAM,SAAS,uBAAA;AACf,WAAO,MAAM,OACV,KAAK,sBAAsB,EAC3B,OAAO,GAAG,EACV,MAAM,cAAc,EAAE,WAAW,MAAM;AAAA,EAC5C;AAAA,EAEA,MAAM,eAAe,UAA6B;AAChD,UAAM,SAAS,uBAAA;AACf,WAAO,MAAM,OAAO,KAAK,sBAAsB,EAAE,OAAO,CAAC,QAAQ,CAAC,EAAE,OAAA;AAAA,EACtE;AAAA,EAEA,MAAM,eAAe,IAAY,SAA4B;AAC3D,UAAM,SAAS,uBAAA;AACf,WAAO,MAAM,OAAO,KAAK,sBAAsB,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,EAAE,EAAE,OAAA;AAAA,EAChF;AAAA,EAEA,MAAM,eAAe,IAAY;AAC/B,UAAM,SAAS,uBAAA;AACf,WAAO,MAAM,OAAO,KAAK,sBAAsB,EAAE,SAAS,GAAG,MAAM,EAAE;AAAA,EACvE;AACF;","names":[],"sources":["../../../../api/community.ts"],"sourcesContent":["import { getSupabaseClient } from '@/utils/supabase'\nimport { getAdminSupabaseClient } from '@/utils/supabase-admin'\n\nexport interface Article {\n  id: string\n  title: string\n  description?: string\n  content?: string\n  cover_image?: string\n  video_url?: string\n  category: string\n  is_published?: boolean\n  views: number\n  created_at: string\n  author?: {\n    name: string\n    avatar: string\n  }\n}\n\nexport interface Category {\n  id: string\n  name: string\n  icon?: string\n  color?: string\n  sort_order: number\n  is_active: boolean\n  created_at: string\n}\n\nexport const communityApi = {\n  // Get list of articles (public)\n  async getArticles(category = 'all', page = 1, pageSize = 12) {\n    const client = getSupabaseClient()\n\n    let query = client\n      .from('community_articles')\n      .select('*', { count: 'exact' })\n      .eq('is_published', true)\n      .order('created_at', { ascending: false })\n\n    if (category !== 'all') {\n      query = query.eq('category', category)\n    }\n\n    const from = (page - 1) * pageSize\n    const to = from + pageSize - 1\n\n    const { data, error, count } = await query.range(from, to)\n\n    if (error) {\n      console.error('Error fetching articles:', error)\n      return { success: false, data: [], total: 0 }\n    }\n\n    // Mock author for now since we don't have an authors table relation yet\n    const enrichedData = data?.map(article => ({\n      ...article,\n      author: {\n        name: '官方客服',\n        avatar: '/images/service-avatar.png'\n      }\n    }))\n\n    return { success: true, data: enrichedData, total: count || 0 }\n  },\n\n  // Get active categories (public)\n  async getCategories() {\n    const client = getSupabaseClient()\n    const { data, error } = await client\n      .from('community_categories')\n      .select('*')\n      .eq('is_active', true)\n      .order('sort_order', { ascending: true })\n\n    if (error) {\n      console.error('Error fetching categories:', error)\n      return { success: false, data: [] }\n    }\n    return { success: true, data }\n  },\n\n  // Get single article detail\n  async getArticleDetail(id: string) {\n    const client = getSupabaseClient()\n\n    const { data, error } = await client\n      .from('community_articles')\n      .select('*')\n      .eq('id', id)\n      .single()\n\n    if (error) {\n      console.error('Error fetching article detail:', error)\n      return { success: false, msg: error.message }\n    }\n\n    // Increment view count (fire and forget)\n    this.incrementViews(id)\n\n    return {\n      success: true,\n      data: {\n        ...data,\n        author: {\n          name: '官方客服',\n          avatar: '/images/service-avatar.png'\n        }\n      }\n    }\n  },\n\n  // Increment view count\n  async incrementViews(id: string) {\n    const client = getSupabaseClient()\n    await client.rpc('increment_article_views', { article_id: id })\n  }\n}\n\n// Admin APIs\nexport const adminCommunityApi = {\n  // Articles\n  async getArticles(page = 1, pageSize = 20) {\n    const client = getAdminSupabaseClient()\n\n    const from = (page - 1) * pageSize\n    const to = from + pageSize - 1\n\n    const { data, count, error } = await client\n      .from('community_articles')\n      .select('*', { count: 'exact' })\n      .order('created_at', { ascending: false })\n      .range(from, to)\n\n    return { data, total: count, error }\n  },\n\n  async createArticle(article: Partial<Article>) {\n    const client = getAdminSupabaseClient()\n    return await client.from('community_articles').insert([article]).select()\n  },\n\n  async updateArticle(id: string, updates: Partial<Article>) {\n    const client = getAdminSupabaseClient()\n    return await client.from('community_articles').update(updates).eq('id', id).select()\n  },\n\n  async deleteArticle(id: string) {\n    const client = getAdminSupabaseClient()\n    return await client.from('community_articles').delete().eq('id', id)\n  },\n\n  // Get single article by ID (admin - can fetch drafts)\n  async getArticleById(id: string) {\n    const client = getAdminSupabaseClient()\n    const { data, error } = await client\n      .from('community_articles')\n      .select('*')\n      .eq('id', id)\n      .single()\n\n    if (error) {\n      return { success: false, data: null, msg: error.message }\n    }\n    return { success: true, data, msg: '' }\n  },\n\n  // Categories\n  async getCategories() {\n    const client = getAdminSupabaseClient()\n    return await client\n      .from('community_categories')\n      .select('*')\n      .order('sort_order', { ascending: true })\n  },\n\n  async createCategory(category: Partial<Category>) {\n    const client = getAdminSupabaseClient()\n    return await client.from('community_categories').insert([category]).select()\n  },\n\n  async updateCategory(id: string, updates: Partial<Category>) {\n    const client = getAdminSupabaseClient()\n    return await client.from('community_categories').update(updates).eq('id', id).select()\n  },\n\n  async deleteCategory(id: string) {\n    const client = getAdminSupabaseClient()\n    return await client.from('community_categories').delete().eq('id', id)\n  }\n}\n"],"version":3}