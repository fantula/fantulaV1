{"file":"AdminImagePicker-B9Ws9T0J.js","mappings":"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","names":["_ssrRenderList","_createTextVNode","_ssrRenderComponent","_createVNode","_openBlock","_createBlock","_Fragment","_renderList","_toDisplayString","_createCommentVNode"],"sources":["../../../../components/admin/AdminImagePicker.vue"],"sourcesContent":["<template>\n  <el-dialog v-model=\"visible\" title=\"图库选择\" width=\"800px\" append-to-body destroy-on-close class=\"picker-dialog\">\n    <div class=\"picker-container\">\n      <div class=\"picker-sidebar\">\n        <div \n          class=\"picker-cat-item\" \n          :class=\"{ active: activeCategoryId === '' }\"\n          @click=\"activeCategoryId = ''; fetchImages()\"\n        >全部图片</div>\n        <div \n          v-for=\"cat in categories\" \n          :key=\"cat.id\" \n          class=\"picker-cat-item\"\n          :class=\"{ active: activeCategoryId === cat.id }\"\n          @click=\"activeCategoryId = cat.id; fetchImages()\"\n        >{{ cat.name }}</div>\n      </div>\n      <div class=\"picker-main\" v-loading=\"loading\">\n        <div class=\"picker-toolbar\">\n          <el-upload\n            action=\"#\"\n            :auto-upload=\"false\"\n            :show-file-list=\"false\"\n            :on-change=\"handleUpload\"\n          >\n            <el-button type=\"primary\" size=\"small\">上传新图片</el-button>\n          </el-upload>\n        </div>\n        <div class=\"picker-grid\">\n          <div \n            v-for=\"img in images\" \n            :key=\"img.id\" \n            class=\"picker-img-card\"\n            @click=\"selectImage(img.url)\"\n          >\n            <el-image :src=\"img.url\" fit=\"cover\" />\n            <div class=\"picker-img-name\">{{ img.name }}</div>\n          </div>\n        </div>\n        <el-empty v-if=\"images.length === 0\" description=\"暂无图片\" />\n      </div>\n    </div>\n  </el-dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch, onMounted } from 'vue'\nimport { adminApi, type AdminImage, type AdminImageCategory } from '@/api/admin-supabase'\n\nconst props = defineProps<{\n  modelValue: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'update:modelValue', value: boolean): void\n  (e: 'select', url: string): void\n}>()\n\nconst visible = ref(props.modelValue)\nconst loading = ref(false)\nconst images = ref<AdminImage[]>([])\nconst categories = ref<AdminImageCategory[]>([])\nconst activeCategoryId = ref('')\n\nwatch(() => props.modelValue, (val) => {\n  visible.value = val\n  if (val) {\n    loadCategories()\n    fetchImages()\n  }\n})\n\nwatch(visible, (val) => {\n  emit('update:modelValue', val)\n})\n\nconst loadCategories = async () => {\n  if (categories.value.length > 0) return  // 缓存\n  const res = await adminApi.imageCategory.getCategories()\n  if (res.success) categories.value = res.categories\n}\n\nconst fetchImages = async () => {\n  loading.value = true\n  const res = await adminApi.image.getImages({\n    category_id: activeCategoryId.value || undefined\n  })\n  if (res.success) images.value = res.images\n  loading.value = false\n}\n\nconst selectImage = (url: string) => {\n  emit('select', url)\n  visible.value = false\n}\n\nconst handleUpload = async (file: any) => {\n  loading.value = true\n  try {\n    const { uploadImageToStorage } = await import('@/utils/uploadImage')\n    const upRes = await uploadImageToStorage(file.raw)\n    if (upRes.success) {\n      await adminApi.image.createImage({\n        name: file.name,\n        url: upRes.url!,\n        category_id: activeCategoryId.value || undefined\n      })\n      selectImage(upRes.url!)\n      fetchImages()\n    }\n  } finally {\n    loading.value = false\n  }\n}\n</script>\n\n<style scoped>\n.picker-container {\n  display: flex;\n  height: 500px;\n  gap: 20px;\n}\n\n.picker-sidebar {\n  width: 150px;\n  border-right: 1px solid #f0f2f5;\n  padding-right: 10px;\n  overflow-y: auto;\n}\n\n.picker-cat-item {\n  padding: 10px 15px;\n  cursor: pointer;\n  border-radius: 4px;\n  font-size: 14px;\n  transition: all 0.3s;\n}\n\n.picker-cat-item:hover { \n  background: #f5f7fa; \n  color: #409EFF; \n}\n\n.picker-cat-item.active { \n  background: #ecf5ff; \n  color: #409EFF; \n  font-weight: bold; \n}\n\n.picker-main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n\n.picker-toolbar { margin-bottom: 15px; }\n\n.picker-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n  gap: 15px;\n  overflow-y: auto;\n  padding-bottom: 20px;\n}\n\n.picker-img-card {\n  border: 1px solid #ebeef5;\n  border-radius: 8px;\n  overflow: hidden;\n  cursor: pointer;\n  transition: all 0.3s;\n  background: #fff;\n}\n\n.picker-img-card:hover { \n  border-color: #409EFF; \n  box-shadow: 0 4px 12px rgba(64,158,255,0.15); \n}\n\n.picker-img-card .el-image { \n  width: 100%; \n  height: 100px; \n}\n\n.picker-img-name {\n  padding: 5px;\n  font-size: 12px;\n  color: #606266;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n</style>\n"],"version":3}