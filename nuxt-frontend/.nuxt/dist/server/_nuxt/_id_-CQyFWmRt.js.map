{"version":3,"file":"_id_-CQyFWmRt.js","sources":["../../../../api/supabase.ts","../../../../composables/client/useCheckout.ts","../../../../components/PaySuccessModal.vue","../../../../pages/checkout/[id].vue"],"sourcesContent":["/**\n * Supabase API æœåŠ¡å±‚\n * ä¸¥æ ¼å¯¹æ¥å·²å®ç°çš„åç«¯ Edge Functions\n * ä¸ä¿®æ”¹åç«¯è§„åˆ™ï¼Œä»…åšå‰ç«¯é€‚é…\n */\n\nimport { getSupabaseClient, callEdgeFunction } from '@/utils/supabase'\n\n// ========================================\n// ç±»å‹å®šä¹‰\n// ========================================\n\nexport interface SupabaseUser {\n    id: string\n    uid: string\n    email: string\n    status: 'active' | 'disabled'\n    created_at: string\n}\n\nexport interface SupabaseProduct {\n    id: string\n    product_name: string\n    product_type: 'virtual' | 'shared_account' | 'one_time_cdk'\n    status: 'on' | 'off'\n    category_id: string | null\n    created_at: string\n    stock?: number\n    category?: ProductCategory\n}\n\nexport interface ProductCategory {\n    id: string\n    name: string\n    sort_order: number\n    status: 'on' | 'off'\n    created_at: string\n}\n\nexport interface SupabaseCDK {\n    cdk_id: string\n    cdk_code: string\n    cdk_type: 'virtual' | 'shared' | 'one_time'\n    stock: number\n    account_data: Record<string, any> | null\n}\n\nexport interface SupabaseOrder {\n    id: string\n    order_no: string\n    user_id: string\n    order_type: 'virtual' | 'shared_account' | 'one_time_cdk' // Updated from string to specific Union\n    total_amount: number\n    status: 'pending_delivery' | 'active' | 'refunding' | 'refunded' | 'expired'\n    created_at: string\n    expires_at?: string\n    quantity: number\n    cdk_snapshot?: any // JSONB\n    slot_occupancy_ids?: string[] // [Updated] è½¦ä½IDæ•°ç»„\n    product_snapshot?: ProductSnapshot\n    sku_snapshot?: SkuSnapshot\n    coupon_snapshot?: any // Updated\n}\n\n// ========================================\n// ç”¨æˆ·è®¤è¯ API (10.1)\n// ========================================\nexport const supabaseAuthApi = {\n    /**\n     * POST /auth/login\n     * é‚®ç®±éªŒè¯ç ç™»å½•ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨æ³¨å†Œ\n     */\n    async sendLoginOtp(email: string): Promise<{ success: boolean; message: string }> {\n        const { data, error } = await callEdgeFunction('auth-login', {\n            method: 'POST',\n            body: { email },\n            requireAuth: false,\n        })\n\n        if (error) {\n            return { success: false, message: error }\n        }\n\n        return { success: true, message: data?.message || 'éªŒè¯ç å·²å‘é€' }\n    },\n\n    /**\n     * ä½¿ç”¨ Supabase Auth éªŒè¯ OTP\n     */\n    async verifyOtp(email: string, token: string): Promise<{\n        success: boolean\n        message: string\n        user?: SupabaseUser\n    }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client.auth.verifyOtp({\n            email,\n            token,\n            type: 'email',\n        })\n\n        if (error) {\n            return { success: false, message: error.message }\n        }\n\n        // è·å–ç”¨æˆ· profile\n        if (data.user) {\n            const { data: profile } = await client\n                .from('profiles')\n                .select('uid, email, status, created_at')\n                .eq('id', data.user.id)\n                .single()\n\n            if (profile) {\n                return {\n                    success: true,\n                    message: 'ç™»å½•æˆåŠŸ',\n                    user: {\n                        id: data.user.id,\n                        uid: profile.uid,\n                        email: profile.email,\n                        status: profile.status,\n                        created_at: profile.created_at,\n                    },\n                }\n            }\n        }\n\n        return { success: true, message: 'ç™»å½•æˆåŠŸ' }\n    },\n\n    /**\n     * POST /auth/logout\n     */\n    async logout(): Promise<{ success: boolean }> {\n        const client = getSupabaseClient()\n        await client.auth.signOut()\n        return { success: true }\n    },\n\n    /**\n     * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯\n     */\n    async getCurrentUser(): Promise<SupabaseUser | null> {\n        const client = getSupabaseClient()\n        const { data: { user } } = await client.auth.getUser()\n\n        if (!user) return null\n\n        const { data: profile } = await client\n            .from('profiles')\n            .select('uid, email, status, created_at')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile) return null\n\n        return {\n            id: user.id,\n            uid: profile.uid,\n            email: profile.email,\n            status: profile.status,\n            created_at: profile.created_at,\n        }\n    },\n}\n\n// ========================================\n// å•†å“ API (10.2)\n// ========================================\nexport const supabaseProductApi = {\n    /**\n     * GET /products\n     * è·å–å•†å“åˆ—è¡¨\n     */\n    async getProducts(): Promise<{ success: boolean; products: SupabaseProduct[] }> {\n        const { data, error } = await callEdgeFunction('products', {\n            method: 'GET',\n            requireAuth: false,\n        })\n\n        if (error) {\n            return { success: false, products: [] }\n        }\n\n        return { success: true, products: data?.products || [] }\n    },\n\n    /**\n     * GET /products/:id\n     * è·å–å•ä¸ªå•†å“è¯¦æƒ…\n     */\n    async getProduct(id: string): Promise<{ success: boolean; product: SupabaseProduct | null }> {\n        const { data, error } = await callEdgeFunction('products', {\n            method: 'GET',\n            params: { id },\n            requireAuth: false,\n        })\n\n        if (error) {\n            return { success: false, product: null }\n        }\n\n        return { success: true, product: data }\n    },\n\n    /**\n     * æ£€æŸ¥ SKU æ˜¯å¦å¯è´­ä¹°ï¼ˆè°ƒç”¨æ•°æ®åº“å‡½æ•° get_sku_stockï¼‰\n     * @param skuId SKU ID\n     * @returns available: æ˜¯å¦å¯è´­ä¹°, availableCount: å¯ç”¨æ•°é‡\n     */\n    async checkSkuAvailability(skuId: string): Promise<{\n        available: boolean\n        availableCount: number\n    }> {\n        const client = getSupabaseClient()\n\n        try {\n            const { data, error } = await client\n                .rpc('get_sku_stock', { p_sku_id: skuId })\n                .single()\n\n            if (error || !data) {\n                console.error('æ£€æŸ¥ SKU å¯è´­ä¹°æ€§å¤±è´¥:', error)\n                return { available: false, availableCount: 0 }\n            }\n\n            return {\n                available: data.in_stock,\n                availableCount: data.stock_count\n            }\n        } catch (err: any) {\n            console.error('æ£€æŸ¥ SKU å¯è´­ä¹°æ€§å¼‚å¸¸:', err)\n            return { available: false, availableCount: 0 }\n        }\n    },\n}\n\n// ========================================\n// å•†å“åˆ†ç±» API (å®¢æˆ·ç«¯)\n// ========================================\nexport const supabaseCategoryApi = {\n    /**\n     * è·å–å¯ç”¨çš„åˆ†ç±»åˆ—è¡¨ï¼ˆå®¢æˆ·ç«¯å±•ç¤ºç”¨ï¼‰\n     * ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œåªè¿”å› status='on' çš„åˆ†ç±»\n     */\n    async getCategories(): Promise<{ success: boolean; categories: ProductCategory[] }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client\n            .from('product_categories')\n            .select('*')\n            .eq('status', 'on')\n            .order('sort_order', { ascending: true })\n\n        if (error) {\n            console.error('è·å–åˆ†ç±»å¤±è´¥:', error)\n            return { success: false, categories: [] }\n        }\n\n        return { success: true, categories: data || [] }\n    },\n\n    /**\n     * è·å–æŒ‡å®šåˆ†ç±»ä¸‹çš„å•†å“\n     */\n    async getProductsByCategory(categoryId: string): Promise<{ success: boolean; products: SupabaseProduct[] }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client\n            .from('products')\n            .select('*')\n            .eq('category_id', categoryId)\n            .eq('status', 'on')\n            .order('created_at', { ascending: false })\n\n        if (error) {\n            console.error('è·å–åˆ†ç±»å•†å“å¤±è´¥:', error)\n            return { success: false, products: [] }\n        }\n\n        return { success: true, products: data || [] }\n    },\n}\n\n// ========================================\n// CDK API (10.3)\n// ========================================\nexport const supabaseCdkApi = {\n    /**\n     * POST /cdk/allocate\n     * CDK åˆ†é…ï¼ˆç”± order-create å†…éƒ¨è°ƒç”¨ï¼Œä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨ï¼‰\n     */\n    async allocate(productId: string): Promise<{ success: boolean; cdk: SupabaseCDK | null; error?: string }> {\n        const { data, error } = await callEdgeFunction('cdk-allocate', {\n            method: 'POST',\n            body: { product_id: productId },\n            requireAuth: true,\n        })\n\n        if (error) {\n            return { success: false, cdk: null, error }\n        }\n\n        return { success: true, cdk: data?.cdk || null }\n    },\n\n    /**\n     * POST /cdk/release\n     * CDK é‡Šæ”¾ï¼ˆä»…è´¦å·åˆç§Ÿå‹å’Œè™šæ‹Ÿå……å€¼å‹ï¼‰\n     */\n    async release(cdkId: string): Promise<{ success: boolean; message: string }> {\n        const { data, error } = await callEdgeFunction('cdk-release', {\n            method: 'POST',\n            body: { cdk_id: cdkId },\n            requireAuth: true,\n        })\n\n        if (error) {\n            return { success: false, message: error }\n        }\n\n        return { success: true, message: data?.message || 'CDK å·²é‡Šæ”¾' }\n    },\n}\n\n// ========================================\n// è®¢å• API (10.4)\n// ========================================\nexport const supabaseOrderApi = {\n    /**\n     * POST /order/create\n     * åˆ›å»ºè®¢å•\n     * æ ¸å¿ƒåŸåˆ™ï¼šæ¯ä¸€æ¬¡æ”¯ä»˜ = ä¸€ç¬”è®¢å•\n     */\n    async createOrder(productId: string, durationDays?: number): Promise<{\n        success: boolean\n        order?: {\n            order_id: string\n            cdk_id: string\n            cdk_code: string\n            account_data: Record<string, any> | null\n            start_time: string\n            end_time: string\n        }\n        error?: string\n    }> {\n        const { data, error } = await callEdgeFunction('order-create', {\n            method: 'POST',\n            body: {\n                product_id: productId,\n                duration_days: durationDays,\n            },\n            requireAuth: true,\n        })\n\n        if (error) {\n            return { success: false, error }\n        }\n\n        return { success: true, order: data?.order }\n    },\n\n    /**\n     * POST /order/renew\n     * ç»­è´¹è®¢å•\n     * ä¸¥æ ¼éµå¾ªæ–‡æ¡£ 4.3ï¼š\n     * - å¿…é¡»ç”Ÿæˆæ–°è®¢å• Bï¼ˆorder_type = renewï¼‰\n     * - åŸè®¢å• A çš„ end_time å åŠ æ–°æ—¶é•¿\n     */\n    async renewOrder(orderId: string, durationDays: number): Promise<{\n        success: boolean\n        message?: string\n        renew_order_id?: string\n        original_order_id?: string\n        original_new_end_time?: string\n        renew_period?: {\n            start: string\n            end: string\n        }\n        error?: string\n    }> {\n        const { data, error } = await callEdgeFunction('order-renew', {\n            method: 'POST',\n            body: {\n                order_id: orderId,\n                duration_days: durationDays,\n            },\n            requireAuth: true,\n        })\n\n        if (error) {\n            return { success: false, error }\n        }\n\n        return {\n            success: true,\n            message: data?.message,\n            renew_order_id: data?.renew_order_id,\n            original_order_id: data?.original_order_id,\n            original_new_end_time: data?.original_new_end_time,\n            renew_period: data?.renew_period,\n        }\n    },\n\n    /**\n     * GET /order/list\n     * è·å–ç”¨æˆ·è®¢å•åˆ—è¡¨\n     */\n    async getOrderList(params?: { limit?: number; offset?: number }): Promise<{\n        success: boolean\n        orders: SupabaseOrder[]\n        total: number\n    }> {\n        const queryParams: Record<string, string> = {}\n        if (params?.limit) queryParams.limit = String(params.limit)\n        if (params?.offset) queryParams.offset = String(params.offset)\n\n        const { data, error } = await callEdgeFunction('order-list', {\n            method: 'GET',\n            params: queryParams,\n            requireAuth: true,\n        })\n\n        if (error) {\n            return { success: false, orders: [], total: 0 }\n        }\n\n        return {\n            success: true,\n            orders: data?.orders || [],\n            total: data?.total || 0,\n        }\n    },\n}\n\n// ========================================\n// åå°æ¶ˆæ¯ API (10.5)\n// ========================================\nexport const supabaseAdminApi = {\n    /**\n     * POST /admin/message/send\n     * å‘é€ç³»ç»Ÿæ¶ˆæ¯\n     * è§„åˆ™ï¼šç”¨æˆ·ä¸å­˜åœ¨åˆ™ç¦æ­¢å‘é€\n     */\n    async sendMessage(userUid: string, title: string, content: string): Promise<{\n        success: boolean\n        message_id?: string\n        error?: string\n    }> {\n        const { data, error } = await callEdgeFunction('admin-message-send', {\n            method: 'POST',\n            body: {\n                user_uid: userUid,\n                title,\n                content,\n            },\n            requireAuth: true,\n        })\n\n        if (error) {\n            return { success: false, error }\n        }\n\n        return { success: true, message_id: data?.message_id }\n    },\n}\n\n// ========================================\n// é¢„è®¢å• APIï¼ˆè´­ç‰©è½¦/ç«‹å³è´­ä¹°ä¼˜åŒ–ï¼‰\n// ========================================\n\nexport interface ProductSnapshot {\n    product_id: string\n    product_name: string\n    image: string\n}\n\nexport interface SkuSnapshot {\n    sku_id: string\n    spec_combination: Record<string, string>\n    duration: number\n    price: number\n}\n\nexport interface PreOrder {\n    id: string\n    order_no: string\n    status: 'pending' | 'confirmed' | 'converted' | 'expired' | 'cancelled'\n    quantity: number\n    unit_price: number\n    total_amount: number\n    product_snapshot: ProductSnapshot\n    sku_snapshot: SkuSnapshot\n    source: 'buy_now' | 'cart'\n    expires_at: string\n    created_at: string\n}\n\nexport const supabasePreOrderApi = {\n    /**\n     * åˆ›å»ºé¢„è®¢å•ï¼ˆé”å®šèµ„æºï¼‰\n     * æ–°ç‰ˆæœ¬ï¼šç›´æ¥ä¼  sku_id å’Œ quantity\n     */\n    async createPreOrder(\n        skuId: string,\n        quantity: number = 1,\n        source: 'buy_now' | 'cart' = 'buy_now'\n    ): Promise<{ success: boolean; pre_order_id?: string; order_no?: string; total_amount?: number; expires_at?: string; code?: string; error?: string }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client.rpc('create_pre_order', {\n            p_sku_id: skuId,\n            p_quantity: quantity,\n            p_source: source\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        if (!data.success) {\n            return {\n                success: false,\n                code: data.code,\n                error: data.error\n            }\n        }\n\n        return {\n            success: true,\n            pre_order_id: data.pre_order_id,\n            order_no: data.order_no,\n            total_amount: data.total_amount,\n            expires_at: data.expires_at\n        }\n    },\n\n    /**\n     * æŸ¥è¯¢é¢„è®¢å•è¯¦æƒ…\n     */\n    async getPreOrder(preOrderId: string): Promise<{ success: boolean; pre_order?: PreOrder; error?: string }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client.rpc('get_pre_order', {\n            p_pre_order_id: preOrderId\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        if (!data.success) {\n            return { success: false, error: data.error }\n        }\n        return { success: true, pre_order: data.pre_order }\n    },\n\n    /**\n     * åº”ç”¨ä¼˜æƒ åˆ¸åˆ°é¢„è®¢å•\n     * å¹¶æŒä¹…åŒ–æ›´æ–°é¢„è®¢å•é‡‘é¢\n     */\n    async applyCouponToPreOrder(preOrderId: string, couponId: string | null): Promise<{\n        success: boolean;\n        total_amount?: number;\n        discount_amount?: number;\n        error?: string\n    }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client.rpc('apply_coupon_to_pre_order', {\n            p_pre_order_id: preOrderId,\n            p_coupon_id: couponId\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        const result = data as any\n        if (result.success) {\n            return {\n                success: true,\n                total_amount: result.total_amount,\n                discount_amount: result.discount_amount\n            }\n        } else {\n            return { success: false, error: result.error || 'åº”ç”¨ä¼˜æƒ åˆ¸å¤±è´¥' }\n        }\n    },\n\n    /**\n     * ç¡®è®¤é¢„è®¢å•å¹¶æ”¯ä»˜\n     */\n    async confirmPreOrder(preOrderId: string, payMethod: 'balance' | 'wechat', couponId?: string): Promise<{ success: boolean; order_no?: string; order_id?: string; total_amount?: number; error?: string }> {\n        const client = getSupabaseClient()\n        // ä½¿ç”¨ confirm_pre_order å‡½æ•°\n        const payload: any = {\n            p_pre_order_id: preOrderId,\n            p_pay_method: payMethod\n        }\n\n        if (couponId) {\n            payload.p_coupon_id = couponId\n        }\n\n        const { data, error } = await client.rpc('confirm_pre_order', payload)\n\n        if (error) return { success: false, error: error.message }\n\n        // rpcè¿”å›çš„jsonbéœ€è¦æ‰‹åŠ¨è§£æï¼Œå¦‚æœå·²ç»æ˜¯å¯¹è±¡åˆ™ç›´æ¥ä½¿ç”¨\n        const result = data as any\n        if (result.success) {\n            return {\n                success: true,\n                order_no: result.order_no,\n                order_id: result.order_id,\n                total_amount: result.total_amount\n            }\n        } else {\n            return { success: false, error: result.error || 'æ”¯ä»˜å¤±è´¥' }\n        }\n    },\n\n    /**\n     * å–æ¶ˆé¢„è®¢å•ï¼ˆé‡Šæ”¾èµ„æºï¼‰\n     */\n    async cancelPreOrder(preOrderId: string): Promise<{ success: boolean; error?: string }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client.rpc('cancel_pre_order', {\n            p_pre_order_id: preOrderId\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        if (!data.success) {\n            return { success: false, error: data.error }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * åˆ é™¤é¢„è®¢å•ï¼ˆä»…é™å·²è¿‡æœŸæˆ–å·²å®Œæˆ/å–æ¶ˆï¼‰\n     */\n    async deletePreOrder(preOrderId: string): Promise<{ success: boolean; error?: string }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client.rpc('delete_pre_order', {\n            p_pre_order_id: preOrderId\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        if (!data.success) {\n            return { success: false, error: data.error }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * è¿‡æœŸé¢„è®¢å•ï¼ˆé‡Šæ”¾èµ„æº + çœŸå®åˆ é™¤ï¼‰\n     * ç”¨äºå€’è®¡æ—¶å½’é›¶æ—¶è°ƒç”¨\n     */\n    async expirePreOrder(preOrderId: string): Promise<{ success: boolean; error?: string }> {\n        const client = getSupabaseClient()\n\n        const { data, error } = await client.rpc('expire_pre_order', {\n            p_pre_order_id: preOrderId\n        })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        if (!data.success) {\n            return { success: false, error: data.error }\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * è·å–ç”¨æˆ·æ‰€æœ‰é¢„è®¢å•ï¼ˆåŒ…æ‹¬å¾…æ”¯ä»˜ã€å·²è¿‡æœŸç­‰ï¼‰\n     */\n    async getPreOrders(status?: string): Promise<{ success: boolean; data?: PreOrder[]; error?: string }> {\n        const client = getSupabaseClient()\n\n        let query = client\n            .from('pre_orders')\n            .select('*')\n            .order('created_at', { ascending: false })\n\n        if (status) {\n            query = query.eq('status', status)\n        }\n\n        const { data, error } = await query\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, data: data as PreOrder[] }\n    },\n\n    /**\n     * è·å–ç”¨æˆ·å¾…æ”¯ä»˜é¢„è®¢å•\n     */\n    async getPendingPreOrders(): Promise<{ success: boolean; data?: PreOrder[]; error?: string }> {\n        const client = getSupabaseClient()\n\n        // è·å–æœªè¿‡æœŸä¸”çŠ¶æ€ä¸º pending çš„è®¢å•\n        const { data, error } = await client\n            .from('pre_orders')\n            .select('*')\n            .eq('status', 'pending')\n            .gt('expires_at', new Date().toISOString())\n            .order('created_at', { ascending: false })\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n\n        return { success: true, data: data as PreOrder[] }\n    }\n}\n\n// ========================================\n// FAQ å¸®åŠ©ä¸­å¿ƒ API (10.6)\n// ========================================\nexport const supabaseFaqApi = {\n    /**\n     * è·å–å¸¸è§é—®é¢˜åˆ†ç±»åˆ—è¡¨\n     */\n    async getCategories(): Promise<{ success: boolean; categories: { id: string; name: string }[] }> {\n        const client = getSupabaseClient()\n        const { data, error } = await client\n            .from('faq_categories')\n            .select('id, name')\n            .eq('is_active', true)\n            .order('sort_order', { ascending: true })\n\n        if (error) {\n            return { success: false, categories: [] }\n        }\n        return { success: true, categories: data || [] }\n    },\n\n    /**\n     * è·å–å¸¸è§é—®é¢˜åˆ—è¡¨\n     * @param categoryId å¯é€‰åˆ†ç±»ID\n     */\n    async getFaqs(categoryId?: string): Promise<{ success: boolean; faqs: any[] }> {\n        const client = getSupabaseClient()\n        let query = client\n            .from('faqs')\n            .select('*')\n            .eq('is_active', true)\n\n        if (categoryId) {\n            query = query.eq('category_id', categoryId)\n        }\n\n        query = query.order('sort_order', { ascending: true })\n\n        const { data, error } = await query\n\n        if (error) {\n            return { success: false, faqs: [] }\n        }\n        return { success: true, faqs: data || [] }\n    },\n\n    /**\n     * è·å–æŒ‡å®šå•†å“ç»‘å®šçš„ FAQ\n     */\n    async getFaqsByProduct(productId: string): Promise<{ success: boolean; faqs: any[] }> {\n        const client = getSupabaseClient()\n        const { data, error } = await client\n            .from('faqs')\n            .select('*')\n            .eq('is_active', true)\n            .eq('product_id', productId)\n            .order('sort_order', { ascending: true })\n\n        if (error) {\n            return { success: false, faqs: [] }\n        }\n        return { success: true, faqs: data || [] }\n    },\n\n    /**\n     * æœç´¢ FAQ\n     */\n    async searchFaqs(keyword: string): Promise<{ success: boolean; faqs: any[] }> {\n        const client = getSupabaseClient()\n        const { data, error } = await client\n            .from('faqs')\n            .select(`\n                *,\n                category:faq_categories(name)\n            `)\n            .eq('is_active', true)\n            .ilike('question', `%${keyword}%`)\n            .order('sort_order', { ascending: true })\n            .limit(10)\n\n        if (error) {\n            return { success: false, faqs: [] }\n        }\n        return { success: true, faqs: data || [] }\n    }\n}\n\n// å¯¼å‡ºæ‰€æœ‰ API\nexport const supabaseApi = {\n    auth: supabaseAuthApi,\n    product: supabaseProductApi,\n    category: supabaseCategoryApi,\n    cdk: supabaseCdkApi,\n    order: supabaseOrderApi,\n    admin: supabaseAdminApi,\n    preOrder: supabasePreOrderApi,\n    faq: supabaseFaqApi\n}\n\nexport default supabaseApi\n\n","\nimport { ref, computed, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useUserStore } from '@/stores/user'\nimport { supabasePreOrderApi, type PreOrder } from '@/api/supabase'\nimport { type UserCoupon } from '@/api/coupon'\nimport { ElMessage } from 'element-plus'\n\nexport function useCheckout() {\n  const router = useRouter()\n  const userStore = useUserStore()\n\n  // --- State ---\n  const loading = ref(true)\n  const error = ref('')\n  const preOrders = ref<PreOrder[]>([])\n  const paying = ref(false)\n  // const showBalanceModal = ref(false) // Removed\n  const showPaySuccess = ref(false)\n  const refreshingBalance = ref(false) // New\n  \n  // Settlement Data\n  const lastOrderId = ref('')\n  const lastOrderAmount = ref(0)\n  const selectedCoupon = ref<UserCoupon | null>(null)\n  const couponDiscount = ref(0)\n  \n  // Countdown\n  const remainingSeconds = ref(0)\n  let countdownTimer: any = null\n  let pollTimer: any = null\n\n  // --- Computed ---\n  const totalProductAmount = computed(() => {\n    return preOrders.value.reduce((sum, o) => sum + o.total_amount, 0)\n  })\n\n  // Since preOrder.total_amount is updated by the backend when a coupon is applied,\n  // we can use it directly as the final amount.\n  const finalPayAmount = computed(() => {\n    return preOrders.value.reduce((sum, o) => sum + o.total_amount, 0)\n  })\n\n  const userBalance = computed(() => userStore.user?.balance ?? 0)\n\n  const orderSkuIds = computed(() => {\n    return preOrders.value.map(o => o.sku_snapshot?.sku_id).filter(Boolean)\n  })\n\n  const orderProductIds = computed(() => {\n    return preOrders.value.map(o => o.product_snapshot?.product_id).filter(Boolean)\n  })\n\n  const formatCountdown = computed(() => {\n    const mins = Math.floor(remainingSeconds.value / 60)\n    const secs = remainingSeconds.value % 60\n    return `${mins}:${secs.toString().padStart(2, '0')}`\n  })\n\n  // --- Methods ---\n\n  const refreshBalance = async () => {\n    if (refreshingBalance.value) return\n    refreshingBalance.value = true\n    try {\n        await userStore.fetchUserInfo()\n        ElMessage.success('é¢åº¦å·²æ›´æ–°')\n    } catch (e) {\n        ElMessage.error('æ›´æ–°å¤±è´¥')\n    } finally {\n        refreshingBalance.value = false\n    }\n  }\n\n  const startCountdown = (expiresTime: number) => {\n    const update = () => {\n      const now = Date.now()\n      remainingSeconds.value = Math.max(0, Math.floor((expiresTime - now) / 1000))\n      if (remainingSeconds.value <= 0) {\n        handleExpire()\n        if (countdownTimer) clearInterval(countdownTimer)\n      }\n    }\n    update()\n    countdownTimer = setInterval(update, 1000)\n  }\n\n  const handleExpire = async () => {\n    error.value = 'è®¢å•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ä¸‹å•'\n    if (preOrders.value.length > 0) {\n      try {\n        await supabasePreOrderApi.expirePreOrder(preOrders.value[0].id)\n      } catch (e) {\n        console.error('Failed to expire order', e)\n      }\n    }\n  }\n\n  const startPolling = () => {\n    if (pollTimer) clearInterval(pollTimer)\n    pollTimer = setInterval(async () => {\n      if (error.value || paying.value) return \n      if (preOrders.value.length === 0) return\n      \n      const orderId = preOrders.value[0].id\n      const res = await supabasePreOrderApi.getPreOrder(orderId)\n      if (res.success && res.pre_order) {\n        const status = res.pre_order.status\n        \n        if (status === 'converted' || status === 'confirmed') {\n          if (!showPaySuccess.value) {\n            lastOrderId.value = res.pre_order.order_no\n            lastOrderAmount.value = res.pre_order.total_amount\n            showPaySuccess.value = true\n            clearInterval(pollTimer)\n            clearInterval(countdownTimer)\n          }\n          return\n        }\n        \n        if (status === 'expired' || status === 'cancelled') {\n          error.value = 'è®¢å•å·²å¤±æ•ˆæˆ–å·²å…³é—­'\n          clearInterval(pollTimer)\n          clearInterval(countdownTimer)\n          return\n        }\n        \n        if (res.pre_order.total_amount !== preOrders.value[0].total_amount) {\n          preOrders.value[0].total_amount = res.pre_order.total_amount\n        }\n      }\n    }, 3000)\n  }\n\n  const loadPreOrders = async (ids: string[]) => {\n    loading.value = true\n    error.value = ''\n    try {\n      if (!userStore.isLoggedIn) {\n        await userStore.fetchUserInfo()\n        if (!userStore.isLoggedIn) {\n          ElMessage.warning('è¯·å…ˆç™»å½•')\n          router.push('/')\n          return\n        }\n      }\n\n      if (ids.length === 0) throw new Error('ç¼ºå°‘è®¢å• ID')\n      \n      const list: PreOrder[] = []\n      for (const id of ids) {\n        const res = await supabasePreOrderApi.getPreOrder(id)\n        if (res.success && res.pre_order) list.push(res.pre_order)\n      }\n      \n      if (list.length === 0) throw new Error('è®¢å•ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ')\n      preOrders.value = list\n      \n      const minExpires = Math.min(...list.map(o => new Date(o.expires_at).getTime()))\n      startCountdown(minExpires)\n      startPolling()\n      \n    } catch (e: any) {\n      error.value = e.message\n    } finally {\n      loading.value = false\n    }\n  }\n\n  const handleCouponSelect = async (coupon: UserCoupon | null) => {\n    selectedCoupon.value = coupon\n    const couponId = coupon?.id || null\n    const preOrder = preOrders.value[0]\n    if (!preOrder) return\n\n    loading.value = true\n    try {\n      const res = await supabasePreOrderApi.applyCouponToPreOrder(preOrder.id, couponId)\n      \n      if (res.success) {\n        if (res.total_amount !== undefined) {\n          preOrder.total_amount = res.total_amount\n          couponDiscount.value = res.discount_amount || 0\n        }\n        \n        if (!coupon) {\n          ElMessage.success('å·²å–æ¶ˆä¼˜æƒ åˆ¸')\n        } else {\n          ElMessage.success('ä¼˜æƒ åˆ¸ä½¿ç”¨æˆåŠŸ')\n        }\n      } else {\n        ElMessage.error(res.error || 'åº”ç”¨ä¼˜æƒ åˆ¸å¤±è´¥')\n        // Rollback\n        if (coupon) selectedCoupon.value = null\n        couponDiscount.value = 0\n      }\n    } catch (e: any) {\n      ElMessage.error('ç³»ç»Ÿå¼‚å¸¸: ' + (e.message || JSON.stringify(e)))\n      console.error(e)\n    } finally {\n      loading.value = false\n    }\n  }\n\n  const handlePay = async () => {\n    if (paying.value) return\n    \n    if (preOrders.value.length > 0 && preOrders.value[0].status !== 'pending') {\n      ElMessage.error('è®¢å•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·åˆ·æ–°é¡µé¢')\n      return\n    }\n\n    if (userBalance.value < finalPayAmount.value) {\n      // showBalanceModal.value = true // Removed\n      // Should be handled by UI button state now\n      ElMessage.warning('é¢åº¦ä¸è¶³ï¼Œè¯·å…ˆå……å€¼')\n      router.push('/profile/recharge')\n      return\n    }\n    \n    paying.value = true\n    try {\n      const preOrder = preOrders.value[0]\n      const res = await supabasePreOrderApi.confirmPreOrder(\n        preOrder.id, \n        'balance',\n        selectedCoupon.value?.id\n      )\n      \n      if (!res.success) {\n        // if (res.error?.includes('ä½™é¢ä¸è¶³')) {\n        //   showBalanceModal.value = true\n        // } else {\n          ElMessage.error(res.error || 'æ”¯ä»˜å¤±è´¥')\n        // }\n        return\n      }\n      \n      lastOrderId.value = res.order_no || ''\n      lastOrderAmount.value = finalPayAmount.value\n      showPaySuccess.value = true\n      await userStore.fetchUserInfo()\n      \n    } catch (e: any) {\n      ElMessage.error(e.message || 'ç³»ç»Ÿå¼‚å¸¸')\n    } finally {\n      paying.value = false\n    }\n  }\n\n  const formatSpec = (spec: any) => {\n    if (!spec) return 'é»˜è®¤è§„æ ¼'\n    return Object.values(spec).join(' / ')\n  }\n\n  // Cleanup\n  onUnmounted(() => {\n    if (countdownTimer) clearInterval(countdownTimer)\n    if (pollTimer) clearInterval(pollTimer)\n  })\n\n  return {\n    // State\n    loading,\n    error,\n    preOrders,\n    paying,\n    // showBalanceModal, // Removed\n    showPaySuccess,\n    refreshingBalance, // New\n    lastOrderId,\n    lastOrderAmount,\n    selectedCoupon,\n    couponDiscount,\n    remainingSeconds,\n    \n    // Computed\n    totalProductAmount,\n    finalPayAmount,\n    userBalance,\n    orderSkuIds,\n    orderProductIds,\n    formatCountdown,\n    \n    // Methods\n    loadPreOrders,\n    handleCouponSelect,\n    handlePay,\n    formatSpec,\n    refreshBalance // New\n  }\n}\n","<template>\n  <div class=\"modal-mask\" @click.self=\"$emit('close')\">\n    <div class=\"pay-success-modal glass-card\">\n      <div class=\"success-header\">\n        <div class=\"success-circle\">\n          <div class=\"success-icon-wrapper\">\n            <svg width=\"60\" height=\"60\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <polyline points=\"20 6 9 17 4 12\"></polyline>\n            </svg>\n          </div>\n        </div>\n        <div class=\"success-title\">æ”¯ä»˜æˆåŠŸ</div>\n        <div class=\"success-desc\">æ‚¨çš„è®¢å•å·²ç¡®è®¤ï¼Œæ„Ÿè°¢æ‚¨çš„è´­ä¹°</div>\n      </div>\n      \n      <div class=\"success-info\">\n        <div class=\"info-row\">\n          <span class=\"info-label\">è®¢å•ç¼–å·</span>\n          <span class=\"info-value info-link\">{{ safeOrderId }}</span>\n        </div>\n        <div class=\"info-divider\"></div>\n        <div class=\"info-row\">\n          <span class=\"info-label\">æ”¯ä»˜é‡‘é¢</span>\n          <span class=\"info-value info-amount\">Â¥{{ safeAmount }}</span>\n        </div>\n        <div class=\"info-divider\"></div>\n        <div class=\"info-row\">\n          <span class=\"info-label\">æ”¯ä»˜æ–¹å¼</span>\n          <span class=\"info-value info-paytype\">{{ safePayTypeName }}</span>\n        </div>\n        <div class=\"info-divider\"></div>\n        <div class=\"info-row\">\n          <span class=\"info-label\">æ”¯ä»˜æ—¶é—´</span>\n          <span class=\"info-value info-time\">{{ safeTime }}</span>\n        </div>\n      </div>\n      \n      <!-- New Status Display -->\n      <div class=\"status-box\">\n        <div class=\"status-icon\">ğŸš€</div>\n        <div class=\"status-text\">ç³»ç»Ÿæ­£åœ¨ä¸ºæ‚¨è‡ªåŠ¨å‘è´§ï¼Œè¯·ç¨å€™æŸ¥çœ‹</div>\n      </div>\n      \n      <div class=\"success-actions\">\n        <button class=\"order-btn\" @click=\"handleGoToOrders\">\n          å‰å¾€æŸ¥çœ‹è®¢å•\n        </button>\n        <button class=\"home-btn\" @click=\"handleGoToHome\">\n          è¿”å›é¦–é¡µ\n        </button>\n      </div>\n      \n      <div class=\"success-tip\">\n        å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»å®¢æœ \n        <span class=\"kefu-phone\">åœ¨çº¿å®¢æœ</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nconst props = defineProps({\n  orderId: { \n    type: String, \n    default: 'N/A'\n  },\n  payType: { \n    type: String, \n    default: 'balance'\n  },\n  amount: { \n    type: [String, Number], \n    default: 0\n  }\n})\n\nconst emits = defineEmits(['close'])\n\nconst safeOrderId = computed(() => {\n  return props.orderId || 'N/A'\n})\n\nconst safeAmount = computed(() => {\n  try {\n    const num = typeof props.amount === 'string' ? parseFloat(props.amount || '0') : (props.amount || 0)\n    return isNaN(num) ? '0.00' : num.toFixed(2)\n  } catch {\n    return '0.00'\n  }\n})\n\nconst safePayTypeName = computed(() => {\n  const typeMap: Record<string, string> = {\n    'alipay': 'æ”¯ä»˜å®æ”¯ä»˜',\n    'balance': 'ä½™é¢æ”¯ä»˜',\n    'other': 'å…¶ä»–æ”¯ä»˜'\n  }\n  return typeMap[props.payType] || 'æœªçŸ¥æ”¯ä»˜æ–¹å¼'\n})\n\nconst safeTime = computed(() => {\n  try {\n    const now = new Date()\n    return now.toLocaleString('zh-CN', { hour12: false })\n  } catch {\n    return 'åˆšåˆš'\n  }\n})\n\nconst handleGoToHome = () => {\n  emits('close')\n  try {\n    navigateTo('/')\n  } catch (error) {\n    window.location.href = '/'\n  }\n}\n\nconst handleGoToOrders = () => {\n  emits('close')\n  try {\n    // Go to specific order detail page\n    if (props.orderId && props.orderId !== 'N/A') {\n      navigateTo(`/profile/order/${props.orderId}`)\n    } else {\n      navigateTo('/profile/orders')\n    }\n  } catch (error) {\n    window.location.href = '/profile/orders'\n  }\n}\n</script>\n\n<style scoped>\n.modal-mask {\n  position: fixed;\n  z-index: 3000;\n  left: 0; top: 0; right: 0; bottom: 0;\n  background: rgba(0,0,0,0.6);\n  backdrop-filter: blur(8px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  animation: fadeIn 0.3s ease-out;\n}\n\n.pay-success-modal {\n  width: 420px;\n  background: rgba(30, 41, 59, 0.85); /* Glass Dark */\n  backdrop-filter: blur(16px);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 24px;\n  overflow: hidden;\n  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 40px 32px 32px 32px;\n  animation: slideUp 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);\n  position: relative;\n}\n\n/* Add a subtle glow at the top */\n.pay-success-modal::before {\n  content: '';\n  position: absolute;\n  top: 0; left: 0; right: 0;\n  height: 4px;\n  background: linear-gradient(90deg, var(--active-orange), var(--primary-blue));\n}\n\n.success-header {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-bottom: 32px;\n  width: 100%;\n}\n\n.success-circle {\n  width: 80px;\n  height: 80px;\n  background: linear-gradient(135deg, var(--active-orange), #ff9f43);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 20px;\n  box-shadow: 0 10px 30px rgba(249, 115, 22, 0.4);\n  animation: bounceIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n}\n\n.success-icon-wrapper {\n  color: #fff;\n  animation: checkWiggle 0.8s ease-in-out 0.4s;\n}\n\n.success-title {\n  font-size: 26px;\n  font-weight: 800;\n  color: #fff;\n  margin-bottom: 8px;\n  text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);\n}\n\n.success-desc {\n  font-size: 14px;\n  color: var(--text-sub);\n  text-align: center;\n}\n\n.success-info {\n  width: 100%;\n  background: rgba(255, 255, 255, 0.03);\n  border: 1px solid rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 16px;\n  margin-bottom: 20px;\n}\n\n.info-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 0;\n  font-size: 14px;\n}\n\n.info-divider {\n  width: 100%;\n  height: 1px;\n  background: rgba(255, 255, 255, 0.05);\n}\n\n.info-label {\n  color: var(--text-sub);\n}\n\n.info-value {\n  color: var(--text-main);\n  font-weight: 600;\n}\n\n.info-link {\n  color: var(--primary-blue);\n  font-family: monospace;\n}\n\n.info-amount {\n  color: #fff;\n  font-size: 16px;\n  font-weight: 700;\n}\n\n/* Status Box */\n.status-box {\n  width: 100%;\n  background: rgba(34, 197, 94, 0.1);\n  border: 1px solid rgba(34, 197, 94, 0.2);\n  border-radius: 12px;\n  padding: 12px;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  margin-bottom: 24px;\n}\n\n.status-icon {\n  font-size: 20px;\n}\n\n.status-text {\n  font-size: 13px;\n  color: #4ade80; /* Green-400 */\n}\n\n/* Actions */\n.success-actions {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.order-btn {\n  width: 100%;\n  background: linear-gradient(90deg, var(--active-orange) 0%, #FB923C 100%);\n  color: #fff;\n  border: none;\n  border-radius: 12px;\n  font-size: 16px;\n  font-weight: 700;\n  padding: 14px 0;\n  cursor: pointer;\n  transition: all 0.3s;\n  box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);\n}\n\n.order-btn:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4);\n}\n\n.home-btn {\n  width: 100%;\n  background: rgba(255, 255, 255, 0.05);\n  color: var(--text-sub);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  font-size: 15px;\n  font-weight: 600;\n  padding: 14px 0;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.home-btn:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: #fff;\n  border-color: rgba(255, 255, 255, 0.2);\n}\n\n.success-tip {\n  margin-top: 24px;\n  font-size: 12px;\n  color: var(--text-sub);\n  text-align: center;\n}\n\n.kefu-phone {\n  color: var(--primary-blue);\n  cursor: pointer;\n  font-weight: 600;\n}\n\n/* Animations */\n@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }\n@keyframes bounceIn {\n  from, 20%, 40%, 60%, 80%, to { animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1); }\n  0% { transform: scale3d(0.3, 0.3, 0.3); opacity: 0; }\n  20% { transform: scale3d(1.1, 1.1, 1.1); }\n  40% { transform: scale3d(0.9, 0.9, 0.9); }\n  60% { transform: scale3d(1.03, 1.03, 1.03); }\n  80% { transform: scale3d(0.97, 0.97, 0.97); }\n  to { transform: scale3d(1, 1, 1); opacity: 1; }\n}\n@keyframes checkWiggle {\n  0% { transform: rotate(0deg); }\n  25% { transform: rotate(-10deg); }\n  50% { transform: rotate(10deg); }\n  75% { transform: rotate(-5deg); }\n  100% { transform: rotate(0deg); }\n}\n</style>","<template>\n  <div class=\"checkout-page\">\n    <div class=\"checkout-content\">\n      <!-- å¤´éƒ¨å¯¼èˆª -->\n      <div class=\"checkout-header\">\n        <button class=\"back-btn\" @click=\"router.back()\">\n          <el-icon><ArrowLeft /></el-icon> è¿”å›\n        </button>\n        <div class=\"page-title\">è®¢å•ç»“ç®—</div>\n      </div>\n\n      <!-- åŠ è½½ä¸­ -->\n      <div class=\"checkout-loading\" v-if=\"loading\">\n        <div class=\"glass-loader\"></div>\n        <p>æ­£åœ¨åŠ è½½è®¢å•ä¿¡æ¯...</p>\n      </div>\n\n      <!-- é”™è¯¯çŠ¶æ€ -->\n      <div class=\"checkout-error\" v-else-if=\"error\">\n        <div class=\"error-icon\">âš ï¸</div>\n        <p>{{ error }}</p>\n        <button class=\"action-btn\" @click=\"router.push('/')\">è¿”å›é¦–é¡µ</button>\n      </div>\n\n      <!-- æ­£å¸¸ç»“ç®— -->\n      <div class=\"checkout-main\" v-else-if=\"preOrders.length > 0\">\n        <!-- å·¦ä¾§ï¼šè®¢å•é¢„è§ˆ -->\n        <div class=\"order-section\">\n          <!-- å€’è®¡æ—¶æç¤º -->\n          <div class=\"countdown-bar\" v-if=\"remainingSeconds > 0\">\n            <el-icon><Timer /></el-icon>\n            <span>è¯·åœ¨ <strong class=\"time-highlight\">{{ formatCountdown }}</strong> å†…å®Œæˆæ”¯ä»˜ï¼Œè¶…æ—¶å°†é‡Šæ”¾åº“å­˜</span>\n          </div>\n\n          <!-- é¢„è®¢å•åˆ—è¡¨ -->\n          <div class=\"order-list\">\n            <div v-for=\"order in preOrders\" :key=\"order.id\" class=\"order-card glass-card\">\n              <div class=\"order-header-row\">\n                <span class=\"order-no\">è®¢å•å·: {{ order.order_no }}</span>\n                <span class=\"order-status\">å¾…æ”¯ä»˜</span>\n              </div>\n              \n              <div class=\"order-body\">\n                <div class=\"product-thumb\">\n                  <div class=\"sq-cover-img-container\">\n                    <img :src=\"order.product_snapshot?.image || '/images/shared/logo.png'\" class=\"sq-cover-img\" />\n                  </div>\n                </div>\n                <div class=\"product-info\">\n                  <div class=\"product-name\">{{ order.product_snapshot?.product_name }}</div>\n                  <div class=\"product-meta-row\">\n                     <el-tag size=\"small\" effect=\"dark\" class=\"spec-tag\">{{ formatSpec(order.sku_snapshot?.spec_combination) }}</el-tag>\n                     <span class=\"delivery-info\">å‘è´§æ–¹å¼ï¼šè‡ªåŠ¨å‘è´§</span>\n                  </div>\n                </div>\n                <div class=\"product-price\">\n                  <div class=\"price-val\">{{ order.unit_price.toFixed(2) }} ç‚¹</div>\n                  <div class=\"qty\">x{{ order.quantity }}</div>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <!-- æ¸©é¦¨æç¤º moved to bottom of left section -->\n          <div class=\"tips-container\">\n             <div class=\"tips-card glass-card\">\n              <h4><el-icon><InfoFilled /></el-icon> æ¸©é¦¨æç¤º</h4>\n              <ul>\n                <li>èµ„æºå·²ä¸ºæ‚¨é”å®šï¼Œè¯·å°½å¿«å®Œæˆæ”¯ä»˜ã€‚</li>\n                <li>è¶…æ—¶æœªæ”¯ä»˜å°†è‡ªåŠ¨é‡Šæ”¾ï¼Œéœ€é‡æ–°ä¸‹å•ã€‚</li>\n                <li>å¦‚é‡é—®é¢˜ï¼Œè¯·è”ç³»åœ¨çº¿å®¢æœã€‚</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n\n        <!-- å³ä¾§ï¼šç»“ç®—å° -->\n        <div class=\"summary-section\">\n          <div class=\"summary-card glass-card sticky-card\">\n            <h3 class=\"card-title\">æ”¯ä»˜è¯¦æƒ…</h3>\n            \n            <!-- ä»·æ ¼æ˜ç»† -->\n            <div class=\"price-rows\">\n              <div class=\"price-row\">\n                <span>å•†å“æ€»é¢</span>\n                <span class=\"val\">{{ totalProductAmount.toFixed(2) }} ç‚¹</span>\n              </div>\n              \n              <!-- ä¼˜æƒ åˆ¸é€‰æ‹© -->\n              <div class=\"price-row coupon-row\" @click=\"showCouponModal = true\">\n                <div class=\"coupon-label\">\n                  <span>ä¼˜æƒ åˆ¸</span>\n                  <el-tag v-if=\"selectedCoupon\" size=\"small\" type=\"danger\" effect=\"dark\" class=\"discount-tag\">\n                    å·²æŠµæ‰£ {{ couponDiscount.toFixed(2) }} ç‚¹\n                  </el-tag>\n                </div>\n                <div class=\"coupon-action\">\n                  <span v-if=\"selectedCoupon\" class=\"val discount\">-{{ couponDiscount.toFixed(2) }} ç‚¹</span>\n                  <span v-else class=\"placeholder\">é€‰æ‹©ä¼˜æƒ åˆ¸</span>\n                  <el-icon><ArrowRight /></el-icon>\n                </div>\n              </div>\n\n              <div class=\"divider\"></div>\n\n              <div class=\"price-row total\">\n                <span>åº”ä»˜é‡‘é¢</span>\n                <span class=\"val final\">{{ finalPayAmount.toFixed(2) }} ç‚¹</span>\n              </div>\n            </div>\n\n            <!-- æ”¯ä»˜æ–¹å¼ (Changes: Balance -> Quota) -->\n            <div class=\"payment-method\">\n              <div class=\"method-title\">æ”¯ä»˜æ–¹å¼</div>\n              <div class=\"balance-card active\">\n                <div class=\"balance-icon\">\n                  <el-icon><Wallet /></el-icon>\n                </div>\n                <div class=\"balance-info\">\n                  <div class=\"method-name\">é¢åº¦æ”¯ä»˜</div>\n                  <div class=\"user-balance-row\">\n                      <span class=\"user-balance\">å¯ç”¨é¢åº¦: {{ userBalance.toFixed(2) }} ç‚¹</span>\n                      <el-button link type=\"primary\" size=\"small\" @click.stop=\"refreshBalance\" :loading=\"refreshingBalance\" class=\"refresh-btn\">\n                          <el-icon><Refresh /></el-icon>\n                      </el-button>\n                  </div>\n                </div>\n                <div class=\"check-mark\"><el-icon><Select /></el-icon></div>\n              </div>\n            </div>\n\n            <!-- æ”¯ä»˜æŒ‰é’® -->\n            <div class=\"action-area\">\n              <button \n                class=\"pay-btn\" \n                :class=\"{ 'insufficient': isBalanceInsufficient }\"\n                :disabled=\"paying || remainingSeconds <= 0\"\n                @click=\"handlePayAction\"\n              >\n                <div v-if=\"paying\" class=\"btn-loader\"></div>\n                <!-- Logic change: If insufficient, show 'Go Recharge' -->\n                <span v-else-if=\"isBalanceInsufficient\">é¢åº¦ä¸è¶³ï¼Œå»å……å€¼</span>\n                <span v-else>ç«‹å³æ”¯ä»˜ {{ finalPayAmount.toFixed(2) }} ç‚¹</span>\n              </button>\n              <div class=\"agreement-text\">\n                ç‚¹å‡»æ”¯ä»˜å³è¡¨ç¤ºåŒæ„ <a href=\"/docs/terms\" target=\"_blank\">æœåŠ¡åè®®</a> å’Œ <a href=\"/docs/privacy\" target=\"_blank\">éšç§åè®®</a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- å¼¹çª—ç»„ä»¶ -->\n    <!-- BalanceNotEnoughModal removed -->\n    \n    <PaySuccessModal \n      v-if=\"showPaySuccess\" \n      :orderId=\"lastOrderId\" \n      :amount=\"lastOrderAmount\" \n      :payType=\"'balance'\"\n      @close=\"handlePaySuccessClose\"\n    />\n\n    <CouponSelectorModal\n      v-model=\"showCouponModal\"\n      :orderAmount=\"totalProductAmount\"\n      :skuIds=\"orderSkuIds\"\n      :productIds=\"orderProductIds\"\n      :currentCouponId=\"selectedCoupon?.id\"\n      @select=\"handleCouponSelect\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ArrowLeft, Timer, InfoFilled, ArrowRight, Wallet, Select, Refresh } from '@element-plus/icons-vue'\nimport { useCheckout } from '@/composables/client/useCheckout'\n// BalanceNotEnoughModal import removed\nimport PaySuccessModal from '@/components/PaySuccessModal.vue'\nimport CouponSelectorModal from '@/components/modal/business/CouponSelectorModal.vue'\n\ndefinePageMeta({ ssr: false })\n\nconst route = useRoute()\nconst router = useRouter()\nconst showCouponModal = ref(false)\n\n// Use Composable\nconst {\n  loading,\n  error,\n  preOrders,\n  paying,\n  showPaySuccess,\n  \n  lastOrderId,\n  lastOrderAmount,\n  selectedCoupon,\n  couponDiscount,\n  \n  remainingSeconds,\n  formatCountdown,\n  \n  totalProductAmount,\n  finalPayAmount,\n  userBalance,\n  orderSkuIds,\n  orderProductIds,\n  \n  loadPreOrders,\n  handleCouponSelect,\n  handlePay,\n  formatSpec,\n  refreshBalance, // New\n  refreshingBalance // New\n} = useCheckout()\n\n// Computed\nconst preOrderIds = computed(() => {\n  const id = route.params.id as string\n  const ids = route.query.ids as string\n  if (ids) return ids.split(',')\n  if (id) return [id]\n  return []\n})\n\nconst isBalanceInsufficient = computed(() => {\n    return userBalance.value < finalPayAmount.value\n})\n\nconst handlePayAction = () => {\n    if (isBalanceInsufficient.value) {\n        // Redirect to recharge\n        router.push('/profile/recharge') // Assuming recharge route\n        return\n    }\n    handlePay()\n}\n\n// Lifecycle\nonMounted(() => {\n  loadPreOrders(preOrderIds.value)\n})\n\nconst handlePaySuccessClose = () => {\n  showPaySuccess.value = false\n  router.push('/profile/orders')\n}\n</script>\n\n<style scoped>\n.checkout-page {\n  /* Using global background, no need for specific background here as per theme */\n  min-height: calc(100vh - 80px); /* Adjust for header */\n  position: relative;\n  font-family: 'PingFang SC', system-ui, sans-serif;\n  color: var(--text-main);\n}\n\n.checkout-content {\n  position: relative;\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 40px 24px;\n}\n\n/* Header */\n.checkout-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 32px;\n}\n\n.back-btn {\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  color: var(--text-sub);\n  padding: 8px 16px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.back-btn:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: #fff;\n  border-color: var(--active-orange);\n}\n\n.page-title {\n  font-size: 24px;\n  font-weight: 700;\n  margin-left: 20px;\n  color: #fff;\n  text-shadow: 0 0 10px rgba(23, 143, 198, 0.4);\n}\n\n/* Glass Card Global Override for Local Use if needed, \n   but ideally we use global .glass-card if available, \n   here we define local specific tweaks */\n.glass-card {\n  background: rgba(30, 41, 59, 0.6);\n  backdrop-filter: blur(12px);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 20px;\n  padding: 24px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n}\n\n/* Main Layout */\n.checkout-main {\n  display: grid;\n  grid-template-columns: 1fr 380px;\n  gap: 32px;\n}\n\n/* Order Section */\n.countdown-bar {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  background: rgba(249, 115, 22, 0.1);\n  border: 1px solid rgba(249, 115, 22, 0.2);\n  color: var(--active-orange);\n  padding: 12px 20px;\n  border-radius: 12px;\n  margin-bottom: 24px;\n  font-size: 14px;\n}\n\n.time-highlight {\n  font-family: monospace;\n  font-size: 16px;\n  font-weight: 700;\n}\n\n.order-card {\n  margin-bottom: 20px;\n  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\n}\n\n.order-card:hover {\n  transform: translateY(-2px);\n  border-color: var(--primary-blue);\n  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);\n}\n\n.order-header-row {\n  display: flex;\n  justify-content: space-between;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n  padding-bottom: 12px;\n  margin-bottom: 16px;\n  font-size: 13px;\n  color: var(--text-sub);\n}\n\n.order-body {\n  display: flex;\n  gap: 16px;\n}\n\n.product-thumb {\n  width: 72px;\n  height: 72px;\n  border-radius: 12px;\n  overflow: hidden;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.product-info {\n  flex: 1;\n}\n\n.product-name {\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--text-main);\n  margin-bottom: 8px;\n}\n\n.product-meta-row {\n    display: flex; gap: 12px; align-items: center;\n}\n\n.spec-tag {\n    /* Element Plus Tag Override */\n    --el-tag-bg-color: rgba(255, 255, 255, 0.1);\n    --el-tag-border-color: rgba(255, 255, 255, 0.2);\n    --el-tag-text-color: var(--text-sub);\n}\n\n.delivery-info {\n    font-size: 12px; color: var(--primary-blue);\n    background: rgba(59, 130, 246, 0.1);\n    padding: 2px 8px; border-radius: 4px;\n}\n\n\n.product-price {\n  text-align: right;\n}\n\n.price-val {\n  font-size: 18px;\n  font-weight: 700;\n  color: var(--active-orange);\n}\n\n.qty {\n  font-size: 13px;\n  color: var(--text-sub);\n  margin-top: 4px;\n}\n\n.tips-container {\n    margin-top: auto;\n}\n\n.tips-card h4 {\n  font-size: 15px;\n  color: var(--text-main);\n  margin: 0 0 12px 0;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.tips-card ul {\n  margin: 0;\n  padding-left: 20px;\n  color: var(--text-sub);\n  font-size: 13px;\n  line-height: 1.8;\n}\n\n/* Summary Section */\n.sticky-card {\n  position: sticky;\n  top: 100px;\n  min-height: 480px; /* Slight height increase */\n  display: flex; flex-direction: column;\n}\n\n.card-title {\n  font-size: 18px;\n  font-weight: 700;\n  margin: 0 0 24px 0;\n  color: #fff;\n  border-left: 4px solid var(--primary-blue);\n  padding-left: 12px;\n}\n\n.price-rows {\n  margin-bottom: 24px;\n}\n\n.price-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 14px;\n  font-size: 14px;\n  color: var(--text-sub);\n}\n\n.val {\n  color: var(--text-main);\n  font-weight: 500;\n}\n\n/* Coupon Row */\n.coupon-row {\n  cursor: pointer;\n  padding: 8px 0;\n  transition: opacity 0.2s;\n}\n\n.coupon-row:hover {\n  opacity: 0.8;\n}\n\n.coupon-label {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.discount-tag {\n  border: none;\n  background: rgba(239, 68, 68, 0.2);\n  color: #F87171;\n}\n\n.coupon-action {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n.placeholder {\n  color: var(--text-sub);\n  font-size: 13px;\n}\n\n.val.discount {\n  color: #EF4444;\n}\n\n.divider {\n  height: 1px;\n  background: rgba(255, 255, 255, 0.08);\n  margin: 20px 0;\n}\n\n.price-row.total .val.final {\n  font-size: 28px;\n  color: var(--active-orange);\n  font-weight: 700;\n  text-shadow: 0 0 15px rgba(249, 115, 22, 0.3);\n}\n\n/* Payment Method */\n.payment-method {\n    flex: 1; /* Push others */\n}\n.method-title {\n  font-size: 15px;\n  font-weight: 600;\n  color: var(--text-sub);\n  margin-bottom: 16px;\n}\n\n.balance-card {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  background: rgba(23, 143, 198, 0.1);\n  border: 1px solid rgba(23, 143, 198, 0.3);\n  padding: 20px;\n  border-radius: 16px;\n  margin-bottom: 32px;\n  position: relative;\n  transition: all 0.2s;\n}\n\n.balance-card.active {\n  background: rgba(23, 143, 198, 0.15);\n  border-color: var(--primary-blue);\n  box-shadow: 0 4px 20px rgba(23, 143, 198, 0.15);\n}\n\n.balance-icon {\n  font-size: 28px;\n  color: var(--primary-blue);\n}\n\n.balance-info {\n  flex: 1;\n}\n\n.method-name {\n  font-size: 16px;\n  font-weight: 600;\n  color: #fff;\n}\n\n.user-balance-row {\n    display: flex; align-items: center; gap: 8px; margin-top: 4px;\n}\n\n.user-balance {\n  font-size: 13px;\n  color: var(--text-sub);\n}\n.refresh-btn {\n    padding: 0; height: auto;\n}\n.refresh-btn :deep(.el-icon) {\n    font-size: 14px; color: var(--text-sub);\n}\n.refresh-btn:hover :deep(.el-icon) {\n    color: var(--active-orange);\n}\n\n.check-mark {\n  margin-left: auto;\n  color: var(--primary-blue);\n  font-weight: bold;\n  font-size: 18px;\n}\n\n/* Action Area */\n.pay-btn {\n  width: 100%;\n  background: linear-gradient(90deg, var(--active-orange) 0%, #FB923C 100%);\n  color: #fff;\n  border: none;\n  padding: 16px;\n  border-radius: 14px;\n  font-size: 18px;\n  font-weight: 700;\n  cursor: pointer;\n  transition: all 0.3s;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);\n}\n\n.pay-btn:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4);\n}\n\n.pay-btn.insufficient {\n    background: #334155;\n    box-shadow: none;\n    color: #94A3B8;\n}\n.pay-btn.insufficient:hover {\n    background: #475569;\n    color: #fff;\n}\n\n.pay-btn:disabled {\n  background: #1e293b;\n  color: #64748B;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n\n.agreement-text {\n  text-align: center;\n  font-size: 12px;\n  color: var(--text-sub);\n  margin-top: 16px;\n}\n\n.agreement-text a {\n  color: var(--primary-blue);\n  text-decoration: none;\n  transition: color 0.2s;\n}\n\n.agreement-text a:hover {\n  color: var(--active-orange);\n}\n\n/* Loading/Error */\n.checkout-loading, .checkout-error {\n  text-align: center;\n  padding: 100px 0;\n  color: var(--text-sub);\n}\n\n.action-btn {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  color: #fff;\n  padding: 8px 20px;\n  border-radius: 20px;\n  cursor: pointer;\n  margin-top: 16px;\n  transition: all 0.2s;\n}\n\n.action-btn:hover {\n  background: rgba(255, 255, 255, 0.2);\n}\n\n.glass-loader {\n  width: 40px;\n  height: 40px;\n  border: 4px solid rgba(255, 255, 255, 0.1);\n  border-left-color: var(--primary-blue);\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin: 0 auto 16px;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n</style>\n"],"names":["_ssrRenderAttrs","_mergeProps","_unref","_ssrRenderList","_ssrInterpolate","_withCtx","_createVNode","Refresh"],"mappings":"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"}