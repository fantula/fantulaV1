{"version":3,"file":"useAdminOrderList-DviHj6Hn.js","sources":["../../../../composables/admin/useAdminOrderList.ts"],"sourcesContent":["\nimport { ref } from 'vue'\nimport { adminOrderApi, type AdminOrder } from '@/api/admin/order'\nimport { ElMessage } from 'element-plus'\nimport { DEFAULT_AVATAR } from '@/utils/constants'\nimport { useBizConfig } from '@/composables/common/useBizConfig'\nimport { useBizFormat } from '@/composables/common/useBizFormat'\n\n/**\n * 后台订单列表通用逻辑\n * @param orderType 订单类型 ('virtual' | 'shared_account' | 'one_time_cdk')\n */\nexport function useAdminOrderList(orderType: 'virtual' | 'shared_account' | 'one_time_cdk') {\n    const loading = ref(false)\n    const list = ref<AdminOrder[]>([])\n    const total = ref(0)\n    const page = ref(1)\n    const pageSize = ref(20)\n    const selectedIds = ref<string[]>([])\n\n    // 加载列表\n    async function loadList() {\n        loading.value = true\n        try {\n            const { success, orders, total: totalCount, error } = await adminOrderApi.getOrders({\n                page: page.value,\n                pageSize: pageSize.value,\n                order_type: orderType,\n                exclude_status: ['refunding', 'refunded'] // 排除退款中和已退款的订单\n            })\n\n            if (!success) {\n                ElMessage.error(error || '加载失败')\n                return\n            }\n\n            // Double Hydration Protection (Already handled in API, but kept for safety)\n            list.value = orders\n            total.value = totalCount\n\n        } catch (e) {\n            console.error('加载订单失败:', e)\n            ElMessage.error('系统异常')\n        } finally {\n            loading.value = false\n        }\n    }\n\n    // 分页处理\n    function handlePageChange(val: number) {\n        page.value = val\n        loadList()\n    }\n\n    function handleSizeChange(val: number) {\n        pageSize.value = val\n        page.value = 1\n        loadList()\n    }\n\n    // 选中处理\n    function handleSelectionChange(selection: AdminOrder[]) {\n        selectedIds.value = selection.map(item => item.id)\n    }\n\n    // 工具函数：复制\n    function handleCopy(text: string) {\n        if (!text) return\n        navigator.clipboard.writeText(text)\n        ElMessage.success('已复制')\n    }\n\n    // 工具函数：格式化规格\n    function formatSpec(spec: any): string {\n        if (!spec) return '-'\n        if (typeof spec === 'string') return spec\n        if (typeof spec === 'object') {\n            return Object.entries(spec).map(([k, v]) => `${k}: ${v}`).join(' / ')\n        }\n        return '-'\n    }\n\n    // --- Global Standard Helpers ---\n    const { formatPrice, formatDate } = useBizFormat()\n    const { getOrderStatusLabel, getOrderStatusType } = useBizConfig()\n\n    // Status Helpers (Mapped to Global)\n    const getStatusText = (status: string) => getOrderStatusLabel(status)\n    const getStatusType = (status: string) => getOrderStatusType(status)\n    const formatTime = (time: string) => formatDate(time)\n\n    return {\n        // State\n        loading,\n        list,\n        total,\n        page,\n        pageSize,\n        selectedIds,\n        DEFAULT_AVATAR,\n\n        // Actions\n        loadList,\n        handlePageChange,\n        handleSizeChange,\n        handleSelectionChange,\n        handleCopy,\n\n        // Helpers\n        formatSpec,\n        getStatusText,\n        getStatusType,\n        formatTime,\n        formatPrice\n    }\n}\n"],"names":[],"mappings":";;;;;;AAYO,SAAA,kBAAA,WAAA;AACH,QAAA,UAAA,IAAA,KAAA;AACA,QAAA,OAAA,IAAA,EAAA;AACA,QAAA,QAAA,IAAA,CAAA;AACA,QAAA,OAAA,IAAA,CAAA;AACA,QAAA,WAAA,IAAA,EAAA;AACA,QAAA,cAAA,IAAA,EAAA;AAGA,iBAAA,WAAA;AACI,YAAA,QAAA;AACA,QAAA;AACI,YAAA,EAAA,SAAA,QAAA,OAAA,YAAA,MAAA,IAAA,MAAA,cAAA,UAAA;AAAA,QAAoF,MAAA,KAAA;AAAA,QACrE,UAAA,SAAA;AAAA,QACQ,YAAA;AAAA,QACP,gBAAA,CAAA,aAAA,UAAA;AAAA;AAAA,MAC4B,CAAA;AAG5C,UAAA,CAAA,SAAA;AACI,kBAAA,MAAA,SAAA,MAAA;AACA;AAAA,MAAA;AAIJ,WAAA,QAAA;AACA,YAAA,QAAA;AAAA,IAAc,SAAA,GAAA;AAGd,cAAA,MAAA,WAAA,CAAA;AACA,gBAAA,MAAA,MAAA;AAAA,IAAsB,UAAA;AAEtB,cAAA,QAAA;AAAA,IAAgB;AAAA,EACpB;AAIJ,WAAA,iBAAA,KAAA;AACI,SAAA,QAAA;AACA,aAAA;AAAA,EAAS;AAGb,WAAA,iBAAA,KAAA;AACI,aAAA,QAAA;AACA,SAAA,QAAA;AACA,aAAA;AAAA,EAAS;AAIb,WAAA,sBAAA,WAAA;AACI,gBAAA,QAAA,UAAA,IAAA,CAAA,SAAA,KAAA,EAAA;AAAA,EAAiD;AAIrD,WAAA,WAAA,MAAA;AACI,QAAA,CAAA,KAAA;AACA,IAAA,SAAA,UAAA,UAAA,IAAA;AACA,cAAA,QAAA,KAAA;AAAA,EAAuB;AAI3B,WAAA,WAAA,MAAA;AACI,QAAA,CAAA,KAAA,QAAA;AACA,QAAA,OAAA,SAAA,SAAA,QAAA;AACA,QAAA,OAAA,SAAA,UAAA;AACI,aAAA,OAAA,QAAA,IAAA,EAAA,IAAA,CAAA,CAAA,GAAA,CAAA,MAAA,GAAA,CAAA,KAAA,CAAA,EAAA,EAAA,KAAA,KAAA;AAAA,IAAoE;AAExE,WAAA;AAAA,EAAO;AAIX,QAAA,EAAA,aAAA,WAAA,IAAA,aAAA;AACA,QAAA,EAAA,qBAAA,mBAAA,IAAA,aAAA;AAGA,QAAA,gBAAA,CAAA,WAAA,oBAAA,MAAA;AACA,QAAA,gBAAA,CAAA,WAAA,mBAAA,MAAA;AACA,QAAA,aAAA,CAAA,SAAA,WAAA,IAAA;AAEA,SAAA;AAAA;AAAA,IAAO;AAAA,IAEH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA,IACA;AAAA,IAGA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA,IACA;AAAA,IAGA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACA;AAER;"}