{"file":"SkuEditor-H0DykQLU.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_unref","Delete","_ssrRenderList","_ssrInterpolate","_createVNode","_openBlock","_createBlock","_withCtx","Picture","_createTextVNode","_toDisplayString"],"sources":["../../../../components/admin/SkuEditor.vue"],"sourcesContent":["<template>\n  <div class=\"sku-editor\">\n    <!-- 规格配置区域 -->\n    <div class=\"spec-editor\">\n      <div class=\"spec-editor-header\">\n        <div class=\"panel-title\">规格配置</div>\n      </div>\n      \n      <div class=\"spec-list-grid\">\n        <div v-for=\"(spec, index) in specs\" :key=\"index\" class=\"spec-group\">\n          <div class=\"spec-header\">\n            <el-input v-model=\"spec.name\" placeholder=\"规格名 (如: 颜色)\" style=\"width: 150px;\" :disabled=\"readOnly\" />\n            <el-button v-if=\"!readOnly\" type=\"danger\" link @click=\"removeSpec(index)\" :icon=\"Delete\" circle />\n          </div>\n          <div class=\"spec-values\">\n            <el-tag \n              v-for=\"(val, vIndex) in spec.values\" \n              :key=\"vIndex\" \n              :closable=\"!readOnly\"\n              @close=\"removeSpecValue(index, vIndex)\"\n              class=\"spec-tag\"\n            >\n              {{ val }}\n            </el-tag>\n            <el-input \n              v-if=\"spec.inputVisible\"\n              ref=\"saveTagInput\"\n              v-model=\"spec.inputValue\"\n              class=\"input-new-tag\"\n              size=\"small\"\n              @keyup.enter=\"handleInputConfirm(index)\"\n              @blur=\"handleInputConfirm(index)\"\n            />\n            <el-button v-else-if=\"!readOnly\" class=\"button-new-tag\" size=\"small\" @click=\"showInput(index)\">+ 添加值</el-button>\n          </div>\n        </div>\n      </div>\n\n      <!-- 添加规格按钮 -->\n      <div class=\"add-spec-btn-container\" v-if=\"!readOnly\">\n        <div class=\"premium-add-btn\" @click=\"addSpec\">\n          <div class=\"btn-icon\"><Plus /></div>\n          <div class=\"btn-text\">\n            <span class=\"t1\">添加规格项目</span>\n            <span class=\"t2\">支持自定义规格名与属性值</span>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <el-divider />\n\n    <!-- SKU 表格 -->\n    <div class=\"sku-table-container\">\n      <div class=\"panel-title\">SKU 配置</div>\n      <el-table :data=\"skus\" border style=\"width: 100%\">\n        <!-- 动态规格列 -->\n        <el-table-column \n          v-for=\"(spec, index) in specs\" \n          :key=\"index\"\n          :label=\"spec.name || '规格'\" \n          min-width=\"100\"\n        >\n          <template #default=\"{ row }\">\n            {{ row.specValues[spec.name] }}\n          </template>\n        </el-table-column>\n\n        <!-- 类型选择列 -->\n        <el-table-column label=\"类型\" width=\"140\" align=\"center\">\n          <template #default=\"{ row }\">\n            <el-select v-model=\"row.product_type\" size=\"small\" placeholder=\"选择类型\" style=\"width: 100%;\" :disabled=\"readOnly\">\n              <el-option label=\"虚拟充值\" value=\"virtual\" />\n              <el-option label=\"账号合租\" value=\"shared_account\" />\n              <el-option label=\"兑换码\" value=\"one_time_cdk\" />\n            </el-select>\n          </template>\n        </el-table-column>\n\n        <!-- SKU 图片 -->\n        <el-table-column label=\"SKU图片\" width=\"100\" align=\"center\">\n          <template #default=\"{ row }\">\n            <div class=\"sku-img-uploader small-box\" @click=\"!readOnly && openSkuImagePicker(row)\" :class=\"{ disabled: readOnly }\">\n              <img v-if=\"row.image\" :src=\"row.image\" class=\"sku-img\" />\n              <div v-else class=\"sku-upload-placeholder\">\n                <el-icon><Picture /></el-icon>\n              </div>\n            </div>\n          </template>\n        </el-table-column>\n\n        <!-- 简介 -->\n        <el-table-column label=\"简介\" min-width=\"150\" v-if=\"!readOnly\">\n          <template #default=\"{ row }\">\n            <el-input v-model=\"row.intro\" size=\"small\" placeholder=\"简短描述\" />\n          </template>\n        </el-table-column>\n\n        <!-- 时长 -->\n        <el-table-column label=\"时长(天)\" width=\"100\">\n          <template #default=\"{ row }\">\n            <el-input-number v-model=\"row.duration\" size=\"small\" :min=\"0\" :controls=\"false\" style=\"width: 100%;\" :disabled=\"readOnly\" />\n          </template>\n        </el-table-column>\n\n        <!-- 售价 -->\n        <el-table-column label=\"售价 (元)\" width=\"140\" align=\"center\">\n          <template #default=\"{ row }\">\n            <el-input-number v-model=\"row.price\" :min=\"0\" :precision=\"2\" :step=\"1\" size=\"small\" style=\"width: 100%;\" :controls=\"false\" :disabled=\"readOnly\" />\n          </template>\n        </el-table-column>\n\n      </el-table>\n    </div>\n\n    <!-- 全局图片选择器 -->\n    <AdminImageSelector \n        v-model=\"imagePickerVisible\"\n        :multiple=\"false\"\n        @select=\"handleImageSelected\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch, nextTick, onMounted } from 'vue'\nimport { Plus, Delete, Picture } from '@element-plus/icons-vue'\nimport AdminImageSelector from '@/components/admin/base/AdminImageSelector.vue'\n\n// ========================================\n// Props\n// ========================================\ninterface SkuItem {\n  id?: string\n  key: string\n  specValues: Record<string, string>\n  product_type: 'virtual' | 'shared_account' | 'one_time_cdk'\n  price: number\n  duration: number | null\n  intro: string\n  image: string\n  tag?: number\n}\n\ninterface SpecItem {\n  name: string\n  values: string[]\n  inputVisible: boolean\n  inputValue: string\n}\n\nconst props = defineProps<{\n  mode: 'standalone' | 'linked'\n  productId?: string\n  tag?: number\n  initialSpecs?: SpecItem[]\n  initialSkus?: SkuItem[]\n  readOnly?: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'update:specs', specs: SpecItem[]): void\n  (e: 'update:skus', skus: SkuItem[]): void\n}>()\n\n// ========================================\n// State\n// ========================================\nconst specs = ref<SpecItem[]>([])\nconst skus = ref<SkuItem[]>([])\n\n// 监听初始数据变化（支持异步加载）\nwatch(() => props.initialSpecs, (newSpecs) => {\n  console.log('[SkuEditor] initialSpecs changed:', newSpecs)\n  if (newSpecs && newSpecs.length > 0) {\n    specs.value = JSON.parse(JSON.stringify(newSpecs))\n  }\n}, { immediate: true, deep: true })\n\nwatch(() => props.initialSkus, (newSkus) => {\n  console.log('[SkuEditor] initialSkus changed:', newSkus)\n  if (newSkus && newSkus.length > 0) {\n    skus.value = JSON.parse(JSON.stringify(newSkus))\n  }\n}, { immediate: true, deep: true })\n\n// ========================================\n// 规格管理\n// ========================================\nconst addSpec = () => {\n  specs.value.push({\n    name: '',\n    values: [],\n    inputVisible: false,\n    inputValue: ''\n  })\n}\n\nconst removeSpec = (index: number) => {\n  specs.value.splice(index, 1)\n  generateSKUs()\n}\n\nconst removeSpecValue = (specIndex: number, valueIndex: number) => {\n  specs.value[specIndex].values.splice(valueIndex, 1)\n  generateSKUs()\n}\n\nconst saveTagInput = ref<any[]>([])\n\nconst showInput = (index: number) => {\n  specs.value[index].inputVisible = true\n  nextTick(() => {\n    const inputRefs = saveTagInput.value\n    if (inputRefs && inputRefs[index]) {\n      inputRefs[index]?.focus?.()\n    }\n  })\n}\n\nconst handleInputConfirm = (index: number) => {\n  const inputVal = specs.value[index].inputValue.trim()\n  if (inputVal && !specs.value[index].values.includes(inputVal)) {\n    specs.value[index].values.push(inputVal)\n    generateSKUs()\n  }\n  specs.value[index].inputVisible = false\n  specs.value[index].inputValue = ''\n}\n\n// ========================================\n// SKU 生成\n// ========================================\nconst generateSKUs = () => {\n  const validSpecs = specs.value.filter(s => s.name && s.values.length > 0)\n  \n  if (validSpecs.length === 0) {\n    skus.value = []\n    emitUpdates()\n    return\n  }\n\n  // 生成笛卡尔积\n  const cartesian = (arrays: string[][]): string[][] => {\n    if (arrays.length === 0) return [[]]\n    const [first, ...rest] = arrays\n    const restCartesian = cartesian(rest)\n    return first.flatMap(item => restCartesian.map(r => [item, ...r]))\n  }\n\n  const specArrays = validSpecs.map(s => s.values)\n  const combinations = cartesian(specArrays)\n\n  // 保留现有 SKU 数据（按 key 匹配）\n  const existingMap = new Map<string, SkuItem>()\n  skus.value.forEach(sku => {\n    existingMap.set(sku.key, sku)\n  })\n\n  skus.value = combinations.map(combo => {\n    const specValues: Record<string, string> = {}\n    validSpecs.forEach((spec, idx) => {\n      specValues[spec.name] = combo[idx]\n    })\n    const key = combo.join('::')\n    \n    const existing = existingMap.get(key)\n    if (existing) {\n      return { ...existing, specValues }\n    }\n\n    return {\n      key,\n      specValues,\n      product_type: 'virtual' as const,\n      price: 0,\n      duration: null,\n      intro: '',\n      image: '',\n      tag: props.tag\n    }\n  })\n\n  emitUpdates()\n}\n\nconst emitUpdates = () => {\n  emit('update:specs', specs.value)\n  emit('update:skus', skus.value)\n}\n\nwatch(() => specs.value, () => {\n  // 不自动生成，只在值确认时生成\n}, { deep: true })\n\n// ========================================\n// 图片选择\n// ========================================\nconst imagePickerVisible = ref(false)\nconst currentSkuRow = ref<SkuItem | null>(null)\n\nconst openSkuImagePicker = (row: SkuItem) => {\n  currentSkuRow.value = row\n  imagePickerVisible.value = true\n}\n\nconst handleImageSelected = (urls: string[]) => {\n    if (urls.length > 0 && currentSkuRow.value) {\n        currentSkuRow.value.image = urls[0]\n        emitUpdates()\n    }\n}\n\n// ========================================\n// 公开方法\n// ========================================\ndefineExpose({\n  getSpecs: () => specs.value,\n  getSkus: () => skus.value,\n  setSpecs: (newSpecs: SpecItem[]) => {\n    specs.value = JSON.parse(JSON.stringify(newSpecs))\n  },\n  setSkus: (newSkus: SkuItem[]) => {\n    skus.value = JSON.parse(JSON.stringify(newSkus))\n  }\n})\n</script>\n\n<style scoped>\n.sku-editor { width: 100%; }\n.panel-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--el-text-color-primary); }\n.spec-editor { margin-bottom: 20px; }\n.spec-list-grid { display: flex; flex-wrap: wrap; gap: 16px; }\n.spec-group { background: var(--el-fill-color-light); border-radius: 8px; padding: 12px 16px; min-width: 200px; }\n.spec-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }\n.spec-values { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }\n.spec-tag { margin: 0; }\n.input-new-tag { width: 90px; }\n.button-new-tag { height: 24px; padding: 0 10px; }\n.add-spec-btn-container { margin-top: 16px; }\n.premium-add-btn { display: flex; align-items: center; gap: 12px; padding: 16px 20px; background: linear-gradient(135deg, rgba(64,158,255,0.08) 0%, rgba(64,158,255,0.02) 100%); border: 1px dashed var(--el-color-primary-light-5); border-radius: 8px; cursor: pointer; transition: all 0.2s; }\n.premium-add-btn:hover { background: linear-gradient(135deg, rgba(64,158,255,0.12) 0%, rgba(64,158,255,0.05) 100%); border-color: var(--el-color-primary); }\n.premium-add-btn .btn-icon { width: 40px; height: 40px; border-radius: 50%; background: var(--el-color-primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 20px; }\n.premium-add-btn .btn-text { display: flex; flex-direction: column; gap: 2px; }\n.premium-add-btn .btn-text .t1 { font-size: 14px; font-weight: 500; color: var(--el-text-color-primary); }\n.premium-add-btn .btn-text .t2 { font-size: 12px; color: var(--el-text-color-secondary); }\n.sku-table-container { margin-top: 20px; }\n.sku-img-uploader { width: 50px; height: 50px; border: 1px dashed var(--el-border-color); border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; overflow: hidden; margin: 0 auto; }\n.sku-img-uploader:hover { border-color: var(--el-color-primary); }\n.sku-img-uploader .sku-img { width: 100%; height: 100%; object-fit: cover; }\n.sku-img-uploader .sku-upload-placeholder { color: var(--el-text-color-placeholder); font-size: 16px; }\n</style>\n"],"version":3}