{"file":"TicketChatModal-DW4iUsSW.js","mappings":"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","names":["_push","_withCtx","_createVNode","_unref","RefreshRight","_ssrRenderList","Check","_openBlock","_createBlock","_createTextVNode","_toDisplayString","_createCommentVNode","_withKeys","_withModifiers","CircleCheckFilled"],"sources":["../../../../api/admin/ticket.ts","../../../../pages/_mgmt_9Xfa3/tickets/components/TicketChatModal.vue"],"sourcesContent":["import { getAdminSupabaseClient } from '@/utils/supabase-admin'\n\nexport interface AdminTicket {\n  id: string\n  user_id: string\n  order_id: string\n  title: string\n  status: 'processing' | 'resolved'\n  priority: 'low' | 'medium' | 'high'\n  created_at: string\n  updated_at: string\n  resolved_at?: string\n  // Joins\n  profiles?: { email: string }\n  orders?: { order_no: string }\n}\n\nexport interface TicketMessage {\n  id: string\n  ticket_id: string\n  sender_id: string\n  is_admin: boolean\n  content: string\n  message_type: 'text' | 'image'\n  attachments: string[]\n  created_at: string\n  profiles?: { email: string, avatar_url: string }\n}\n\nexport const adminTicketApi = {\n  // 1. Get List\n  async getList(params: { page: number, pageSize: number, status?: string }): Promise<{ success: boolean; data: any; total: number; error?: string }> {\n    const client = getAdminSupabaseClient()\n    const { page, pageSize, status } = params\n\n    let query = client\n      .from('tickets')\n      .select('*, profiles(email), orders(id, order_no, product_snapshot, sku_snapshot, total_amount, quantity, status, created_at, end_time, expires_at)', { count: 'exact' })\n      .order('created_at', { ascending: false })\n      .range((page - 1) * pageSize, page * pageSize - 1)\n\n    if (status && status !== 'all') {\n      query = query.eq('status', status)\n    }\n\n    const { data, error, count } = await query\n\n    if (error) return { success: false, data: [], total: 0, error: error.message }\n    return { success: true, data, total: count || 0 }\n  },\n\n  // 1.5 Get Detail\n  async getDetail(ticketId: string): Promise<{ success: boolean; data: any; error?: string }> {\n    const client = getAdminSupabaseClient()\n    const { data, error } = await client\n      .from('tickets')\n      .select('*, profiles(email), orders(id, order_no, product_snapshot, sku_snapshot, total_amount, quantity, status, created_at, end_time, expires_at)')\n      .eq('id', ticketId)\n      .single()\n\n    if (error) return { success: false, data: null, error: error.message }\n    return { success: true, data }\n  },\n\n  // 2. Get Messages for a Ticket\n  async getMessages(ticketId: string): Promise<{ success: boolean; data: TicketMessage[]; error?: string }> {\n    const client = getAdminSupabaseClient()\n    const { data, error } = await client\n      .from('ticket_messages')\n      .select('*, profiles(email)')\n      .eq('ticket_id', ticketId)\n      .order('created_at', { ascending: true })\n\n    if (error) return { success: false, data: [], error: error.message }\n    return { success: true, data: data as any }\n  },\n\n  // 3. Admin Reply\n  async reply(ticketId: string, content: string, attachments: string[] = []): Promise<{ success: boolean; error?: string }> {\n    const client = getAdminSupabaseClient()\n\n    // Admin ID logic: ideally we fetch logged in admin profile. \n    // BUT admin API often uses service_role. \n    // We should try to get the 'admin' user profile if possible or leave sender_id NULL for System.\n    // For this context, let's leave sender_id NULL to represent \"System/Support\" or try to find a default admin.\n\n    const { error } = await client\n      .from('ticket_messages')\n      .insert({\n        ticket_id: ticketId,\n        sender_id: null, // Null = System/Admin\n        is_admin: true,\n        content,\n        message_type: attachments.length > 0 ? 'image' : 'text',\n        attachments\n      })\n\n    if (error) return { success: false, error: error.message }\n    return { success: true }\n  },\n\n  // 4. Resolve Ticket\n  async resolve(ticketId: string): Promise<{ success: boolean; error?: string }> {\n    const client = getAdminSupabaseClient()\n    const { error } = await client\n      .from('tickets')\n      .update({ status: 'resolved', resolved_at: new Date(), updated_at: new Date() })\n      .eq('id', ticketId)\n\n    if (error) return { success: false, error: error.message }\n    return { success: true }\n  },\n\n  // 5. Cleanup Images (One-Click)\n  async cleanupImages(daysOld: number = 7): Promise<{ success: boolean; count: number; error?: string }> {\n    const client = getAdminSupabaseClient()\n    const dateLimit = new Date();\n    dateLimit.setDate(dateLimit.getDate() - daysOld);\n\n    // 1. Find resolved tickets older than limit\n    const { data: tickets } = await client\n      .from('tickets')\n      .select('id')\n      .eq('status', 'resolved')\n      .lt('resolved_at', dateLimit.toISOString())\n\n    if (!tickets || tickets.length === 0) return { success: true, count: 0 }\n\n    const ticketIds = tickets.map(t => t.id)\n\n    // 2. Find messages with images for these tickets\n    const { data: messages } = await client\n      .from('ticket_messages')\n      .select('id, attachments')\n      .in('ticket_id', ticketIds)\n      .not('attachments', 'is', null)\n\n    if (!messages || messages.length === 0) return { success: true, count: 0 }\n\n    let deletedFilesCount = 0\n    const filesToDelete: string[] = []\n\n    // 3. Extract paths from URLs\n    // URL format: https://.../storage/v1/object/public/tickets/filename.png\n    // We need just \"filename.png\" or \"folder/filename.png\"\n    messages.forEach(msg => {\n      if (Array.isArray(msg.attachments)) {\n        msg.attachments.forEach((url: string) => {\n          try {\n            const urlObj = new URL(url)\n            // Pathname: /storage/v1/object/public/tickets/abc.png\n            // We need 'abc.png'. \n            const pathParts = urlObj.pathname.split('/tickets/')\n            if (pathParts.length > 1) {\n              // Decoded path is safer\n              filesToDelete.push(decodeURIComponent(pathParts[1]))\n            }\n          } catch (e) {\n            // Fallback if relative path stored\n            filesToDelete.push(url)\n          }\n        })\n      }\n    })\n\n    if (filesToDelete.length > 0) {\n      const { data, error } = await client.storage.from('tickets').remove(filesToDelete)\n      if (error) return { success: false, count: 0, error: error.message }\n      deletedFilesCount = data?.length || 0\n    }\n\n    return { success: true, count: deletedFilesCount }\n  }\n}\n","<template>\n  <el-dialog\n    v-model=\"visible\"\n    title=\"工单详情与处理\"\n    width=\"900px\"\n    class=\"ticket-chat-modal\"\n    @close=\"handleClose\"\n    :close-on-click-modal=\"false\"\n    destroy-on-close\n    append-to-body\n  >\n    <div class=\"modal-layout\" v-loading=\"loading\">\n       <!-- Error State -->\n       <div v-if=\"error\" class=\"flex flex-col items-center justify-center w-full h-full text-center\">\n          <el-icon class=\"text-red-500 mb-2\" :size=\"40\"><CircleCloseFilled /></el-icon>\n          <div class=\"text-gray-600 mb-4\">{{ error }}</div>\n          <el-button type=\"primary\" @click=\"loadData\">\n             <el-icon class=\"mr-1\"><RefreshRight /></el-icon> 重试\n          </el-button>\n       </div>\n\n       <!-- Content (Only show when loaded and no error) -->\n       <template v-else-if=\"loaded\">\n           <!-- Left Sidebar: Info -->\n           <div class=\"layout-sidebar\">\n              <!-- Ticket Status -->\n              <div class=\"info-block\">\n                 <div class=\"label\">工单状态</div>\n                 <div class=\"value\">\n                    <el-tag :type=\"getTicketStatusType(ticket?.status)\" effect=\"dark\" size=\"large\">\n                       {{ getTicketStatusLabel(ticket?.status) }}\n                    </el-tag>\n                 </div>\n              </div>\n\n              <!-- User Info -->\n              <div class=\"info-block\">\n                 <div class=\"label\">提交用户</div>\n                 <div class=\"user-card\">\n                    <el-avatar :size=\"32\" class=\"user-avatar\">\n                       {{ ticket?.user_id?.substring(0,2).toUpperCase() }}\n                    </el-avatar>\n                    <div class=\"user-details\">\n                       <div class=\"uid\">UID: {{ ticket?.user_id?.substring(0,8).toUpperCase() }}</div>\n                       <div class=\"email\" v-if=\"ticket?.profiles?.email\">{{ ticket.profiles.email }}</div>\n                    </div>\n                 </div>\n              </div>\n\n              <!-- Associated Order Snapshot -->\n              <div class=\"info-block\" v-if=\"ticket?.orders\">\n                 <div class=\"label\">关联订单快照</div>\n                 <div class=\"order-card-large\">\n                     <img :src=\"ticket.orders.product_snapshot?.image\" class=\"order-img-large\" />\n                     \n                     <div class=\"order-details-rows\">\n                        <div class=\"detail-row\">\n                           <span class=\"row-label\">订单号</span>\n                           <span class=\"row-value font-mono copyable\" @click=\"copyText(ticket.orders.order_no)\">\n                              {{ ticket.orders.order_no }}\n                           </span>\n                        </div>\n                        <div class=\"detail-row\">\n                           <span class=\"row-label\">商品</span>\n                           <span class=\"row-value\" :title=\"ticket.orders.product_snapshot?.product_name\">\n                              {{ ticket.orders.product_snapshot?.product_name }}\n                           </span>\n                        </div>\n                        <div class=\"detail-row\" v-if=\"ticket.orders.sku_snapshot?.spec_combination\">\n                           <span class=\"row-label\">规格</span>\n                           <span class=\"row-value spec-tag\">\n                              {{ Object.values(ticket.orders.sku_snapshot.spec_combination).join(' / ') }}\n                           </span>\n                        </div>\n                        <div class=\"detail-row\">\n                           <span class=\"row-label\">金额</span>\n                           <span class=\"row-value price\">¥{{ ticket.orders.total_amount?.toFixed(2) }}</span>\n                        </div>\n                        \n                        <!-- Time Remaining -->\n                        <div class=\"detail-row bg-blue-50 p-2 rounded mt-2 border border-blue-100\" v-if=\"timeLeft\">\n                           <span class=\"row-label text-blue-600\">剩余时间</span>\n                           <span class=\"row-value font-bold text-blue-700\">{{ timeLeft }}</span>\n                        </div>\n                     </div>\n                 </div>\n              </div>\n              \n              <!-- Created Time -->\n              <div class=\"info-block\">\n                 <div class=\"label\">创建时间</div>\n                 <div class=\"value text-gray-500 text-sm\">\n                    {{ ticket ? new Date(ticket.created_at).toLocaleString() : '-' }}\n                 </div>\n              </div>\n           </div>\n\n           <!-- Right Content: Chat -->\n           <div class=\"layout-main\">\n              <!-- Chat History -->\n              <div class=\"chat-container custom-scrollbar\" ref=\"chatBox\">\n                  <div v-if=\"messages.length === 0\" class=\"empty-chat\">\n                     <el-empty description=\"暂无沟通记录\" :image-size=\"60\" />\n                  </div>\n\n                  <div v-for=\"(group, date) in groupedMessages\" :key=\"date\">\n                     <div class=\"date-divider\"><span>{{ date }}</span></div>\n                     \n                     <div v-for=\"msg in group\" :key=\"msg.id\" class=\"message-row\" :class=\"{ 'is-admin': msg.is_admin }\">\n                        <el-avatar :size=\"32\" :class=\"msg.is_admin ? 'avatar-admin' : 'avatar-user'\">\n                           {{ msg.is_admin ? '服' : '客' }}\n                        </el-avatar>\n                        \n                        <div class=\"message-content\">\n                           <div class=\"bubble\">\n                              {{ msg.content }}\n                           </div>\n                           \n                           <div class=\"meta\">\n                              <span>{{ formatTime(msg.created_at) }}</span>\n                           </div>\n\n                           <div v-if=\"msg.attachments?.length\" class=\"attachments\">\n                              <el-image \n                                v-for=\"url in msg.attachments\" :key=\"url\"\n                                :src=\"url\" \n                                class=\"attachment-img\"\n                                :preview-src-list=\"msg.attachments\"\n                                preview-teleported\n                                fit=\"cover\"\n                              />\n                           </div>\n                        </div>\n                     </div>\n                  </div>\n              </div>\n\n              <!-- Action Footer -->\n              <div class=\"chat-footer\">\n                  <!-- Debug: Show status if it's not processing or resolved (temporary) -->\n                  <div v-if=\"ticket?.status !== 'processing' && ticket?.status !== 'resolved'\" class=\"text-xs text-red-400 text-center mb-2\">\n                      当前状态异常: {{ ticket?.status }}\n                  </div>\n\n                  <div v-if=\"ticket?.status === 'processing'\" class=\"action-area\">\n                     <el-input \n                        v-model=\"replyText\" \n                        type=\"textarea\" \n                        :rows=\"3\"\n                        resize=\"none\"\n                        placeholder=\"请输入回复内容 (Cmd/Ctrl + Enter 发送)\" \n                        @keydown.meta.enter=\"handleReply\"\n                        @keydown.ctrl.enter=\"handleReply\"\n                     />\n                     <div class=\"footer-buttons\">\n                         <el-button type=\"success\" plain @click=\"handleResolve\" :loading=\"resolving\">\n                            <el-icon class=\"mr-1\"><Check /></el-icon> 标记已解决\n                         </el-button>\n                         <el-button type=\"primary\" @click=\"handleReply\" :loading=\"sending\" :disabled=\"!replyText.trim()\">\n                            发送回复\n                         </el-button>\n                     </div>\n                  </div>\n                  \n                  <div v-else-if=\"ticket?.status === 'resolved'\" class=\"resolved-banner\">\n                     <el-icon class=\"text-green-500 mr-2\"><CircleCheckFilled /></el-icon>\n                     工单已结单，无法继续回复\n                  </div>\n              </div>\n           </div>\n       </template>\n    </div>\n  </el-dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, nextTick } from 'vue'\nimport { adminTicketApi, type TicketMessage } from '@/api/admin/ticket'\nimport { useBizConfig } from '@/composables/common/useBizConfig'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { Check, CircleCheckFilled, RefreshRight } from '@element-plus/icons-vue'\n\nconst props = defineProps<{\n  modelValue: boolean\n  ticketId: string\n}>()\n\nconst emit = defineEmits(['update:modelValue', 'closed'])\n\nconst { getTicketStatusLabel, getTicketStatusType } = useBizConfig()\n\nconst visible = computed({\n  get: () => props.modelValue,\n  set: (val) => emit('update:modelValue', val)\n})\n\nconst loading = ref(false)\nconst loaded = ref(false) // New: distinct loaded state\nconst error = ref<string | null>(null) // New: error state\nconst sending = ref(false)\nconst resolving = ref(false)\nconst messages = ref<TicketMessage[]>([])\nconst ticket = ref<any>(null)\nconst replyText = ref('')\nconst chatBox = ref<HTMLElement | null>(null)\n\n// --- Helper Functions ---\nconst handleClose = () => {\n    emit('closed')\n}\n\nconst copyText = (text: string) => {\n    if (!text) return\n    navigator.clipboard.writeText(text)\n    ElMessage.success('已复制')\n}\n\nconst timeLeft = computed(() => {\n    if (!ticket.value?.orders) return null\n    const order = ticket.value.orders\n    \n    // Check various expiry fields\n    const expiryStr = order.expires_at || order.end_time\n    if (!expiryStr) return null\n    \n    const expiry = new Date(expiryStr).getTime()\n    const now = new Date().getTime()\n    const diff = expiry - now\n    \n    if (diff <= 0) return '已过期'\n    \n    const days = Math.floor(diff / (1000 * 60 * 60 * 24))\n    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))\n    \n    if (days > 0) return `${days}天 ${hours}小时`\n    return `${hours}小时`\n})\n\nconst formatTime = (isoString: string) => {\n   return new Date(isoString).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n}\n\nconst isToday = (date: Date) => {\n   const today = new Date()\n   return date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear()\n}\n\nconst isYesterday = (date: Date) => {\n   const yesterday = new Date()\n   yesterday.setDate(yesterday.getDate() - 1)\n   return date.getDate() === yesterday.getDate() && date.getMonth() === yesterday.getMonth() && date.getFullYear() === yesterday.getFullYear()\n}\n\n// --- Logic ---\nconst groupedMessages = computed(() => {\n   const groups: Record<string, TicketMessage[]> = {}\n   messages.value.forEach(msg => {\n      const date = new Date(msg.created_at)\n      const dateStr = isToday(date) ? '今天' : \n                      isYesterday(date) ? '昨天' : \n                      date.toLocaleDateString()\n      if (!groups[dateStr]) groups[dateStr] = []\n      groups[dateStr].push(msg)\n   })\n   return groups\n})\n\nconst scrollToBottom = () => {\n   nextTick(() => {\n      if (chatBox.value) {\n         chatBox.value.scrollTop = chatBox.value.scrollHeight + 200\n      }\n   })\n}\n\nconst loadData = async () => {\n   if (!props.ticketId) return\n   \n   loading.value = true\n   error.value = null\n   \n   try {\n      console.log('[TicketChatModal] Loading data for:', props.ticketId)\n      \n      // Parallel fetch for better performance\n      const [resDetail, resMsgs] = await Promise.all([\n         adminTicketApi.getDetail(props.ticketId),\n         adminTicketApi.getMessages(props.ticketId)\n      ])\n\n      if (resDetail.success) {\n          ticket.value = resDetail.data\n          loaded.value = true // Successful load\n      } else {\n          throw new Error(resDetail.error || '工单详情加载失败')\n      }\n\n      if (resMsgs.success) {\n         messages.value = resMsgs.data\n         scrollToBottom()\n      } else {\n         console.warn('[TicketChatModal] Messages load warning:', resMsgs.error)\n         // We don't block the UI if just messages fail, but maybe show a toast\n      }\n   } catch(e: any) {\n      console.error('[TicketChatModal] Load Failed:', e)\n      error.value = e.message || '加载失败，请重试'\n      loaded.value = false\n   } finally {\n      loading.value = false\n   }\n}\n\nconst handleReply = async () => {\n   if (!replyText.value.trim()) return\n   sending.value = true\n   try {\n      const res = await adminTicketApi.reply(props.ticketId, replyText.value)\n      if (res.success) {\n         replyText.value = ''\n         ElMessage.success('发送成功')\n         // Refresh messages\n         const resMsgs = await adminTicketApi.getMessages(props.ticketId)\n         if (resMsgs.success) {\n            messages.value = resMsgs.data\n            scrollToBottom()\n         }\n      } else {\n         ElMessage.error(res.error || '发送失败')\n      }\n   } catch (e) {\n      ElMessage.error('系统错误')\n   } finally {\n      sending.value = false\n   }\n}\n\nconst handleResolve = async () => {\n   try {\n      await ElMessageBox.confirm('确定要将此工单标记为已解决吗？用户将无法再回复。', '确认结单', { \n          confirmButtonText: '确定结单',\n          cancelButtonText: '取消',\n          type: 'warning' \n      })\n      resolving.value = true\n      const res = await adminTicketApi.resolve(props.ticketId)\n      if (res.success) {\n         ElMessage.success('工单已结单')\n         await loadData() // Refresh status\n      } else {\n         ElMessage.error('操作失败')\n      }\n   } catch (e) {} finally {\n      resolving.value = false\n   }\n}\n\n// Watch for modal open\nwatch(() => props.modelValue, (val) => {\n    if (val && props.ticketId) {\n        // Reset state\n        messages.value = []\n        ticket.value = null\n        replyText.value = ''\n        error.value = null\n        loaded.value = false\n        \n        loadData()\n    }\n}, { immediate: true })\n</script>\n\n<style scoped>\n.modal-layout {\n    display: flex;\n    height: 600px; /* Fixed height for consistency */\n    border-top: 1px solid #e5e7eb;\n}\n\n/* Sidebar */\n.layout-sidebar {\n    width: 260px;\n    border-right: 1px solid #e5e7eb;\n    background: #f9fafb;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 24px;\n}\n\n.info-block .label {\n    font-size: 12px;\n    font-weight: 600;\n    color: #6b7280;\n    margin-bottom: 8px;\n    text-transform: uppercase;\n}\n\n.user-card {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n.user-avatar { background: #dbeafe; color: #2563eb; font-weight: 600; font-size: 12px; }\n.user-details { display: flex; flex-direction: column; min-width: 0; }\n.uid { font-family: monospace; font-size: 12px; font-weight: 500; color: #374151; }\n.email { font-size: 11px; color: #6b7280; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 140px; }\n\n.order-card-large {\n    border: 1px solid #e5e7eb;\n    border-radius: 8px;\n    background: white;\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n.order-img-large { width: 100%; height: 120px; border-radius: 6px; object-fit: cover; background: #f3f4f6; }\n\n.order-details-rows { display: flex; flex-direction: column; gap: 8px; }\n.detail-row { display: flex; justify-content: space-between; font-size: 12px; align-items: flex-start; }\n.row-label { color: #6b7280; flex-shrink: 0; margin-right: 8px; }\n.row-value { color: #374151; font-weight: 500; text-align: right; word-break: break-all; }\n.copyable { cursor: pointer; color: #2563eb; }\n.copyable:hover { text-decoration: underline; }\n.spec-tag { background: #f3f4f6; color: #6b7280; padding: 1px 6px; border-radius: 4px; font-size: 11px; }\n.price { font-weight: 600; color: #059669; }\n\n/* Main Chat Area */\n.layout-main {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    background: white;\n}\n\n.chat-container {\n    flex: 1;\n    padding: 20px;\n    overflow-y: auto;\n    background: #ffffff;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.date-divider {\n    text-align: center;\n    position: sticky;\n    top: 0;\n    z-index: 5;\n}\n.date-divider span {\n    background: #f3f4f6;\n    color: #9ca3af;\n    font-size: 11px;\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n.message-row { display: flex; gap: 12px; align-items: flex-start; }\n.is-admin { flex-direction: row-reverse; }\n\n.avatar-admin { background: #2563eb; color: white; font-size: 12px; }\n.avatar-user { background: #9ca3af; color: white; font-size: 12px; }\n\n.message-content {\n    max-width: 70%;\n    display: flex;\n    flex-direction: column;\n}\n.is-admin .message-content { align-items: flex-end; }\n\n.bubble {\n    padding: 10px 14px;\n    border-radius: 8px;\n    font-size: 14px;\n    line-height: 1.5;\n    word-break: break-word;\n    white-space: pre-wrap;\n    position: relative;\n}\n.message-row:not(.is-admin) .bubble {\n    background: #f3f4f6;\n    color: #1f2937;\n    border-top-left-radius: 0;\n}\n.message-row.is-admin .bubble {\n    background: #eff6ff;\n    border: 1px solid #dbeafe;\n    color: #1e3a8a;\n    border-top-right-radius: 0;\n}\n\n.meta { font-size: 10px; color: #9ca3af; margin-top: 4px; padding: 0 2px; }\n\n.attachments { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }\n.is-admin .attachments { justify-content: flex-end; }\n.attachment-img { width: 80px; height: 80px; border-radius: 4px; border: 1px solid #e5e7eb; }\n\n/* Footer */\n.chat-footer {\n    padding: 16px;\n    border-top: 1px solid #e5e7eb;\n    background: #f9fafb;\n}\n\n.footer-buttons {\n    display: flex;\n    justify-content: flex-end;\n    gap: 12px;\n    margin-top: 12px;\n}\n\n.resolved-banner {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 12px;\n    background: #ecfdf5;\n    border: 1px solid #d1fae5;\n    border-radius: 6px;\n    color: #059669;\n    font-size: 14px;\n}\n\n/* Custom Scrollbar */\n.custom-scrollbar::-webkit-scrollbar { width: 6px; }\n.custom-scrollbar::-webkit-scrollbar-track { background: transparent; }\n.custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }\n.custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }\n</style>\n"],"version":3}