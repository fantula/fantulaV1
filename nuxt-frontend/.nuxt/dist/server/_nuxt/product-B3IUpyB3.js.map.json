{"file":"product-B3IUpyB3.js","mappings":"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","names":[],"sources":["../../../../api/admin/product.ts"],"sourcesContent":["\nimport { getAdminSupabaseClient } from '@/utils/supabase-admin'\nimport type { AdminProduct, ProductCategory } from '@/api/admin-supabase'\n\nexport const adminProductApi = {\n    /**\n     * Ëé∑ÂèñÂïÜÂìÅÂàóË°®ÔºàÁÆ°ÁêÜÂëòËßÜËßíÔºåÊîØÊåÅÂàÜÈ°µÂíåÊúçÂä°Á´ØÁ≠õÈÄâÔºâ\n     */\n    async getProducts(params?: {\n        category_id?: string\n        status?: string\n        keyword?: string\n        page?: number\n        page_size?: number\n    }): Promise<{ success: boolean; products: AdminProduct[]; total: number; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const page = params?.page || 1\n        const pageSize = params?.page_size || 20\n        const offset = (page - 1) * pageSize\n\n        let query = client\n            .from('products')\n            .select('*', { count: 'exact' })\n\n        if (params?.category_id) {\n            query = query.eq('category_id', params.category_id)\n        }\n        if (params?.status) {\n            query = query.eq('status', params.status)\n        }\n        if (params?.keyword) {\n            query = query.ilike('product_name', `%${params.keyword}%`)\n        }\n\n        query = query\n            .order('created_at', { ascending: false })\n            .range(offset, offset + pageSize - 1)\n\n        const { data, error, count } = await query\n\n        if (error) {\n            return { success: false, products: [], total: 0, error: error.message }\n        }\n\n        const products = data || []\n        const productIds = products.map(p => p.id)\n\n        // ÊâπÈáèÊü•ËØ¢ SKU ËØ¶ÊÉÖ (Batch Query to avoid N+1)\n        let skuCountMap: Record<string, number> = {}\n        let skuDetailsMap: Record<string, string[]> = {}\n\n        if (productIds.length > 0) {\n            const { data: skuMapData } = await client\n                .from('product_sku_map')\n                .select('product_id, sku:product_skus (tag, tag_name, spec_combination)')\n                .in('product_id', productIds)\n\n            skuMapData?.forEach((item: any) => {\n                const pid = item.product_id\n                skuCountMap[pid] = (skuCountMap[pid] || 0) + 1\n\n                if (!skuDetailsMap[pid]) skuDetailsMap[pid] = []\n                const sku = item.sku\n                if (sku) {\n                    let label = ''\n                    if (sku.tag_name) label = `üîñ ${sku.tag_name}`\n                    else if (sku.spec_combination && Object.values(sku.spec_combination).length > 0) {\n                        label = Object.values(sku.spec_combination).join(' / ')\n                    } else {\n                        label = 'ÈªòËÆ§ËßÑÊ†º'\n                    }\n                    if (label && !skuDetailsMap[pid].includes(label)) {\n                        skuDetailsMap[pid].push(label)\n                    }\n                }\n            })\n        }\n\n        const productsWithSkuCount = products.map(product => ({\n            ...product,\n            sku_count: skuCountMap[product.id] || 0,\n            sku_details: skuDetailsMap[product.id] || []\n        }))\n\n        return { success: true, products: productsWithSkuCount, total: count || 0 }\n    },\n\n    /**\n     * Ëé∑ÂèñÂçï‰∏™ÂïÜÂìÅËØ¶ÊÉÖÔºàÁî®‰∫éÁºñËæëÔºâ\n     */\n    async getProductById(id: string): Promise<{ success: boolean; product?: AdminProduct; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { data, error } = await client\n            .from('products')\n            .select('*, category:product_categories(id, name)')\n            .eq('id', id)\n            .single()\n\n        if (error || !data) {\n            return { success: false, error: error?.message || 'ÂïÜÂìÅ‰∏çÂ≠òÂú®' }\n        }\n        return { success: true, product: data }\n    },\n\n    /**\n     * ÂàõÂª∫ÂïÜÂìÅ\n     */\n    async createProduct(data: Partial<AdminProduct>): Promise<{ success: boolean; product?: AdminProduct; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { data: product, error } = await client\n            .from('products')\n            .insert({\n                product_name: data.product_name,\n                category_id: data.category_id,\n                image: data.image,\n                sort_order: data.sort_order || 0,\n                display_price: data.display_price || 0,\n                tags: data.tags || [],\n                initial_sales: data.initial_sales || 0,\n                badge_label: data.badge_label,\n                rating: data.rating || 100,\n                allow_addon: data.allow_addon || false,\n                detail_modules: data.detail_modules || [],\n                status: data.status || 'on',\n            })\n            .select()\n            .single()\n\n        if (error) return { success: false, error: error.message }\n        return { success: true, product }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÂïÜÂìÅ\n     */\n    async updateProduct(id: string, data: Partial<AdminProduct>): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n        const { error } = await client\n            .from('products')\n            .update(data)\n            .eq('id', id)\n\n        if (error) return { success: false, error: error.message }\n        return { success: true }\n    },\n\n    /**\n     * ÂàáÊç¢ÂïÜÂìÅÁä∂ÊÄÅ\n     */\n    async toggleStatus(id: string, status: 'on' | 'off'): Promise<{ success: boolean; error?: string }> {\n        return this.updateProduct(id, { status })\n    },\n\n    /**\n     * Âà†Èô§ÂïÜÂìÅÔºàÊîØÊåÅÊâπÈáèÔºâ\n     * Á∫ßËÅîÂà†Èô§ÔºöÂÖàÂà†Êò†Â∞ÑÔºåÂÜçÂà†ÂïÜÂìÅ\n     */\n    async deleteProducts(ids: string[]): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // 1. Âà†Èô§Êò†Â∞Ñ\n        await client.from('product_sku_map').delete().in('product_id', ids)\n\n        // 2. Âà†Èô§ÂïÜÂìÅ\n        const { error } = await client.from('products').delete().in('id', ids)\n\n        if (error) return { success: false, error: error.message }\n        return { success: true }\n    },\n\n    /**\n     * Ëé∑ÂèñÂïÜÂìÅÂÆåÊï¥Êï∞ÊçÆÔºàÂê´ËßÑÊ†ºÂíåSKUÔºâ\n     * Áî®‰∫éÁºñËæëÈ°µÂõûÊòæ\n     */\n    async getProductWithSkus(productId: string): Promise<{\n        success: boolean\n        product?: AdminProduct\n        specs?: { name: string; values: { id: string; value: string }[] }[]\n        skus?: any[]\n        error?: string\n    }> {\n        const client = getAdminSupabaseClient()\n\n        // 1. ÂïÜÂìÅ‰ø°ÊÅØ\n        const { data: product, error: pError } = await client\n            .from('products')\n            .select('*')\n            .eq('id', productId)\n            .single()\n\n        if (pError) return { success: false, error: pError.message }\n\n        // 2. SKU Êò†Â∞Ñ\n        const { data: skuMappings, error: sError } = await client\n            .from('product_sku_map')\n            .select('*, product_skus(*)')\n            .eq('product_id', productId)\n            .order('sort_order', { ascending: true })\n\n        if (sError) return { success: false, error: sError.message }\n\n        // 3. ÊèêÂèñÂíåÊé®ÂØº\n        const skus = (skuMappings || []).map(m => (m as any).product_skus).filter(Boolean)\n\n        // ÁÆÄÂçïÊé®ÂØºËßÑÊ†ºÁªìÊûÑ (Áî®‰∫éÂâçÁ´ØÁºñËæëÂô®ÂõûÊòæ)\n        const specsMap = new Map<string, Set<string>>()\n        skus.forEach((sku: any) => {\n            if (sku.spec_combination) {\n                Object.entries(sku.spec_combination).forEach(([k, v]) => {\n                    if (!specsMap.has(k)) specsMap.set(k, new Set())\n                    specsMap.get(k)?.add(String(v))\n                })\n            }\n        })\n\n        const specs = Array.from(specsMap.entries()).map(([name, valuesSet]) => ({\n            name,\n            values: Array.from(valuesSet).map(v => ({ id: v, value: v }))\n        }))\n\n        return { success: true, product, specs, skus }\n    },\n\n    /**\n     * ÂàõÂª∫ÂïÜÂìÅ SKU (Áî®‰∫éÂ§çÂà∂ÂïÜÂìÅÊó∂)\n     * Ê≥®ÊÑèÔºöËøôÊòØÂàõÂª∫Êñ∞ÁöÑ ProductSKU ËÆ∞ÂΩï\n     */\n    async createProductSkus(productId: string, skus: any[]): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        const skuData = skus.map(sku => ({\n            product_type: sku.product_type,\n            spec_combination: sku.spec_combination,\n            image: sku.image || null,\n            intro: sku.intro || null,\n            price: sku.price,\n            duration: sku.duration || null,\n            sort_order: sku.sort_order,\n            tag: sku.tag || null // Â¶ÇÊûúÊúâtagËØ¥ÊòéÊòØÂÖ±‰∫´ÁªÑSKUÔºå‰ΩÜËøôÈáåÈÄöÂ∏∏ÊòØÂ§çÂà∂‰∏∫ÁßÅÊúâ\n        }))\n\n        const { data: createdSkus, error: skuError } = await client\n            .from('product_skus')\n            .insert(skuData)\n            .select('id')\n\n        if (skuError) return { success: false, error: skuError.message }\n\n        const mappings = (createdSkus || []).map((sku, index) => ({\n            product_id: productId,\n            sku_id: sku.id,\n            sort_order: skus[index]?.sort_order || index\n        }))\n\n        if (mappings.length > 0) {\n            await client.from('product_sku_map').insert(mappings)\n        }\n\n        return { success: true }\n    },\n\n    /**\n     * Êõ¥Êñ∞ÂïÜÂìÅÂÖ≥ËÅîÁöÑ SKU (Â§çÊùÇÈÄªËæë)\n     * ÂßîÊâòÁªô SKUS Êé•Âè£ÊàñÂú®Ê≠§ÂÆûÁé∞? \n     * Èâ¥‰∫é post.vue/sku_editor ÁöÑÈÄªËæëÔºåupdateProductSkus ÈÄöÂ∏∏ÊØîËæÉÂ§çÊùÇ„ÄÇ\n     * ËøôÈáå‰∏∫‰∫Ü‰øùÊåÅÂÖºÂÆπÔºåÊàë‰ª¨Â∞Ü updateProductSkus ÁöÑÈÄªËæëÂ§çÂàªËøáÊù•ÔºåÊàñËÄÖÂú® api/admin/sku.ts ‰∏≠Â§ÑÁêÜ„ÄÇ\n     * ËÄÉËôëÂà∞ËøôÊòØÂ±û‰∫é \"ÈÖçÁΩÆÂïÜÂìÅÂ±ûÊÄß\" ÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÊîæÂú® product.ts ‰πüÊòØÂêàÁêÜÁöÑ„ÄÇ\n     */\n    async updateProductSkus(productId: string, options: {\n        mode: 'custom' | 'shared'\n        skus?: any[]\n        sharedTag?: number\n    }): Promise<{ success: boolean; error?: string }> {\n        const client = getAdminSupabaseClient()\n\n        // 1. ÂÖ±‰∫´Ê®°ÂºèÔºöÈáçÁΩÆ‰∏∫ÂºïÁî®\n        if (options.mode === 'shared') {\n            if (!options.sharedTag) return { success: false, error: 'Áº∫Â∞ëÂÖ±‰∫´ËßÑÊ†ºÁªÑ Tag' }\n\n            const { data: sharedSkus } = await client\n                .from('product_skus')\n                .select('id, sort_order')\n                .eq('tag', options.sharedTag)\n\n            if (!sharedSkus?.length) return { success: false, error: 'ËØ•ÂÖ±‰∫´ÁªÑÊ≤°Êúâ SKU' }\n\n            // ‰∫ãÂä°: Âà†ÊóßÊò† -> Âª∫Êñ∞Êò†\n            await client.from('product_sku_map').delete().eq('product_id', productId)\n\n            const mappings = sharedSkus.map(sku => ({\n                product_id: productId,\n                sku_id: sku.id,\n                sort_order: sku.sort_order\n            }))\n\n            const { error } = await client.from('product_sku_map').insert(mappings)\n            return error ? { success: false, error: error.message } : { success: true }\n        }\n\n        // 2. Ëá™ÂÆö‰πâÊ®°ÂºèÔºöÊô∫ËÉΩÊõ¥Êñ∞ (Diff Update)\n        // Ëøô‰∏ÄÂùóÈÄªËæëËæÉÂ§öÔºå‰∏î‰ªÖ‰ªÖÂú® sku/[id].vue ‰ΩøÁî®„ÄÇ\n        // ‰∏∫‰∫ÜÁÆÄÂåñÔºåÊàë‰ª¨ÂÅáËÆæÂâçÁ´ØÂ∑≤ÁªèÊï¥ÁêÜÂ•Ω‰∫Ü„ÄÇ\n\n        // Ëé∑ÂèñÂΩìÂâçÊò†Â∞Ñ\n        const { data: currentMappings } = await client\n            .from('product_sku_map')\n            .select('sku_id')\n            .eq('product_id', productId)\n\n        const currentSkuIds = new Set((currentMappings || []).map(m => m.sku_id))\n        const newSkus = options.skus || []\n        const newSkuIds = new Set(newSkus.filter(s => s.id).map(s => s.id))\n\n        // A. ÁßªÈô§\n        const toRemoveIds = [...currentSkuIds].filter(id => !newSkuIds.has(id))\n        if (toRemoveIds.length > 0) {\n            await client.from('product_sku_map')\n                .delete()\n                .eq('product_id', productId)\n                .in('sku_id', toRemoveIds)\n        }\n\n        // B. Êõ¥Êñ∞\n        const toUpdate = newSkus.filter(s => s.id && currentSkuIds.has(s.id))\n        for (const sku of toUpdate) {\n            await client.from('product_skus').update({\n                product_type: sku.product_type,\n                spec_combination: sku.spec_combination,\n                image: sku.image,\n                intro: sku.intro,\n                price: sku.price,\n                duration: sku.duration,\n                sort_order: sku.sort_order\n            }).eq('id', sku.id).is('tag', null) // Only update private skus\n        }\n\n        // C. ÊèíÂÖ•\n        const toInsert = newSkus.filter(s => !s.id)\n        if (toInsert.length > 0) {\n            const insertData = toInsert.map(sku => ({\n                product_type: sku.product_type,\n                spec_combination: sku.spec_combination,\n                image: sku.image,\n                intro: sku.intro,\n                price: sku.price,\n                duration: sku.duration,\n                sort_order: sku.sort_order,\n                tag: null // Private SKU\n            }))\n\n            const { data: createdSkus, error } = await client\n                .from('product_skus')\n                .insert(insertData)\n                .select('id')\n\n            if (!error && createdSkus) {\n                const newMappings = createdSkus.map((sku, idx) => ({\n                    product_id: productId,\n                    sku_id: sku.id,\n                    sort_order: toInsert[idx].sort_order\n                }))\n                await client.from('product_sku_map').insert(newMappings)\n            }\n        }\n\n        return { success: true }\n    }\n}\n"],"version":3}