{"file":"cart-B3bx4XpX.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+FA,cAAA;AACA,iBAAA;AACA,UAAA,YAAA,aAAA;AAEA,UAAA,cAAA,IAAA,KAAA;AAGA,UAAA,YAAA,SAAA,MAAA,UAAA,KAAA;AACA,UAAA,aAAA,SAAA,MAAA,UAAA,UAAA;AAGA,UAAA,WAAA,SAAA,MAAA;AACE,UAAA,WAAA,SAAA,IAAA,QAAA;AACA,UAAA,WAAA,SAAA,IAAA,QAAA;AACA,UAAA,WAAA,SAAA,IAAA,QAAA;AACA,aAAA;AAAA,IAAO,CAAA;;AA7GF,YAAA,OAAAA,eAAAC,WAAA,EAAA,OAAA,eAAA,MAAA,CAAA,CAAA,uMAAA;AAQc,UAAAC,MAAA,SAAA,EAAA,SAAA;;;;;;AAoBYC,sBAAA,UAAA,OAAA,CAAA,SAAA;;AAKsB,cAAA,KAAA,UAAA;AAAqB,kBAAA,mDAAAC,eAAA,KAAA,QAAA,CAAA,QAAA;AAAA,UAAa,OAAA;;;;AAMvD,cAAA,KAAA,YAAA;;;AAKA,kBAAA,yBAAAA,eAAA,KAAA,QAAA,CAAA,SAAA;AAAA,UAAa;AAEA,gBAAA,mDAAAA,gBAAA,KAAA,QAAA,KAAA,UAAA,QAAA,CAAA,CAAA,CAAA,4FAAA;AAAA,QAAmC,CAAA;;;;;;;;;;;;;;","names":["_ssrRenderAttrs","_mergeProps","_unref","_ssrRenderList","_ssrInterpolate"],"sources":["../../../../pages/cart.vue"],"sourcesContent":["<template>\n  <div class=\"cart-page\">\n    <div class=\"cart-main-bg\">\n      <div class=\"cart-container\">\n        <!-- 左侧商品列表 -->\n        <div class=\"cart-list-section\">\n          <h2 class=\"cart-title\">购物车</h2>\n          \n          <!-- 加载中 -->\n          <div v-if=\"cartStore.loading\" class=\"loading-state\">加载中...</div>\n          \n          <!-- 空购物车 -->\n          <div v-else-if=\"cartItems.length === 0\" class=\"empty-cart\">\n            <p>购物车是空的</p>\n            <button @click=\"router.push('/')\">去选购</button>\n          </div>\n          \n          <!-- 购物车列表 -->\n          <table v-else class=\"cart-table\">\n            <thead>\n              <tr>\n                <th>商品信息</th>\n                <th>单价</th>\n                <th>数量</th>\n                <th>小计</th>\n                <th>操作</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr v-for=\"item in cartItems\" :key=\"item.id\">\n                <td class=\"cart-goods-info\">\n                  <img :src=\"item.productImage\" class=\"cart-goods-img\" />\n                  <div class=\"cart-goods-meta\">\n                    <div class=\"cart-goods-name\">{{ item.productName }}</div>\n                    <div class=\"cart-goods-spec\" v-if=\"item.specName\">规格：{{ item.specName }}</div>\n                  </div>\n                </td>\n                <td class=\"cart-price\">￥{{ item.price.toFixed(2) }}</td>\n                <td class=\"cart-qty\">\n                  <!-- 是否支持加量 -->\n                  <template v-if=\"item.allowAddon\">\n                    <button @click=\"decreaseQty(item)\" :disabled=\"item.quantity <= 1\">-</button>\n                    <span class=\"qty-value\">{{ item.quantity }}</span>\n                    <button @click=\"increaseQty(item)\">+</button>\n                  </template>\n                  <span v-else>{{ item.quantity }}</span>\n                </td>\n                <td class=\"cart-subtotal\">￥{{ (item.price * item.quantity).toFixed(2) }}</td>\n                <td><button class=\"cart-remove\" @click=\"removeItem(item)\">删除</button></td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n        \n        <!-- 右侧结算区 -->\n        <div class=\"cart-summary-section\">\n          <div class=\"summary-title\">订单结算</div>\n          <div class=\"summary-row\">\n            <span>商品总额</span>\n            <span>￥{{ totalPrice.toFixed(2) }}</span>\n          </div>\n          <div class=\"summary-row\">\n            <span>优惠折扣</span>\n            <span class=\"discount\">-￥{{ discount.toFixed(2) }}</span>\n          </div>\n          <div class=\"summary-row total\">\n            <span>应付总额</span>\n            <span class=\"total-price\">￥{{ (totalPrice - discount).toFixed(2) }}</span>\n          </div>\n          <button \n            class=\"checkout-btn\" \n            @click=\"goCheckout\" \n            :disabled=\"cartItems.length === 0 || checkingOut\"\n          >\n            {{ checkingOut ? '正在创建订单...' : `去结算 (${cartItems.length})` }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * 购物车页面\n * 重构版 - 使用 clientOrderApi\n */\nimport { ref, computed, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useCartStore } from '@/stores/cart'\nimport { useUserStore } from '@/stores/user'\nimport { clientOrderApi } from '@/api/client'\nimport { ElMessage, ElMessageBox } from 'element-plus'\n\nconst router = useRouter()\nconst userStore = useUserStore()\nconst cartStore = useCartStore()\n\nconst checkingOut = ref(false)\n\n// 购物车数据\nconst cartItems = computed(() => cartStore.items)\nconst totalPrice = computed(() => cartStore.totalPrice)\n\n// 优惠折扣\nconst discount = computed(() => {\n  if (totalPrice.value >= 1000) return 120\n  if (totalPrice.value >= 500) return 50\n  if (totalPrice.value >= 200) return 20\n  return 0\n})\n\n// 加载购物车\nonMounted(() => {\n  cartStore.loadCart()\n})\n\n// 增加数量\nconst increaseQty = (item: any) => {\n  cartStore.updateQuantity(item.id, item.quantity + 1)\n}\n\n// 减少数量\nconst decreaseQty = (item: any) => {\n  if (item.quantity > 1) {\n    cartStore.updateQuantity(item.id, item.quantity - 1)\n  }\n}\n\n// 删除商品\nconst removeItem = (item: any) => {\n  cartStore.removeFromCart(item.id)\n}\n\n// 去结算 - 创建多个预订单，跳转到结算页\nconst goCheckout = async () => {\n  if (!userStore.isLoggedIn) {\n    ElMessage.warning('请先登录')\n    return\n  }\n  \n  if (cartItems.value.length === 0) {\n    ElMessage.warning('购物车是空的')\n    return\n  }\n  \n  checkingOut.value = true\n  const createdPreOrderIds: string[] = []\n  const failedItems: string[] = []\n  \n  try {\n    // 为每个购物车商品创建预订单\n    for (const item of cartItems.value) {\n      const result = await clientOrderApi.createPreOrder(\n        item.skuId,\n        item.quantity,\n        'cart'\n      )\n      \n      if (!result.success) {\n        // 重复下单\n        if (result.error?.includes('DUPLICATE_ORDER') || result.error?.includes('未支付')) {\n          try {\n            await ElMessageBox.confirm(\n              `商品 \"${item.productName}\" 已存在未支付订单，快去看看吧`,\n              '重复下单提示',\n              {\n                confirmButtonText: '去查看',\n                cancelButtonText: '继续结算',\n                type: 'warning'\n              }\n            )\n            router.push('/profile/orders?tab=待支付')\n            return\n          } catch {\n            // 用户选择继续结算，跳过此商品\n            failedItems.push(item.productName)\n            continue\n          }\n        }\n        \n        // 订单超限\n        if (result.error?.includes('LIMIT_EXCEEDED') || result.error?.includes('太多')) {\n          await ElMessageBox.alert(\n            '您的未支付订单太多了，请先处理一下吧',\n            '订单数量超限',\n            { type: 'warning' }\n          )\n          router.push('/profile/orders?tab=待支付')\n          return\n        }\n        \n        failedItems.push(item.productName)\n        continue\n      }\n      \n      // 创建成功\n      createdPreOrderIds.push(result.preOrderId!)\n      await cartStore.removeFromCart(item.id)\n    }\n    \n    // 检查是否有成功创建的预订单\n    if (createdPreOrderIds.length === 0) {\n      ElMessage.error('创建订单失败，请稍后重试')\n      return\n    }\n    \n    // 跳转到结算页面\n    if (createdPreOrderIds.length === 1) {\n      // 单个预订单\n      router.push(`/checkout/${createdPreOrderIds[0]}`)\n    } else {\n      // 多个预订单，使用 query 参数传递给同一个页面\n      router.push(`/checkout/${createdPreOrderIds[0]}?ids=${createdPreOrderIds.join(',')}`)\n    }\n    \n  } catch (e: any) {\n    console.error('结算失败:', e)\n    ElMessage.error(e.message || '创建订单失败')\n  } finally {\n    checkingOut.value = false\n  }\n}\n</script>\n\n<style scoped>\n.cart-page {\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n  background: #f7fbff;\n}\n.cart-main-bg {\n  max-width: 1320px;\n  width: 100%;\n  margin: 48px auto 32px auto;\n  border-radius: 32px;\n  box-shadow: 0 8px 32px rgba(35,92,220,0.10);\n  background: linear-gradient(120deg, #EEF8FB 0%, #F6F3F0 50%, #FBEFEA 100%);\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  padding: 48px 0 32px 0;\n}\n.cart-container {\n  max-width: 1200px;\n  width: 100%;\n  margin: 0 auto;\n  display: flex;\n  gap: 32px;\n  align-items: flex-start;\n}\n.cart-list-section {\n  flex: 2;\n  background: #fff;\n  border-radius: 18px;\n  box-shadow: 0 4px 24px rgba(35,92,220,0.08);\n  padding: 32px 24px;\n}\n.cart-title {\n  font-size: 28px;\n  font-weight: 700;\n  margin-bottom: 24px;\n}\n.cart-table {\n  width: 100%;\n  border-collapse: collapse;\n}\n.cart-table th, .cart-table td {\n  padding: 12px 8px;\n  text-align: center;\n}\n.cart-goods-info {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.cart-goods-img {\n  width: 64px;\n  height: 64px;\n  border-radius: 10px;\n  object-fit: cover;\n  background: #f0f0f0;\n}\n.cart-goods-meta {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  text-align: left;\n}\n.cart-goods-name {\n  font-size: 16px;\n  font-weight: 600;\n  color: #222;\n}\n.cart-goods-spec {\n  font-size: 14px;\n  color: #888;\n}\n.cart-price, .cart-subtotal {\n  color: #e74c3c;\n  font-weight: 600;\n}\n.cart-qty button {\n  width: 28px;\n  height: 28px;\n  border: none;\n  background: #f0f0f0;\n  border-radius: 6px;\n  font-size: 18px;\n  cursor: pointer;\n  margin: 0 4px;\n}\n.cart-qty button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.qty-value {\n  display: inline-block;\n  min-width: 30px;\n  text-align: center;\n}\n.cart-remove {\n  background: #ff4757;\n  color: #fff;\n  border: none;\n  border-radius: 6px;\n  padding: 6px 14px;\n  cursor: pointer;\n  font-size: 14px;\n}\n.cart-remove:hover {\n  background: #e74c3c;\n}\n.cart-summary-section {\n  flex: 1;\n  background: #fff;\n  border-radius: 18px;\n  box-shadow: 0 4px 24px rgba(35,92,220,0.08);\n  padding: 28px 24px;\n  min-width: 320px;\n}\n.summary-title {\n  font-weight: 700;\n  font-size: 24px;\n  margin-bottom: 20px;\n  padding-bottom: 16px;\n  border-bottom: 2px solid #f0f0f0;\n}\n.summary-row {\n  display: flex;\n  justify-content: space-between;\n  font-size: 16px;\n  color: #666;\n  margin-bottom: 16px;\n}\n.summary-row.total {\n  font-size: 20px;\n  font-weight: 700;\n  color: #e74c3c;\n  margin-top: 24px;\n  padding-top: 16px;\n  border-top: 2px solid #f0f0f0;\n}\n.discount {\n  color: #27ae60;\n}\n.total-price {\n  color: #e74c3c;\n}\n.checkout-btn {\n  width: 100%;\n  background: linear-gradient(90deg, #4C7AE0 0%, #235CDC 100%);\n  color: #fff;\n  border: none;\n  border-radius: 10px;\n  padding: 14px 0;\n  font-size: 18px;\n  font-weight: 600;\n  margin-top: 24px;\n  cursor: pointer;\n}\n.checkout-btn:hover {\n  background: linear-gradient(90deg, #235CDC 0%, #4C7AE0 100%);\n}\n.checkout-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.empty-cart {\n  text-align: center;\n  padding: 60px 20px;\n}\n.empty-cart p {\n  font-size: 18px;\n  color: #999;\n  margin-bottom: 20px;\n}\n.empty-cart button {\n  background: #4C7AE0;\n  color: #fff;\n  border: none;\n  border-radius: 8px;\n  padding: 12px 32px;\n  font-size: 16px;\n  cursor: pointer;\n}\n.loading-state {\n  text-align: center;\n  padding: 60px 20px;\n  color: #999;\n}\n</style>"],"version":3}