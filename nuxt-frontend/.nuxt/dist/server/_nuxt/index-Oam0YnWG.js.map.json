{"file":"index-Oam0YnWG.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiHA,UAAA,EAAA,YAAA,YAAA,IAAA,aAAA;AASA,UAAA,SAAA,UAAA;AACA,UAAA,UAAA,IAAA,KAAA;AACA,UAAA,OAAA,IAAA,EAAA;AACA,UAAA,QAAA,IAAA,CAAA;AACA,UAAA,cAAA,IAAA,EAAA;AAGA,UAAA,gBAAA,IAAA,KAAA;AACA,UAAA,gBAAA,IAAA,IAAA;AAEA,UAAA,kBAAA,SAAA;AAAA,MAAiC,SAAA;AAAA,MACtB,UAAA;AAAA,MACC,YAAA;AAAA,IACE,CAAA;AAId,UAAA,mBAAA,SAAA;AAAA,MAAqE,SAAA;AAAA,MAC1D,QAAA;AAAA,IACD,CAAA;AAGV,UAAA,WAAA,YAAA;AACE,cAAA,QAAA;AACA,UAAA;AACE,cAAA,MAAA,MAAA,SAAA,OAAA,WAAA,EAAA,MAAA,WAAA;AACA,YAAA,IAAA,SAAA;AACE,eAAA,QAAA,IAAA,QAAA,IAAA,CAAA,UAAA,EAAA,GAAA,MAAA,eAAA,MAAA,EAAA;AACA,gBAAA,QAAA,IAAA,SAAA,KAAA,MAAA;AAAA,QAAsC;AAAA,MACxC,SAAA,GAAA;AAEA,kBAAA,MAAA,MAAA;AAAA,MAAsB,UAAA;AAEtB,gBAAA,QAAA;AAAA,MAAgB;AAAA,IAClB;AAGF,UAAA,eAAA,MAAA;AACE,aAAA,KAAA,mCAAA;AAAA,IAA+C;AAGjD,UAAA,aAAA,CAAA,QAAA;AACE,aAAA,KAAA,wCAAA,IAAA,EAAA,EAAA;AAAA,IAA4D;AAG9D,UAAA,iBAAA,CAAA,QAAA;AACE,oBAAA,QAAA;AACA,oBAAA,QAAA;AAAA,IAAsB;AAKxB,UAAA,kBAAA,CAAA,QAAA;AACI,sBAAA,WAAA,IAAA;AACA,sBAAA,aAAA,IAAA;AACA,sBAAA,UAAA;AAAA,IAA0B;AAG9B,UAAA,iBAAA,CAAA,QAAA;AACI,uBAAA,SAAA;AACA,uBAAA,UAAA;AAAA,IAA2B;AAG/B,UAAA,wBAAA,CAAA,cAAA;AACE,kBAAA,QAAA,UAAA,IAAA,CAAA,SAAA,KAAA,EAAA;AAAA,IAAiD;AAGnD,UAAA,mBAAA,MAAA;AACE,UAAA,CAAA,YAAA,MAAA,OAAA;AACA,mBAAA,QAAA,YAAA,YAAA,MAAA,MAAA,WAAA,QAAA;AAAA,QAA4E,MAAA;AAAA,MACpE,CAAA,EAAA,KAAA,YAAA;AAEN,YAAA,eAAA;AACA,mBAAA,MAAA,YAAA,OAAA;AACI,gBAAA,MAAA,MAAA,SAAA,OAAA,aAAA,EAAA;AACA,cAAA,IAAA,QAAA;AAAA,QAAiB;AAErB,kBAAA,QAAA,QAAA,YAAA,OAAA;AACA,iBAAA;AACA,oBAAA,QAAA,CAAA;AAAA,MAAqB,CAAA;AAAA,IACtB;AAGH,UAAA,eAAA,OAAA,QAAA;AACE,UAAA,gBAAA;AACA,UAAA;AACE,cAAA,MAAA,MAAA,SAAA,OAAA,aAAA,IAAA,IAAA,IAAA,MAAA;AACA,YAAA,IAAA,SAAA;AACE,oBAAA,QAAA,IAAA,IAAA,SAAA,OAAA,IAAA,EAAA;AAAA,QAAgD,OAAA;AAEhD,cAAA,SAAA,CAAA,IAAA;AACA,oBAAA,MAAA,IAAA,SAAA,MAAA;AAAA,QAAmC;AAAA,MACrC,SAAA,GAAA;AAEA,YAAA,SAAA,CAAA,IAAA;AAAA,MAAkB,UAAA;AAElB,YAAA,gBAAA;AAAA,MAAoB;AAAA,IACtB;;;;;;;AA1NK,YAAA,OAAAA,eAAAC,WAAA,EAAA,OAAA,yBAAA,MAAA,CAAA,CAAA,mBAAA;;;QAEK,aAAA;AAAA,MACM,GAAA,MAAA,OAAA,CAAA;;;;;;cAKQ,SAAA;AAAA,YAAiB,GAAA;AAAA;;;;;;kBAAY;AAAA;;;;;;cAC/B,MAAAC,MAAAC,YAAA;AAAA,cAAiB,SAAA;AAAA,YAAc,GAAA;AAAA;;;;;;kBAAqB;AAAA;;;;;;;gBADT,MAAAD,MAAAE,eAAA;AAAA,gBAAzC,SAAA;AAAA,cAAiB,GAAA;AAAA;kBAAYC,gBAAA,IAAA;AAAA,gBAAA,CAAA;AAAA;;;gBACiC,MAAA;AAAA,gBAAhE,MAAAH,MAAAC,YAAA;AAAA,gBAAiB,SAAA;AAAA,cAAc,GAAA;AAAA;kBAAqBE,gBAAA,SAAA;AAAA,gBAAA,CAAA;AAAA;;;;;;;AAKhE,UAAA,YAAA,MAAA,SAAA,GAAA;;;UACc,UAAA;AAAA,QACX,GAAA,MAAA,OAAA,CAAA;AAAA;;;;;QAKF,mBAAA;AAAA,MACY,GAAAC,qBAAA,MAAA,oBAAA,QAAA,KAAA,CAAA,GAAA;AAAA,QAFD,SAAAC,QAAA,CAAA,GAAA,QAAA,UAAA,aAAA;;;;cAII,OAAA;AAAA,cAAkB,OAAA;AAAA,YAAW,GAAA,MAAA,UAAA,QAAA,CAAA;;;cAE5B,aAAA;AAAA,YAAe,GAAA;AAAA;;;;;;sBAEZC,YAAA,OAAA,EAAA,OAAA,YAAA,GAAAC,gBAAA,IAAA,IAAA,GAAA,CAAA;AAAA,oBACc,CAAA;AAAA;;;;;;;cAKjB,aAAA;AAAA,YAAiB,GAAA;AAAA;;AAExB,sBAAA,IAAA,WAAA,IAAA,QAAA,QAAA;;AACaC,kCAAA,IAAA,QAAA,MAAA,GAAA,CAAA,GAAA,CAAA,QAAA;;;wBAA+B,MAAA;AAAA,wBAAU,QAAA;AAAA,wBAAe,OAAA;AAAA,sBAAc,GAAA;AAAA;;AAClF,mCAAA,SAAAC,eAAA,IAAA,MAAA,GAAA,CAAA,CAAA,CAAA,MAAA;AAAA,0BAAS,OAAA;;;4BACnB;AAAA;;;;;;;;;wBAC2C,MAAA;AAAA,sBAAa,GAAA;AAAA;;;0BAA6B,OAAA;;;4BAAA;AAAA;;;;;;;;;;;;;;sBACjF,KAAA;AAAA;oBAL8C,GAAA;AAAA;;0BAGzC,KAAA;AAAA,0BAF4C,MAAA;AAAA,0BAAU,QAAA;AAAA,0BAAe,OAAA;AAAA,wBAAc,GAAA;AAAA;4BACrFN,gBAAA,WAAAI,gBAAA,IAAA,MAAA,GAAA,CAAA,CAAA,IAAA,QAAA,CAAA;AAAA,0BACP,CAAA;AAAA;;;;wBACqG,KAAA;AAAA;wBAA1D,MAAA;AAAA,sBAAa,GAAA;AAAA;0BAAQJ,gBAAA,MAAAI,gBAAA,IAAA,QAAA,SAAA,CAAA,GAAA,CAAA;AAAA,wBAAqB,CAAA;AAAA;;;sBAEvC,KAAA;AAAA;oBAA7B,GAAA,OAAA;AAAA,kBAAsB;AAAA;;;;;;cAIvB,OAAA;AAAA,cAAa,OAAA;AAAA,YAAY,GAAA;AAAA;;;;;;kBAEC;AAAA;;;;;;cAI1B,OAAA;AAAA,cAAY,OAAA;AAAA,YAAY,GAAA;AAAA;;AAE/B,sBAAA,CAAA,IAAA,UAAA;;;;;;;;sBAA6C,KAAA;AAAA;oBAAzB,GAAA,MAAA,MAAAG,aAAAC,YAAA,OAAA;AAAA,sBAG1B,KAAA;AAAA;oBAFY,GAAA;AAAA;oBACsB,CAAA;AAAA;;;;;;;cAKrB,OAAA;AAAA,cAAW,OAAA;AAAA,YAAY,GAAA;AAAA;;;;oBAG3B,uBAAA,CAAA,WAAA,IAAA,SAAA;AAAA,oBAAM,iBAAA;AAAA,oBACnB,eAAA;AAAA,oBACY,iBAAA;AAAA,oBACE,SAAA,IAAA;AAAA,oBACA,UAAA,CAAA,WAAA,aAAA,GAAA;AAAA,kBACW,GAAA,MAAA,UAAA,SAAA,CAAA;AAAA;;;sBACzB,YAAA,IAAA;AAAA,sBANa,uBAAA,CAAA,WAAA,IAAA,SAAA;AAAA,sBAAM,iBAAA;AAAA,sBACnB,eAAA;AAAA,sBACY,iBAAA;AAAA,sBACE,SAAA,IAAA;AAAA,sBACA,UAAA,CAAA,WAAA,aAAA,GAAA;AAAA,oBACW,GAAA,MAAA,GAAA,CAAA,cAAA,uBAAA,WAAA,UAAA,CAAA;AAAA;;;;;;;cAKR,OAAA;AAAA,cAAW,OAAA;AAAA,cAAY,OAAA;AAAA,YAAe,GAAA;AAAA;;;;oBAE9C,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,WAAA,GAAA;AAAA,kBAAgC,GAAA;AAAA;;;;;;wBAAK;AAAA;;;;;;oBAC/C,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,eAAA,GAAA;AAAA,kBAAoC,GAAA;AAAA;;;;;;wBAAK;AAAA;;;;;;oBACnD,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,eAAA,GAAA;AAAA,kBAAoC,GAAA;AAAA;;;;;;wBAAK;AAAA;;;;;;oBACnD,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,gBAAA,GAAA;AAAA,kBAAkC,GAAA;AAAA;;;;;;wBAAK;AAAA;;;;;;;sBAHU,MAAA;AAAA,sBAA3D,MAAA;AAAA,sBAAU,SAAA,CAAA,WAAA,WAAA,GAAA;AAAA,oBAAgC,GAAA;AAAA;wBAAKR,gBAAA,IAAA;AAAA,sBAAA,CAAA;AAAA;;;sBACgB,MAAA;AAAA,sBAA/D,MAAA;AAAA,sBAAU,SAAA,CAAA,WAAA,eAAA,GAAA;AAAA,oBAAoC,GAAA;AAAA;wBAAKA,gBAAA,IAAA;AAAA,sBAAA,CAAA;AAAA;;;sBACY,MAAA;AAAA,sBAA/D,MAAA;AAAA,sBAAU,SAAA,CAAA,WAAA,eAAA,GAAA;AAAA,oBAAoC,GAAA;AAAA;wBAAKA,gBAAA,IAAA;AAAA,sBAAA,CAAA;AAAA;;;sBACU,MAAA;AAAA,sBAA7D,MAAA;AAAA,sBAAU,SAAA,CAAA,WAAA,gBAAA,GAAA;AAAA,oBAAkC,GAAA;AAAA;wBAAKA,gBAAA,IAAA;AAAA,sBAAA,CAAA;AAAA;;;;;;;;;;gBAvDF,MAAA;AAAA,gBAAxC,OAAA;AAAA,gBAAkB,OAAA;AAAA,cAAW,CAAA;AAAA;gBAQjC,OAAA;AAAA,gBANK,aAAA;AAAA,cAAe,GAAA;AAAA;kBACXG,YAAA,OAAA,EAAA,OAAA,YAAA,GAAA;AAAA,oBACDA,YAAA,OAAA,EAAA,OAAA,YAAA,GAAAC,gBAAA,IAAA,IAAA,GAAA,CAAA;AAAA,kBACc,CAAA;AAAA;;;;gBAetB,OAAA;AAAA,gBAVK,aAAA;AAAA,cAAiB,GAAA;AAAA;kBACb,IAAA,WAAA,IAAA,QAAA,UAAAG,UAAA,GAAAC,YAAA,OAAA;AAAA,oBAMhB,KAAA;AAAA;kBAL8C,GAAA;AAAA;;wBAGzC,KAAA;AAAA,wBAF4C,MAAA;AAAA,wBAAU,QAAA;AAAA,wBAAe,OAAA;AAAA,sBAAc,GAAA;AAAA;0BACrFR,gBAAA,WAAAI,gBAAA,IAAA,MAAA,GAAA,CAAA,CAAA,IAAA,QAAA,CAAA;AAAA,wBACP,CAAA;AAAA;;;;sBACqG,KAAA;AAAA;sBAA1D,MAAA;AAAA,oBAAa,GAAA;AAAA;wBAAQJ,gBAAA,MAAAI,gBAAA,IAAA,QAAA,SAAA,CAAA,GAAA,CAAA;AAAA,sBAAqB,CAAA;AAAA;;;oBAEvC,KAAA;AAAA;kBAA7B,GAAA,OAAA;AAAA,gBAAsB,CAAA;AAAA;;;gBAQ5B,OAAA;AAAA,gBAJK,OAAA;AAAA,gBAAa,OAAA;AAAA,cAAY,GAAA;AAAA;kBACrBD,YAAA,QAAA,EAAA,OAAA,SAAA,GAAAC,gBAAAP,MAAA,WAAA,EAAA,IAAA,KAAA,CAAA,GAAA,CAAA;AAAA,gBACsB,CAAA;AAAA;;;gBAW/B,OAAA;AAAA,gBAPK,OAAA;AAAA,gBAAY,OAAA;AAAA,cAAY,GAAA;AAAA;kBACpB,CAAA,IAAA,YAAAU,UAAA,GAAAC,YAAA,OAAA;AAAA,oBACkC,KAAA;AAAA;kBAAzB,GAAA,MAAA,MAAAD,aAAAC,YAAA,OAAA;AAAA,oBAG1B,KAAA;AAAA;kBAFY,GAAA;AAAA;kBACsB,CAAA;AAAA;;;;gBAgB1B,OAAA;AAAA,gBAXK,OAAA;AAAA,gBAAW,OAAA;AAAA,cAAY,GAAA;AAAA;kBACnBL,YAAA,sBAAA;AAAA,oBAQrB,YAAA,IAAA;AAAA,oBANa,uBAAA,CAAA,WAAA,IAAA,SAAA;AAAA,oBAAM,iBAAA;AAAA,oBACnB,eAAA;AAAA,oBACY,iBAAA;AAAA,oBACE,SAAA,IAAA;AAAA,oBACA,UAAA,CAAA,WAAA,aAAA,GAAA;AAAA,kBACW,GAAA,MAAA,GAAA,CAAA,cAAA,uBAAA,WAAA,UAAA,CAAA;AAAA;;;;gBAYb,OAAA;AAAA,gBAPK,OAAA;AAAA,gBAAW,OAAA;AAAA,gBAAY,OAAA;AAAA,cAAe,GAAA;AAAA;kBAClCA,YAAA,sBAAA;AAAA,oBAC+C,MAAA;AAAA,oBAA3D,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,WAAA,GAAA;AAAA,kBAAgC,GAAA;AAAA;sBAAKH,gBAAA,IAAA;AAAA,oBAAA,CAAA;AAAA;;;oBACgB,MAAA;AAAA,oBAA/D,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,eAAA,GAAA;AAAA,kBAAoC,GAAA;AAAA;sBAAKA,gBAAA,IAAA;AAAA,oBAAA,CAAA;AAAA;;;oBACY,MAAA;AAAA,oBAA/D,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,eAAA,GAAA;AAAA,kBAAoC,GAAA;AAAA;sBAAKA,gBAAA,IAAA;AAAA,oBAAA,CAAA;AAAA;;;oBACU,MAAA;AAAA,oBAA7D,MAAA;AAAA,oBAAU,SAAA,CAAA,WAAA,gBAAA,GAAA;AAAA,kBAAkC,GAAA;AAAA;sBAAKA,gBAAA,IAAA;AAAA,oBAAA,CAAA;AAAA;;;;;;;;;;;;QAOvD,uBAAA,CAAA,WAAA,cAAA,QAAA;AAAA,QAAa,QAAA,cAAA;AAAA,MACb,GAAA,MAAA,OAAA,CAAA;;;QAIgB,uBAAA,CAAA,WAAA,gBAAA,UAAA;AAAA,QAAO,aAAA,gBAAA;AAAA,QACJ,eAAA,gBAAA;AAAA,MACE,GAAA,MAAA,OAAA,CAAA;;;QAIJ,uBAAA,CAAA,WAAA,iBAAA,UAAA;AAAA,QAAO,QAAA,iBAAA;AAAA,QACP,SAAA;AAAA,MAClB,GAAA,MAAA,OAAA,CAAA;;;;;;;;;;;;","names":["_ssrRenderAttrs","_mergeProps","_unref","Plus","Refresh","_createTextVNode","_ssrGetDirectiveProps","_withCtx","_createVNode","_toDisplayString","_ssrRenderList","_ssrInterpolate","_openBlock","_createBlock"],"sources":["../../../../pages/_mgmt_9Xfa3/coupons/product/index.vue"],"sourcesContent":["<template>\n  <div class=\"coupon-product-list\">\n    <PageTipHeader \n      title=\"指定商品券\" \n      description=\"管理特定商品专用的优惠券，用户购买指定商品时可享受优惠。\"\n    />\n\n    <AdminActionCard>\n      <template #actions>\n        <el-button :icon=\"Refresh\" @click=\"loadList\">刷新</el-button>\n        <el-button type=\"primary\" :icon=\"Plus\" @click=\"handleCreate\">新增指定商品券</el-button>\n      </template>\n    </AdminActionCard>\n\n    <BulkActionBar \n      v-if=\"selectedIds.length > 0\"\n      :count=\"selectedIds.length\"\n      @delete=\"handleBulkDelete\"\n    />\n\n    <AdminDataTable\n      v-loading=\"loading\"\n      :data=\"list\"\n      @selection-change=\"handleSelectionChange\"\n    >\n      <el-table-column type=\"selection\" width=\"50\" align=\"center\" />\n      \n      <el-table-column label=\"名称\" min-width=\"180\">\n        <template #default=\"{ row }\">\n          <div class=\"code-info\">\n            <div class=\"code-name\">{{ row.name }}</div>\n          </div>\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"关联商品\" min-width=\"200\">\n        <template #default=\"{ row }\">\n           <div v-if=\"row.sku_ids && row.sku_ids.length\" class=\"product-tags\">\n             <el-tag v-for=\"sid in row.sku_ids.slice(0, 3)\" :key=\"sid\" size=\"small\" effect=\"plain\" class=\"product-tag\">\n               SKU: {{ sid.slice(0, 6) }}...\n             </el-tag>\n             <el-tag v-if=\"row.sku_ids.length > 3\" size=\"small\" type=\"info\">+{{ row.sku_ids.length - 3 }}</el-tag>\n           </div>\n           <span v-else class=\"text-secondary\">无关联商品</span>\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"立减金额\" width=\"120\" align=\"right\">\n        <template #default=\"{ row }\">\n          <span class=\"amount\">{{ formatPrice(row.value) }}</span>\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"有效期\" width=\"200\" align=\"center\">\n        <template #default=\"{ row }\">\n          <div v-if=\"!row.end_date\" class=\"validity-tag\">永久有效</div>\n          <div v-else class=\"validity-range\">\n            <div>{{ formatDate(row.end_date) }} 到期</div>\n          </div>\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"状态\" width=\"100\" align=\"center\">\n        <template #default=\"{ row }\">\n          <el-switch\n            v-model=\"row.status\"\n            inline-prompt\n            active-text=\"启用\"\n            inactive-text=\"停用\"\n            :loading=\"row.statusLoading\"\n            @change=\"toggleStatus(row)\"\n          />\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"操作\" width=\"260\" align=\"center\" fixed=\"right\">\n        <template #default=\"{ row }\">\n          <el-button link type=\"primary\" @click=\"handleEdit(row)\">编辑</el-button>\n          <el-button link type=\"success\" @click=\"handleGenerate(row)\">发券</el-button>\n          <el-button link type=\"warning\" @click=\"handleEditCode(row)\">说明</el-button>\n          <el-button link type=\"info\" @click=\"handleViewCodes(row)\">详情</el-button>\n        </template>\n      </el-table-column>\n    </AdminDataTable>\n\n    <!-- Code Generator Modal -->\n    <CouponCodeGenerator\n      v-model=\"showGenerator\"\n      :coupon=\"currentCoupon\"\n    />\n    \n    <CouponCodeDrawer \n      v-model=\"viewCodesDialog.visible\" \n      :coupon-id=\"viewCodesDialog.couponId\" \n      :coupon-name=\"viewCodesDialog.couponName\"\n    />\n    <!-- 说明编辑弹窗 -->\n    <CouponCodeEditor\n      v-model=\"codeEditorDialog.visible\"\n      :coupon=\"codeEditorDialog.coupon\"\n      @saved=\"loadList\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { Plus, Refresh } from '@element-plus/icons-vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { adminApi, type AdminCoupon } from '@/api/admin-supabase'\nimport { useBizFormat } from '@/composables/common/useBizFormat'\n\nconst { formatDate, formatPrice } = useBizFormat()\nimport PageTipHeader from '@/components/admin/base/PageTipHeader.vue'\nimport AdminActionCard from '@/components/admin/base/AdminActionCard.vue'\nimport BulkActionBar from '@/components/admin/base/BulkActionBar.vue'\nimport AdminDataTable from '@/components/admin/base/AdminDataTable.vue'\nimport CouponCodeDrawer from '@/components/admin/coupon/CouponCodeDrawer.vue'\nimport CouponCodeGenerator from '@/components/admin/CouponCodeGenerator.vue'\nimport CouponCodeEditor from '@/components/admin/coupon/CouponCodeEditor.vue'\n\nconst router = useRouter()\nconst loading = ref(false)\nconst list = ref<AdminCoupon[]>([])\nconst total = ref(0)\nconst selectedIds = ref<string[]>([])\n\n// Generator Modal State\nconst showGenerator = ref(false)\nconst currentCoupon = ref<AdminCoupon | null>(null)\n\nconst viewCodesDialog = reactive({\n  visible: false,\n  couponId: '',\n  couponName: ''\n})\n\n// 说明编辑弹窗状态\nconst codeEditorDialog = reactive<{ visible: boolean; coupon: any }>({ \n  visible: false, \n  coupon: null \n})\n\nconst loadList = async () => {\n  loading.value = true\n  try {\n    const res = await adminApi.coupon.getCoupons({ type: 'product' })\n    if (res.success) {\n      list.value = (res.coupons as any[]).map(item => ({ ...item, statusLoading: false }))\n      total.value = res.total || list.value.length\n    }\n  } catch (e) {\n    ElMessage.error('加载异常')\n  } finally {\n    loading.value = false\n  }\n}\n\nconst handleCreate = () => {\n  router.push('/_mgmt_9Xfa3/coupons/product/post')\n}\n\nconst handleEdit = (row: AdminCoupon) => {\n  router.push(`/_mgmt_9Xfa3/coupons/product/post?id=${row.id}`)\n}\n\nconst handleGenerate = (row: AdminCoupon) => {\n  currentCoupon.value = row\n  showGenerator.value = true\n}\n\n// Old submitGenerate removed\n\nconst handleViewCodes = (row: AdminCoupon) => {\n    viewCodesDialog.couponId = row.id\n    viewCodesDialog.couponName = row.name\n    viewCodesDialog.visible = true\n}\n\nconst handleEditCode = (row: AdminCoupon) => {\n    codeEditorDialog.coupon = row\n    codeEditorDialog.visible = true\n}\n\nconst handleSelectionChange = (selection: AdminCoupon[]) => {\n  selectedIds.value = selection.map(item => item.id)\n}\n\nconst handleBulkDelete = () => {\n  if (!selectedIds.value.length) return\n  ElMessageBox.confirm(`确定要删除选中的 ${selectedIds.value.length} 个优惠券吗？`, '批量删除', {\n    type: 'warning'\n  }).then(async () => {\n    let successCount = 0\n    for (const id of selectedIds.value) {\n        const res = await adminApi.coupon.deleteCoupon(id)\n        if (res.success) successCount++\n    }\n    ElMessage.success(`成功删除 ${successCount} 个优惠券`)\n    loadList()\n    selectedIds.value = []\n  })\n}\n\nconst toggleStatus = async (row: any) => {\n  row.statusLoading = true\n  try {\n    const res = await adminApi.coupon.toggleStatus(row.id, row.status)\n    if (res.success) {\n      ElMessage.success(`已${row.status ? '启用' : '停用'}`)\n    } else {\n      row.status = !row.status\n      ElMessage.error(res.error || '操作失败')\n    }\n  } catch (e) {\n    row.status = !row.status\n  } finally {\n    row.statusLoading = false\n  }\n}\n\n// formatDate and formatPrice are now from useBizFormat\n\nonMounted(() => {\n  loadList()\n})\n</script>\n\n<style scoped>\n.code-info {\n  display: flex;\n  flex-direction: column;\n}\n.code-name {\n  font-weight: 600;\n  font-size: 14px;\n}\n.amount {\n  color: var(--el-color-primary);\n  font-weight: bold;\n}\n.product-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 4px;\n}\n.product-tag {\n  max-width: 100%;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.text-secondary {\n  color: #909399;\n  font-size: 12px;\n}\n.validity-range {\n  font-size: 12px;\n  color: var(--el-text-color-regular);\n}\n</style>\n"],"version":3}