{"file":"create-DGVyWqRU.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2GA,aAAA;AACA,cAAA;AAEA,QAAA,EAAA;AACA,UAAA,QAAA,IAAA,IAAA;AACA,UAAA,UAAA,IAAA,IAAA;AACA,UAAA,QAAA,IAAA,EAAA;AACA,UAAA,aAAA,IAAA,KAAA;AACA,UAAA,oBAAA,IAAA,KAAA;AAEA,UAAA,SAAA,IAAA,EAAA;AACA,UAAA,eAAA,IAAA,EAAA;AAEA,UAAA,gBAAA;AAAA,MAAsB,EAAA,OAAA,QAAA,OAAA,OAAA;AAAA,MACW,EAAA,OAAA,QAAA,OAAA,OAAA;AAAA,MACA,EAAA,OAAA,UAAA,OAAA,SAAA;AAAA,MACI,EAAA,OAAA,SAAA,OAAA,QAAA;AAAA,MACF,EAAA,OAAA,QAAA,OAAA,OAAA;AAAA,IACF;AAoDjC,aAAA,YAAA,aAAA;AACE,UAAA,CAAA,aAAA,iBAAA,QAAA;AACA,aAAA,OAAA,OAAA,YAAA,gBAAA,EAAA,KAAA,KAAA;AAAA,IAA6D;;;;;;AAlLxD,YAAA,OAAAA,eAAAC,WAAA,EAAA,OAAA,uBAAA,MAAA,CAAA,CAAA,iJAAA;;;;;;;;YAKyB;AAAA;;;;;;;;;MAeb,WAAA,kBAAA,OAAA;;;;;;UAmCW,uBAAA,CAAA,WAAA,OAAA,QAAA;AAAA,UAAM,aAAA;AAAA,UAAc,OAAA;AAAA,QAAgB,GAAA;AAAA;;;AAEtCC,4BAAA,eAAA,CAAA,QAAA;;;kBACJ,OAAA,IAAA;AAAA,kBACE,OAAA,IAAA;AAAA,gBACA,GAAA,MAAA,UAAA,QAAA,CAAA;AAAA;;;;;;oBACZ,KAAA,IAAA;AAAA,oBAHU,OAAA,IAAA;AAAA,oBACE,OAAA,IAAA;AAAA,kBACA,GAAA,MAAA,GAAA,CAAA,SAAA,OAAA,CAAA;AAAA;;;;;;;;;UASL,uBAAA,CAAA,WAAA,aAAA,QAAA;AAAA,UAAY,MAAA;AAAA,UAChB,MAAA;AAAA,UACE,aAAA;AAAA,UACK,WAAA;AAAA,UACF,mBAAA;AAAA,QACV,GAAA,MAAA,OAAA,CAAA;;;;;;;;;;;;;;","names":["_ssrRenderAttrs","_mergeProps","_ssrRenderList"],"sources":["../../../../pages/support/refund/create.vue"],"sourcesContent":["<template>\n  <div class=\"refund-apply-page\">\n    <div class=\"page-container\">\n      <!-- Header -->\n      <div class=\"page-header\">\n        <button class=\"back-btn\" @click=\"goBack\">\n          <el-icon><ArrowLeft /></el-icon>\n          è¿”å›\n        </button>\n        <h1 class=\"page-title\">ç”³è¯·é€€æ¬¾</h1>\n      </div>\n\n      <!-- Loading -->\n      <div v-if=\"loading\" class=\"loading-state\">\n        <div class=\"spinner\"></div>\n        <p>åŠ è½½ä¸­...</p>\n      </div>\n\n      <!-- Error -->\n      <div v-else-if=\"error\" class=\"error-state\">\n        <div class=\"error-icon\">âš ï¸</div>\n        <p>{{ error }}</p>\n        <button class=\"retry-btn\" @click=\"loadOrder\">é‡è¯•</button>\n      </div>\n\n      <!-- Already has pending request -->\n      <div v-else-if=\"hasPendingRequest\" class=\"pending-state\">\n        <div class=\"pending-icon\">ğŸ•</div>\n        <h2>é€€æ¬¾ç”³è¯·å¤„ç†ä¸­</h2>\n        <p>æ‚¨çš„é€€æ¬¾ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚</p>\n        <button class=\"primary-btn\" @click=\"goBack\">è¿”å›è®¢å•è¯¦æƒ…</button>\n      </div>\n\n      <!-- Apply Form -->\n      <div v-else class=\"apply-form\">\n        <!-- Order Info -->\n        <div class=\"order-card\">\n          <div class=\"order-header\">\n            <span class=\"order-label\">è®¢å•ä¿¡æ¯</span>\n            <span class=\"order-no\">{{ order?.order_no }}</span>\n          </div>\n          <div class=\"order-content\">\n            <div class=\"product-info\">\n              <img :src=\"order?.product_snapshot?.image || '/images/placeholder.png'\" class=\"product-img\" />\n              <div class=\"product-detail\">\n                <div class=\"product-name\">{{ order?.product_snapshot?.product_name }}</div>\n                <div class=\"product-spec\">{{ getSpecText(order?.sku_snapshot) }}</div>\n              </div>\n            </div>\n            <div class=\"order-amount\">Â¥{{ order?.total_amount }}</div>\n          </div>\n        </div>\n\n        <!-- Reason Selection -->\n        <div class=\"form-section\">\n          <div class=\"form-label\">é€€æ¬¾åŸå›  <span class=\"required\">*</span></div>\n          <el-select v-model=\"reason\" placeholder=\"è¯·é€‰æ‹©é€€æ¬¾åŸå› \" class=\"reason-select\">\n            <el-option \n              v-for=\"opt in reasonOptions\" \n              :key=\"opt.value\" \n              :label=\"opt.label\" \n              :value=\"opt.value\" \n            />\n          </el-select>\n        </div>\n\n        <!-- Detail -->\n        <div class=\"form-section\">\n          <div class=\"form-label\">è¡¥å……è¯´æ˜</div>\n          <el-input\n            v-model=\"reasonDetail\"\n            type=\"textarea\"\n            :rows=\"3\"\n            placeholder=\"è¯·è¯¦ç»†æè¿°æ‚¨çš„é—®é¢˜ï¼ˆé€‰å¡«ï¼‰\"\n            maxlength=\"500\"\n            show-word-limit\n          />\n        </div>\n\n        <!-- Notice -->\n        <div class=\"notice-card\">\n          <div class=\"notice-icon\">â„¹ï¸</div>\n          <div class=\"notice-text\">\n            é€€æ¬¾ç”³è¯·æäº¤åå°†è¿›å…¥äººå·¥å®¡æ ¸æµç¨‹ï¼Œæœ€ç»ˆé€€æ¬¾é‡‘é¢ä»¥å®¡æ ¸ç»“æœä¸ºå‡†ã€‚\n          </div>\n        </div>\n\n        <!-- Submit -->\n        <button \n          class=\"submit-btn\" \n          :disabled=\"!reason || submitting\"\n          @click=\"handleSubmit\"\n        >\n          {{ submitting ? 'æäº¤ä¸­...' : 'æäº¤é€€æ¬¾ç”³è¯·' }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { ArrowLeft } from '@element-plus/icons-vue'\nimport { getSupabaseClient } from '@/utils/supabase'\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst orderId = ref('')\nconst order = ref<any>(null)\nconst loading = ref(true)\nconst error = ref('')\nconst submitting = ref(false)\nconst hasPendingRequest = ref(false)\n\nconst reason = ref('')\nconst reasonDetail = ref('')\n\nconst reasonOptions = [\n  { value: 'ä¹°é”™å•†å“', label: 'ä¹°é”™å•†å“' },\n  { value: 'ä¸æƒ³è¦äº†', label: 'ä¸æƒ³è¦äº†' },\n  { value: 'å•†å“æ— æ³•ä½¿ç”¨', label: 'å•†å“æ— æ³•ä½¿ç”¨' },\n  { value: 'æœªæ”¶åˆ°å•†å“', label: 'æœªæ”¶åˆ°å•†å“' },\n  { value: 'å…¶ä»–åŸå› ', label: 'å…¶ä»–åŸå› ' }\n]\n\nonMounted(() => {\n  orderId.value = route.query.orderId as string\n  if (!orderId.value) {\n    error.value = 'ç¼ºå°‘è®¢å•ID'\n    loading.value = false\n    return\n  }\n  loadOrder()\n})\n\nasync function loadOrder() {\n  loading.value = true\n  error.value = ''\n  \n  try {\n    const client = getSupabaseClient()\n    \n    // Get order\n    const { data: orderData, error: orderError } = await client\n      .from('orders')\n      .select('*')\n      .eq('id', orderId.value)\n      .single()\n    \n    if (orderError) throw orderError\n    order.value = orderData\n    \n    // Check if can apply\n    if (!['pending_delivery', 'active'].includes(orderData.status)) {\n      error.value = 'å½“å‰è®¢å•çŠ¶æ€ä¸å¯ç”³è¯·é€€æ¬¾'\n      return\n    }\n    \n    // Check existing request\n    const { data: requestData } = await client.rpc('get_refund_request', {\n      p_order_id: orderId.value\n    })\n    \n    if (requestData?.request?.status === 'pending') {\n      hasPendingRequest.value = true\n    }\n    \n  } catch (e: any) {\n    error.value = e.message || 'åŠ è½½å¤±è´¥'\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction getSpecText(skuSnapshot: any) {\n  if (!skuSnapshot?.spec_combination) return ''\n  return Object.values(skuSnapshot.spec_combination).join(' / ')\n}\n\nasync function handleSubmit() {\n  if (!reason.value || submitting.value) return\n  \n  try {\n    await ElMessageBox.confirm(\n      'ç¡®å®šè¦æäº¤é€€æ¬¾ç”³è¯·å—ï¼Ÿ',\n      'ç¡®è®¤æäº¤',\n      { confirmButtonText: 'ç¡®å®š', cancelButtonText: 'å–æ¶ˆ' }\n    )\n  } catch {\n    return\n  }\n  \n  submitting.value = true\n  \n  try {\n    const client = getSupabaseClient()\n    const { data, error: rpcError } = await client.rpc('create_refund_request', {\n      p_order_id: orderId.value,\n      p_reason: reason.value,\n      p_reason_detail: reasonDetail.value || null\n    })\n    \n    if (rpcError) throw rpcError\n    \n    if (!data?.success) {\n      ElMessage.error(data?.error || 'æäº¤å¤±è´¥')\n      return\n    }\n    \n    ElMessage.success('é€€æ¬¾ç”³è¯·å·²æäº¤ï¼Œè¯·ç­‰å¾…å®¡æ ¸')\n    router.replace(`/profile/order/${orderId.value}`)\n    \n  } catch (e: any) {\n    ElMessage.error(e.message || 'æäº¤å¤±è´¥')\n  } finally {\n    submitting.value = false\n  }\n}\n\nfunction goBack() {\n  if (orderId.value) {\n    router.push(`/profile/order/${orderId.value}`)\n  } else {\n    router.back()\n  }\n}\n</script>\n\n<style scoped>\n.refund-apply-page {\n  min-height: 100vh;\n  background: transparent;\n  padding: 20px;\n}\n\n.page-container {\n  max-width: 600px;\n  margin: 0 auto;\n}\n\n.page-header {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  margin-bottom: 24px;\n}\n\n.back-btn {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  padding: 8px 12px;\n  color: #94a3b8;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.back-btn:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: #e2e8f0;\n}\n\n.page-title {\n  font-size: 20px;\n  font-weight: 600;\n  color: #e2e8f0;\n  margin: 0;\n}\n\n/* Loading & Error */\n.loading-state, .error-state, .pending-state {\n  text-align: center;\n  padding: 60px 20px;\n  color: #94a3b8;\n}\n\n.spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(255, 255, 255, 0.1);\n  border-top-color: #4C7AE0;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin: 0 auto 16px;\n}\n\n@keyframes spin { to { transform: rotate(360deg); } }\n\n.error-icon, .pending-icon {\n  font-size: 48px;\n  margin-bottom: 16px;\n}\n\n.pending-state h2 {\n  color: #e2e8f0;\n  margin: 0 0 8px 0;\n}\n\n.retry-btn, .primary-btn {\n  margin-top: 16px;\n  padding: 10px 24px;\n  border-radius: 8px;\n  font-size: 14px;\n  cursor: pointer;\n}\n\n.retry-btn {\n  background: rgba(255, 255, 255, 0.1);\n  border: none;\n  color: #94a3b8;\n}\n\n.primary-btn {\n  background: #3b82f6;\n  border: none;\n  color: white;\n}\n\n/* Order Card */\n.order-card {\n  background: rgba(255, 255, 255, 0.03);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 12px;\n  padding: 16px;\n  margin-bottom: 20px;\n}\n\n.order-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 12px;\n  font-size: 13px;\n}\n\n.order-label { color: #64748b; }\n.order-no { color: #94a3b8; font-family: monospace; }\n\n.order-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.product-info {\n  display: flex;\n  gap: 12px;\n  align-items: center;\n}\n\n.product-img {\n  width: 56px;\n  height: 56px;\n  border-radius: 8px;\n  object-fit: cover;\n  background: #1e293b;\n}\n\n.product-name {\n  font-size: 14px;\n  font-weight: 500;\n  color: #e2e8f0;\n  margin-bottom: 4px;\n}\n\n.product-spec {\n  font-size: 12px;\n  color: #64748b;\n}\n\n.order-amount {\n  font-size: 16px;\n  font-weight: 600;\n  color: #22c55e;\n}\n\n/* Form */\n.form-section {\n  margin-bottom: 20px;\n}\n\n.form-label {\n  font-size: 14px;\n  color: #94a3b8;\n  margin-bottom: 8px;\n}\n\n.required { color: #ef4444; }\n\n.reason-select {\n  width: 100%;\n}\n\n:deep(.el-select) {\n  width: 100%;\n}\n\n:deep(.el-textarea__inner) {\n  background: rgba(255, 255, 255, 0.03);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #e2e8f0;\n}\n\n/* Notice */\n.notice-card {\n  display: flex;\n  gap: 12px;\n  background: rgba(59, 130, 246, 0.1);\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  border-radius: 12px;\n  padding: 16px;\n  margin-bottom: 24px;\n}\n\n.notice-icon { font-size: 20px; }\n\n.notice-text {\n  font-size: 13px;\n  color: #94a3b8;\n  line-height: 1.6;\n}\n\n/* Submit */\n.submit-btn {\n  width: 100%;\n  background: #ef4444;\n  color: white;\n  border: none;\n  padding: 14px;\n  border-radius: 12px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.submit-btn:hover {\n  background: #dc2626;\n}\n\n.submit-btn:disabled {\n  background: #334155;\n  color: #64748b;\n  cursor: not-allowed;\n}\n</style>\n"],"version":3}