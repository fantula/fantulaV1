{"version":3,"file":"index-ONWF44uy.js","sources":["../../../../pages/_mgmt_9Xfa3/orders/cancelled-refunds/index.vue"],"sourcesContent":["<template>\n  <div class=\"refund-stats-page\">\n    <div class=\"page-header\">\n      <h2>退款统计</h2>\n      <p class=\"sub-desc\">已取消的退款申请记录</p>\n    </div>\n\n    <!-- 筛选 -->\n    <el-card shadow=\"never\" class=\"filter-card\">\n      <div class=\"filter-container\">\n        <div class=\"filter-left\">\n          <el-input v-model=\"filterParams.orderNo\" placeholder=\"订单号\" clearable style=\"width: 200px; margin-right: 15px;\" @keyup.enter=\"handleSearch\">\n            <template #prefix>\n              <el-icon><Search /></el-icon>\n            </template>\n          </el-input>\n          <el-input v-model=\"filterParams.uid\" placeholder=\"用户UID\" clearable style=\"width: 150px; margin-right: 15px;\" @keyup.enter=\"handleSearch\">\n            <template #prefix>\n              <el-icon><User /></el-icon>\n            </template>\n          </el-input>\n          <el-button type=\"primary\" :icon=\"Search\" @click=\"handleSearch\">查询</el-button>\n          <el-button :icon=\"Refresh\" @click=\"handleRefresh\">刷新</el-button>\n        </div>\n        <div class=\"filter-right\">\n          <el-statistic title=\"总取消次数\">\n            <template #default>\n              <span class=\"stat-number\">{{ totalCount }}</span>\n            </template>\n          </el-statistic>\n        </div>\n      </div>\n    </el-card>\n\n    <!-- 列表 -->\n    <el-card shadow=\"never\" class=\"list-card\">\n      <el-table :data=\"cancelledList\" style=\"width: 100%\" v-loading=\"loading\" border>\n        <el-table-column prop=\"order_no\" label=\"订单号\" min-width=\"180\" show-overflow-tooltip />\n        <el-table-column label=\"用户\" width=\"150\">\n          <template #default=\"{ row }\">\n            <span>{{ row.user_nickname || row.user_id?.slice(0, 8) }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"reason\" label=\"退款原因\" min-width=\"150\" show-overflow-tooltip />\n        <el-table-column prop=\"reason_detail\" label=\"补充说明\" min-width=\"150\" show-overflow-tooltip>\n          <template #default=\"{ row }\">\n            {{ row.reason_detail || '-' }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"申请时间\" width=\"180\">\n          <template #default=\"{ row }\">\n            {{ formatDate(row.created_at) }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"取消时间\" width=\"180\">\n          <template #default=\"{ row }\">\n            {{ formatDate(row.reviewed_at) }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"状态\" width=\"100\" align=\"center\">\n          <template #default>\n            <el-tag type=\"info\">已取消</el-tag>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <!-- 分页 -->\n      <div class=\"pagination-wrapper\" style=\"margin-top: 20px; display: flex; justify-content: flex-end;\">\n        <el-pagination\n          background\n          layout=\"total, prev, pager, next\"\n          :total=\"totalCount\"\n          :page-size=\"pageSize\"\n          :current-page=\"currentPage\"\n          @current-change=\"handlePageChange\"\n        />\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive, onMounted } from 'vue'\nimport { Search, Refresh, User } from '@element-plus/icons-vue'\nimport { ElMessage } from 'element-plus'\nimport { getSupabaseClient } from '@/utils/supabase'\n\ndefinePageMeta({\n  title: '退款统计'\n})\n\ninterface CancelledRefund {\n  id: string\n  order_id: string\n  order_no: string\n  user_id: string\n  user_nickname?: string\n  reason: string\n  reason_detail?: string\n  created_at: string\n  reviewed_at: string\n}\n\nconst loading = ref(false)\nconst cancelledList = ref<CancelledRefund[]>([])\nconst totalCount = ref(0)\nconst currentPage = ref(1)\nconst pageSize = ref(20)\n\nconst filterParams = reactive({\n  orderNo: '',\n  uid: ''\n})\n\n// 加载数据\nconst loadData = async () => {\n  loading.value = true\n  try {\n    const client = getSupabaseClient()\n    \n    // 构建查询 - 使用明确的外键关系\n    let query = client\n      .from('refund_requests')\n      .select(`\n        id,\n        order_id,\n        user_id,\n        reason,\n        reason_detail,\n        created_at,\n        reviewed_at,\n        orders!inner(order_no),\n        profiles!refund_requests_user_id_fkey(nickname)\n      `, { count: 'exact' })\n      .eq('status', 'cancelled')\n      .order('reviewed_at', { ascending: false })\n      .range((currentPage.value - 1) * pageSize.value, currentPage.value * pageSize.value - 1)\n\n    const { data, error, count } = await query\n\n    if (error) {\n      console.error('加载失败:', error)\n      ElMessage.error('加载失败: ' + error.message)\n      return\n    }\n\n    // 处理数据格式\n    cancelledList.value = (data || []).map((item: any) => ({\n      id: item.id,\n      order_id: item.order_id,\n      order_no: item.orders?.order_no || '-',\n      user_id: item.user_id,\n      user_nickname: item.profiles?.nickname,\n      reason: item.reason,\n      reason_detail: item.reason_detail,\n      created_at: item.created_at,\n      reviewed_at: item.reviewed_at\n    }))\n\n    totalCount.value = count || 0\n  } catch (e: any) {\n    ElMessage.error('系统错误: ' + e.message)\n  } finally {\n    loading.value = false\n  }\n}\n\nconst handleSearch = () => {\n  currentPage.value = 1\n  loadData()\n}\n\nconst handleRefresh = () => {\n  filterParams.orderNo = ''\n  filterParams.uid = ''\n  currentPage.value = 1\n  loadData()\n}\n\nconst handlePageChange = (page: number) => {\n  currentPage.value = page\n  loadData()\n}\n\nconst formatDate = (dateStr: string) => {\n  if (!dateStr) return '-'\n  const date = new Date(dateStr)\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`\n}\n\nonMounted(() => {\n  loadData()\n})\n</script>\n\n<style scoped>\n.refund-stats-page {\n  padding: 0;\n}\n.page-header {\n  margin-bottom: 24px;\n}\n.page-header h2 {\n  margin: 0;\n  font-size: 28px;\n  color: var(--el-text-color-primary);\n  font-weight: 600;\n}\n.page-header .sub-desc {\n  margin: 8px 0 0;\n  font-size: 14px;\n  color: var(--el-text-color-secondary);\n}\n\n.filter-card {\n  margin-bottom: 24px;\n}\n.filter-container {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.filter-left {\n  display: flex;\n  align-items: center;\n}\n.filter-right {\n  text-align: right;\n}\n.stat-number {\n  font-size: 24px;\n  font-weight: 600;\n  color: #909399;\n}\n</style>\n"],"names":["_ssrRenderAttrs","_mergeProps","_withCtx","_createVNode","_unref","Search","User","_ssrRenderComponent","_withKeys","_createTextVNode","Refresh","_toDisplayString","_ssrGetDirectiveProps","_ssrInterpolate"],"mappings":"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"}